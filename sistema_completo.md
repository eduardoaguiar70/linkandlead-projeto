# Exporta√ß√£o do Sistema
Data: 2026-02-17 11:42:25

## File: ARCHITECTURE.md
```md
# Link&Lead - Arquitetura de Sistema

## üß† M√≥dulo de Intelig√™ncia & Automa√ß√£o (Intelligence Module)

Este documento detalha a arquitetura do "Inbox Inteligente" e "An√°lise de Sentimento", descrevendo a estrutura de dados, fluxos de automa√ß√£o e regras visuais.

### 1. Estrutura de Dados (Novas Colunas)

A tabela `leads` foi enriquecida com campos de intelig√™ncia artificial. O Frontend deve consumir estes dados preferencialmente atrav√©s de JOINs ou Views atualizadas.

| Coluna | Tipo | Descri√ß√£o e Regras |
| :--- | :--- | :--- |
| `trust_score` | `Integer` | **Mede a probabilidade de convers√£o (0-100).**<br>‚Ä¢ **0-20:** Cr√≠tico/Hostil<br>‚Ä¢ **21-40:** Frio/Desinteressado<br>‚Ä¢ **41-60:** Neutro<br>‚Ä¢ **61-80:** Engajado<br>‚Ä¢ **81-100:** Quente (Sinais de compra) |
| `sentiment_reasoning` | `Text` | Explica√ß√£o curta da IA sobre o porqu√™ da nota do Trust Score (ex: "Lead pediu reuni√£o"). |
| `icp_reason` | `Text` | Justificativa da classifica√ß√£o de perfil (A/B/C). |
| `conversation_summary` | `Text` | Breve resumo do contexto da negocia√ß√£o at√© o momento. |
| `ai_suggested_replies` | `JSONB` | Array de objetos para sugest√£o de resposta.<br>**Schema:** `[{ "text":String, "strategy":String }]`<br>**Uso:** `text` vai para editor, `strategy` aparece como label. |
| `ready_for_analysis` | `Boolean` | Flag de controle de fila. `TRUE` = Lead precisa ser processado pela IA. |

### 2. Arquitetura de Automa√ß√£o H√≠brida (Triggers)

O sistema utiliza uma abordagem h√≠brida (Reativa + Proativa) para manter os dados atualizados com baixo custo de tokens.

#### A. Controle de Fila (`ready_for_analysis`)
O campo booleano `ready_for_analysis` na tabela `leads` atua como um "cursor de fila".
- **TRUE:** O lead aguarda processamento da IA.
- **FALSE:** O lead est√° atualizado.

#### B. Workflow 5: O Analista (Processador)
- **Fun√ß√£o:** Consome a fila, analisa o hist√≥rico do chat via OpenAI, gera Insights/Scores e limpa a fila.
- **L√≥gica:** Roda a cada 15/30min ‚Üí Pega leads (`ready=true`) ‚Üí Processa ‚Üí Seta `ready=false`.
- **Output:** Atualiza `trust_score`, `ai_suggested_replies`, etc.

#### C. Workflow 3: Sync Mensagens (Gatilho Reativo)
- **Fun√ß√£o:** Detecta mensagens novas em tempo real.
- **L√≥gica:** Sempre que uma mensagem (sent/received) √© salva no banco, este workflow for√ßa `ready_for_analysis = true` imediatamente.
- **Objetivo:** Garantir resposta r√°pida da IA em conversas ativas.

#### D. Workflow 6: O Vigia (Gatilho Proativo/Time-Decay)
- **Fun√ß√£o:** Re-engajamento de leads esquecidos (Ghosting).
- **L√≥gica:** Roda via Cron (Di√°rio 00:00). Executa query SQL para encontrar leads que:
  1. N√£o est√£o na fila (`ready=false`);
  2. Est√£o em sil√™ncio h√° > 7 dias;
  3. Possuem Score > 30 (Lead qualificado);
  4. Pipeline em aberto (N√£o √© Lost/Won).
- **A√ß√£o:** Seta `ready_for_analysis = true` para que o Workflow 5 gere uma estrat√©gia de recupera√ß√£o na manh√£ seguinte.

### 3. Mapeamento Visual (Frontend - Kanban)

A visualiza√ß√£o de lista deve ser tratada como um Kanban de Prioridades baseada nos dados acima:

#### Colunas Priorit√°rias
1. **üî• Prioridade Alta:** `trust_score > 70` **OU** `Tier A`.
2. **üì© Para Responder:** `last_interaction_type = 'received'` (Ordenado por data).
3. **‚è≥ Aguardando:** `last_interaction_type = 'sent'`.
4. **üí§ Stand-by:** `trust_score < 40` **OU** Sem intera√ß√£o > 7 dias.

#### Componente "Smart Action"
- Deve exibir a sugest√£o de resposta (`item.text`) acompanhada obrigatoriamente da sua estrat√©gia (`item.strategy`) para dar contexto ao usu√°rio antes do envio.

```

## File: eslint.config.js
```javascript
import js from '@eslint/js'
import globals from 'globals'
import reactHooks from 'eslint-plugin-react-hooks'
import reactRefresh from 'eslint-plugin-react-refresh'
import { defineConfig, globalIgnores } from 'eslint/config'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{js,jsx}'],
    extends: [
      js.configs.recommended,
      reactHooks.configs.flat.recommended,
      reactRefresh.configs.vite,
    ],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
      parserOptions: {
        ecmaVersion: 'latest',
        ecmaFeatures: { jsx: true },
        sourceType: 'module',
      },
    },
    rules: {
      'no-unused-vars': ['error', { varsIgnorePattern: '^[A-Z_]' }],
    },
  },
])

```

## File: index.html
```html
<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/png" href="/favicon.png" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Link&Lead System</title>
</head>

<body>
  <div id="root"></div>
  <script type="module" src="/src/main.jsx"></script>
</body>

</html>
```

## File: package.json
```json
{
  "name": "link-lead-system",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "lint": "eslint .",
    "preview": "vite preview"
  },
  "dependencies": {
    "@supabase/supabase-js": "^2.87.1",
    "date-fns": "^4.1.0",
    "lucide-react": "^0.561.0",
    "react": "^19.2.0",
    "react-datepicker": "^9.0.0",
    "react-day-picker": "^9.13.0",
    "react-dom": "^19.2.0",
    "react-markdown": "^10.1.0",
    "react-pdf": "^10.3.0",
    "react-router-dom": "^7.10.1"
  },
  "devDependencies": {
    "@eslint/js": "^9.39.1",
    "@types/react": "^19.2.5",
    "@types/react-dom": "^19.2.3",
    "@vitejs/plugin-react": "^5.1.1",
    "autoprefixer": "^10.4.23",
    "eslint": "^9.39.1",
    "eslint-plugin-react-hooks": "^7.0.1",
    "eslint-plugin-react-refresh": "^0.4.24",
    "globals": "^16.5.0",
    "postcss": "^8.5.6",
    "tailwindcss": "^3.4.17",
    "vite": "^7.2.4"
  }
}

```

## File: postcss.config.js
```javascript
export default {
    plugins: {
        tailwindcss: {},
        autoprefixer: {},
    },
}

```

## File: README.md
```md
# React + Vite

This template provides a minimal setup to get React working in Vite with HMR and some ESLint rules.

Currently, two official plugins are available:

- [@vitejs/plugin-react](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react) uses [Babel](https://babeljs.io/) (or [oxc](https://oxc.rs) when used in [rolldown-vite](https://vite.dev/guide/rolldown)) for Fast Refresh
- [@vitejs/plugin-react-swc](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react-swc) uses [SWC](https://swc.rs/) for Fast Refresh

## React Compiler

The React Compiler is not enabled on this template because of its impact on dev & build performances. To add it, see [this documentation](https://react.dev/learn/react-compiler/installation).

## Expanding the ESLint configuration

If you are developing a production application, we recommend using TypeScript with type-aware lint rules enabled. Check out the [TS template](https://github.com/vitejs/vite/tree/main/packages/create-vite/template-react-ts) for information on how to integrate TypeScript and [`typescript-eslint`](https://typescript-eslint.io) in your project.

```

## File: sistema_completo_para_analise.md
```md
# Exporta√ß√£o do Sistema LinkLead

Data de gera√ß√£o: <built-in function times>

## Arquivo: ARCHITECTURE.md
```md
# Link&Lead - Arquitetura de Sistema

## üß† M√≥dulo de Intelig√™ncia & Automa√ß√£o (Intelligence Module)

Este documento detalha a arquitetura do "Inbox Inteligente" e "An√°lise de Sentimento", descrevendo a estrutura de dados, fluxos de automa√ß√£o e regras visuais.

### 1. Estrutura de Dados (Novas Colunas)

A tabela `leads` foi enriquecida com campos de intelig√™ncia artificial. O Frontend deve consumir estes dados preferencialmente atrav√©s de JOINs ou Views atualizadas.

| Coluna | Tipo | Descri√ß√£o e Regras |
| :--- | :--- | :--- |
| `trust_score` | `Integer` | **Mede a probabilidade de convers√£o (0-100).**<br>‚Ä¢ **0-20:** Cr√≠tico/Hostil<br>‚Ä¢ **21-40:** Frio/Desinteressado<br>‚Ä¢ **41-60:** Neutro<br>‚Ä¢ **61-80:** Engajado<br>‚Ä¢ **81-100:** Quente (Sinais de compra) |
| `sentiment_reasoning` | `Text` | Explica√ß√£o curta da IA sobre o porqu√™ da nota do Trust Score (ex: "Lead pediu reuni√£o"). |
| `icp_reason` | `Text` | Justificativa da classifica√ß√£o de perfil (A/B/C). |
| `conversation_summary` | `Text` | Breve resumo do contexto da negocia√ß√£o at√© o momento. |
| `ai_suggested_replies` | `JSONB` | Array de objetos para sugest√£o de resposta.<br>**Schema:** `[{ "text":String, "strategy":String }]`<br>**Uso:** `text` vai para editor, `strategy` aparece como label. |
| `ready_for_analysis` | `Boolean` | Flag de controle de fila. `TRUE` = Lead precisa ser processado pela IA. |

### 2. Arquitetura de Automa√ß√£o H√≠brida (Triggers)

O sistema utiliza uma abordagem h√≠brida (Reativa + Proativa) para manter os dados atualizados com baixo custo de tokens.

#### A. Controle de Fila (`ready_for_analysis`)
O campo booleano `ready_for_analysis` na tabela `leads` atua como um "cursor de fila".
- **TRUE:** O lead aguarda processamento da IA.
- **FALSE:** O lead est√° atualizado.

#### B. Workflow 5: O Analista (Processador)
- **Fun√ß√£o:** Consome a fila, analisa o hist√≥rico do chat via OpenAI, gera Insights/Scores e limpa a fila.
- **L√≥gica:** Roda a cada 15/30min ‚Üí Pega leads (`ready=true`) ‚Üí Processa ‚Üí Seta `ready=false`.
- **Output:** Atualiza `trust_score`, `ai_suggested_replies`, etc.

#### C. Workflow 3: Sync Mensagens (Gatilho Reativo)
- **Fun√ß√£o:** Detecta mensagens novas em tempo real.
- **L√≥gica:** Sempre que uma mensagem (sent/received) √© salva no banco, este workflow for√ßa `ready_for_analysis = true` imediatamente.
- **Objetivo:** Garantir resposta r√°pida da IA em conversas ativas.

#### D. Workflow 6: O Vigia (Gatilho Proativo/Time-Decay)
- **Fun√ß√£o:** Re-engajamento de leads esquecidos (Ghosting).
- **L√≥gica:** Roda via Cron (Di√°rio 00:00). Executa query SQL para encontrar leads que:
  1. N√£o est√£o na fila (`ready=false`);
  2. Est√£o em sil√™ncio h√° > 7 dias;
  3. Possuem Score > 30 (Lead qualificado);
  4. Pipeline em aberto (N√£o √© Lost/Won).
- **A√ß√£o:** Seta `ready_for_analysis = true` para que o Workflow 5 gere uma estrat√©gia de recupera√ß√£o na manh√£ seguinte.

### 3. Mapeamento Visual (Frontend - Kanban)

A visualiza√ß√£o de lista deve ser tratada como um Kanban de Prioridades baseada nos dados acima:

#### Colunas Priorit√°rias
1. **üî• Prioridade Alta:** `trust_score > 70` **OU** `Tier A`.
2. **üì© Para Responder:** `last_interaction_type = 'received'` (Ordenado por data).
3. **‚è≥ Aguardando:** `last_interaction_type = 'sent'`.
4. **üí§ Stand-by:** `trust_score < 40` **OU** Sem intera√ß√£o > 7 dias.

#### Componente "Smart Action"
- Deve exibir a sugest√£o de resposta (`item.text`) acompanhada obrigatoriamente da sua estrat√©gia (`item.strategy`) para dar contexto ao usu√°rio antes do envio.

```

---

## Arquivo: eslint.config.js
```js
import js from '@eslint/js'
import globals from 'globals'
import reactHooks from 'eslint-plugin-react-hooks'
import reactRefresh from 'eslint-plugin-react-refresh'
import { defineConfig, globalIgnores } from 'eslint/config'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{js,jsx}'],
    extends: [
      js.configs.recommended,
      reactHooks.configs.flat.recommended,
      reactRefresh.configs.vite,
    ],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
      parserOptions: {
        ecmaVersion: 'latest',
        ecmaFeatures: { jsx: true },
        sourceType: 'module',
      },
    },
    rules: {
      'no-unused-vars': ['error', { varsIgnorePattern: '^[A-Z_]' }],
    },
  },
])

```

---

## Arquivo: index.html
```html
<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/png" href="/favicon.png" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Link&Lead System</title>
</head>

<body>
  <div id="root"></div>
  <script type="module" src="/src/main.jsx"></script>
</body>

</html>
```

---

## Arquivo: package.json
```json
{
  "name": "link-lead-system",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "lint": "eslint .",
    "preview": "vite preview"
  },
  "dependencies": {
    "@supabase/supabase-js": "^2.87.1",
    "date-fns": "^4.1.0",
    "lucide-react": "^0.561.0",
    "react": "^19.2.0",
    "react-datepicker": "^9.0.0",
    "react-day-picker": "^9.13.0",
    "react-dom": "^19.2.0",
    "react-markdown": "^10.1.0",
    "react-pdf": "^10.3.0",
    "react-router-dom": "^7.10.1"
  },
  "devDependencies": {
    "@eslint/js": "^9.39.1",
    "@types/react": "^19.2.5",
    "@types/react-dom": "^19.2.3",
    "@vitejs/plugin-react": "^5.1.1",
    "autoprefixer": "^10.4.23",
    "eslint": "^9.39.1",
    "eslint-plugin-react-hooks": "^7.0.1",
    "eslint-plugin-react-refresh": "^0.4.24",
    "globals": "^16.5.0",
    "postcss": "^8.5.6",
    "tailwindcss": "^3.4.17",
    "vite": "^7.2.4"
  }
}

```

---

## Arquivo: postcss.config.js
```js
export default {
    plugins: {
        tailwindcss: {},
        autoprefixer: {},
    },
}

```

---

## Arquivo: README.md
```md
# React + Vite

This template provides a minimal setup to get React working in Vite with HMR and some ESLint rules.

Currently, two official plugins are available:

- [@vitejs/plugin-react](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react) uses [Babel](https://babeljs.io/) (or [oxc](https://oxc.rs) when used in [rolldown-vite](https://vite.dev/guide/rolldown)) for Fast Refresh
- [@vitejs/plugin-react-swc](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react-swc) uses [SWC](https://swc.rs/) for Fast Refresh

## React Compiler

The React Compiler is not enabled on this template because of its impact on dev & build performances. To add it, see [this documentation](https://react.dev/learn/react-compiler/installation).

## Expanding the ESLint configuration

If you are developing a production application, we recommend using TypeScript with type-aware lint rules enabled. Check out the [TS template](https://github.com/vitejs/vite/tree/main/packages/create-vite/template-react-ts) for information on how to integrate TypeScript and [`typescript-eslint`](https://typescript-eslint.io) in your project.

```

---

## Arquivo: tailwind.config.js
```js
/** @type {import('tailwindcss').Config} */
export default {
    content: [
        "./index.html",
        "./src/**/*.{js,ts,jsx,tsx}",
    ],
    theme: {
        extend: {
            colors: {
                obsidian: '#030303',
                charcoal: '#0a0a0a',
                primary: '#ff4d00',
                glass: 'rgba(255, 255, 255, 0.03)',
                'glass-border': 'rgba(255, 255, 255, 0.08)',
                'surface': 'rgba(255, 255, 255, 0.05)',
                'surface-hover': 'rgba(255, 255, 255, 0.08)',
            },
            backdropBlur: {
                xs: '2px',
            },
            boxShadow: {
                glow: '0 0 20px rgba(255, 77, 0, 0.3)',
            }
        },
    },
    plugins: [],
}

```

---

## Arquivo: vercel.json
```json
{
    "rewrites": [
        {
            "source": "/(.*)",
            "destination": "/index.html"
        }
    ]
}
```

---

## Arquivo: vite.config.js
```js
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'
import path from 'path'

// https://vite.dev/config/
export default defineConfig({
  plugins: [react()],
  resolve: {
    alias: {
      "@": path.resolve(__dirname, "./src"),
    },
  },
})

```

---

## Arquivo: src\App.css
```css
/* App.css */
```

---

## Arquivo: src\App.jsx
```jsx
import React, { useState, useEffect } from 'react'
import { supabase } from './services/supabaseClient'
import { BrowserRouter as Router, Routes, Route, Navigate, useLocation } from 'react-router-dom'
import { AuthProvider, useAuth } from './contexts/AuthContext'
import './App.css'

// Pages & Components
import AdminPanel from './pages/AdminPanel'
import ClientPortal from './pages/ClientPortal' // External review
import ClientDashboard from './pages/ClientDashboard' // Old/Legacy portal if any
import PostsPage from './pages/PostsPage'
import PostFeedbackPage from './pages/PostFeedbackPage' // New Feedback Loop
import Login from './pages/Login'
import ClientsPage from './pages/ClientsPage'
import IdeasPage from './pages/IdeasPage'
import SalesHubPage from './pages/SalesHubPage'
import SalesInboxPage from './pages/SalesInboxPage'
import CampaignsPage from './pages/CampaignsPage'
import CampaignLeadsView from './pages/CampaignLeadsView'
import CampaignLeadsPage from './pages/CampaignLeadsPage'
import SystemInfoPage from './pages/SystemInfoPage'
import LinkedInEngagementPage from './pages/LinkedInEngagementPage'
import MissionsPage from './pages/MissionsPage'
import AdminLayout from './components/AdminLayout'

// Client Portal New (Ideas/Insights)
import ClientLoginPage from './pages/ClientLoginPage'
import ClientDashboardLayout from './components/ClientDashboardLayout'
import ClientInsightsPage from './pages/ClientInsightsPage'
import { ClientAuthProvider, useClientAuth } from './contexts/ClientAuthContext'
import { ClientSelectionProvider } from './contexts/ClientSelectionContext'
import { useParams, useNavigate } from 'react-router-dom'

// Magic Link Handler Component
const MagicLinkHandler = () => {
  console.log("ROTA ACIONADA: MagicLinkHandler montado") // DEBUG LIFE CHECK
  const { token } = useParams()
  console.log("Token from URL:", token)

  const { loginWithToken, loading: authLoading, clientUser } = useClientAuth()
  const navigate = useNavigate()
  const [authAttempted, setAuthAttempted] = useState(false)
  const [error, setError] = useState(null)

  useEffect(() => {
    const attemptLogin = async () => {
      if (token && !clientUser) {
        // Ignore "insights" if it accidentally matches (though Router should handle it)
        if (token === 'insights' || token === 'login') return;

        const success = await loginWithToken(token)
        if (!success) {
          setError('Link inv√°lido ou expirado.')
        }
      }
      setAuthAttempted(true)
    }
    attemptLogin()
  }, [token, clientUser, loginWithToken])

  if (authLoading || !authAttempted) {
    return (
      <div className="loading-screen" style={{ display: 'flex', flexDirection: 'column', gap: '1rem', alignItems: 'center', justifyContent: 'center', height: '100vh' }}>
        <div style={{ width: '40px', height: '40px', border: '3px solid #e2e8f0', borderTopColor: '#2563eb', borderRadius: '50%', animation: 'spin 1s linear infinite' }}></div>
        <span>Validando acesso...</span>
        <style>{`@keyframes spin { to { transform: rotate(360deg); } }`}</style>
      </div>
    )
  }

  if (error) {
    return (
      <div style={{ height: '100vh', display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', gap: '1rem', fontFamily: 'sans-serif' }}>
        <h2 style={{ fontSize: '1.5rem', fontWeight: 'bold', color: '#ef4444' }}>Acesso Negado</h2>
        <p style={{ color: '#64748b' }}>{error}</p>
        <button
          onClick={() => navigate('/portal/login')}
          style={{ padding: '0.75rem 1.5rem', background: '#2563eb', color: 'white', border: 'none', borderRadius: '8px', cursor: 'pointer' }}
        >
          Ir para Login
        </button>
      </div>
    )
  }

  if (!clientUser) {
    // Fallback safety
    return <Navigate to="/portal/login" replace />
  }

  // Success: Render the standard Dashboard Layout
  return (
    <ClientDashboardLayout>
      <ClientInsightsPage />
    </ClientDashboardLayout>
  )
}

// Validates authentication and role (Admin)
const ProtectedRoute = ({ children, allowedRoles }) => {
  const { user, profile, loading } = useAuth()
  const location = useLocation()

  // 1. Loading inicial de Auth (Sess√£o)
  if (loading) return <div className="loading-screen">Carregando...</div>

  // 2. Sem usu√°rio -> Login
  if (!user) {
    return <Navigate to="/login" state={{ from: location }} replace />
  }

  // 3. Usu√°rio existe, mas Perfil ainda carregando (Fetch em background)
  // Se a rota exige role, precisamos esperar o profile
  if (allowedRoles && !profile) {
    return <div className="loading-screen">Verificando permiss√µes...</div>
  }

  // 4. Checagem de Role
  if (allowedRoles && profile && !allowedRoles.includes(profile.role)) {
    // Redirect based on role
    if (profile.role === 'client') return <Navigate to="/portal/insights" replace />
    if (profile.role === 'admin') return <Navigate to="/" replace />
    return <Navigate to="/login" replace /> // Fallback
  }

  return children
}

function App() {
  // REMOVED BLOCKING SESSION CHECK here to allow instant render of public routes.
  // AuthProvider will handle its own loading state for protected routes.

  return (
    <Router>
      <Routes>
        {/* === CLIENT PORTAL ROUTES (Decoupled from Global AuthProvider) === */}

        {/* 1. Magic Link Route (Public - handled by ClientInsightsPage logic) */}
        <Route path="/portal/:token" element={
          <ClientAuthProvider>
            <ClientInsightsPage />
          </ClientAuthProvider>
        } />

        {/* 2. Login Page (Public) */}
        <Route path="/portal/login" element={<ClientLoginPage />} />

        {/* 3. Insights Page (Protected by Layout check logic) */}
        <Route path="/portal/insights" element={
          <ClientAuthProvider>
            <ClientDashboardLayout>
              <ClientInsightsPage />
            </ClientDashboardLayout>
          </ClientAuthProvider>
        } />

        {/* === MAIN APP ROUTES (Wrapped in AuthProvider) === */}
        <Route path="/*" element={
          <AuthProvider>
            <Routes>
              {/* Public App Routes */}
              <Route path="/login" element={<Login />} />
              <Route path="/aprovacao" element={<ClientPortal />} />
              <Route path="/post-feedback/:id" element={<PostFeedbackPage />} />

              {/* Admin Protected Routes */}
              <Route element={
                <ProtectedRoute allowedRoles={['admin']}>
                  <ClientSelectionProvider>
                    <AdminLayout />
                  </ClientSelectionProvider>
                </ProtectedRoute>
              }>
                <Route path="/" element={<AdminPanel />} />
                <Route path="/posts" element={<PostsPage />} />
                <Route path="/clients" element={<ClientsPage />} />
                <Route path="/ideas" element={<IdeasPage />} />
                <Route path="/sales" element={<SalesHubPage />} />
                <Route path="/campaigns" element={<CampaignsPage />} />
                <Route path="/campaigns" element={<CampaignsPage />} />
                <Route path="/campaigns/:id" element={<CampaignLeadsView />} />
                <Route path="/campaigns/:campaignId/leads" element={<CampaignLeadsPage />} />
                <Route path="/sales/inbox" element={<SalesInboxPage />} />
                <Route path="/system-info" element={<SystemInfoPage />} />
                <Route path="/engagement" element={<LinkedInEngagementPage />} />
                <Route path="/missions" element={<MissionsPage />} />
              </Route>

              {/* Fallback */}
              <Route path="*" element={<Navigate to="/" replace />} />
            </Routes>
          </AuthProvider>
        } />
      </Routes>
    </Router>
  )
}

export default App

```

---

## Arquivo: src\index.css
```css
/* Google Fonts - Plus Jakarta Sans */
@import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:ital,wght@0,200..800;1,200..800&display=swap');

@tailwind base;
@tailwind components;
@tailwind utilities;

:root {
  /* Brand Typography */
  --font-main: 'Plus Jakarta Sans', system-ui, -apple-system, sans-serif;

  /* Color Palette - OBSIDIAN GLASS THEME */
  --color-bg: #030303;
  /* Deep Void */
  --color-surface: rgba(255, 255, 255, 0.03);
  --color-surface-hover: rgba(255, 255, 255, 0.06);
  --color-glass-border: rgba(255, 255, 255, 0.08);
  --color-glass-shine: rgba(255, 255, 255, 0.15);

  /* Text Colors */
  --color-text-heading: #ffffff;
  /* White */
  --color-text-body: #94a3b8;
  /* Slate 400 */
  --color-text-muted: #64748b;
  /* Slate 500 */
  --color-text-highlight: #e2e8f0;
  /* Slate 200 */

  /* Brand Colors */
  --color-primary: #ff4d00;
  /* Signal Orange */
  --color-primary-glow: rgba(255, 77, 0, 0.4);
  --color-primary-dim: rgba(255, 77, 0, 0.1);

  /* Status Colors */
  --color-success: #10b981;
  --color-success-glow: rgba(16, 185, 129, 0.4);
  --color-danger: #ef4444;
  --color-danger-glow: rgba(239, 68, 68, 0.4);

  /* Spacing & Radii */
  --radius-sm: 4px;
  /* Sharp/Tech */
  --radius-md: 8px;
  /* Standard */
  --radius-lg: 16px;
  /* Floating panels */
  --radius-full: 9999px;

  /* Animation */
  --ease-spring: cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

/* Global Reset & Base */
body {
  margin: 0;
  min-width: 320px;
  min-height: 100vh;
  font-family: var(--font-main);
  background-color: var(--color-bg);
  /* Deep mesh gradient background */
  background-image:
    radial-gradient(circle at 15% 50%, rgba(255, 77, 0, 0.08), transparent 25%),
    radial-gradient(circle at 85% 30%, rgba(77, 77, 255, 0.05), transparent 25%);
  color: var(--color-text-body);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  line-height: 1.6;
  overflow-x: hidden;
}

/* Headings */
h1,
h2,
h3,
h4,
h5,
h6 {
  color: var(--color-text-heading);
  font-weight: 700;
  margin-top: 0;
  letter-spacing: -0.025em;
  /* Tighter for modern look */
}

/* GLASS UTILITIES - The Core of the Design */

.glass-panel {
  background: var(--color-surface);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  border: 1px solid var(--color-glass-border);
  box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
}

.glass-panel-hover:hover {
  background: var(--color-surface-hover);
  border-color: var(--color-glass-shine);
  box-shadow: 0 0 15px rgba(255, 255, 255, 0.05);
  transition: all 0.3s ease;
}

/* Primary Button - Neo-Glass */
.btn-primary {
  position: relative;
  background: var(--color-primary);
  color: white;
  border: none;
  padding: 0.75rem 1.5rem;
  border-radius: var(--radius-sm);
  font-weight: 600;
  font-size: 0.9rem;
  letter-spacing: 0.01em;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  overflow: hidden;
  transition: all 0.2s var(--ease-spring);
  box-shadow: 0 0 20px var(--color-primary-glow);
  z-index: 1;
}

/* Internal glass sheen for button */
.btn-primary::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg,
      transparent,
      rgba(255, 255, 255, 0.2),
      transparent);
  transition: 0.5s;
  z-index: -1;
}

.btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 0 30px var(--color-primary-glow);
}

.btn-primary:hover::before {
  left: 100%;
}

/* Inputs - Glass Style */
input,
select,
textarea {
  font-family: inherit;
  background-color: rgba(255, 255, 255, 0.03);
  /* Extremely transparent */
  border: 1px solid var(--color-glass-border);
  border-radius: var(--radius-sm);
  padding: 0.75rem 1rem;
  font-size: 0.95rem;
  color: var(--color-text-heading);
  transition: all 0.2s;
  outline: none;
  backdrop-filter: blur(4px);
}

input:focus,
select:focus,
textarea:focus {
  background-color: rgba(255, 255, 255, 0.05);
  border-color: var(--color-primary);
  box-shadow: 0 0 0 1px var(--color-primary), 0 0 15px var(--color-primary-dim);
}

input::placeholder {
  color: var(--color-text-muted);
}

/* Scrollbar - Dark & Slim */
::-webkit-scrollbar {
  width: 6px;
  height: 6px;
}

::-webkit-scrollbar-track {
  background: #000;
}

::-webkit-scrollbar-thumb {
  background: #333;
  border-radius: 3px;
}

::-webkit-scrollbar-thumb:hover {
  background: var(--color-primary);
}

/* Utility: Text Gradients */
.text-gradient {
  background: linear-gradient(135deg, #fff 0%, #94a3b8 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.text-gradient-primary {
  background: linear-gradient(135deg, #ff4d00 0%, #ff8800 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

/* Table overrides for Glass look */
/* We'll use these in the component updates, but defining base here helps */

/* Animations */
@keyframes float {
  0% {
    transform: translateY(0px);
  }

  50% {
    transform: translateY(-10px);
  }

  100% {
    transform: translateY(0px);
  }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}
```

---

## Arquivo: src\main.jsx
```jsx
import { StrictMode } from 'react'
import { createRoot } from 'react-dom/client'
import './index.css'
import App from './App.jsx'

console.log('Main starting...')
window.mainLoaded = true

import ErrorBoundary from './components/ErrorBoundary'

import { LanguageProvider } from './contexts/LanguageContext'

createRoot(document.getElementById('root')).render(
  <StrictMode>
    <ErrorBoundary>
      <LanguageProvider>
        <App />
      </LanguageProvider>
    </ErrorBoundary>
  </StrictMode>,
)

```

---

## Arquivo: src\components\AddLeadsModal.jsx
```jsx
import React, { useState } from 'react'

import {
    X,
    Linkedin,
    Users,
    Search,
    ArrowLeft,
    Loader2,
    CheckCircle2,
    Link as LinkIcon
} from 'lucide-react'

const AddLeadsModal = ({ isOpen, onClose, campaignId, clientId, onImportConnections }) => {
    const [view, setView] = useState('selection') // 'selection' | 'post-form'
    const [postUrl, setPostUrl] = useState('')
    const [loading, setLoading] = useState(false)
    const [success, setSuccess] = useState(false)

    if (!isOpen) return null

    const handleBack = () => {
        setView('selection')
        setPostUrl('')
        setSuccess(false)
    }

    const handleImportFromPost = async (e) => {
        e.preventDefault()
        if (!postUrl) return

        setLoading(true)
        try {
            const response = await fetch('https://n8n-n8n-start.kfocge.easypanel.host/webhook/import-post-leads', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    post_url: postUrl,
                    campaign_id: campaignId,
                    client_id: clientId
                })
            })

            if (response.ok) {
                setSuccess(true)
                setTimeout(() => {
                    onClose()
                    // Reset after close
                    setTimeout(() => {
                        setSuccess(false)
                        setPostUrl('')
                        setView('selection')
                    }, 300)
                }, 2000)
            } else {
                console.error('Webhook error')
                // Handle error visual state if needed
            }
        } catch (err) {
            console.error(err)
        } finally {
            setLoading(false)
        }
    }

    // NEW: Trigger History Import (Backend Logic Requirement)
    const triggerHistoryScan = async (leadId, accountId) => {
        try {
            const response = await fetch('https://n8n-n8n-start.kfocge.easypanel.host/webhook/import-history', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    lead_id: leadId,
                    account_id: accountId
                })
            })
            if (!response.ok) {
                // Feedback only on error
                console.error('Falha no trigger de hist√≥rico')
                // If we had a toast system here: toast.error("Erro ao iniciar sincroniza√ß√£o de hist√≥rico")
                alert("Erro ao iniciar sincroniza√ß√£o de hist√≥rico")
            }
        } catch (e) {
            console.error(e)
            alert("Erro ao iniciar sincroniza√ß√£o de hist√≥rico")
        }
    }

    return (
        <div className="fixed inset-0 z-50 flex items-center justify-center bg-slate-900/50 backdrop-blur-sm p-4 animate-fade-in">
            <div className="bg-white w-full max-w-lg rounded-2xl shadow-2xl overflow-hidden animate-scale-in flex flex-col max-h-[90vh]">

                {/* HEADER */}
                <div className="p-6 border-b border-slate-100 flex justify-between items-center">
                    <div className="flex items-center gap-3">
                        {view === 'post-form' && (
                            <button onClick={handleBack} className="p-1 rounded-full hover:bg-gray-100 text-gray-500 transition-colors">
                                <ArrowLeft size={20} />
                            </button>
                        )}
                        <div>
                            <h2 className="text-xl font-bold text-slate-800">Adicionar Leads</h2>
                            <p className="text-sm text-gray-500 mt-0.5">
                                {view === 'selection' ? 'Escolha uma fonte de importa√ß√£o' : 'Importar engajamento de Post'}
                            </p>
                        </div>
                    </div>
                    <button onClick={onClose} className="p-2 rounded-full hover:bg-gray-100 text-gray-400 transition-colors">
                        <X size={20} />
                    </button>
                </div>

                {/* CONTENT */}
                <div className="p-6 overflow-y-auto">
                    {success ? (
                        <div className="flex flex-col items-center justify-center py-10 text-center animate-fade-in">
                            <div className="w-16 h-16 bg-green-100 text-green-600 rounded-full flex items-center justify-center mb-4">
                                <CheckCircle2 size={32} />
                            </div>
                            <h3 className="text-xl font-bold text-slate-800 mb-2">Importa√ß√£o Iniciada!</h3>
                            <p className="text-gray-500 max-w-xs mx-auto">
                                O rob√¥ est√° processando o post. Os leads aparecer√£o na campanha em breve.
                            </p>
                        </div>
                    ) : view === 'selection' ? (
                        <div className="grid gap-4">
                            {/* Option 1: LinkedIn Post */}
                            <button
                                onClick={() => setView('post-form')}
                                className="flex items-center gap-4 p-4 rounded-xl border border-slate-200 hover:border-blue-500 hover:bg-blue-50/30 transition-all text-left group"
                            >
                                <div className="w-12 h-12 rounded-lg bg-blue-100 text-blue-600 flex items-center justify-center shrink-0 group-hover:scale-110 transition-transform">
                                    <Linkedin size={24} />
                                </div>
                                <div>
                                    <h3 className="font-bold text-slate-800 group-hover:text-blue-700">Importar de Post do LinkedIn</h3>
                                    <p className="text-xs text-gray-500 mt-1">Extraia perfis que curtiram ou comentaram em um post viral.</p>
                                </div>
                            </button>

                            {/* Option 2: Connections (Active) */}
                            <button
                                onClick={() => {
                                    if (onImportConnections) onImportConnections()
                                    onClose()
                                }}
                                className="flex items-center gap-4 p-4 rounded-xl border border-slate-200 hover:border-blue-500 hover:bg-blue-50/30 transition-all text-left group w-full"
                            >
                                <div className="w-12 h-12 rounded-lg bg-blue-100 text-blue-600 flex items-center justify-center shrink-0 group-hover:scale-110 transition-transform">
                                    <Users size={24} />
                                </div>
                                <div className="flex-1">
                                    <div className="flex justify-between items-center">
                                        <h3 className="font-bold text-slate-800 group-hover:text-blue-700">Suas Conex√µes</h3>
                                        <span className="text-[10px] font-bold bg-green-100 text-green-600 px-2 py-0.5 rounded-full uppercase">Novo</span>
                                    </div>
                                    <p className="text-xs text-gray-500 mt-1">Importe suas conex√µes recentes para qualifica√ß√£o.</p>
                                </div>
                            </button>

                            {/* Option 3: Search (Disabled) */}
                            <div className="flex items-center gap-4 p-4 rounded-xl border border-slate-200 bg-slate-50/50 opacity-60 cursor-not-allowed">
                                <div className="w-12 h-12 rounded-lg bg-slate-200 text-slate-400 flex items-center justify-center shrink-0">
                                    <Search size={24} />
                                </div>
                                <div className="flex-1">
                                    <div className="flex justify-between items-center">
                                        <h3 className="font-bold text-slate-400">Sales Navigator Search</h3>
                                        <span className="text-[10px] font-bold bg-gray-200 text-gray-500 px-2 py-0.5 rounded-full uppercase">Em Breve</span>
                                    </div>
                                    <p className="text-xs text-gray-400 mt-1">Cole uma URL de pesquisa do Sales Nav.</p>
                                </div>
                            </div>
                        </div>
                    ) : (
                        // FORM VIEW
                        <form onSubmit={handleImportFromPost} className="animate-fade-in">
                            <div className="mb-6">
                                <label className="block text-sm font-bold text-slate-700 mb-2">URL do Post do LinkedIn</label>
                                <div className="relative">
                                    <div className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">
                                        <LinkIcon size={18} />
                                    </div>
                                    <input
                                        autoFocus
                                        type="url"
                                        required
                                        value={postUrl}
                                        onChange={e => setPostUrl(e.target.value)}
                                        placeholder="https://www.linkedin.com/posts/..."
                                        className="w-full pl-10 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-800 focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all font-medium"
                                    />
                                </div>
                                <p className="text-xs text-gray-400 mt-2">
                                    Certifique-se de que o post √© p√∫blico. O rob√¥ ir√° verificar likes e coment√°rios.
                                </p>
                            </div>

                            <button
                                type="submit"
                                disabled={loading || !postUrl}
                                className="w-full py-3.5 rounded-xl bg-blue-600 text-white font-bold hover:bg-blue-700 transition-all shadow-lg shadow-blue-200 disabled:opacity-70 disabled:cursor-not-allowed flex items-center justify-center gap-2"
                            >
                                {loading ? <Loader2 className="animate-spin" size={20} /> : <Linkedin size={20} />}
                                {loading ? 'Importando...' : 'Importar e Analisar'}
                            </button>
                        </form>
                    )}
                </div>
            </div>
        </div>
    )
}

export default AddLeadsModal

```

---

## Arquivo: src\components\AdminLayout.jsx
```jsx
import React, { useState } from 'react'
import { Outlet, Link, useLocation } from 'react-router-dom'
import { useAuth } from '../contexts/AuthContext'
import {
    LayoutDashboard,
    FileText,
    Users,
    LogOut,
    Plus,
    Lightbulb,
    Menu, // Added
    X, // Added
    Briefcase, // Added
    Database, // Added
    ChevronDown,
    ChevronRight,
    MessageCircle, // Added
    Target, // Added
    Crosshair, // Added for Missions
    Info,
    ThumbsUp
} from 'lucide-react'
import CreatePostModal from './CreatePostModal'
import ClientSelector from './ClientSelector'
// Reusing AdminPanel styles as requested/implied for consistency without full CSS refactor
import '../pages/AdminPanel.css'

import { useLanguage } from '../contexts/LanguageContext'

const AdminLayout = () => {
    const { signOut } = useAuth()
    const { t, language, setLanguage } = useLanguage()
    const [showModal, setShowModal] = useState(false)
    const [isSidebarOpen, setSidebarOpen] = useState(false) // Mobile State
    const location = useLocation()

    const isActive = (path) => {
        return location.pathname === path ? 'nav-item active' : 'nav-item'
    }

    const toggleSidebar = () => setSidebarOpen(!isSidebarOpen)

    const [expandedGroups, setExpandedGroups] = useState({
        creative: true,
        sales: true
    })

    const toggleGroup = (group) => {
        setExpandedGroups(prev => ({ ...prev, [group]: !prev[group] }))
    }



    return (
        <div className="dashboard-layout">
            {/* MOBILE HEADER (VISIBLE ONLY ON MOBILE) */}
            <div className="mobile-header">
                <button onClick={toggleSidebar} className="menu-btn">
                    <Menu size={24} />
                </button>
                <img src="/logo-linklead.png" alt="Link&Lead" style={{ height: '32px' }} />
            </div>

            {/* OVERLAY FOR MOBILE */}
            {isSidebarOpen && (
                <div
                    className="sidebar-overlay"
                    onClick={() => setSidebarOpen(false)}
                />
            )}

            {/* GLOBAL SIDEBAR */}
            <aside className={`sidebar ${isSidebarOpen ? 'open' : ''}`}>

                {/* Mobile Close Button */}
                {/* Sidebar Close Button Removed as requested */}


                <div className="logo-area">
                    <img src="/logo-linklead.png" alt="Link&Lead" style={{ maxWidth: '160px', height: 'auto' }} />
                </div>
                <nav className="nav-menu" style={{ gap: '0.5rem' }}>

                    {/* GROUP 1: Gest√£o Criativa */}
                    <div className="nav-group">
                        <button
                            onClick={() => toggleGroup('creative')}
                            style={{
                                width: '100%', display: 'flex', alignItems: 'center', justifyContent: 'space-between',
                                background: 'transparent', border: 'none', color: '#94a3b8',
                                padding: '0.5rem 1.5rem', cursor: 'pointer', fontSize: '0.75rem', fontWeight: '700', letterSpacing: '0.05em'
                            }}
                        >
                            GEST√ÉO CRIATIVA
                            {expandedGroups.creative ? <ChevronDown size={14} /> : <ChevronRight size={14} />}
                        </button>

                        {expandedGroups.creative && (
                            <div className="nav-group-items" style={{ animation: 'fadeIn 0.2s' }}>
                                <Link to="/" className={isActive('/')}>
                                    <LayoutDashboard size={20} /> {t('dashboard')}
                                </Link>
                                <Link to="/posts" className={isActive('/posts')}>
                                    <FileText size={20} /> {t('posts')}
                                </Link>
                                <Link to="/ideas" className={isActive('/ideas')}>
                                    <Lightbulb size={20} /> {t('ideas')}
                                </Link>
                            </div>
                        )}
                    </div>

                    {/* GROUP 2: M√°quina de Vendas */}
                    <div className="nav-group">
                        <button
                            onClick={() => toggleGroup('sales')}
                            style={{
                                width: '100%', display: 'flex', alignItems: 'center', justifyContent: 'space-between',
                                background: 'transparent', border: 'none', color: '#94a3b8',
                                padding: '0.5rem 1.5rem', marginTop: '1rem', cursor: 'pointer', fontSize: '0.75rem', fontWeight: '700', letterSpacing: '0.05em'
                            }}
                        >
                            M√ÅQUINA DE VENDAS
                            {expandedGroups.sales ? <ChevronDown size={14} /> : <ChevronRight size={14} />}
                        </button>

                        {expandedGroups.sales && (
                            <div className="nav-group-items" style={{ animation: 'fadeIn 0.2s' }}>
                                <Link to="/campaigns" className={isActive('/campaigns')}>
                                    <Target size={20} /> Campanhas & Prospec√ß√£o
                                </Link>
                                <Link to="/missions" className={isActive('/missions')}>
                                    <Crosshair size={20} /> Miss√µes Di√°rias
                                </Link>
                                <Link to="/sales/inbox" className={isActive('/sales/inbox')}>
                                    <div style={{ position: 'relative' }}>
                                        <MessageCircle size={20} />
                                    </div>
                                    Inbox Inteligente
                                </Link>
                                <Link to="/clients" className={isActive('/clients')}>
                                    <Users size={20} /> Gerenciar Clientes
                                </Link>
                                <Link to="/engagement" className={isActive('/engagement')}>
                                    <ThumbsUp size={20} /> Engajamento LinkedIn
                                </Link>
                                <Link to="/system-info" className={isActive('/system-info')}>
                                    <Info size={20} /> Informa√ß√µes do Sistema
                                </Link>
                            </div>
                        )}
                    </div>

                    <div style={{ marginTop: 'auto' }}></div>

                    <button
                        type="button"
                        onClick={(e) => {
                            e.preventDefault()
                            signOut()
                        }}
                        className="nav-item"
                        style={{
                            marginTop: '0',
                            background: 'transparent',
                            border: 'none',
                            cursor: 'pointer',
                            color: '#ef4444',
                            width: '100%',
                            justifyContent: 'flex-start',
                            position: 'relative',
                            zIndex: 50
                        }}
                    >
                        <LogOut size={20} /> {t('logout')}
                    </button>
                </nav>
                <div className="sidebar-footer">
                    <button className="btn-new-post" onClick={() => setShowModal(true)}>
                        <Plus size={18} /> {t('newPost')}
                    </button>
                </div>
            </aside>

            {/* MAIN CONTENT AREA */}
            <main className="main-content">
                {/* Sales Context Header */}
                {(location.pathname.startsWith('/sales') || location.pathname.startsWith('/leads') || location.pathname.startsWith('/campaigns') || location.pathname.startsWith('/engagement') || location.pathname.startsWith('/missions')) && (
                    <div className="context-header" style={{
                        padding: '0.75rem 1.5rem',
                        background: 'rgba(255, 255, 255, 0.03)',
                        borderBottom: '1px solid rgba(255, 255, 255, 0.08)',
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'space-between'
                    }}>
                        <div style={{ display: 'flex', alignItems: 'center', gap: '1rem' }}>
                            <span style={{ fontSize: '0.9rem', color: '#5F5F5F' }}>Contexto:</span>
                            <ClientSelector />
                        </div>
                    </div>
                )}
                <Outlet />
            </main>

            {/* GLOBAL CREATE MODAL */}
            {
                showModal && (
                    <CreatePostModal
                        onClose={() => setShowModal(false)}
                        onSuccess={() => {
                            // Ideally we trigger a refresh here. 
                            // Since we are in Layout, we might need a context or simple page reload for now.
                            // Or we pass a context method. 
                            // For simplicity in this request (focus on Layout), I'll just close it.
                            // The user can refresh individual pages or we rely on React Query (not installed) or Realtime (installed).
                            // I'll force a soft reload of the current view if possible, or just close.
                            setShowModal(false)
                            window.location.reload() // Bruteforce refresh to ensure lists update on all pages
                        }}
                    />
                )
            }
        </div >
    )
}

export default AdminLayout

```

---

## Arquivo: src\components\ClientDashboardLayout.jsx
```jsx
import React from 'react'
import { Outlet, Navigate, useLocation } from 'react-router-dom'
import { useClientAuth } from '../contexts/ClientAuthContext'
import { LogOut, LayoutDashboard, HelpCircle } from 'lucide-react'
import SystemStatusHelpModal from './SystemStatusHelpModal'

const ClientDashboardLayout = () => {
    const { clientUser, clientId, loading, signOut, isTokenAuth } = useClientAuth()
    const location = useLocation()
    const [isHelpOpen, setIsHelpOpen] = React.useState(false)

    if (loading) return (
        <div className="min-h-screen flex items-center justify-center bg-obsidian text-white">
            <div className="animate-pulse flex flex-col items-center gap-4">
                <div className="w-12 h-12 rounded-full border-2 border-primary border-t-transparent animate-spin" />
                <span className="text-gray-400 text-sm tracking-wider uppercase">Carregando Portal...</span>
            </div>
        </div>
    )

    if (!clientUser || !clientId) {
        return <Navigate to="/portal/login" state={{ from: location }} replace />
    }

    return (
        <div className="min-h-screen bg-obsidian text-white selection:bg-primary selection:text-white pb-12 relative overflow-x-hidden">

            {/* AMBIENT BACKGROUND GLOWS - FIXED POSITIONS */}
            <div className="fixed top-0 left-0 w-[500px] h-[500px] bg-primary/20 blur-[120px] rounded-full pointer-events-none -translate-x-1/2 -translate-y-1/2 z-0" />
            <div className="fixed bottom-0 right-0 w-[500px] h-[500px] bg-blue-600/10 blur-[120px] rounded-full pointer-events-none translate-x-1/2 translate-y-1/2 z-0" />

            {/* FLOATING HUD HEADER */}
            <header className="sticky top-6 mx-auto max-w-7xl px-6 z-50 mb-12">
                <div className="glass-panel rounded-2xl md:rounded-full px-6 py-4 flex justify-between items-center shadow-glow border border-glass-border/50">
                    <div className="flex items-center gap-4">
                        <div className="w-10 h-10 rounded-full bg-gradient-to-br from-gray-800 to-black flex items-center justify-center border border-glass-border shadow-inner">
                            <img src="/logo-linklead.png" alt="Link&Lead" className="h-6 w-auto opacity-90" />
                        </div>
                        <div className="h-6 w-px bg-glass-border"></div>
                        <span className="text-gray-300 font-medium tracking-wide text-sm uppercase">Portal do Cliente</span>

                    </div>

                    <div className="flex items-center gap-3">
                        <button
                            onClick={() => setIsHelpOpen(true)}
                            className="p-2 rounded-full text-gray-400 hover:text-white hover:bg-white/10 transition-all"
                            title="Ajuda e Status do Sistema"
                        >
                            <HelpCircle size={20} />
                        </button>

                        {!isTokenAuth && (
                            <button
                                onClick={signOut}
                                className="group flex items-center gap-2 text-gray-400 hover:text-red-400 transition-colors text-sm font-medium px-4 py-2 rounded-full hover:bg-white/5 active:scale-95"
                            >
                                <span className="group-hover:translate-x-1 transition-transform">Sair</span>
                                <LogOut size={16} />
                            </button>
                        )}
                    </div>
                </div>
            </header>

            {/* MAIN CONTENT */}
            <main className="relative z-10 mx-auto max-w-7xl px-6 w-full animate-fade-in-up">
                <Outlet />
            </main>
            <SystemStatusHelpModal isOpen={isHelpOpen} onClose={() => setIsHelpOpen(false)} />
        </div>
    )
}

export default ClientDashboardLayout

```

---

## Arquivo: src\components\ClientSelector.jsx
```jsx
import React, { useEffect, useState } from 'react'
import { supabase } from '../services/supabaseClient'
import { useClientSelection } from '../contexts/ClientSelectionContext'
import { Users, ChevronDown } from 'lucide-react'

const ClientSelector = () => {
    const [clients, setClients] = useState([])
    const { selectedClientId, setSelectedClientId } = useClientSelection()
    const [loading, setLoading] = useState(true)

    useEffect(() => {
        const fetchClients = async () => {
            try {
                const { data, error } = await supabase
                    .from('clients')
                    .select('id, name')
                    .order('name', { ascending: true })

                if (error) throw error
                setClients(data || [])
            } catch (err) {
                console.error('Error fetching clients for selector:', err)
            } finally {
                setLoading(false)
            }
        }
        fetchClients()
    }, [])

    const handleChange = (e) => {
        const val = e.target.value
        setSelectedClientId(val ? parseInt(val) : null)
    }

    const getClientName = (c) => c.name || 'Cliente sem nome'

    return (
        <div className="relative flex items-center group">
            <div className="absolute left-3 pointer-events-none text-primary/80 group-hover:text-primary transition-colors">
                <Users size={16} />
            </div>
            <select
                value={selectedClientId || ''}
                onChange={handleChange}
                disabled={loading}
                className="appearance-none bg-white/5 border border-glass-border hover:border-primary/50 text-sm font-medium rounded-lg pl-10 pr-10 py-2.5 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all cursor-pointer min-w-[200px] backdrop-blur-md"
                style={{ color: '#5F5F5F' }}
            >
                <option value="" className="bg-charcoal text-gray-400">Selecione um Cliente...</option>
                {clients.map(client => (
                    <option key={client.id} value={client.id} className="bg-charcoal text-white">
                        {getClientName(client)}
                    </option>
                ))}
            </select>
            <div className="absolute right-3 pointer-events-none text-gray-500 group-hover:text-white transition-colors">
                <ChevronDown size={14} />
            </div>
        </div>
    )
}

export default ClientSelector

```

---

## Arquivo: src\components\ContentCalendar.jsx
```jsx
import React, { useState } from 'react'
import { format } from 'date-fns'
import { ptBR } from 'date-fns/locale'
import { DayPicker } from 'react-day-picker'
import 'react-day-picker/dist/style.css'
import { Clock, CheckCircle2, ArrowRight, X } from 'lucide-react'

const ContentCalendar = ({ posts }) => {
    const [selectedDayPosts, setSelectedDayPosts] = useState(null)

    // Filter posts that have a schedule date
    const scheduledPosts = posts.filter(p => p.data_agendamento)

    // Modifiers Logic
    const hasPostModifier = (date) => {
        return scheduledPosts.some(post => {
            const postDate = new Date(post.data_agendamento)
            return postDate.toDateString() === date.toDateString()
        })
    }

    const modifiers = {
        hasPost: hasPostModifier
    }

    const modifiersStyles = {
        hasPost: {
            fontWeight: 'bold',
            color: '#6366f1'
        }
    }

    // Custom Day Content to show Dots
    const DayContent = (props) => {
        const { date, displayMonth, activeModifiers } = props
        const dayPosts = scheduledPosts.filter(post =>
            new Date(post.data_agendamento).toDateString() === date.toDateString()
        )

        const isPast = date < new Date().setHours(0, 0, 0, 0)

        // Only render content for days in the current month view (standard behavior)
        if (date.getMonth() !== displayMonth.getMonth()) {
            return <span style={{ color: '#cbd5e1' }}>{date.getDate()}</span>
        }

        return (
            <div style={{ position: 'relative', display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', height: '100%', width: '100%' }}>
                <span>{date.getDate()}</span>
                {dayPosts.length > 0 && (
                    <div style={{ display: 'flex', gap: '2px', position: 'absolute', bottom: '4px' }}>
                        {dayPosts.slice(0, 3).map((post, i) => {
                            const postIsPast = new Date(post.data_agendamento) < new Date()
                            return (
                                <div key={i} style={{
                                    width: '4px', height: '4px', borderRadius: '50%',
                                    backgroundColor: postIsPast ? '#22c55e' : '#3b82f6'
                                }} />
                            )
                        })}
                    </div>
                )}
            </div>
        )
    }

    const handleDayClick = (day) => {
        if (!day) return
        const dayPosts = scheduledPosts.filter(post =>
            new Date(post.data_agendamento).toDateString() === day.toDateString()
        )

        if (dayPosts.length > 0) {
            setSelectedDayPosts({ date: day, posts: dayPosts })
        } else {
            setSelectedDayPosts(null)
        }
    }

    const scrollToPost = (postId) => {
        const element = document.getElementById(`post-${postId}`)
        if (element) {
            element.scrollIntoView({ behavior: 'smooth', block: 'center' })
            element.style.transition = 'background 0.5s'
            const originalBg = element.style.background
            element.style.background = '#fef3c7'
            setTimeout(() => {
                element.style.background = originalBg
            }, 1000)
        }
        setSelectedDayPosts(null)
    }

    return (
        <div className="content-calendar-wrapper" style={{
            background: 'white',
            borderRadius: '16px',
            boxShadow: '0 4px 20px rgba(0,0,0,0.05)',
            padding: '1.5rem',
            marginBottom: '2rem',
            border: '1px solid #f1f5f9',
            fontFamily: "'Inter', sans-serif",
            display: 'flex',
            flexDirection: 'column',
            alignItems: 'center'
        }}>

            <style>{`
                .rdp {
                    margin: 0;
                    --rdp-cell-size: 45px;
                    --rdp-accent-color: #6366f1;
                    --rdp-background-color: #e0e7ff; 
                }
                .rdp-day_selected { 
                    background-color: var(--rdp-accent-color); 
                }
                .rdp-day_today { 
                    font-weight: bold; 
                    color: #6366f1;
                }
                .rdp-caption_label {
                    font-size: 1rem;
                    color: #1e293b;
                    font-weight: 700;
                    text-transform: capitalize;
                }
                .rdp-head_cell {
                    color: #94a3b8;
                    font-weight: 600;
                    font-size: 0.85rem;
                }
                @media (max-width: 640px) {
                    .rdp { --rdp-cell-size: 36px; }
                }
            `}</style>

            <h3 style={{ width: '100%', fontSize: '1.1rem', fontWeight: 700, color: '#1e293b', display: 'flex', alignItems: 'center', gap: '8px', marginBottom: '1rem' }}>
                <Clock size={20} color="#6366f1" />
                Calend√°rio de Conte√∫do
            </h3>

            <DayPicker
                mode="single"
                locale={ptBR}
                onDayClick={handleDayClick}
                modifiers={modifiers}
                modifiersStyles={modifiersStyles}
                components={{
                    DayContent: DayContent
                }}
            />

            {/* Popover / Overlay */}
            {selectedDayPosts && (
                <>
                    <div
                        style={{ position: 'fixed', inset: 0, zIndex: 9999, background: 'rgba(0,0,0,0.2)' }}
                        onClick={() => setSelectedDayPosts(null)}
                    ></div>
                    <div className="calendar-popover" style={{
                        position: 'fixed',
                        top: '50%', left: '50%', transform: 'translate(-50%, -50%)',
                        zIndex: 10000,
                        background: 'white',
                        padding: '1.5rem',
                        borderRadius: '16px',
                        boxShadow: '0 20px 50px rgba(0,0,0,0.2)',
                        width: '320px',
                        maxWidth: '90%',
                        border: '1px solid #e2e8f0',
                        animation: 'fadeIn 0.2s ease-out'
                    }}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1rem' }}>
                            <div>
                                <h4 style={{ margin: 0, fontWeight: 700, color: '#1e293b', fontSize: '1.1rem' }}>
                                    {format(selectedDayPosts.date, "EEEE, d 'de' MMMM", { locale: ptBR })}
                                </h4>
                                <span style={{ fontSize: '0.85rem', color: '#64748b' }}>
                                    {selectedDayPosts.posts.length} {selectedDayPosts.posts.length === 1 ? 'postagem' : 'postagens'}
                                </span>
                            </div>
                            <button onClick={() => setSelectedDayPosts(null)} style={{ background: 'none', border: 'none', cursor: 'pointer', color: '#94a3b8' }}>
                                <X size={20} />
                            </button>
                        </div>

                        <div style={{ display: 'flex', flexDirection: 'column', gap: '1rem', maxHeight: '300px', overflowY: 'auto' }}>
                            {selectedDayPosts.posts.map(post => {
                                const isPast = new Date(post.data_agendamento) < new Date()
                                return (
                                    <div key={post.id} style={{ padding: '1rem', background: '#f8fafc', borderRadius: '12px', border: '1px solid #f1f5f9' }}>
                                        <div style={{ fontSize: '0.9rem', fontWeight: 700, color: '#334155', marginBottom: '4px' }}>
                                            {post.tema || post.corpo_post?.substring(0, 30) + "..." || "Post sem t√≠tulo"}
                                        </div>
                                        <div style={{ display: 'flex', alignItems: 'center', gap: '6px', fontSize: '0.75rem', marginBottom: '12px' }}>
                                            {isPast ? (
                                                <span style={{ color: '#16a34a', display: 'flex', alignItems: 'center', gap: '4px', background: '#dcfce7', padding: '2px 8px', borderRadius: '12px', fontWeight: 600 }}>
                                                    <CheckCircle2 size={12} /> Publicado as {format(new Date(post.data_agendamento), 'HH:mm')}
                                                </span>
                                            ) : (
                                                <span style={{ color: '#3b82f6', display: 'flex', alignItems: 'center', gap: '4px', background: '#dbeafe', padding: '2px 8px', borderRadius: '12px', fontWeight: 600 }}>
                                                    <Clock size={12} /> Agendado para {format(new Date(post.data_agendamento), 'HH:mm')}
                                                </span>
                                            )}
                                        </div>
                                        <button
                                            onClick={() => scrollToPost(post.id)}
                                            style={{
                                                width: '100%',
                                                padding: '8px',
                                                border: '1px solid #cbd5e1',
                                                borderRadius: '8px',
                                                background: 'white',
                                                color: '#0f172a',
                                                fontSize: '0.85rem',
                                                cursor: 'pointer',
                                                display: 'flex',
                                                alignItems: 'center',
                                                justifyContent: 'center',
                                                gap: '6px',
                                                fontWeight: 600,
                                                transition: 'all 0.2s'
                                            }}
                                            onMouseOver={(e) => e.currentTarget.style.background = '#f1f5f9'}
                                            onMouseOut={(e) => e.currentTarget.style.background = 'white'}
                                        >
                                            Visualizar <ArrowRight size={14} />
                                        </button>
                                    </div>
                                )
                            })}
                        </div>
                    </div>
                </>
            )}
        </div>
    )
}

export default ContentCalendar

```

---

## Arquivo: src\components\CreatePostModal.css
```css
/* 
  DEPRECATED: Styles have been moved to Tailwind classes in CreatePostModal.jsx
  as part of the Obsidian Glass visual overhaul.
*/
```

---

## Arquivo: src\components\CreatePostModal.jsx
```jsx
import React, { useState, useEffect } from 'react'
import { generateContent } from '../services/api'
import { supabase } from '../services/supabaseClient'
import { X, Loader2, Building2, Briefcase, Sparkles, User, AlertCircle, Image as ImageIcon, UploadCloud, FileText, CheckCircle2 } from 'lucide-react'

const CreatePostModal = ({ onClose, onSuccess }) => {
    // Clients List
    const [clients, setClients] = useState([])
    const [loadingClients, setLoadingClients] = useState(true)

    // Wizard State
    const [step, setStep] = useState(1) // 1: Briefing, 2: Review, 3: Finalize

    // Form State
    const [selectedClientId, setSelectedClientId] = useState('') // This holds the UUID
    const [clienteName, setClienteName] = useState('')
    const [selectedClientData, setSelectedClientData] = useState(null)

    const [tema, setTema] = useState('')
    const [publico, setPublico] = useState('')

    // Content State
    const [generatedText, setGeneratedText] = useState('')
    const [currentPostId, setCurrentPostId] = useState(null)
    const [selectedFiles, setSelectedFiles] = useState([])

    // Process State
    const [loading, setLoading] = useState(false)
    const [errorMsg, setErrorMsg] = useState(null)

    // New Tab State
    const [activeTab, setActiveTab] = useState('ai') // 'ai' | 'manual'

    // Fetch clients on mount
    useEffect(() => {
        const fetchClients = async () => {
            try {
                const { data, error } = await supabase
                    .from('clients')
                    .select('*')
                    .order('name')

                if (error) throw error
                const validClients = (data || []).filter(c => c.name)
                setClients(validClients)
            } catch (err) {
                console.error('Erro ao buscar clientes:', err)
            } finally {
                setLoadingClients(false)
            }
        }
        fetchClients()
    }, [])

    const handleClientChange = (e) => {
        const uuid = e.target.value
        setSelectedClientId(uuid)

        const clientData = clients.find(c => String(c.id) === uuid)
        if (clientData) {
            setClienteName(clientData.name)
            setSelectedClientData(clientData)
        } else {
            setClienteName('')
            setSelectedClientData(null)
        }
    }

    // --- STEP 1: GENERATE DRAFT ---
    const handleGenerateDraft = async (e) => {
        e.preventDefault()
        if (!selectedClientId) return alert("Por favor, selecione um cliente.")
        if (!tema || !publico) return

        setLoading(true)
        setErrorMsg(null)

        try {
            const data = await generateContent(clienteName, tema, publico, selectedClientData, null)

            let text = ""
            if (typeof data === 'string') text = data
            else if (data.text) text = data.text
            else if (data.content) text = data.content
            else if (data.response) text = data.response
            else if (data.transcription) text = data.transcription
            else if (data.corpo_post) text = data.corpo_post
            else text = JSON.stringify(data, null, 2)

            setGeneratedText(text.replace(/^"|"$/g, '').replace(/\\n/g, '\n'))

            if (data.id) setCurrentPostId(data.id)
            else if (data.record_id) setCurrentPostId(data.record_id)

            setStep(2)
        } catch (err) {
            console.error(err)
            setErrorMsg('Falha ao gerar rascunho. Tente novamente.')
        } finally {
            setLoading(false)
        }
    }

    // --- FINAL SAVE (Shared Logic) ---
    const performSave = async (isManual = false) => {
        if (!selectedClientId) {
            alert("Erro: ID do cliente n√£o identificado")
            return
        }

        setLoading(true)
        setErrorMsg(null)

        try {
            // Validate client name for manual flow
            let finalClientName = clienteName
            if (isManual && !finalClientName) {
                const { data: clientData } = await supabase
                    .from('clients')
                    .select('name')
                    .eq('id', selectedClientId)
                    .single()
                finalClientName = clientData?.name
            }

            if (!finalClientName) throw new Error("Nome do cliente n√£o encontrado")

            // Upload Images
            let finalImageUrls = []
            if (selectedFiles.length > 0) {
                const uploadPromises = selectedFiles.map(async (file) => {
                    const fileExt = file.name.split('.').pop()
                    const sanitizedName = file.name.replace(/[^a-zA-Z0-9]/g, '_')
                    const fileName = `${Date.now()}_${Math.random().toString(36).substring(7)}_${sanitizedName}.${fileExt}`

                    const { error: uploadError } = await supabase.storage
                        .from('post-images')
                        .upload(fileName, file)

                    if (uploadError) throw uploadError

                    const { data: publicUrlData } = supabase.storage
                        .from('post-images')
                        .getPublicUrl(fileName)

                    return publicUrlData.publicUrl
                })
                finalImageUrls = await Promise.all(uploadPromises)
            }

            // Payload
            const payload = {
                id_client: selectedClientId,
                nome_cliente: finalClientName,
                tema: tema || 'Post Manual',
                publico: publico || 'Geral',
                corpo_post: generatedText,
                sugestao_imagem: finalImageUrls,
                status: 'waiting_approval'
            }

            // Insert or Update
            if (currentPostId && !isManual) {
                const { error } = await supabase.from('tabela_projetofred1').update(payload).eq('id', currentPostId)
                if (error) throw error
            } else {
                const { error, data } = await supabase.from('tabela_projetofred1').insert([payload]).select()
                if (error) throw error
                // Basic check
                if (data && data[0] && !data[0].nome_cliente) {
                    alert("Aviso: Banco de dados pode ter ignorado o nome do cliente.")
                }
            }

            alert("Post salvo com sucesso!")
            if (onSuccess) onSuccess()
            else onClose()

        } catch (err) {
            console.error("Save Error:", err)
            setErrorMsg("Erro ao salvar post: " + err.message)
        } finally {
            setLoading(false)
        }
    }

    const handleFileChange = (e) => {
        if (e.target.files && e.target.files.length > 0) {
            const newFiles = Array.from(e.target.files)
            const validFiles = newFiles.filter(file => {
                if (file.size > 50 * 1024 * 1024) {
                    alert(`Arquivo ${file.name} excede 50MB.`)
                    return false
                }
                return true
            })
            if (validFiles.length > 0) setSelectedFiles(prev => [...prev, ...validFiles])
        }
    }

    // --- UI COMPONENTS ---
    const ProgressBar = () => (
        <div className="flex items-center gap-2 mb-8">
            {[1, 2, 3].map(s => (
                <div key={s} className="flex-1 h-1 rounded-full overflow-hidden bg-white/10">
                    <div
                        className={`h-full transition-all duration-300 ${s <= step ? 'bg-primary' : 'bg-transparent'}`}
                        style={{ width: s <= step ? '100%' : '0%' }}
                    />
                </div>
            ))}
            <span className="text-xs font-semibold text-gray-500 uppercase tracking-wider ml-2">Passo {step}/3</span>
        </div>
    )

    const ModernInput = ({ label, icon: Icon, ...props }) => (
        <div className="mb-6">
            <label className="block text-sm font-medium text-gray-400 mb-2 ml-1">{label}</label>
            <div className="relative group">
                <div className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 group-focus-within:text-primary transition-colors pointer-events-none">
                    {Icon && <Icon size={18} />}
                </div>
                {props.type === 'textarea' ? (
                    <textarea
                        {...props}
                        className="w-full bg-white/5 border border-glass-border rounded-xl pl-10 pr-4 py-3 text-white placeholder-gray-600 focus:outline-none focus:border-primary/50 focus:ring-1 focus:ring-primary/50 transition-all min-h-[100px] resize-y"
                    />
                ) : (
                    <input
                        {...props}
                        className="w-full bg-white/5 border border-glass-border rounded-xl pl-10 pr-4 py-3 text-white placeholder-gray-600 focus:outline-none focus:border-primary/50 focus:ring-1 focus:ring-primary/50 transition-all"
                    />
                )}
            </div>
        </div>
    )

    // --- RENDER ---
    return (
        <div className="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4 pt-16" onClick={(e) => e.target === e.currentTarget && onClose()}>
            <div className="bg-[#0f0f0f] border border-glass-border w-full max-w-2xl max-h-[85vh] rounded-2xl shadow-2xl flex flex-col overflow-hidden animate-fade-in-up">

                {/* HEADER */}
                <div className="p-6 border-b border-glass-border flex justify-between items-center bg-white/[0.02]">
                    <div>
                        <h2 className="text-xl font-bold text-white mb-0.5">Novo Conte√∫do B2B</h2>
                        <p className="text-xs font-medium text-transparent bg-clip-text bg-gradient-to-r from-primary to-orange-400 uppercase tracking-wider">Criar Novo Post</p>
                    </div>
                    <button onClick={onClose} className="p-2 rounded-full hover:bg-white/10 text-gray-400 hover:text-white transition-colors">
                        <X size={20} />
                    </button>
                </div>

                {/* TABS */}
                <div className="flex border-b border-glass-border bg-black/20">
                    <button
                        onClick={() => setActiveTab('ai')}
                        className={`flex-1 py-4 text-sm font-medium flex items-center justify-center gap-2 transition-colors relative ${activeTab === 'ai' ? 'text-white' : 'text-gray-500 hover:text-gray-300'}`}
                    >
                        <Sparkles size={16} className={activeTab === 'ai' ? 'text-primary' : ''} />
                        Criar com IA
                        {activeTab === 'ai' && <div className="absolute bottom-0 left-0 right-0 h-0.5 bg-primary shadow-[0_0_10px_rgba(255,77,0,0.5)]" />}
                    </button>
                    <button
                        onClick={() => setActiveTab('manual')}
                        className={`flex-1 py-4 text-sm font-medium flex items-center justify-center gap-2 transition-colors relative ${activeTab === 'manual' ? 'text-white' : 'text-gray-500 hover:text-gray-300'}`}
                    >
                        <FileText size={16} className={activeTab === 'manual' ? 'text-primary' : ''} />
                        Manual
                        {activeTab === 'manual' && <div className="absolute bottom-0 left-0 right-0 h-0.5 bg-primary shadow-[0_0_10px_rgba(255,77,0,0.5)]" />}
                    </button>
                </div>

                {/* BODY */}
                <div className="flex-1 overflow-y-auto p-6 custom-scrollbar">

                    {/* --- AI MODE --- */}
                    {activeTab === 'ai' && (
                        <>
                            <ProgressBar />

                            {/* STEP 1 */}
                            {step === 1 && (
                                <form onSubmit={handleGenerateDraft}>
                                    <div className="mb-6">
                                        <label className="block text-sm font-medium text-gray-400 mb-2 ml-1">Selecione o Cliente</label>
                                        <div className="relative">
                                            <div className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 pointer-events-none"><Building2 size={18} /></div>
                                            <select
                                                value={selectedClientId}
                                                onChange={handleClientChange}
                                                className="w-full bg-white/5 border border-glass-border rounded-xl pl-10 pr-4 py-3 text-white appearance-none focus:outline-none focus:border-primary/50 focus:ring-1 focus:ring-primary/50 transition-all"
                                                required
                                            >
                                                <option value="" className="bg-charcoal text-gray-500">Selecione...</option>
                                                {clients.map(c => <option key={c.id} value={c.id} className="bg-charcoal text-white">{c.name}</option>)}
                                            </select>
                                        </div>
                                    </div>

                                    <ModernInput
                                        label="Tema Central"
                                        icon={Briefcase}
                                        type="textarea"
                                        placeholder="Sobre o que vamos falar hoje?"
                                        value={tema} onChange={e => setTema(e.target.value)} required
                                    />

                                    <ModernInput
                                        label="P√∫blico-Alvo"
                                        icon={User}
                                        placeholder="CEO, Marketing Managers..."
                                        value={publico} onChange={e => setPublico(e.target.value)} required
                                    />

                                    {errorMsg && <div className="mb-4 p-3 bg-red-500/10 border border-red-500/20 rounded-lg text-red-400 text-sm flex items-center gap-2"><AlertCircle size={16} /> {errorMsg}</div>}

                                    <div className="flex gap-4 pt-4">
                                        <button type="button" onClick={onClose} className="flex-1 px-4 py-3 rounded-xl border border-glass-border text-gray-400 hover:bg-white/5 hover:text-white transition-all font-medium">Cancelar</button>
                                        <button type="submit" disabled={loading} className="flex-[2] btn-primary">
                                            {loading ? <Loader2 className="animate-spin" /> : <><Sparkles size={18} /> Gerar Rascunho</>}
                                        </button>
                                    </div>
                                </form>
                            )}

                            {/* STEP 2 */}
                            {step === 2 && (
                                <div className="animate-fade-in-up">
                                    <label className="block text-sm font-medium text-gray-400 mb-2 ml-1">Rascunho Gerado (Edite √† vontade):</label>
                                    <textarea
                                        value={generatedText}
                                        onChange={e => setGeneratedText(e.target.value)}
                                        className="w-full bg-white/5 border border-glass-border rounded-xl p-4 text-gray-200 focus:outline-none focus:border-primary/50 focus:ring-1 focus:ring-primary/50 transition-all min-h-[300px] leading-relaxed resize-y mb-6 font-mono text-sm"
                                    />

                                    <div className="flex gap-4">
                                        <button onClick={() => setStep(1)} className="flex-1 px-4 py-3 rounded-xl border border-glass-border text-gray-400 hover:bg-white/5 hover:text-white transition-all font-medium">Voltar e Ajustar</button>
                                        <button onClick={() => setStep(3)} className="flex-[2] btn-primary">
                                            Aprovar Texto <CheckCircle2 size={18} />
                                        </button>
                                    </div>
                                </div>
                            )}

                            {/* STEP 3 */}
                            {step === 3 && (
                                <div className="animate-fade-in-up">
                                    <FormMediaUpload selectedFiles={selectedFiles} setSelectedFiles={setSelectedFiles} handleFileChange={handleFileChange} />

                                    <div className="bg-white/5 border border-glass-border rounded-xl p-4 mb-6">
                                        <h4 className="text-sm font-bold text-gray-300 mb-2 uppercase tracking-wider">Resumo</h4>
                                        <div className="text-sm text-gray-400 space-y-1">
                                            <p><span className="text-gray-500">Cliente:</span> {clienteName}</p>
                                            <p><span className="text-gray-500">Tema:</span> {tema}</p>
                                        </div>
                                    </div>

                                    {errorMsg && <div className="mb-4 p-3 bg-red-500/10 border border-red-500/20 rounded-lg text-red-400 text-sm flex items-center gap-2"><AlertCircle size={16} /> {errorMsg}</div>}

                                    <div className="flex gap-4">
                                        <button onClick={() => setStep(2)} className="flex-1 px-4 py-3 rounded-xl border border-glass-border text-gray-400 hover:bg-white/5 hover:text-white transition-all font-medium">Voltar</button>
                                        <button onClick={() => performSave(false)} disabled={loading} className="flex-[2] btn-primary">
                                            {loading ? <Loader2 className="animate-spin" /> : "üíæ Salvar Post Final"}
                                        </button>
                                    </div>
                                </div>
                            )}
                        </>
                    )}

                    {/* --- MANUAL MODE --- */}
                    {activeTab === 'manual' && (
                        <form onSubmit={(e) => { e.preventDefault(); performSave(true); }} className="animate-fade-in-up">
                            <div className="mb-6">
                                <label className="block text-sm font-medium text-gray-400 mb-2 ml-1">Selecione o Cliente</label>
                                <div className="relative">
                                    <div className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 pointer-events-none"><Building2 size={18} /></div>
                                    <select
                                        value={selectedClientId}
                                        onChange={handleClientChange}
                                        className="w-full bg-white/5 border border-glass-border rounded-xl pl-10 pr-4 py-3 text-white appearance-none focus:outline-none focus:border-primary/50 focus:ring-1 focus:ring-primary/50 transition-all"
                                        required
                                    >
                                        <option value="" className="bg-charcoal text-gray-500">Selecione...</option>
                                        {clients.map(c => <option key={c.id} value={c.id} className="bg-charcoal text-white">{c.name}</option>)}
                                    </select>
                                </div>
                            </div>

                            <ModernInput
                                label="T√≠tulo / Tema"
                                icon={Briefcase}
                                placeholder="Ex: Campanha de Ver√£o"
                                value={tema} onChange={e => setTema(e.target.value)}
                            />

                            <ModernInput
                                label="Texto do Post"
                                icon={FileText}
                                type="textarea"
                                placeholder="Escreva o conte√∫do aqui..."
                                value={generatedText} onChange={e => setGeneratedText(e.target.value)} required
                            />

                            <FormMediaUpload selectedFiles={selectedFiles} setSelectedFiles={setSelectedFiles} handleFileChange={handleFileChange} />

                            {errorMsg && <div className="mb-4 p-3 bg-red-500/10 border border-red-500/20 rounded-lg text-red-400 text-sm flex items-center gap-2"><AlertCircle size={16} /> {errorMsg}</div>}

                            <div className="flex gap-4 pt-4">
                                <button type="button" onClick={onClose} className="flex-1 px-4 py-3 rounded-xl border border-glass-border text-gray-400 hover:bg-white/5 hover:text-white transition-all font-medium">Cancelar</button>
                                <button type="submit" disabled={loading} className="flex-[2] btn-primary">
                                    {loading ? <Loader2 className="animate-spin" /> : "üíæ Salvar Manualmente"}
                                </button>
                            </div>
                        </form>
                    )}

                </div>
            </div>
        </div>
    )
}

// Sub-component for Media Upload to keep logic clean
const FormMediaUpload = ({ selectedFiles, setSelectedFiles, handleFileChange }) => (
    <div className="mb-8">
        <label className="block text-sm font-medium text-gray-400 mb-2 ml-1">M√≠dia (Imagens/V√≠deo)</label>
        <div className={`border-2 border-dashed rounded-xl p-4 transition-all ${selectedFiles.length > 0 ? 'border-primary/50 bg-primary/5' : 'border-glass-border hover:border-gray-500 hover:bg-white/5'}`}>
            <input type="file" multiple accept="image/*,video/*,application/pdf" onChange={handleFileChange} className="hidden" id="file-upload" />

            {selectedFiles.length === 0 ? (
                <label htmlFor="file-upload" className="flex flex-col items-center justify-center h-24 cursor-pointer gap-2">
                    <UploadCloud className="text-gray-500" size={24} />
                    <span className="text-sm font-medium text-gray-400">Clique para selecionar arquivos</span>
                </label>
            ) : (
                <div>
                    <div className="flex justify-between items-center mb-3 px-1">
                        <span className="text-xs font-semibold text-gray-400 uppercase">{selectedFiles.length} arquivos</span>
                        <button type="button" onClick={() => setSelectedFiles([])} className="text-xs text-red-400 hover:text-red-300 font-medium">Limpar Tudo</button>
                    </div>
                    <div className="grid grid-cols-4 gap-2">
                        {selectedFiles.map((file, i) => (
                            <div key={i} className="aspect-square rounded-lg bg-black/40 border border-glass-border overflow-hidden relative flex items-center justify-center group">
                                {file.type.includes('pdf') ? <FileText className="text-red-500" /> :
                                    <img src={URL.createObjectURL(file)} className="w-full h-full object-cover opacity-80 group-hover:opacity-100 transition-opacity" />
                                }
                            </div>
                        ))}
                        <label htmlFor="file-upload" className="aspect-square rounded-lg border border-glass-border flex items-center justify-center cursor-pointer hover:bg-white/5 text-gray-500 hover:text-white transition-colors">
                            <span className="text-2xl">+</span>
                        </label>
                    </div>
                </div>
            )}
        </div>
    </div>
)

export default CreatePostModal

```

---

## Arquivo: src\components\EditPostModal.jsx
```jsx
import React, { useState } from 'react'
import { supabase } from '../services/supabaseClient'
import { X, Loader2, Save, Image as ImageIcon, UploadCloud, Calendar as CalendarIcon } from 'lucide-react'
import DatePicker, { registerLocale } from 'react-datepicker'
import "react-datepicker/dist/react-datepicker.css"
import ptBR from 'date-fns/locale/pt-BR'

registerLocale('pt-BR', ptBR)

const EditPostModal = ({ post, onClose, onSuccess }) => {
    const [theme, setTheme] = useState(post.tema || '')

    // Helper to format DB timestamp (UTC) to datetime-local (Local)
    // This helper is no longer needed if scheduleDate is stored as a Date object
    // const formatDateForInput = (isoString) => {
    //     if (!isoString) return ''
    //     const date = new Date(isoString)
    //     const offset = date.getTimezoneOffset() * 60000
    //     const localDate = new Date(date.getTime() - offset)
    //     return localDate.toISOString().slice(0, 16)
    // }

    // Initialize directly with Date object or null
    const [scheduleDate, setScheduleDate] = useState(post.data_agendamento ? new Date(post.data_agendamento) : null)
    const [text, setText] = useState(post.corpo_post || '')
    // Initialize as array (handle legacy string or null)
    const initialImages = Array.isArray(post.sugestao_imagem)
        ? post.sugestao_imagem
        : post.sugestao_imagem
            ? [post.sugestao_imagem]
            : []

    const [currentImageUrls, setCurrentImageUrls] = useState(initialImages)
    const [newImageFiles, setNewImageFiles] = useState([])

    const [loading, setLoading] = useState(false)
    const [errorMsg, setErrorMsg] = useState(null)

    const handleFileChange = (e) => {
        if (e.target.files && e.target.files.length > 0) {
            const files = Array.from(e.target.files)

            // Validate basic constraints
            const validFiles = files.filter(file => {
                if (!file.type.startsWith('image/')) {
                    alert(`Arquivo ${file.name} n√£o √© uma imagem.`)
                    return false
                }
                if (file.size > 50 * 1024 * 1024) {
                    alert(`Arquivo ${file.name} excede o limite de 50MB.`)
                    return false
                }
                return true
            })

            setNewImageFiles(validFiles)
        }
    }

    const handleSave = async (e) => {
        e.preventDefault()
        setLoading(true)
        setErrorMsg(null)

        try {
            let finalImageUrls = currentImageUrls

            // 1. Upload new images if selected (Replacing old)
            if (newImageFiles.length > 0) {
                const uploadPromises = newImageFiles.map(async (file) => {
                    const fileExt = file.name.split('.').pop()
                    const sanitizedName = file.name.replace(/[^a-zA-Z0-9]/g, '_')
                    const fileName = `${Date.now()}_${Math.random().toString(36).substring(7)}_${sanitizedName}.${fileExt}`

                    const { error: uploadError } = await supabase.storage
                        .from('post-images')
                        .upload(fileName, file)

                    if (uploadError) throw uploadError

                    const { data: publicUrlData } = supabase.storage
                        .from('post-images')
                        .getPublicUrl(fileName)

                    return publicUrlData.publicUrl
                })

                finalImageUrls = await Promise.all(uploadPromises)
            }

            // 2. Update DB
            const updates = {
                tema: theme,
                corpo_post: text,
                sugestao_imagem: finalImageUrls, // Save as Array
                data_agendamento: scheduleDate ? scheduleDate.toISOString() : null // Date Object to ISO
            }

            // REVIS√ÉO LOGIC: If editing a post with feedback, reset status to waiting_approval
            if ((post.status === 'revis√£o' || post.status === 'changes_requested') && post.feedback_cliente) {
                updates.status = 'waiting_approval'
            }

            const { error: dbError } = await supabase
                .from('tabela_projetofred1')
                .update(updates)
                .eq('id', post.id)

            if (dbError) throw dbError

            alert("Post atualizado com sucesso!")
            onSuccess() // Should trigger refresh
            onClose()

        } catch (err) {
            console.error(err)
            setErrorMsg("Erro ao atualizar: " + err.message)
        } finally {
            setLoading(false)
        }
    }

    return (
        <div style={{
            position: 'fixed', top: 0, left: 0, right: 0, bottom: 0,
            background: 'rgba(0,0,0,0.5)', display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 1100
        }} onClick={(e) => {
            if (e.target === e.currentTarget) onClose()
        }}>
            <div className="modern-modal" style={{ maxWidth: '700px', width: '90%', maxHeight: '90vh', overflowY: 'auto' }}>
                <div className="modal-header">
                    <div className="header-title">
                        <h2>Editar Post #{post.id}</h2>
                        <span className="subtitle">{post.tema}</span>
                    </div>
                    <button className="close-btn" onClick={onClose} aria-label="Fechar">
                        <X size={24} />
                    </button>
                </div>

                <div className="modal-body" style={{ padding: '2rem' }}>

                    {/* FEEDBACK ALERT */}
                    {(post.status === 'revis√£o' || post.status === 'changes_requested') && post.feedback_cliente && (
                        <div style={{
                            background: '#fef2f2',
                            border: '1px solid #fee2e2',
                            borderRadius: '8px',
                            padding: '1rem',
                            marginBottom: '1.5rem',
                            display: 'flex',
                            gap: '0.75rem',
                            alignItems: 'start'
                        }}>
                            <AlertCircle color="#ef4444" size={20} style={{ marginTop: '2px', flexShrink: 0 }} />
                            <div>
                                <h4 style={{ color: '#991b1b', fontWeight: 700, fontSize: '0.95rem', marginBottom: '4px' }}>
                                    üì¢ Aten√ß√£o: Cliente solicitou altera√ß√µes
                                </h4>
                                <p style={{ color: '#7f1d1d', fontSize: '0.9rem', lineHeight: '1.5' }}>
                                    "{post.feedback_cliente}"
                                </p>
                            </div>
                        </div>
                    )}

                    <form onSubmit={handleSave}>
                        {/* THEME EDITOR */}
                        <div className="modern-form-group">
                            <label className="input-label">Tema / T√≠tulo Interno</label>
                            <input
                                type="text"
                                value={theme}
                                onChange={e => setTheme(e.target.value)}
                                className="modern-input"
                                placeholder="T√≠tulo do post..."
                            />
                        </div>

                        {/* SCHEDULE DATE (PREMIUM UI) */}
                        <div className="modern-form-group">
                            <label className="input-label" style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                                <CalendarIcon size={16} /> Data de Publica√ß√£o / Agendamento
                            </label>
                            <div className="custom-datepicker-wrapper">
                                <DatePicker
                                    selected={scheduleDate}
                                    onChange={(date) => setScheduleDate(date)}
                                    showTimeSelect
                                    timeFormat="HH:mm"
                                    timeIntervals={15}
                                    dateFormat="dd/MM/yyyy HH:mm"
                                    locale="pt-BR"
                                    placeholderText="Selecione data e hora..."
                                    className="modern-input"
                                    wrapperClassName="w-full"
                                    showPopperArrow={false}
                                />
                            </div>
                        </div>

                        {/* TEXT EDITOR */}
                        <div className="modern-form-group">
                            <label className="input-label">Texto do Post</label>
                            <textarea
                                value={text}
                                onChange={e => setText(e.target.value)}
                                className="modern-textarea"
                                style={{ minHeight: '200px', fontSize: '1rem', lineHeight: '1.6' }}
                            />
                        </div>

                        {/* IMAGE EDITOR (CAROUSEL SUPPORT) */}
                        <div className="modern-form-group">
                            <label className="input-label">M√≠dia (Imagens)</label>

                            {/* Current/New Preview Grid */}
                            <div style={{ marginBottom: '1rem', background: '#f8fafc', padding: '1rem', borderRadius: '8px' }}>
                                {newImageFiles.length > 0 ? (
                                    <div>
                                        <div style={{ color: '#16a34a', fontWeight: 600, marginBottom: '0.5rem', textAlign: 'center' }}>
                                            {newImageFiles.length} Novas imagens selecionadas:
                                        </div>
                                        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fill, minmax(80px, 1fr))', gap: '8px' }}>
                                            {newImageFiles.map((file, idx) => (
                                                <div key={idx} style={{ aspectRatio: '1/1', borderRadius: '6px', overflow: 'hidden', border: '1px solid #ddd' }}>
                                                    <img src={URL.createObjectURL(file)} alt="Preview" style={{ width: '100%', height: '100%', objectFit: 'cover' }} />
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                ) : currentImageUrls.length > 0 ? (
                                    <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fill, minmax(80px, 1fr))', gap: '8px' }}>
                                        {currentImageUrls.map((url, idx) => (
                                            <div key={idx} style={{ aspectRatio: '1/1', borderRadius: '6px', overflow: 'hidden', border: '1px solid #ddd' }}>
                                                <img src={url} alt={`Current ${idx}`} style={{ width: '100%', height: '100%', objectFit: 'cover' }} />
                                            </div>
                                        ))}
                                    </div>
                                ) : (
                                    <div style={{ color: '#94a3b8', textAlign: 'center' }}>Sem imagem atualmente</div>
                                )}
                            </div>

                            {/* Upload Input */}
                            <div className={`upload-wrapper ${newImageFiles.length > 0 ? 'has-file' : ''}`}>
                                <input
                                    type="file"
                                    accept="image/*"
                                    multiple
                                    onChange={handleFileChange}
                                    className="file-input-hidden"
                                />
                                <div className="upload-content-empty">
                                    <UploadCloud size={20} className="upload-icon-empty" />
                                    <span className="upload-text">Clique para trocar imagens (Substituir tudo)</span>
                                </div>
                            </div>
                        </div>

                        {errorMsg && <p className="error-text">{errorMsg}</p>}

                        <div className="modal-footer">
                            <button type="button" className="btn-cancel" onClick={onClose} disabled={loading}>
                                Cancelar
                            </button>
                            <button type="submit" className="btn-generate-primary" disabled={loading}>
                                {loading ? <><Loader2 className="spinner" /> Salvando...</> : <><Save size={18} /> Salvar Altera√ß√µes</>}
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            {/* Premium DatePicker Styles Override */}
            <style>{`
                    .custom-datepicker-wrapper .react-datepicker-wrapper {
                        width: 100%;
                    }
                    .react-datepicker {
                        font-family: 'Inter', sans-serif;
                        border: 1px solid #e2e8f0;
                        border-radius: 12px;
                        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
                        overflow: hidden;
                    }
                    .react-datepicker__header {
                        background-color: white;
                        border-bottom: 1px solid #e2e8f0;
                        padding-top: 1rem;
                    }
                    .react-datepicker__current-month {
                        font-weight: 700;
                        color: #1e293b;
                        margin-bottom: 0.5rem;
                        text-transform: capitalize;
                    }
                    .react-datepicker__day-name {
                        color: #64748b;
                        font-weight: 500;
                        width: 2.5rem;
                    }
                    .react-datepicker__day {
                        width: 2.5rem;
                        line-height: 2.5rem;
                        margin: 0.1rem;
                        border-radius: 8px;
                        color: #334155;
                        font-weight: 500;
                    }
                    .react-datepicker__day:hover {
                        background-color: #f1f5f9;
                        border-radius: 8px;
                    }
                    .react-datepicker__day--selected, 
                    .react-datepicker__day--keyboard-selected {
                        background-color: #3b82f6 !important;
                        color: white !important;
                        font-weight: 700;
                    }
                    .react-datepicker__day--today {
                        color: #3b82f6;
                        font-weight: 700;
                        background: none;
                    }
                    .react-datepicker__time-container {
                        border-left: 1px solid #e2e8f0;
                    }
                    .react-datepicker__time-container .react-datepicker__time .react-datepicker__time-box ul.react-datepicker__time-list li.react-datepicker__time-list-item--selected {
                        background-color: #3b82f6 !important;
                    }
                    .react-datepicker__navigation-icon::before {
                        border-color: #64748b;
                        border-width: 2px 2px 0 0;
                    }
                `}</style>
        </div>
    )
}

export default EditPostModal

```

---

## Arquivo: src\components\ErrorBoundary.jsx
```jsx

import React from 'react';
import { AlertTriangle, RefreshCw } from 'lucide-react';

class ErrorBoundary extends React.Component {
    constructor(props) {
        super(props);
        this.state = { hasError: false, error: null, errorInfo: null };
    }

    static getDerivedStateFromError(error) {
        // Update state so the next render will show the fallback UI.
        return { hasError: true };
    }

    componentDidCatch(error, errorInfo) {
        // You can also log the error to an error reporting service
        console.error("Uncaught error:", error, errorInfo);
        this.setState({ error, errorInfo });
    }

    render() {
        if (this.state.hasError) {
            // You can render any custom fallback UI
            return (
                <div style={{
                    height: '100vh',
                    display: 'flex',
                    flexDirection: 'column',
                    alignItems: 'center',
                    justifyContent: 'center',
                    backgroundColor: '#f8fafc',
                    color: '#1e293b',
                    textAlign: 'center',
                    fontFamily: "'Montserrat', sans-serif"
                }}>
                    <div style={{
                        background: '#fff',
                        padding: '2rem 3rem',
                        borderRadius: '16px',
                        boxShadow: '0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1)',
                        maxWidth: '500px',
                        width: '90%'
                    }}>
                        <div style={{
                            background: '#fee2e2',
                            padding: '1rem',
                            borderRadius: '50%',
                            display: 'inline-flex',
                            marginBottom: '1.5rem'
                        }}>
                            <AlertTriangle size={48} color="#ef4444" />
                        </div>

                        <h1 style={{ fontSize: '1.5rem', fontWeight: '700', marginBottom: '0.5rem', color: '#0f172a' }}>
                            Ops! Algo deu errado.
                        </h1>

                        <p style={{ color: '#64748b', marginBottom: '2rem', lineHeight: '1.5' }}>
                            Ocorreu um erro inesperado e o sistema precisou parar.
                            <br />
                            N√£o se preocupe, seus dados est√£o seguros.
                        </p>

                        <button
                            onClick={() => window.location.reload()}
                            style={{
                                display: 'inline-flex',
                                alignItems: 'center',
                                gap: '0.5rem',
                                padding: '0.75rem 1.5rem',
                                background: '#0f172a',
                                color: '#fff',
                                border: 'none',
                                borderRadius: '8px',
                                fontWeight: '600',
                                fontSize: '0.95rem',
                                cursor: 'pointer',
                                transition: 'opacity 0.2s',
                            }}
                            onMouseOver={(e) => e.target.style.opacity = '0.9'}
                            onMouseOut={(e) => e.target.style.opacity = '1'}
                        >
                            <RefreshCw size={18} /> Recarregar P√°gina
                        </button>

                        {/* Optional: details for debugging (hidden by default or small) */}
                        {this.state.error && process.env.NODE_ENV === 'development' && (
                            <details style={{ marginTop: '2rem', textAlign: 'left', color: '#94a3b8', fontSize: '0.75rem', overflow: 'auto', maxHeight: '100px' }}>
                                <summary>Detalhes do Erro</summary>
                                <pre>{this.state.error.toString()}</pre>
                                <pre>{this.state.errorInfo.componentStack}</pre>
                            </details>
                        )}
                    </div>
                </div>
            );
        }

        return this.props.children;
    }
}

export default ErrorBoundary;

```

---

## Arquivo: src\components\ImportContactsModal.jsx
```jsx
import React, { useState, useEffect } from 'react'
import { supabase } from '../services/supabaseClient'
import { X, Linkedin, Download, Loader2, AlertCircle } from 'lucide-react'

const ImportContactsModal = ({ isOpen, onClose, listId, clientId, accountId, onSuccess }) => {
    const [searchUrl, setSearchUrl] = useState('')
    const [loading, setLoading] = useState(false)
    const [error, setError] = useState(null)

    const handleSubmit = async (e) => {
        e.preventDefault()
        if (!searchUrl.trim() || !clientId || !listId) return

        // Validate Account ID
        if (!accountId) {
            setError('Esta lista n√£o est√° vinculada a uma conta do LinkedIn. (Account ID ausente).')
            return
        }

        setLoading(true)
        setError(null)

        try {
            // Call n8n Webhook
            const response = await fetch('https://n8n-n8n-start.kfocge.easypanel.host/webhook/import-linkedin-search', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    search_url: searchUrl,
                    list_id: listId,
                    client_id: clientId,
                    account_id: accountId
                })
            })

            if (!response.ok) throw new Error('Falha na comunica√ß√£o com o servidor de importa√ß√£o.')

            // Update List Status to PROCESSING
            await supabase
                .from('contact_lists')
                .update({
                    status: 'PROCESSING',
                })
                .eq('id', listId)

            onSuccess()
            onClose()
            setSearchUrl('')

        } catch (err) {
            console.error(err)
            setError(err.message || 'Erro desconhecido ao iniciar importa√ß√£o.')
        } finally {
            setLoading(false)
        }
    }

    if (!isOpen) return null

    return (
        <div className="fixed inset-0 z-50 flex items-center justify-center bg-slate-900/50 backdrop-blur-sm p-4 animate-fade-in">
            <div className="bg-white w-full max-w-md rounded-2xl shadow-2xl overflow-hidden animate-scale-in">
                <div className="p-6 border-b border-gray-100 flex justify-between items-center bg-slate-50">
                    <div>
                        <h2 className="text-xl font-bold text-slate-800">Importar Contatos</h2>
                        <p className="text-xs text-gray-500 mt-1">Adicione leads a esta lista automaticamente.</p>
                    </div>
                    <button onClick={onClose} className="p-2 rounded-full hover:bg-gray-200 text-gray-400 hover:text-gray-600 transition-colors">
                        <X size={20} />
                    </button>
                </div>

                <div className="p-6">
                    {/* Source Selection - For now just LinkedIn Search */}
                    <div className="mb-6">
                        <label className="block text-xs font-bold text-gray-400 uppercase tracking-wider mb-2">Fonte de Dados</label>
                        <div className="border-2 border-indigo-100 bg-indigo-50/50 rounded-xl p-4 flex items-center gap-4 cursor-pointer hover:border-indigo-300 transition-all">
                            <div className="w-10 h-10 rounded-lg bg-blue-600 text-white flex items-center justify-center">
                                <Linkedin size={24} />
                            </div>
                            <div>
                                <h3 className="font-bold text-slate-800">LinkedIn Search</h3>
                                <p className="text-xs text-slate-500">Extrair leads de uma busca salva.</p>
                            </div>
                            <div className="ml-auto">
                                <input type="radio" checked readOnly className="w-4 h-4 text-indigo-600" />
                            </div>
                        </div>
                    </div>

                    <form onSubmit={handleSubmit}>
                        <div className="mb-6">
                            <label className="block text-sm font-bold text-slate-700 mb-2">LinkedIn Search URL</label>
                            <input
                                autoFocus
                                type="url"
                                required
                                value={searchUrl}
                                onChange={e => setSearchUrl(e.target.value)}
                                placeholder="https://www.linkedin.com/search/results/people/..."
                                className="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl text-slate-800 focus:outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 transition-all font-medium text-sm"
                            />
                            <p className="text-xs text-slate-400 mt-2">Cole a URL completa da p√°gina de resultados de busca do LinkedIn.</p>
                        </div>

                        {error && (
                            <div className="mb-4 p-3 bg-red-50 text-red-600 text-sm rounded-lg flex items-start gap-2">
                                <AlertCircle size={16} className="mt-0.5 shrink-0" />
                                <span>{error}</span>
                            </div>
                        )}

                        <div className="flex gap-3 justify-end pt-2">
                            <button
                                type="button"
                                onClick={onClose}
                                className="px-5 py-2.5 rounded-xl text-slate-600 font-bold hover:bg-gray-100 transition-colors"
                            >
                                Cancelar
                            </button>
                            <button
                                type="submit"
                                disabled={loading || !searchUrl.trim()}
                                className="px-5 py-2.5 rounded-xl bg-indigo-600 text-white font-bold hover:bg-indigo-700 transition-all shadow-lg shadow-indigo-200 disabled:opacity-70 disabled:cursor-not-allowed flex items-center gap-2"
                            >
                                {loading ? <Loader2 className="animate-spin" size={18} /> : <Download size={18} />}
                                {loading ? 'Iniciando...' : 'Extrair e Importar'}
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    )
}

export default ImportContactsModal

```

---

## Arquivo: src\components\KanbanColumn.jsx
```jsx
import React from 'react'

/**
 * Reusable Kanban Column component
 * @param {string} title - Column title
 * @param {string} icon - Emoji icon for the column
 * @param {number} count - Number of items in the column
 * @param {string} color - Tailwind color class for the header accent
 * @param {React.ReactNode} children - Lead cards to render inside
 */
const KanbanColumn = ({ title, icon, count = 0, color = 'bg-slate-500', children }) => {
    return (
        <div className="flex flex-col bg-slate-50 rounded-2xl border border-slate-200 min-w-[300px] max-w-[320px] h-full">
            {/* Column Header */}
            <div className={`flex items-center justify-between px-4 py-3 border-b border-slate-200 ${color} bg-opacity-10 rounded-t-2xl`}>
                <div className="flex items-center gap-2">
                    <span className="text-lg">{icon}</span>
                    <h3 className="font-semibold text-slate-700 text-sm">{title}</h3>
                </div>
                <span className={`px-2.5 py-0.5 rounded-full text-xs font-bold ${color} text-white`}>
                    {count}
                </span>
            </div>

            {/* Scrollable Card List */}
            <div className="flex-1 overflow-y-auto p-3 space-y-2 max-h-[calc(100vh-280px)]">
                {children}
                {count === 0 && (
                    <div className="text-center py-8 text-slate-400 text-sm">
                        Nenhum lead aqui
                    </div>
                )}
            </div>
        </div>
    )
}

export default KanbanColumn

```

---

## Arquivo: src\components\KanbanLeadCard.jsx
```jsx
import React from 'react'
import { Clock, MessageCircle, ExternalLink, Zap } from 'lucide-react'

/**
 * Compact Lead Card for Kanban view
 * @param {object} lead - Lead data object
 * @param {function} onClick - Handler when card is clicked
 */
const KanbanLeadCard = ({ lead, onClick }) => {
    // Calculate time since last interaction
    const getTimeSince = (date) => {
        if (!date) return 'Sem intera√ß√£o'
        const now = new Date()
        const lastDate = new Date(date)
        const diffDays = Math.floor((now - lastDate) / (1000 * 60 * 60 * 24))

        if (diffDays === 0) return 'Hoje'
        if (diffDays === 1) return 'Ontem'
        if (diffDays < 7) return `${diffDays} dias`
        if (diffDays < 30) return `${Math.floor(diffDays / 7)} sem`
        return `${Math.floor(diffDays / 30)} m√™s`
    }

    // Get score color
    const getScoreColor = (score) => {
        if (score >= 70) return 'bg-emerald-500'
        if (score >= 40) return 'bg-amber-500'
        return 'bg-red-500'
    }

    // Get ICP badge style
    const getIcpStyle = (icp) => {
        if (icp === 'A') return 'bg-emerald-100 text-emerald-700 border-emerald-300'
        if (icp === 'B') return 'bg-amber-100 text-amber-700 border-amber-300'
        return 'bg-slate-100 text-slate-600 border-slate-300'
    }

    const trustScore = lead?.trust_score || 0
    const icpScore = lead?.icp_score || 'C'
    const totalInteractions = lead?.total_interactions_count || lead?.total_interactions || 0
    const lastInteractionDate = lead?.last_interaction_date
    const hasAiSuggestions = (lead?.ai_suggested_replies?.length || 0) > 0

    return (
        <div
            className="bg-white rounded-xl border border-slate-200 p-3 cursor-pointer hover:shadow-md hover:border-slate-300 transition-all group"
            onClick={() => onClick(lead)}
        >
            {/* Top Row: Avatar + Name + Score */}
            <div className="flex items-start gap-3">
                {/* Avatar */}
                <div className="w-10 h-10 rounded-full bg-gradient-to-br from-slate-200 to-slate-300 flex items-center justify-center overflow-hidden shrink-0">
                    {lead?.avatar_url ? (
                        <img src={lead.avatar_url} alt={lead.nome} className="w-full h-full object-cover" />
                    ) : (
                        <span className="text-sm font-bold text-slate-500">{lead?.nome?.charAt(0) || '?'}</span>
                    )}
                </div>

                {/* Name + Headline */}
                <div className="flex-1 min-w-0">
                    <h4 className="font-semibold text-slate-800 text-sm truncate">{lead?.nome || 'Lead'}</h4>
                    <p className="text-xs text-slate-500 truncate">{lead?.headline || lead?.empresa || '‚Äî'}</p>
                </div>

                {/* Trust Score Badge */}
                <div className={`${getScoreColor(trustScore)} text-white text-xs font-bold px-2 py-1 rounded-lg shrink-0`}>
                    {trustScore}
                </div>
            </div>

            {/* Bottom Row: Meta Info */}
            <div className="flex items-center justify-between mt-3 pt-2 border-t border-slate-100">
                {/* ICP Badge */}
                <span className={`text-[10px] font-bold px-2 py-0.5 rounded border ${getIcpStyle(icpScore)}`}>
                    ICP {icpScore}
                </span>

                {/* Interaction Count */}
                <div className="flex items-center gap-1 text-slate-400 text-xs">
                    <MessageCircle size={12} />
                    <span>{totalInteractions}</span>
                </div>

                {/* Time Since */}
                <div className="flex items-center gap-1 text-slate-400 text-xs">
                    <Clock size={12} />
                    <span>{getTimeSince(lastInteractionDate)}</span>
                </div>

                {/* AI Ready Indicator */}
                {hasAiSuggestions && (
                    <div className="text-amber-500" title="Sugest√µes de IA prontas">
                        <Zap size={14} />
                    </div>
                )}
            </div>
        </div>
    )
}

export default KanbanLeadCard

```

---

## Arquivo: src\components\LeadDetailModal.jsx
```jsx
import React, { useState, useEffect } from 'react'
import { supabase } from '../services/supabaseClient'
import {
    X,
    Briefcase,
    MapPin,
    ExternalLink,
    Copy,
    Check,
    Sparkles,
    MessageCircle,
    ArrowRight,
    ArrowLeft,
    Info,
    Brain,
    Send
} from 'lucide-react'

const LeadDetailModal = ({ lead, campaignLead, onClose }) => {
    const [interactions, setInteractions] = useState([])
    const [loadingInteractions, setLoadingInteractions] = useState(false)
    const [copiedIdx, setCopiedIdx] = useState(null)
    const [enrichedData, setEnrichedData] = useState(null) // Local state for fresh DB data
    const [draftMessage, setDraftMessage] = useState('') // Human-in-the-loop message editing
    const [selectedSuggestionIdx, setSelectedSuggestionIdx] = useState(null)

    useEffect(() => {
        if (lead?.id) fetchInteractions()
    }, [lead?.id])

    const fetchInteractions = async () => {
        setLoadingInteractions(true)
        try {
            // 1. Fetch Interactions
            const { data: interactionsData, error: interactionsError } = await supabase
                .from('interactions')
                .select('*')
                .eq('lead_id', lead.id)
                .order('interaction_date', { ascending: false })
                .limit(5)

            if (interactionsError) throw interactionsError
            setInteractions(interactionsData || [])

            // 2. FETCH MISSING DATA (Trust Score, Sentiment, AI Replies, Summary)
            // Since the main view can't join, we fetch fresh data here
            const { data: leadData, error: leadError } = await supabase
                .from('leads')
                .select('cadence_stage, sentiment, sentiment_reasoning, ai_suggested_replies, conversation_summary, icp_reason')
                .eq('id', lead.id)
                .single()

            if (leadData) {
                console.log('[LeadDetailModal] Fetched fresh enriched data:', leadData)
                // Merge fresh data into the local lead object mechanism
                // We'll update a local state or ref, but since 'lead' is a prop, 
                // we might need a local state for the enriched fields.
                setEnrichedData(leadData)
            }

        } catch (err) {
            console.error('Error fetching details:', err)
        } finally {
            setLoadingInteractions(false)
        }
    }

    const copyToClipboard = (text, idx) => {
        navigator.clipboard.writeText(text)
        setCopiedIdx(idx)
        setTimeout(() => setCopiedIdx(null), 2000)
    }

    // ============ DATA TRIAD LOGIC ============

    // 1. QUALITY (A/B/C tier)
    const getQualityData = () => {
        const tier = lead?.icp_score?.toUpperCase() || 'C'
        const configs = {
            'A': { label: 'A', percent: 100, color: '#10b981', bg: 'bg-emerald-500', text: 'text-emerald-400' },
            'B': { label: 'B', percent: 66, color: '#f59e0b', bg: 'bg-amber-500', text: 'text-amber-400' },
            'C': { label: 'C', percent: 33, color: '#ef4444', bg: 'bg-red-500', text: 'text-red-400' }
        }
        return configs[tier] || configs['C']
    }

    // 2. INTERACTION (message volume)
    const getInteractionData = () => {
        const count = lead?.total_interactions || 0
        if (count >= 10) return { percent: 100, color: '#10b981', label: count, text: 'text-emerald-400' }
        if (count >= 5) return { percent: 66, color: '#f59e0b', label: count, text: 'text-amber-400' }
        return { percent: Math.max(10, count * 10), color: '#ef4444', label: count, text: 'text-red-400' }
    }

    // 3. CADENCE STAGE ‚Üí Trust/Proximity Level
    // In outbound prospecting, cadence stages reflect growing trust:
    // G1 (first contact) ‚Üí G7+ (high trust / ready to close)
    const getCadenceData = () => {
        const stage = enrichedData?.cadence_stage
            ?? lead?.cadence_stage
            ?? lead?.leads?.cadence_stage
            ?? ''

        // Extract numeric level from stage (e.g. "G5" ‚Üí 5, "G1" ‚Üí 1)
        const match = stage?.toString().match(/(\d+)/)
        const level = match ? parseInt(match[1], 10) : 0

        // Map level to trust progression (outbound context)
        const trustLevels = [
            { max: 0, label: 'Sem Cad√™ncia', desc: 'Este lead ainda n√£o iniciou a cad√™ncia de prospec√ß√£o.', percent: 5, color: '#94a3b8', text: 'text-slate-400' },
            { max: 1, label: 'Primeiro Contato', desc: 'Lead recebeu o primeiro toque. N√≠vel de confian√ßa inicial.', percent: 15, color: '#3b82f6', text: 'text-blue-400' },
            { max: 2, label: 'Reconhecimento', desc: 'Lead come√ßa a reconhecer voc√™. Confian√ßa em constru√ß√£o.', percent: 30, color: '#06b6d4', text: 'text-cyan-400' },
            { max: 3, label: 'Considera√ß√£o', desc: 'Lead demonstra abertura para conversar. Confian√ßa em crescimento.', percent: 45, color: '#f59e0b', text: 'text-amber-400' },
            { max: 4, label: 'Interesse Ativo', desc: 'Lead engajado e interessado. Boa confian√ßa estabelecida.', percent: 60, color: '#f97316', text: 'text-orange-400' },
            { max: 5, label: 'Relacionamento', desc: 'Lead confia em voc√™ como refer√™ncia. Rela√ß√£o s√≥lida.', percent: 75, color: '#10b981', text: 'text-emerald-400' },
            { max: 6, label: 'Alta Confian√ßa', desc: 'Lead altamente engajado. Pronto para proposta.', percent: 90, color: '#22c55e', text: 'text-green-400' },
            { max: Infinity, label: 'Pronto p/ Fechar', desc: 'M√°xima confian√ßa atingida. Momento ideal para convers√£o.', percent: 100, color: '#eab308', text: 'text-yellow-400' }
        ]

        const config = trustLevels.find(t => level <= t.max) || trustLevels[0]

        return { ...config, stage, level }
    }

    const quality = getQualityData()
    const interaction = getInteractionData()
    const cadence = getCadenceData()
    // Prioritize fresh AI replies
    const aiReplies = enrichedData?.ai_suggested_replies || lead?.ai_suggested_replies || []

    if (!lead) return null

    // Circular Progress Ring Component
    const CircularGauge = ({ percent, color, size = 80, strokeWidth = 6, children }) => {
        const radius = (size - strokeWidth) / 2
        const circumference = radius * 2 * Math.PI
        const offset = circumference - (percent / 100) * circumference

        return (
            <div className="relative" style={{ width: size, height: size }}>
                <svg className="transform -rotate-90" width={size} height={size}>
                    <circle
                        cx={size / 2}
                        cy={size / 2}
                        r={radius}
                        stroke="rgba(255,255,255,0.1)"
                        strokeWidth={strokeWidth}
                        fill="none"
                    />
                    <circle
                        cx={size / 2}
                        cy={size / 2}
                        r={radius}
                        stroke={color}
                        strokeWidth={strokeWidth}
                        fill="none"
                        strokeLinecap="round"
                        strokeDasharray={circumference}
                        strokeDashoffset={offset}
                        style={{ transition: 'stroke-dashoffset 0.5s ease' }}
                    />
                </svg>
                <div className="absolute inset-0 flex items-center justify-center">
                    {children}
                </div>
            </div>
        )
    }

    return (
        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-md p-4" onClick={onClose}>
            <div
                className="bg-white rounded-3xl shadow-2xl w-full max-w-2xl max-h-[92vh] overflow-hidden border border-slate-200"
                onClick={e => e.stopPropagation()}
            >
                {/* ========== HEADER: Identity (Keep Dark) ========== */}
                <div className="relative px-6 pt-6 pb-4 bg-gradient-to-b from-slate-900 to-slate-800 rounded-t-3xl">
                    <button
                        onClick={onClose}
                        className="absolute top-4 right-4 p-2 rounded-full hover:bg-white/10 transition text-slate-400 hover:text-white"
                    >
                        <X size={20} />
                    </button>

                    <div className="flex items-center gap-4">
                        {/* Avatar */}
                        <div className="w-16 h-16 rounded-full bg-gradient-to-br from-sky-500 to-indigo-600 p-0.5 shrink-0">
                            <div className="w-full h-full rounded-full bg-slate-800 flex items-center justify-center overflow-hidden">
                                {lead.avatar_url ? (
                                    <img src={lead.avatar_url} alt={lead.nome} className="w-full h-full object-cover" />
                                ) : (
                                    <span className="text-2xl font-bold text-white">{lead.nome?.charAt(0) || '?'}</span>
                                )}
                            </div>
                        </div>

                        {/* Name + Headline */}
                        <div className="flex-1 min-w-0">
                            <h2 className="text-xl font-bold text-white truncate">{lead.nome || 'Lead'}</h2>
                            <p className="text-slate-400 text-sm flex items-center gap-1.5 mt-0.5 truncate">
                                <Briefcase size={14} className="shrink-0" />
                                {lead.headline || 'Sem cargo informado'}
                            </p>
                            {lead.location && (
                                <p className="text-slate-500 text-xs flex items-center gap-1 mt-1">
                                    <MapPin size={12} /> {lead.location}
                                </p>
                            )}
                        </div>

                        {lead.linkedin_url && (
                            <a
                                href={lead.linkedin_url}
                                target="_blank"
                                rel="noopener noreferrer"
                                className="shrink-0 p-2.5 rounded-xl bg-slate-800 hover:bg-slate-700 text-slate-400 hover:text-white transition"
                            >
                                <ExternalLink size={18} />
                            </a>
                        )}
                    </div>
                </div>

                {/* ========== TRUST TRIAD: 3 Gauges (Light Theme) ========== */}
                <div className="px-6 py-5 border-b border-slate-200 bg-slate-50">
                    <div className="grid grid-cols-3 gap-4">
                        {/* Gauge 1: Qualifica√ß√£o ICP */}
                        <div className="flex flex-col items-center">
                            <CircularGauge percent={quality.percent} color={quality.color}>
                                <span className={`text-xl font-bold ${quality.text}`}>{quality.label}</span>
                            </CircularGauge>
                            <span className="text-[11px] text-slate-600 font-semibold uppercase tracking-wider mt-2">Qualifica√ß√£o ICP</span>
                        </div>

                        {/* Gauge 2: Intera√ß√µes */}
                        <div className="flex flex-col items-center">
                            <CircularGauge percent={interaction.percent} color={interaction.color}>
                                <span className={`text-xl font-bold ${interaction.text}`}>{interaction.label}</span>
                            </CircularGauge>
                            <span className="text-[11px] text-slate-600 font-semibold uppercase tracking-wider mt-2">Intera√ß√µes</span>
                        </div>

                        {/* Gauge 3: N√≠vel de Cad√™ncia (Trust Proxy) */}
                        <div className="flex flex-col items-center">
                            <CircularGauge percent={cadence.percent} color={cadence.color}>
                                <div className="flex flex-col items-center">
                                    <span className={`text-lg font-bold ${cadence.text}`}>{cadence.stage || '‚Äî'}</span>
                                </div>
                            </CircularGauge>
                            <span className="text-[11px] text-slate-600 font-semibold uppercase tracking-wider mt-2">Cad√™ncia</span>
                            <span className={`text-[9px] font-medium mt-0.5 ${cadence.text}`}>{cadence.label}</span>
                        </div>
                    </div>

                    {/* ICP Reasoning */}
                    <div className="mt-4 p-3 bg-white rounded-xl border border-slate-200 shadow-sm">
                        <p className="text-xs text-slate-600">
                            <span className="font-bold text-slate-800 mr-1">Por que ICP {quality.label}?</span>
                            {enrichedData?.icp_reason || lead?.icp_reason || "Sem justificativa dispon√≠vel."}
                        </p>
                    </div>

                    {/* Cadence Stage Explanation */}
                    <div className="mt-3 p-3 bg-white rounded-xl border border-slate-200 shadow-sm">
                        <p className="text-xs text-slate-600">
                            <span className="font-bold text-slate-800 mr-1">N√≠vel de Cad√™ncia ({cadence.stage || '‚Äî'}):</span>
                            {cadence.desc}
                        </p>
                    </div>
                </div>

                {/* ========== SCROLLABLE CONTENT (Light Theme) ========== */}
                <div className="px-6 pb-6 pt-4 overflow-y-auto max-h-[calc(92vh-340px)] space-y-5 bg-white">

                    {/* ========== AI BRIEFING (Context) ========== */}
                    {(enrichedData?.conversation_summary || lead?.conversation_summary) && (
                        <div className="bg-blue-50 rounded-xl p-4 border border-blue-200">
                            <div className="flex items-center gap-2 mb-2">
                                <Brain size={16} className="text-blue-600" />
                                <span className="text-xs font-bold text-blue-700 uppercase tracking-wider">Resumo da Conversa</span>
                            </div>
                            <p className="text-sm text-slate-700 leading-relaxed">
                                {enrichedData?.conversation_summary || lead?.conversation_summary}
                            </p>
                        </div>
                    )}

                    {/* ========== ACTION ENGINE: AI Suggestions (Enhanced) ========== */}
                    <div>
                        <div className="flex items-center gap-2 mb-3">
                            <Sparkles size={16} className="text-amber-500" />
                            <span className="text-xs font-bold text-slate-600 uppercase tracking-wider">Motor de A√ß√£o</span>
                        </div>

                        {aiReplies.length > 0 ? (
                            <div className="space-y-3">
                                {aiReplies.map((reply, idx) => {
                                    // Support both old string format and new object format
                                    const text = typeof reply === 'object' ? reply.text : reply
                                    const strategy = typeof reply === 'object' ? reply.strategy : null
                                    const isSelected = selectedSuggestionIdx === idx

                                    return (
                                        <div
                                            key={idx}
                                            className={`group relative p-4 rounded-2xl border transition-all cursor-pointer ${isSelected
                                                ? 'ring-2 ring-violet-500 border-violet-400 bg-violet-50'
                                                : idx === 0
                                                    ? 'bg-gradient-to-r from-violet-100 to-indigo-100 border-violet-300 hover:border-violet-400'
                                                    : 'bg-slate-50 border-slate-200 hover:border-slate-300'
                                                }`}
                                            onClick={() => {
                                                setDraftMessage(text)
                                                setSelectedSuggestionIdx(idx)
                                            }}
                                        >
                                            {idx === 0 && (
                                                <span className="absolute -top-2 left-3 px-2 py-0.5 bg-violet-600 text-white text-[10px] font-bold uppercase rounded-full">
                                                    Recomendada
                                                </span>
                                            )}
                                            <p className="text-sm text-slate-700 leading-relaxed pr-10">
                                                "{text}"
                                            </p>
                                            {/* Strategy Explanation */}
                                            {strategy && (
                                                <p className="text-xs text-slate-500 italic mt-2 border-t border-slate-200 pt-2">
                                                    üí° <span className="font-medium">Estrat√©gia:</span> {strategy}
                                                </p>
                                            )}
                                            <button
                                                className="absolute top-4 right-4 p-2 rounded-lg bg-slate-100 hover:bg-slate-200 text-slate-500 hover:text-slate-700 transition opacity-0 group-hover:opacity-100"
                                                onClick={(e) => { e.stopPropagation(); copyToClipboard(text, idx) }}
                                            >
                                                {copiedIdx === idx ? <Check size={16} className="text-emerald-500" /> : <Copy size={16} />}
                                            </button>
                                        </div>
                                    )
                                })}

                                {/* ========== HUMAN-IN-THE-LOOP EDITOR ========== */}
                                {draftMessage && (
                                    <div className="mt-4 p-4 bg-white rounded-xl border-2 border-dashed border-blue-300 space-y-3">
                                        <div className="flex items-center gap-2 text-xs text-blue-600 font-bold uppercase tracking-wider">
                                            <MessageCircle size={14} />
                                            Editar Mensagem Antes de Enviar
                                        </div>
                                        <textarea
                                            className="w-full h-28 p-3 bg-slate-50 border border-slate-200 rounded-lg text-sm text-slate-700 focus:outline-none focus:border-blue-400 focus:ring-2 focus:ring-blue-100 resize-none"
                                            value={draftMessage}
                                            onChange={(e) => setDraftMessage(e.target.value)}
                                            placeholder="Edite a mensagem aqui..."
                                        />
                                        <div className="flex gap-2">
                                            <button
                                                onClick={() => copyToClipboard(draftMessage, -1)}
                                                className="flex-1 py-2.5 rounded-lg bg-slate-100 text-slate-600 font-semibold text-sm hover:bg-slate-200 transition flex items-center justify-center gap-2"
                                            >
                                                <Copy size={14} />
                                                Copiar
                                            </button>
                                            <button
                                                onClick={() => {
                                                    console.log('[LinkedIn Send] Simulating send:', draftMessage)
                                                    alert('‚úÖ Mensagem pronta para envio! (Simula√ß√£o)')
                                                    setDraftMessage('')
                                                    setSelectedSuggestionIdx(null)
                                                }}
                                                className="flex-1 py-2.5 rounded-lg bg-blue-600 text-white font-semibold text-sm hover:bg-blue-700 transition flex items-center justify-center gap-2 shadow-lg shadow-blue-200"
                                            >
                                                <Send size={14} />
                                                Enviar via LinkedIn
                                            </button>
                                        </div>
                                    </div>
                                )}
                            </div>
                        ) : (
                            <div className="p-5 rounded-2xl bg-slate-50 border border-dashed border-slate-300 text-center">
                                <Sparkles size={24} className="mx-auto text-slate-400 mb-2" />
                                <p className="text-sm text-slate-500">
                                    Nenhuma sugest√£o dispon√≠vel ainda.<br />
                                    <span className="text-slate-400">Sincronize as mensagens para gerar.</span>
                                </p>
                            </div>
                        )}
                    </div>

                    {/* ========== RECENT MESSAGES ========== */}
                    {interactions.length > 0 && (
                        <div>
                            <div className="flex items-center gap-2 mb-3">
                                <MessageCircle size={16} className="text-slate-500" />
                                <span className="text-xs font-bold text-slate-600 uppercase tracking-wider">√öltimas Mensagens</span>
                            </div>
                            <div className="space-y-2">
                                {interactions.slice(0, 3).map((msg, idx) => (
                                    <div key={idx} className="p-3 rounded-xl bg-slate-50 border border-slate-200">
                                        <div className="flex items-center justify-between mb-1.5">
                                            <div className="flex items-center gap-2">
                                                <span className={`w-5 h-5 rounded-full flex items-center justify-center ${msg.direction === 'outbound' ? 'bg-blue-100 text-blue-600' : 'bg-emerald-100 text-emerald-600'
                                                    }`}>
                                                    {msg.direction === 'outbound' ? <ArrowRight size={10} /> : <ArrowLeft size={10} />}
                                                </span>
                                                <span className={`text-xs font-semibold ${msg.direction === 'outbound' ? 'text-blue-600' : 'text-emerald-600'
                                                    }`}>
                                                    {msg.direction === 'outbound' ? 'Enviada' : 'Recebida'}
                                                </span>
                                            </div>
                                            <span className="text-[10px] text-slate-400">
                                                {new Date(msg.interaction_date).toLocaleDateString('pt-BR')}
                                            </span>
                                        </div>
                                        <p className="text-sm text-slate-700 line-clamp-2">{msg.content || '‚Äî'}</p>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}

                    {!loadingInteractions && interactions.length === 0 && (
                        <div className="text-center py-6 text-slate-600 text-sm">
                            <MessageCircle size={24} className="mx-auto mb-2 opacity-50" />
                            Nenhuma mensagem registrada
                        </div>
                    )}
                </div>
            </div>
        </div>
    )
}

export default LeadDetailModal

```

---

## Arquivo: src\components\MissionCard.jsx
```jsx
import React from 'react'
import { useNavigate } from 'react-router-dom'
import {
    MessageSquare,
    AlertTriangle,
    UserPlus,
    Sprout,
    Crosshair,
    Clock,
    ChevronRight
} from 'lucide-react'

const TYPE_CONFIG = {
    GHOSTING: { icon: AlertTriangle, label: 'Ghosting', color: 'text-red-400' },
    NEW_CONNECTION: { icon: UserPlus, label: 'Nova Conex√£o', color: 'text-cyan-400' },
    NURTURING: { icon: Sprout, label: 'Nutri√ß√£o', color: 'text-emerald-400' },
    CLOSING: { icon: Crosshair, label: 'Fechamento', color: 'text-amber-400' },
}

const getCadenceStyle = (level) => {
    if (!level) return 'bg-gray-800 text-gray-400 border-gray-700'
    const num = parseInt(level?.toString().replace(/\D/g, ''), 10) || 0
    if (num >= 5) return 'bg-emerald-900/60 text-emerald-300 border-emerald-700'
    if (num >= 3) return 'bg-amber-900/60 text-amber-300 border-amber-700'
    return 'bg-cyan-900/60 text-cyan-300 border-cyan-700'
}

const getIcpStyle = (tier) => {
    switch (tier) {
        case 'A': return 'bg-emerald-900/60 text-emerald-300 border-emerald-700'
        case 'B': return 'bg-blue-900/60 text-blue-300 border-blue-700'
        default: return 'bg-gray-800 text-gray-400 border-gray-700'
    }
}

const MissionCard = ({ task, isHighPriority = false }) => {
    const navigate = useNavigate()
    const lead = task.leads || {}
    const typeConfig = TYPE_CONFIG[task.type] || TYPE_CONFIG.NURTURING
    const TypeIcon = typeConfig.icon

    const handleOpenChat = (e) => {
        e.stopPropagation()
        if (task.lead_id) {
            navigate(`/sales/inbox?lead=${task.lead_id}`)
        }
    }

    return (
        <div
            className={`
                rounded-xl p-4 group cursor-pointer
                transition-all duration-200
                bg-white/[0.03] border border-white/[0.08]
                hover:bg-white/[0.06] hover:border-white/[0.15]
                ${isHighPriority
                    ? 'border-l-[3px] border-l-red-500/70'
                    : ''
                }
            `}
            onClick={handleOpenChat}
            style={{ backdropFilter: 'blur(8px)' }}
        >
            <div className="flex items-start gap-3 sm:gap-4">
                {/* Lead Avatar */}
                <div className="w-10 h-10 sm:w-11 sm:h-11 rounded-full overflow-hidden shrink-0 bg-gradient-to-br from-gray-800 to-black border border-white/[0.1] flex items-center justify-center">
                    {lead.avatar_url ? (
                        <img src={lead.avatar_url} alt={lead.nome} className="w-full h-full object-cover" />
                    ) : (
                        <span className="text-sm font-bold text-gray-300">
                            {lead.nome?.charAt(0)?.toUpperCase() || '?'}
                        </span>
                    )}
                </div>

                {/* Content */}
                <div className="flex-1 min-w-0">
                    {/* Row 1: Name + Badges */}
                    <div className="flex items-center gap-2 flex-wrap">
                        <h4 className="text-sm font-semibold text-white truncate max-w-[160px] sm:max-w-[240px]">
                            {lead.nome || 'Lead'}
                        </h4>

                        {lead.last_cadence_level && (
                            <span className={`text-[10px] font-bold px-1.5 py-0.5 rounded border ${getCadenceStyle(lead.last_cadence_level)}`}>
                                {lead.last_cadence_level}
                            </span>
                        )}
                        {lead.icp_score && (
                            <span className={`text-[10px] font-bold px-1.5 py-0.5 rounded border ${getIcpStyle(lead.icp_score)}`}>
                                ICP {lead.icp_score}
                            </span>
                        )}

                        {task.days_overdue > 0 && (
                            <span className="text-[10px] font-medium px-1.5 py-0.5 rounded bg-red-900/50 text-red-300 border border-red-700 flex items-center gap-0.5">
                                <Clock size={10} />
                                {task.days_overdue}d
                            </span>
                        )}
                    </div>

                    {/* Row 2: Headline */}
                    {lead.headline && (
                        <p className="text-xs text-gray-500 truncate mt-0.5">{lead.headline}</p>
                    )}

                    {/* Row 3: Reasoning */}
                    <div className="flex items-start gap-1.5 mt-2">
                        <TypeIcon size={14} className={`${typeConfig.color} shrink-0 mt-0.5`} />
                        <p className="text-xs text-gray-400 leading-relaxed line-clamp-2">
                            {task.reasoning || `Miss√£o de ${typeConfig.label}`}
                        </p>
                    </div>
                </div>

                {/* Action Button */}
                <button
                    onClick={handleOpenChat}
                    className="
                        shrink-0 flex items-center gap-1.5 px-3 py-2 rounded-lg text-xs font-semibold
                        bg-primary text-white
                        hover:shadow-glow hover:-translate-y-0.5
                        transition-all duration-200
                        opacity-70 group-hover:opacity-100
                    "
                >
                    <MessageSquare size={14} />
                    <span className="hidden sm:inline">Abrir Chat</span>
                    <ChevronRight size={14} className="sm:hidden" />
                </button>
            </div>
        </div>
    )
}

export default MissionCard

```

---

## Arquivo: src\components\SchedulePostModal.jsx
```jsx
import React, { useState } from 'react'
import { CalendarClock, X, Loader2, CheckCircle2 } from 'lucide-react'
import { supabase } from '../services/supabaseClient'
import './CreatePostModal.css' // Reusing modal styles

const SchedulePostModal = ({ post, onClose, onSuccess }) => {
    const [scheduleDate, setScheduleDate] = useState('')
    const [loading, setLoading] = useState(false)

    const handleSchedule = async (e) => {
        e.preventDefault()
        if (!scheduleDate) return

        setLoading(true)
        try {
            const { error } = await supabase
                .from('tabela_projetofred1')
                .update({
                    data_agendamento: scheduleDate,
                    status: 'AGENDADO'
                })
                .eq('id', post.id)

            if (error) throw error

            // Show success logic if needed (handled by parent usually, but we can do a local one)
            onSuccess()
            onClose()
            // Optional: You could use a toast library here if available in the project context
            alert(`Post agendado para ${new Date(scheduleDate).toLocaleString()}!`)

        } catch (error) {
            console.error('Erro ao agendar:', error)
            alert('Erro ao agendar post: ' + error.message)
        } finally {
            setLoading(false)
        }
    }

    return (
        <div className="modal-overlay">
            <div className="modal-content" style={{ maxWidth: '500px' }}>
                <div className="modal-header">
                    <h2 style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                        <CalendarClock size={24} className="text-primary" />
                        Agendar Publica√ß√£o
                    </h2>
                    <button className="close-btn" onClick={onClose}>
                        <X size={24} />
                    </button>
                </div>

                <div className="modal-body">
                    <div className="form-group">
                        <label style={{ fontSize: '0.9rem', color: '#64748b', marginBottom: '4px', display: 'block' }}>Tema do Post</label>
                        <div style={{
                            padding: '12px',
                            background: '#f8fafc',
                            borderRadius: '8px',
                            border: '1px solid #e2e8f0',
                            fontWeight: 500,
                            color: '#1e293b'
                        }}>
                            {post.tema || 'Sem T√≠tulo'}
                        </div>
                    </div>

                    <form onSubmit={handleSchedule} style={{ marginTop: '20px' }}>
                        <div className="form-group">
                            <label htmlFor="scheduleDate">Data e Hora da Publica√ß√£o</label>
                            <input
                                type="datetime-local"
                                id="scheduleDate"
                                className="form-input"
                                value={scheduleDate}
                                onChange={(e) => setScheduleDate(e.target.value)}
                                required
                                style={{ width: '100%' }}
                            />
                        </div>

                        <div className="modal-actions" style={{ marginTop: '24px', display: 'flex', justifyContent: 'flex-end', gap: '12px' }}>
                            <button type="button" className="btn-secondary" onClick={onClose} disabled={loading}>
                                Cancelar
                            </button>
                            <button
                                type="submit"
                                className="btn-primary"
                                disabled={loading || !scheduleDate}
                                style={{ display: 'flex', alignItems: 'center', gap: '8px' }}
                            >
                                {loading ? <Loader2 className="spinner" size={18} /> : <CheckCircle2 size={18} />}
                                Confirmar Agendamento
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    )
}

export default SchedulePostModal

```

---

## Arquivo: src\components\StrategicContextCard.jsx
```jsx
import React, { useState } from 'react'
import { ShieldAlert, Brain, Radio, Target, TrendingUp, Loader2 } from 'lucide-react'

// Cadence level configurations
const CADENCE_LEVELS = {
    G1: { label: 'Frio', desc: 'Lead acabou de ser abordado. Sem conex√£o emocional ainda.', color: 'from-slate-400 to-slate-500', bg: 'bg-slate-500/15', border: 'border-slate-500/40', text: 'text-slate-300', percent: 20 },
    G2: { label: 'Receptivo', desc: 'Lead reconhece voc√™ e est√° aberto a ouvir.', color: 'from-blue-400 to-blue-500', bg: 'bg-blue-500/15', border: 'border-blue-500/40', text: 'text-blue-300', percent: 40 },
    G3: { label: 'Contextualizado', desc: 'Lead entende sua proposta e est√° avaliando.', color: 'from-amber-400 to-amber-500', bg: 'bg-amber-500/15', border: 'border-amber-500/40', text: 'text-amber-300', percent: 60 },
    G4: { label: 'Interessado', desc: 'Lead demonstra interesse ativo. Engajamento crescente.', color: 'from-orange-400 to-orange-500', bg: 'bg-orange-500/15', border: 'border-orange-500/40', text: 'text-orange-300', percent: 80 },
    G5: { label: 'Quente', desc: 'Lead confia em voc√™. Pronto para a√ß√£o de convers√£o.', color: 'from-emerald-400 to-emerald-500', bg: 'bg-emerald-500/15', border: 'border-emerald-500/40', text: 'text-emerald-300', percent: 100 },
}

const getCadenceConfig = (level) => {
    if (!level) return null
    const key = level.toString().toUpperCase().trim()
    return CADENCE_LEVELS[key] || CADENCE_LEVELS['G1']
}

const StrategicContextCard = ({ lead }) => {
    const [showTooltip, setShowTooltip] = useState(false)

    if (!lead) return null

    const cadenceLevel = lead.last_cadence_level
    const signal = lead.last_signal_detected
    const psychological = lead.last_psychological_factor
    const forbidden = lead.last_forbidden_action
    const strategy = lead.last_strategy_used

    // If ALL fields are null ‚Üí show "awaiting analysis" state
    const hasAnyData = cadenceLevel || signal || psychological || forbidden || strategy

    if (!hasAnyData) {
        return (
            <div className="bg-[#0d0d0d] rounded-2xl border border-white/10 p-5">
                <div className="flex items-center gap-2 mb-4">
                    <div className="w-6 h-6 rounded-lg bg-primary/20 flex items-center justify-center">
                        <TrendingUp size={14} className="text-primary" />
                    </div>
                    <h4 className="text-xs font-bold text-primary uppercase tracking-wider">Raio-X da Negocia√ß√£o</h4>
                </div>
                <div className="flex flex-col items-center justify-center py-6 gap-3">
                    <Loader2 size={24} className="text-gray-500 animate-spin" />
                    <p className="text-xs text-gray-500 text-center leading-relaxed">
                        Aguardando An√°lise da IA...<br />
                        <span className="text-gray-600">Dispon√≠vel ap√≥s o pr√≥ximo processamento.</span>
                    </p>
                </div>
            </div>
        )
    }

    const config = getCadenceConfig(cadenceLevel)

    return (
        <div className="bg-[#0d0d0d] rounded-2xl border border-white/10 p-5 space-y-4">
            {/* Header */}
            <div className="flex items-center justify-between">
                <div className="flex items-center gap-2">
                    <div className="w-6 h-6 rounded-lg bg-primary/20 flex items-center justify-center">
                        <TrendingUp size={14} className="text-primary" />
                    </div>
                    <h4 className="text-xs font-bold text-primary uppercase tracking-wider">Raio-X da Negocia√ß√£o</h4>
                </div>
            </div>

            {/* A. Cadence Level Badge */}
            {config && (
                <div className="relative">
                    <div
                        className={`relative overflow-hidden rounded-xl ${config.bg} border ${config.border} p-3 cursor-default`}
                        onMouseEnter={() => setShowTooltip(true)}
                        onMouseLeave={() => setShowTooltip(false)}
                    >
                        {/* Progress bar behind */}
                        <div
                            className={`absolute inset-y-0 left-0 bg-gradient-to-r ${config.color} opacity-10`}
                            style={{ width: `${config.percent}%`, transition: 'width 0.6s ease' }}
                        />

                        <div className="relative flex items-center justify-between">
                            <div className="flex items-center gap-2.5">
                                <span className={`text-lg font-black ${config.text}`}>
                                    {cadenceLevel}
                                </span>
                                <div>
                                    <span className={`text-[10px] font-bold uppercase tracking-widest ${config.text} opacity-80`}>
                                        {config.label}
                                    </span>
                                    <div className="flex items-center gap-1 mt-0.5">
                                        {[1, 2, 3, 4, 5].map(i => {
                                            const levelNum = parseInt(cadenceLevel?.replace(/\D/g, '') || '0')
                                            return (
                                                <div
                                                    key={i}
                                                    className={`h-1 w-4 rounded-full transition-colors ${i <= levelNum
                                                        ? `bg-gradient-to-r ${config.color}`
                                                        : 'bg-white/10'
                                                        }`}
                                                />
                                            )
                                        })}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Tooltip */}
                    {showTooltip && (
                        <div className="absolute z-50 -top-2 left-1/2 -translate-x-1/2 -translate-y-full bg-gray-900 border border-white/20 rounded-lg px-3 py-2 shadow-xl max-w-[220px]">
                            <p className="text-[11px] text-gray-200 leading-relaxed">{config.desc}</p>
                            <div className="absolute bottom-0 left-1/2 -translate-x-1/2 translate-y-1/2 rotate-45 w-2 h-2 bg-gray-900 border-r border-b border-white/20" />
                        </div>
                    )}
                </div>
            )}

            {/* B. Forbidden Action - DANGER ZONE */}
            {forbidden && (
                <div className="rounded-xl bg-red-500/10 border border-red-500/30 p-3 space-y-1.5">
                    <div className="flex items-center gap-2">
                        <ShieldAlert size={14} className="text-red-400 shrink-0" />
                        <span className="text-[10px] font-bold uppercase tracking-widest text-red-400">Zona de Perigo</span>
                    </div>
                    <p className="text-xs text-red-300/90 leading-relaxed font-medium pl-[22px]">
                        {forbidden}
                    </p>
                </div>
            )}

            {/* C. Lead Analysis (Signal + Psychological) */}
            {(signal || psychological) && (
                <div className="rounded-xl bg-white/[0.03] border border-white/10 p-3 space-y-2.5">
                    <span className="text-[10px] font-bold uppercase tracking-widest text-gray-400">An√°lise do Lead</span>

                    {signal && (
                        <div className="flex items-start gap-2">
                            <Radio size={13} className="text-cyan-400 mt-0.5 shrink-0" />
                            <div>
                                <span className="text-[9px] uppercase tracking-widest text-cyan-400/70 font-bold">Sinal Detectado</span>
                                <p className="text-xs text-gray-300 leading-relaxed">{signal}</p>
                            </div>
                        </div>
                    )}

                    {psychological && (
                        <div className="flex items-start gap-2">
                            <Brain size={13} className="text-purple-400 mt-0.5 shrink-0" />
                            <div>
                                <span className="text-[9px] uppercase tracking-widest text-purple-400/70 font-bold">Fator Psicol√≥gico</span>
                                <p className="text-xs text-gray-300 leading-relaxed">{psychological}</p>
                            </div>
                        </div>
                    )}
                </div>
            )}

            {/* D. Recommended Tactic */}
            {strategy && (
                <div className="rounded-xl bg-primary/10 border border-primary/30 p-3 space-y-1.5">
                    <div className="flex items-center gap-2">
                        <Target size={14} className="text-primary shrink-0" />
                        <span className="text-[10px] font-bold uppercase tracking-widest text-primary/80">T√°tica Recomendada</span>
                    </div>
                    <p className="text-xs text-gray-200 leading-relaxed pl-[22px]">
                        {strategy}
                    </p>
                </div>
            )}
        </div>
    )
}

export default StrategicContextCard

```

---

## Arquivo: src\components\SystemStatusHelpModal.jsx
```jsx
import React from 'react'
import { X, RefreshCw, History, Info } from 'lucide-react'

const SystemStatusHelpModal = ({ isOpen, onClose }) => {
    if (!isOpen) return null

    return (
        <div className="fixed inset-0 z-[100] flex items-center justify-center bg-slate-900/60 backdrop-blur-sm p-4 animate-fade-in">
            <div className="bg-white w-full max-w-lg rounded-2xl shadow-2xl overflow-hidden animate-scale-in">
                {/* Header */}
                <div className="p-5 border-b border-gray-100 flex justify-between items-center bg-slate-50/50">
                    <div className="flex items-center gap-2.5">
                        <div className="w-8 h-8 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center">
                            <Info size={18} />
                        </div>
                        <div>
                            <h2 className="text-lg font-bold text-slate-800">Ajuda e Status do Sistema</h2>
                            <p className="text-xs text-gray-500 font-medium">Entenda como mantemos seus dados atualizados</p>
                        </div>
                    </div>
                    <button onClick={onClose} className="p-2 rounded-full hover:bg-white hover:shadow-sm text-gray-400 hover:text-slate-600 transition-all">
                        <X size={20} />
                    </button>
                </div>

                {/* Body */}
                <div className="p-6 space-y-6">

                    {/* Block 1: Real-time Sync */}
                    <div className="flex gap-4">
                        <div className="shrink-0 mt-1">
                            <div className="w-10 h-10 rounded-full bg-green-50 text-green-600 border border-green-100 flex items-center justify-center shadow-sm">
                                <RefreshCw size={20} className="animate-spin-slow" />
                            </div>
                        </div>
                        <div>
                            <h3 className="text-sm font-bold text-slate-900 mb-1 flex items-center gap-2">
                                üü¢ Sincroniza√ß√£o em Tempo Real (O "Rep√≥rter")
                            </h3>
                            <p className="text-sm text-slate-600 leading-relaxed">
                                "Para manter suas conversas fluindo, o sistema verifica novas mensagens automaticamente v√°rias vezes ao dia. Assim que seu lead responder no LinkedIn, a mensagem aparecer√° na plataforma e a IA analisar√° o contexto imediato para sugerir a pr√≥xima a√ß√£o. (Janela de leitura: √öltimas 50 mensagens)."
                            </p>
                        </div>
                    </div>

                    <div className="h-px bg-gray-100 w-full" />

                    {/* Block 2: History Import */}
                    <div className="flex gap-4">
                        <div className="shrink-0 mt-1">
                            <div className="w-10 h-10 rounded-full bg-amber-50 text-amber-600 border border-amber-100 flex items-center justify-center shadow-sm">
                                <History size={20} />
                            </div>
                        </div>
                        <div>
                            <h3 className="text-sm font-bold text-slate-900 mb-1 flex items-center gap-2">
                                üü° Importa√ß√£o de Hist√≥rico (O "Arque√≥logo")
                            </h3>
                            <p className="text-sm text-slate-600 leading-relaxed">
                                "Para garantir que a IA conhe√ßa seu cliente a fundo, ao cadastrar um novo lead, iniciamos uma varredura segura para recuperar o hist√≥rico de conversas antigas (at√© 1 ano). Isso permite que o sistema entenda dores passadas e negocia√ß√µes anteriores. (Execu√ß√£o √∫nica no cadastro)."
                            </p>
                        </div>
                    </div>

                </div>

                {/* Footer */}
                <div className="p-4 bg-slate-50 border-t border-gray-100 text-center">
                    <p className="text-xs text-gray-400">
                        O sistema opera em segundo plano. Voc√™ pode continuar navegando normalmente.
                    </p>
                </div>
            </div>
        </div>
    )
}

export default SystemStatusHelpModal

```

---

## Arquivo: src\components\kanban\KanbanColumn.jsx
```jsx
import React from 'react'

/**
 * KanbanColumn - A reusable column component for the Kanban board
 * @param {string} title - Column title
 * @param {string} icon - Emoji icon for the column
 * @param {number} count - Number of items in the column
 * @param {string} colorClass - Tailwind color class for the header accent
 * @param {React.ReactNode} children - Lead cards to render
 */
const KanbanColumn = ({ title, icon, count = 0, colorClass = 'bg-slate-500', children }) => {
    return (
        <div className="flex flex-col bg-white/5 backdrop-blur-lg rounded-2xl border border-white/10 shadow-lg min-w-[300px] max-w-[320px] h-full">
            {/* Column Header */}
            <div className={`flex items-center justify-between px-4 py-3 border-b border-gray-200 rounded-t-2xl`}>
                <div className="flex items-center gap-2">
                    <span className="text-lg">{icon}</span>
                    <h3 className="font-bold text-gray-800 text-sm">{title}</h3>
                </div>
                <span className={`px-2.5 py-0.5 rounded-full text-xs font-bold text-white ${colorClass}`}>
                    {count}
                </span>
            </div>

            {/* Scrollable Card List */}
            <div className="flex-1 overflow-y-auto p-3 space-y-2 max-h-[calc(100vh-320px)] custom-scrollbar">
                {children}
                {count === 0 && (
                    <div className="text-center py-8 text-gray-500 text-sm italic">
                        Nenhum lead aqui
                    </div>
                )}
            </div>
        </div>
    )
}

export default KanbanColumn

```

---

## Arquivo: src\components\kanban\KanbanLeadCard.jsx
```jsx
import React from 'react'
import { MessageCircle, Clock, Zap } from 'lucide-react'

/**
 * KanbanLeadCard - A compact lead card for the Kanban board
 * @param {Object} lead - Lead data object
 * @param {Function} onClick - Click handler
 */
const KanbanLeadCard = ({ lead, onClick }) => {
    // Helper: Time since last interaction
    const getTimeSince = (dateString) => {
        if (!dateString) return '‚Äî'
        const now = new Date()
        const date = new Date(dateString)
        const diffMs = now - date
        const diffHours = Math.floor(diffMs / (1000 * 60 * 60))
        const diffDays = Math.floor(diffHours / 24)

        if (diffDays > 0) return `${diffDays}d`
        if (diffHours > 0) return `${diffHours}h`
        return 'agora'
    }

    // Helper: Cadence stage styling (trust-gradient based on level)
    const getCadenceStyle = (stage) => {
        const match = stage?.toString().match(/(\d+)/)
        const level = match ? parseInt(match[1], 10) : 0

        if (level >= 7) return 'bg-yellow-100 text-yellow-700 border border-yellow-300'
        if (level >= 6) return 'bg-green-100 text-green-700 border border-green-300'
        if (level >= 5) return 'bg-emerald-100 text-emerald-700 border border-emerald-300'
        if (level >= 4) return 'bg-orange-100 text-orange-700 border border-orange-300'
        if (level >= 3) return 'bg-amber-100 text-amber-700 border border-amber-300'
        if (level >= 2) return 'bg-cyan-100 text-cyan-700 border border-cyan-300'
        if (level >= 1) return 'bg-blue-100 text-blue-700 border border-blue-300'
        return 'bg-gray-100 text-gray-600 border border-gray-300'
    }

    // Helper: ICP tier styling
    const getIcpStyle = (tier) => {
        switch (tier) {
            case 'A': return 'bg-emerald-100 text-emerald-700 border-emerald-300'
            case 'B': return 'bg-blue-100 text-blue-700 border-blue-300'
            case 'C': return 'bg-gray-100 text-gray-600 border-gray-300'
            default: return 'bg-gray-100 text-gray-600 border-gray-300'
        }
    }

    // Extract lead data (handle both direct and nested structures)
    const leadData = lead?.leads || lead
    const cadenceStage = leadData?.cadence_stage || ''
    const icpTier = leadData?.qualification_tier || leadData?.icp_score || 'C'
    const totalInteractions = leadData?.total_interactions_count || leadData?.total_interactions || 0
    const lastInteractionDate = leadData?.last_interaction_date
    const hasAiSuggestions = (leadData?.ai_suggested_replies?.length || 0) > 0
    const nome = leadData?.nome || 'Lead'
    const headline = leadData?.headline || leadData?.empresa || ''
    const avatarUrl = leadData?.avatar_url

    return (
        <div
            className="bg-white rounded-xl border border-gray-200 p-3 cursor-pointer hover:bg-gray-50 hover:border-gray-300 hover:shadow-md transition-all group"
            onClick={() => onClick(lead)}
        >
            {/* Top Row: Avatar + Name + Score */}
            <div className="flex items-start gap-3">
                {/* Avatar */}
                <div className="w-10 h-10 rounded-full bg-gradient-to-br from-gray-200 to-gray-300 flex items-center justify-center overflow-hidden shrink-0 border border-gray-200">
                    {avatarUrl ? (
                        <img src={avatarUrl} alt={nome} className="w-full h-full object-cover" />
                    ) : (
                        <span className="text-sm font-bold text-gray-500">{nome?.charAt(0) || '?'}</span>
                    )}
                </div>

                {/* Name + Headline */}
                <div className="flex-1 min-w-0">
                    <h4 className="font-semibold text-gray-800 text-sm truncate">{nome}</h4>
                    <p className="text-xs text-gray-500 truncate">{headline || '‚Äî'}</p>
                </div>

                {/* Cadence Stage Badge */}
                {cadenceStage && (
                    <div className={`${getCadenceStyle(cadenceStage)} text-[10px] font-bold px-2 py-0.5 rounded-lg shrink-0`}>
                        {cadenceStage}
                    </div>
                )}
            </div>

            {/* Bottom Row: Meta Info */}
            <div className="flex items-center justify-between mt-3 pt-2 border-t border-gray-100">
                {/* ICP Badge */}
                <span className={`text-[10px] font-bold px-2 py-0.5 rounded border ${getIcpStyle(icpTier)}`}>
                    ICP {icpTier}
                </span>

                {/* Interaction Count */}
                <div className="flex items-center gap-1 text-gray-500 text-xs">
                    <MessageCircle size={12} />
                    <span>{totalInteractions}</span>
                </div>

                {/* Time Since */}
                <div className="flex items-center gap-1 text-gray-500 text-xs">
                    <Clock size={12} />
                    <span>{getTimeSince(lastInteractionDate)}</span>
                </div>

                {/* AI Ready Indicator */}
                {hasAiSuggestions && (
                    <div className="text-amber-500" title="Sugest√µes de IA prontas">
                        <Zap size={14} />
                    </div>
                )}
            </div>
        </div>
    )
}

export default KanbanLeadCard

```

---

## Arquivo: src\contexts\AuthContext.jsx
```jsx

import React, { createContext, useContext, useState, useEffect } from 'react';
import { supabase } from '../services/supabaseClient';

const AuthContext = createContext({});

export const useAuth = () => useContext(AuthContext);

export const AuthProvider = ({ children }) => {
    const [user, setUser] = useState(null);
    const [profile, setProfile] = useState(null);
    const [loading, setLoading] = useState(true);

    useEffect(() => {
        let mounted = true;

        // 1. Initial Session Check (Critical for F5/Refresh)
        const checkSession = async () => {
            try {
                const { data: { session } } = await supabase.auth.getSession();
                if (mounted && session?.user) {
                    setUser(session.user);
                    setLoading(false); // RELEASE LOADING IMMEDIATELY
                    fetchProfile(session.user.id, session.user.email); // Background fetch
                } else if (mounted) {
                    setLoading(false); // No session, stop loading
                }
            } catch (err) {
                console.error('Session check failed:', err);
                if (mounted) setLoading(false);
            }
        };

        checkSession();

        // 2. Auth State Listener
        const { data: { subscription } } = supabase.auth.onAuthStateChange(async (event, session) => {
            if (!mounted) return;
            console.log('Auth State Change:', event);

            if (session?.user) {
                // If user changes or login happens, update state
                if (session.user.id !== user?.id) {
                    setUser(session.user);
                    setLoading(false); // RELEASE LOADING IMMEDIATELY
                    fetchProfile(session.user.id, session.user.email); // Background fetch
                }
            } else if (event === 'SIGNED_OUT') {
                setUser(null);
                setProfile(null);
                setLoading(false);
            }
        });

        // 3. Safety Timeout
        const safetyTimeout = setTimeout(() => {
            if (mounted && loading) {
                console.warn('Auth check timed out. Forcing stop loading.');
                setLoading(false);
            }
        }, 5000);

        return () => {
            mounted = false;
            clearTimeout(safetyTimeout);
            subscription.unsubscribe();
        };
    }, []); // Empty dependency array ok, relying on internal logic

    const fetchProfile = async (userId, userEmail) => {
        try {
            const { data, error } = await supabase
                .from('profiles')
                .select('*')
                .eq('id', userId)
                .single();

            if (error) {
                // Self-healing attempt for missing profile
                if (error.code === 'PGRST116' && userEmail) {
                    console.log('Profile missing (PGRST116). Attempting to create default profile...');
                    const defaultProfile = {
                        id: userId,
                        email: userEmail,
                        role: 'admin',
                        nome_empresa: 'Minha Ag√™ncia'
                    };

                    const { error: insertError } = await supabase
                        .from('profiles')
                        .insert([defaultProfile]);

                    if (!insertError) {
                        setProfile(defaultProfile);
                        setLoading(false); // Success path
                        return;
                    }
                    console.error('Failed to create fallback profile:', insertError);
                }

                // 3. TRATAMENTO DE ERRO NO PERFIL (Strict Error Handling)
                // If we are here, we failed to get OR create a profile.
                console.error('Critical Profile Error provided. Signing out to prevent broken state.');
                await handleCriticalAuthError();
            } else {
                setProfile(data);
                setLoading(false); // Success path
            }
        } catch (error) {
            console.error('Profile fetch exception:', error);
            await handleCriticalAuthError();
        }
    };

    const handleCriticalAuthError = async () => {
        // Force sign out and clear state
        await supabase.auth.signOut();
        setProfile(null);
        setUser(null);
        setLoading(false); // GUARANTEED: Loading must stop
    };

    const signIn = async (email, password) => {
        const { data, error } = await supabase.auth.signInWithPassword({
            email,
            password,
        });
        if (error) throw error;
        return data;
    };

    const signOut = async () => {
        try {
            await supabase.auth.signOut();
        } catch (error) {
            console.error('Error signing out:', error);
        } finally {
            // Force clear state to ensure UI updates immediately
            setUser(null);
            setProfile(null);
            setLoading(false);
        }
    };

    return (
        <AuthContext.Provider value={{ user, profile, loading, signIn, signOut }}>
            {!loading ? children : (
                <div style={{
                    display: 'flex',
                    justifyContent: 'center',
                    alignItems: 'center',
                    height: '100vh',
                    flexDirection: 'column',
                    gap: '1rem',
                    background: '#f8fafc'
                }}>
                    <div style={{
                        width: '40px',
                        height: '40px',
                        border: '3px solid #e2e8f0',
                        borderTopColor: '#2563eb',
                        borderRadius: '50%',
                        animation: 'spin 1s linear infinite'
                    }}></div>
                    <span style={{ color: '#64748b', fontSize: '0.875rem' }}>Carregando Link&Lead...</span>
                </div>
            )}
            <style>{`@keyframes spin { to { transform: rotate(360deg); } }`}</style>
        </AuthContext.Provider>
    );
};

```

---

## Arquivo: src\contexts\ClientAuthContext.jsx
```jsx
import React, { createContext, useContext, useState, useEffect } from 'react'
import { supabase } from '../services/supabaseClient'

const ClientAuthContext = createContext({})

export const useClientAuth = () => useContext(ClientAuthContext)

export const ClientAuthProvider = ({ children }) => {
    const [clientUser, setClientUser] = useState(null)
    const [clientId, setClientId] = useState(null) // UUID
    const [clientLegacyId, setClientLegacyId] = useState(null) // Integer ID (Legacy)
    const [clientName, setClientName] = useState('')
    const [isTokenAuth, setIsTokenAuth] = useState(false)
    const [loading, setLoading] = useState(true)

    useEffect(() => {
        let mounted = true

        const fetchClientData = async (user) => {
            try {
                // 1. LOGIN (UUID) -> PERFIL
                const { data: profile, error } = await supabase
                    .from('profiles')
                    .select('id, client_id, role, nome_empresa') // Added nome_empresa and id
                    .eq('id', user.id)
                    .single()

                if (error) throw error

                if (profile.role !== 'client') {
                    console.warn('User found but role is not client:', profile.role)
                    setClientUser(null)
                    setClientId(null)
                    setClientLegacyId(null)
                    setClientName('')
                } else {
                    console.log(`Client Auth Success: User ${user.id} (UUID)`)
                    setClientUser(user)
                    setClientId(profile.id) // UUID PRIMARY
                    setClientLegacyId(profile.client_id) // Integer Legacy
                    setClientName(profile.nome_empresa || '')
                }
            } catch (err) {
                console.error('Error fetching client profile:', err)
                setClientUser(null)
                setClientId(null)
                setClientLegacyId(null)
                setClientName('')
            } finally {
                if (mounted) setLoading(false)
            }
        }

        const { data: { subscription } } = supabase.auth.onAuthStateChange((event, session) => {
            if (isTokenAuth) return // Don't override if manually logged in via token

            if (session?.user) {
                fetchClientData(session.user)
            } else {
                setClientUser(null)
                setClientId(null)
                setClientLegacyId(null)
                setClientName('')
                setLoading(false)
            }
        })

        return () => {
            mounted = false
            subscription.unsubscribe()
        }
    }, [isTokenAuth]) // Re-run if token auth state changes (though mainly to re-bind listener logic)

    const loginWithToken = async (token) => {
        setLoading(true)
        try {
            // Check 'clients' table for access_token
            const { data: client, error } = await supabase
                .from('clients')
                .select('*')
                .eq('access_token', token)
                .single()

            if (error || !client) {
                throw new Error('Token inv√°lido ou expirado.')
            }

            // Set global state "as if" logged in
            // Mocking a clientUser object to satisfy existence checks
            setClientUser({ id: 'token_user', email: 'token_access', role: 'client' })

            // Use client.id directly. 
            // Note: If 'tabela_projetofred1' uses UUID from profiles, this might miss-match unless client.id IS the UUID.
            // Assuming client.id is the correct identifier for posts in this context.
            setClientId(client.id)
            setClientLegacyId(client.id) // Assuming same ID or fallback
            // FIX: User confirmed 'clients' table uses 'name' column.
            setClientName(client.name || client.nome_empresa)
            setIsTokenAuth(true)

            return true
        } catch (err) {
            console.error(err)
            return false
        } finally {
            setLoading(false)
        }
    }

    const signOut = async () => {
        if (isTokenAuth) {
            setIsTokenAuth(false)
            setClientUser(null)
            setClientId(null)
            setClientLegacyId(null)
            setClientName('')
        } else {
            await supabase.auth.signOut()
            setClientUser(null)
            setClientId(null)
            setClientLegacyId(null)
            setClientName('')
        }
    }

    return (
        <ClientAuthContext.Provider value={{ clientUser, clientId, clientLegacyId, clientName, loading, signOut, isTokenAuth, loginWithToken }}>
            {children}
        </ClientAuthContext.Provider>
    )
}

```

---

## Arquivo: src\contexts\ClientSelectionContext.jsx
```jsx
import React, { createContext, useContext, useState, useEffect } from 'react'

const ClientSelectionContext = createContext()

export const useClientSelection = () => {
    return useContext(ClientSelectionContext)
}

export const ClientSelectionProvider = ({ children }) => {
    const [selectedClientId, setSelectedClientId] = useState(() => {
        // Persist selection
        const saved = localStorage.getItem('selectedClientId')
        return saved ? JSON.parse(saved) : null
    })

    const setClient = (clientId) => {
        setSelectedClientId(clientId)
        if (clientId) {
            localStorage.setItem('selectedClientId', JSON.stringify(clientId))
        } else {
            localStorage.removeItem('selectedClientId')
        }
    }

    const value = {
        selectedClientId,
        setSelectedClientId: setClient
    }

    return (
        <ClientSelectionContext.Provider value={value}>
            {children}
        </ClientSelectionContext.Provider>
    )
}

```

---

## Arquivo: src\contexts\LanguageContext.jsx
```jsx
import React, { createContext, useState, useContext } from 'react'

const LanguageContext = createContext()

const translations = {
    pt: {
        dashboard: "Vis√£o Geral",
        posts: "Meus Posts",
        clients: "Gerenciar Clientes",
        newPost: "Novo Conte√∫do",
        logout: "Sair",
        agencyProgress: "Progresso da Ag√™ncia",
        pipelineOverview: "Vis√£o geral do pipeline por cliente",
        drafts: "Ideias (Draft)",
        waiting: "Aguardando Aprova√ß√£o",
        review: "Em Revis√£o",
        approved: "Aprovados / Prontos",
        actions: "A√ß√µes",
        client: "Cliente",
        openPosts: "Abrir Posts",
        copyLink: "Copiar Link",
        loading: "Carregando...",
        noClients: "Nenhum cliente cadastrado no pipeline.",
        ideas: "Banco de Ideias",
        newQuestion: "Nova Pergunta",
        pendingQuestions: "Perguntas Pendentes",
        answeredQuestions: "Respondidas / Insights",
        save: "Salvar",
        cancel: "Cancelar",
        delete: "Excluir",
        answer: "Responder",
        questionPlaceholder: "Digite a pergunta estrat√©gica para o cliente...",
        answerPlaceholder: "Digite a resposta do cliente..."
    },
    de: {
        dashboard: "√úbersicht",
        posts: "Meine Beitr√§ge",
        clients: "Kunden verwalten",
        newPost: "Neuer Inhalt",
        logout: "Abmelden",
        agencyProgress: "Agenturfortschritt",
        pipelineOverview: "Pipeline-√úbersicht pro Kunde",
        drafts: "Ideen (Entwurf)",
        waiting: "Wartet auf Genehmigung",
        review: "In √úberarbeitung",
        approved: "Genehmigt / Fertig",
        actions: "Aktionen",
        client: "Kunde",
        openPosts: "Beitr√§ge √∂ffnen",
        copyLink: "Link kopieren",
        loading: "Laden...",
        noClients: "Keine Kunden in der Pipeline registriert.",
        ideas: "Ideenbank",
        newQuestion: "Neue Frage",
        pendingQuestions: "Offene Fragen",
        answeredQuestions: "Beantwortet / Insights",
        save: "Speichern",
        cancel: "Abbrechen",
        delete: "L√∂schen",
        answer: "Antworten",
        questionPlaceholder: "Geben Sie die strategische Frage f√ºr den Kunden ein...",
        answerPlaceholder: "Geben Sie die Antwort des Kunden ein..."
    }
}

export const LanguageProvider = ({ children }) => {
    const [language, setLanguage] = useState('pt')

    const t = (key) => {
        return translations[language][key] || key
    }

    return (
        <LanguageContext.Provider value={{ language, setLanguage, t }}>
            {children}
        </LanguageContext.Provider>
    )
}

export const useLanguage = () => useContext(LanguageContext)

```

---

## Arquivo: src\lib\utils.js
```js
import { clsx } from "clsx"
import { twMerge } from "tailwind-merge"

export function cn(...inputs) {
    return twMerge(clsx(inputs))
}

```

---

## Arquivo: src\pages\AdminPanel.css
```css
/* 
  DEPRECATED: Styles have been moved to Tailwind classes in AdminPanel.jsx and index.css
  as part of the Obsidian Glass visual overhaul.
*/
```

---

## Arquivo: src\pages\AdminPanel.jsx
```jsx
import React, { useState, useEffect } from 'react'
import { supabase } from '../services/supabaseClient'
import { useAuth } from '../contexts/AuthContext'
import { Link } from 'react-router-dom'
import {
    Loader2,
    Briefcase,
    ExternalLink,
    Link as LinkIcon,
    Users,
    ArrowUpRight
} from 'lucide-react'

const AdminPanel = () => {
    const { profile, loading: authLoading } = useAuth()
    const [clients, setClients] = useState([])
    const [posts, setPosts] = useState([])
    const [loading, setLoading] = useState(true)
    const [unreadCounts, setUnreadCounts] = useState({})

    useEffect(() => {
        if (authLoading) return

        if (profile) {
            fetchDashboardData()
        } else {
            setLoading(false)
        }
    }, [authLoading, profile])

    const fetchDashboardData = async () => {
        try {
            setLoading(true)

            // 1. Fetch Clients
            const { data: clientsData, error: clientsError } = await supabase
                .from('clients')
                .select('*')
                .order('name')

            if (clientsError) throw clientsError

            // 2. Fetch All Posts
            let postsQuery = supabase
                .from('tabela_projetofred1')
                .select('id, nome_cliente, status')

            if (profile.role === 'client') {
                if (profile.nome_empresa) {
                    postsQuery = postsQuery.eq('nome_cliente', profile.nome_empresa)
                }
            }

            const { data: postsData, error: postsError } = await postsQuery
            if (postsError) throw postsError

            // NEW: Fetch Unread Comments for Badge
            const { data: unreadData, error: unreadError } = await supabase
                .from('post_comments')
                .select('post_id')
                .eq('role', 'client')
                .eq('read_by_admin', false)

            if (unreadError) throw unreadError

            // Map unread comments to clients
            const counts = {}
            if (unreadData && postsData) {
                unreadData.forEach(comment => {
                    // Find which client owns this post
                    const post = postsData.find(p => p.id === comment.post_id)
                    if (post && post.nome_cliente) {
                        counts[post.nome_cliente] = (counts[post.nome_cliente] || 0) + 1
                    }
                })
            }
            setUnreadCounts(counts)
            setClients(clientsData || [])
            setPosts(postsData || [])

        } catch (err) {
            console.error('Erro ao carregar dashboard:', err)
        } finally {
            setLoading(false)
        }
    }

    // Process Stats Per Client
    const getClientStats = (clientName) => {
        const clientPosts = posts.filter(p => p.nome_cliente === clientName)
        const normalize = (status) => status ? status.toLowerCase() : ''

        const drafts = clientPosts.filter(p => {
            const s = normalize(p.status)
            return !s || ['rascunho', 'ideia', 'draft', 'idea'].includes(s)
        }).length

        const waiting = clientPosts.filter(p => {
            const s = normalize(p.status)
            return ['aguardando aprova√ß√£o', 'pending', 'waiting_approval'].includes(s)
        }).length

        const review = clientPosts.filter(p => {
            const s = normalize(p.status)
            return ['revis√£o', 'review', 'changes_requested', 'revision'].includes(s)
        }).length

        const approved = clientPosts.filter(p => {
            const s = normalize(p.status)
            return ['aprovado', 'postado', 'approved', 'ready', 'published'].includes(s)
        }).length

        return { drafts, waiting, review, approved }
    }

    const renderCount = (count, type) => {
        if (count === 0) return <span className="text-gray-600 font-light">-</span>

        let colorClass = 'text-white'
        switch (type) {
            case 'draft': colorClass = 'text-gray-300'; break;
            case 'waiting': colorClass = 'text-amber-400 font-bold'; break;
            case 'review': colorClass = 'text-red-400 font-bold'; break;
            case 'approved': colorClass = 'text-emerald-400 font-bold'; break;
        }

        return <span className={`text-lg ${colorClass}`}>{count}</span>
    }

    const copyLink = (clientName) => {
        const url = `${window.location.origin}/login`
        navigator.clipboard.writeText(url)
        alert('Link do Portal copiado!')
    }

    return (
        <div className="min-h-screen bg-obsidian text-white p-8 relative overflow-hidden">
            {/* BACKGROUND ACCENTS */}
            <div className="fixed top-20 right-20 w-96 h-96 bg-primary/10 blur-[100px] rounded-full pointer-events-none z-0" />

            {/* FLOATING HUD HEADER */}
            <header className="relative z-10 flex flex-col md:flex-row justify-between items-start md:items-center mb-10 gap-4">
                <div>
                    <h1 className="text-3xl font-bold tracking-tight text-white mb-1">Progresso da Ag√™ncia</h1>
                    <p className="text-gray-400">Vis√£o geral do pipeline por cliente</p>
                </div>
                <div className="flex items-center gap-4">
                    <Link to="/clients" className="glass-panel px-4 py-2 rounded-full text-sm font-medium text-gray-300 hover:text-white hover:border-primary/50 transition-all flex items-center gap-2">
                        <Users size={16} />
                        Gerenciar Clientes
                    </Link>
                    <div className="px-4 py-2 rounded-full border border-glass-border bg-white/5 text-sm font-medium text-gray-400">
                        Admin Ag√™ncia
                    </div>
                </div>
            </header>

            {/* GLASS TABLE CONTAINER */}
            <div className="relative z-10 glass-panel rounded-2xl overflow-hidden border-glass-border/30 shadow-2xl animate-fade-in-up">
                {loading ? (
                    <div className="p-12 text-center text-gray-400 flex flex-col items-center gap-4">
                        <Loader2 className="w-8 h-8 animate-spin text-primary" />
                        <span className="tracking-wide uppercase text-xs font-bold">Carregando pipeline...</span>
                    </div>
                ) : (
                    <div className="overflow-x-auto">
                        <table className="w-full text-left border-collapse">
                            <thead>
                                <tr className="border-b border-glass-border">
                                    <th className="p-5 text-gray-500 font-medium text-xs uppercase tracking-wider pl-8">Cliente</th>
                                    <th className="p-5 text-center text-gray-500 font-medium text-xs uppercase tracking-wider">Ideias</th>
                                    <th className="p-5 text-center text-amber-500/80 font-medium text-xs uppercase tracking-wider">Aguardando</th>
                                    <th className="p-5 text-center text-red-500/80 font-medium text-xs uppercase tracking-wider">Revis√£o</th>
                                    <th className="p-5 text-center text-emerald-500/80 font-medium text-xs uppercase tracking-wider">Aprovados</th>
                                    <th className="p-5 text-right text-gray-500 font-medium text-xs uppercase tracking-wider pr-8">A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody className="divide-y divide-glass-border/50">
                                {clients.length > 0 ? (
                                    clients.map(client => {
                                        const stats = getClientStats(client.name)
                                        const initial = client.name.charAt(0).toUpperCase()

                                        return (
                                            <tr key={client.id} className="group hover:bg-white/5 transition-colors duration-200">
                                                <td className="p-5 pl-8">
                                                    <div className="flex items-center gap-4">
                                                        <div className="w-10 h-10 rounded-full bg-gradient-to-br from-gray-800 to-black border border-glass-border flex items-center justify-center text-sm font-bold text-gray-300 shadow-inner group-hover:border-primary/50 transition-colors">
                                                            {initial}
                                                        </div>
                                                        <div className="flex flex-col">
                                                            <span className="font-semibold text-gray-200 group-hover:text-white transition-colors">{client.name}</span>
                                                            {unreadCounts[client.name] > 0 && (
                                                                <span className="text-xs text-red-400 animate-pulse font-bold flex items-center gap-1 mt-1">
                                                                    <span className="w-1.5 h-1.5 rounded-full bg-red-500" />
                                                                    {unreadCounts[client.name]} nova(s) msg
                                                                </span>
                                                            )}
                                                        </div>
                                                    </div>
                                                </td>

                                                <td className="p-5 text-center">
                                                    {renderCount(stats.drafts, 'draft')}
                                                </td>

                                                <td className="p-5 text-center">
                                                    {renderCount(stats.waiting, 'waiting')}
                                                </td>

                                                <td className="p-5 text-center">
                                                    {stats.review > 0 ? (
                                                        <span className="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-500/10 text-red-400 border border-red-500/20">
                                                            {stats.review}
                                                        </span>
                                                    ) : (
                                                        <span className="text-gray-600">-</span>
                                                    )}
                                                </td>

                                                <td className="p-5 text-center relative overflow-hidden">
                                                    {renderCount(stats.approved, 'approved')}
                                                    {stats.approved > 0 && <div className="absolute inset-x-0 bottom-0 h-0.5 bg-emerald-500/20 group-hover:bg-emerald-500/50 transition-colors" />}
                                                </td>

                                                <td className="p-5 pr-8 text-right">
                                                    <div className="flex items-center justify-end gap-2 opacity-60 group-hover:opacity-100 transition-opacity">
                                                        <Link
                                                            to={`/posts?client=${encodeURIComponent(client.name)}`}
                                                            className="p-2 rounded-lg hover:bg-white/10 text-gray-400 hover:text-white transition-colors"
                                                            title="Abrir Posts"
                                                        >
                                                            <ArrowUpRight size={18} />
                                                        </Link>
                                                        <button
                                                            className="p-2 rounded-lg hover:bg-white/10 text-gray-400 hover:text-primary transition-colors"
                                                            title="Copiar Link do Portal"
                                                            onClick={() => copyLink(client.name)}
                                                        >
                                                            <LinkIcon size={18} />
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                        )
                                    })
                                ) : (
                                    <tr>
                                        <td colSpan="6" className="p-12 text-center text-gray-500">
                                            Nenhum cliente cadastrado no pipeline.
                                        </td>
                                    </tr>
                                )}
                            </tbody>
                        </table>
                    </div>
                )}
            </div>
        </div>
    )
}

export default AdminPanel

```

---

## Arquivo: src\pages\CampaignLeadsPage.jsx
```jsx
import React, { useState, useEffect } from 'react'
import { useParams, useNavigate } from 'react-router-dom'
import { supabase } from '../services/supabaseClient'
import { useClientSelection } from '../contexts/ClientSelectionContext'
import {
    ArrowLeft,
    Search,
    Loader2,
    Building,
    MapPin,
    CheckSquare,
    Square,
    Bot,
    MoreHorizontal,
    Zap,
    RefreshCw,
    X,
    ExternalLink,
    Save,
    Gem
} from 'lucide-react'

const CampaignLeadsPage = () => {
    const { campaignId } = useParams() // Note: Route defined as :campaignId
    const navigate = useNavigate()
    const { selectedClientId } = useClientSelection()

    const [campaign, setCampaign] = useState(null)
    const [leads, setLeads] = useState([])
    const [loading, setLoading] = useState(false)
    const [searchTerm, setSearchTerm] = useState('')

    // Selection State
    const [selectedLeads, setSelectedLeads] = useState([]) // Array of IDs

    // Bulk Action State
    const [isProcessingBulk, setIsProcessingBulk] = useState(false)
    const [bulkProgressText, setBulkProgressText] = useState('')
    const [notification, setNotification] = useState(null)

    // Drawer / Curation State
    const [selectedLead, setSelectedLead] = useState(null)
    const [icebreakerText, setIcebreakerText] = useState('')
    const [isSaving, setIsSaving] = useState(false)

    useEffect(() => {
        if (selectedClientId && campaignId) {
            fetchCampaign()
            fetchLeads()
        }
    }, [selectedClientId, campaignId])

    const fetchCampaign = async () => {
        try {
            const { data, error } = await supabase
                .from('campaigns')
                .select('*')
                .eq('id', campaignId)
                .single()

            if (error) throw error
            setCampaign(data)
        } catch (error) {
            console.error('Error fetching campaign:', error)
        }
    }

    const fetchLeads = async () => {
        setLoading(true)
        try {
            // Join campaign_leads with leads table
            const { data, error } = await supabase
                .from('campaign_leads')
                .select(`
                    *,
                    leads:lead_id (*)
                `)
                .eq('campaign_id', campaignId)
                .order('created_at', { ascending: false })

            if (error) throw error
            setLeads(data || [])
        } catch (error) {
            console.error('Error fetching leads:', error)
        } finally {
            setLoading(false)
        }
    }

    // Selection Logic
    const toggleSelectAll = () => {
        if (selectedLeads.length === leads.length) {
            setSelectedLeads([])
        } else {
            setSelectedLeads(leads.map(l => l.id))
        }
    }

    const toggleSelectOne = (id) => {
        if (selectedLeads.includes(id)) {
            setSelectedLeads(selectedLeads.filter(l => l !== id))
        } else {
            setSelectedLeads([...selectedLeads, id])
        }
    }

    const handleBulkIcebreaker = async () => {
        if (!selectedLeads.length || !selectedClientId) return

        // 1. Calculate Estimated Time (3.5s per lead)
        const totalSeconds = selectedLeads.length * 3.5
        let timeString = `${Math.ceil(totalSeconds)} segundos`
        if (totalSeconds > 60) {
            timeString = `${Math.ceil(totalSeconds / 60)} minutos`
        }

        // 2. Set State
        setIsProcessingBulk(true)
        setBulkProgressText(`Gerando ${selectedLeads.length} mensagens. Tempo estimado: ${timeString}...`)

        try {
            // 3. Call Webhook
            const response = await fetch('https://n8n-n8n-start.kfocge.easypanel.host/webhook/generate-bulk-icebreakers', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    lead_ids: selectedLeads,
                    client_id: selectedClientId
                })
            })

            if (response.ok) {
                // 4. Success
                setNotification({
                    message: `${selectedLeads.length} Icebreakers gerados com sucesso!`,
                    type: 'success'
                })
                setSelectedLeads([]) // Clear selection
                fetchLeads() // Refresh data
            } else {
                throw new Error('Falha na API')
            }

        } catch (error) {
            console.error('Error generating icebreakers:', error)
            setNotification({
                message: 'Erro ao gerar Icebreakers. Tente novamente.',
                type: 'error'
            })
        } finally {
            setIsProcessingBulk(false)
            setBulkProgressText('')
            setTimeout(() => setNotification(null), 5000)
        }
    }

    const filteredLeads = leads.filter(item => {
        const lead = item.leads || {}
        const name = lead.nome || ''
        return name.toLowerCase().includes(searchTerm.toLowerCase())
    })

    // Filtered selection logic support
    // (If searching, 'Select All' could ideally only select visible, but simple global for now is fine or constrained to filtered)
    // Let's stick to simple ID matching for now.

    const getICPBadge = (reason) => {
        // Simple visual logic based on existence of ICP reason or score field if it existed
        // User asked for A, B, C. We don't have that field explicitly yet in the previous schemas viewed,
        // but let's mock the UI for it or use a heuristic.
        // For now, I'll render a generic 'A' badge if qualified, or 'C' if not.
        // Actually, let's use a random mock or derived prop for the visual request.
        return (
            <span className="inline-flex items-center justify-center w-6 h-6 rounded-full bg-green-100 text-green-700 font-bold text-xs border border-green-200">
                A
            </span>
        )
    }

    const getStatusBadge = (status) => {
        switch (status) {
            case 'PENDING_ENRICHMENT':
                return <span className="px-2 py-1 bg-yellow-50 text-yellow-700 rounded-md text-xs font-bold border border-yellow-200">Na Fila</span>
            case 'QUALIFIED_NO_ICEBREAKER':
                return <span className="px-2 py-1 bg-blue-50 text-blue-700 rounded-md text-xs font-bold border border-blue-200">Importado</span>
            case 'APPROACH_READY':
                return <span className="px-2 py-1 bg-green-50 text-green-700 rounded-md text-xs font-bold border border-green-200">Pronto</span>
            default:
                return <span className="px-2 py-1 bg-gray-50 text-gray-600 rounded-md text-xs font-bold border border-gray-200">{status || 'Desconhecido'}</span>
        }
    }

    // Agency Lock
    if (!selectedClientId) {
        return (
            <div className="min-h-screen bg-slate-50 flex items-center justify-center p-6">
                <div className="text-center max-w-md">
                    <div className="bg-white p-6 rounded-full inline-flex mb-6 shadow-sm border border-slate-100">
                        <Building size={48} className="text-slate-300" />
                    </div>
                    <h2 className="text-2xl font-bold text-slate-800 mb-3">Selecione um Cliente</h2>
                    <p className="text-slate-500">
                        Voc√™ precisa selecionar um cliente para visualizar os leads desta campanha.
                    </p>
                </div>
            </div>
        )
    }

    return (
        <div className="min-h-screen bg-slate-50 p-6 md:p-8 font-sans text-slate-800">

            {/* NOTIFICATION TOAST */}
            {notification && (
                <div className={`fixed top-6 right-6 z-50 px-4 py-3 rounded-lg shadow-lg border flex items-center gap-3 animate-slide-in-right ${notification.type === 'error' ? 'bg-red-50 border-red-200 text-red-600' : 'bg-white border-gray-200 text-slate-700'
                    }`}>
                    {notification.type === 'error' ? <Zap size={18} /> : <RefreshCw size={18} className="text-green-500" />}
                    <span className="text-sm font-medium">{notification.message}</span>
                </div>
            )}
            {/* Header */}
            <div className="max-w-7xl mx-auto mb-8">
                <button
                    onClick={() => navigate('/lists')}
                    className="flex items-center gap-2 text-slate-500 hover:text-indigo-600 transition-colors mb-6 text-sm font-bold"
                >
                    <ArrowLeft size={16} /> Voltar para Listas
                </button>

                <div className="flex flex-col md:flex-row justify-between items-end gap-4">
                    <div>
                        <h1 className="text-3xl font-bold text-slate-900 tracking-tight mb-2">
                            {campaign ? campaign.name : 'Carregando...'}
                        </h1>
                        <p className="text-slate-500 font-medium">
                            Gerencie e qualifique os leads da sua campanha.
                        </p>
                    </div>
                    <div className="flex items-center gap-3">
                        {/* Global Actions could go here */}
                    </div>
                </div>
            </div>

            {/* Toolbar & Bulk Actions */}
            <div className="max-w-7xl mx-auto bg-white p-4 rounded-xl border border-slate-200 shadow-sm mb-6 sticky top-4 z-10 transition-all">
                <div className="flex flex-col md:flex-row justify-between items-center gap-4">

                    {selectedLeads.length > 0 ? (
                        <div className="flex items-center gap-4 w-full md:w-auto animate-fade-in">
                            <div className="px-4 py-2 bg-indigo-50 text-indigo-700 rounded-lg font-bold text-sm border border-indigo-100">
                                {selectedLeads.length} leads selecionados
                            </div>
                            <div className="h-8 w-px bg-slate-200 hidden md:block"></div>
                            <button
                                onClick={handleBulkIcebreaker}
                                disabled={isProcessingBulk}
                                className={`flex items-center gap-2 px-4 py-2 rounded-lg font-bold transition-all shadow-md ${isProcessingBulk
                                    ? 'bg-indigo-400 text-white cursor-not-allowed'
                                    : 'bg-indigo-600 text-white hover:bg-indigo-700 shadow-indigo-200'
                                    }`}
                            >
                                {isProcessingBulk ? <Loader2 size={18} className="animate-spin" /> : <Bot size={18} />}
                                {isProcessingBulk ? bulkProgressText : 'Gerar Icebreakers'}
                            </button>
                        </div>
                    ) : (
                        <div className="flex items-center gap-2 text-slate-400 text-sm font-medium">
                            <CheckSquare size={18} /> Selecione leads para a√ß√µes em massa
                        </div>
                    )}

                    <div className="relative w-full md:w-80">
                        <Search className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400" size={18} />
                        <input
                            type="text"
                            placeholder="Buscar por nome ou cargo..."
                            value={searchTerm}
                            onChange={e => setSearchTerm(e.target.value)}
                            className="w-full pl-10 pr-4 py-2 bg-slate-50 border border-slate-200 rounded-lg text-slate-800 focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 transition-all font-medium"
                        />
                    </div>
                </div>
            </div>

            {/* Table */}
            <div className="max-w-7xl mx-auto bg-white border border-slate-200 rounded-xl shadow-sm overflow-hidden">
                <table className="w-full text-left border-collapse">
                    <thead>
                        <tr className="bg-slate-50 border-b border-slate-200 text-xs font-bold text-slate-500 uppercase tracking-wider">
                            <th className="p-4 w-12 text-center">
                                <button
                                    onClick={toggleSelectAll}
                                    className="text-slate-400 hover:text-indigo-600 transition-colors"
                                >
                                    {selectedLeads.length === leads.length && leads.length > 0 ? (
                                        <CheckSquare size={20} className="text-indigo-600" />
                                    ) : (
                                        <Square size={20} />
                                    )}
                                </button>
                            </th>
                            <th className="py-4 px-4">Lead</th>
                            <th className="py-4 px-4">Cargo / Headline</th>
                            <th className="py-4 px-4">Empresa</th>
                            <th className="py-4 px-4">Localiza√ß√£o</th>
                            <th className="py-4 px-4 text-center">ICP</th>
                            <th className="py-4 px-4 text-center">Status</th>
                            <th className="py-4 px-4 text-right"></th>
                        </tr>
                    </thead>
                    <tbody className="divide-y divide-gray-100">
                        {loading ? (
                            <tr>
                                <td colSpan="8" className="py-20 text-center text-gray-400">
                                    <Loader2 className="animate-spin mx-auto mb-2" size={32} />
                                    Carregando leads...
                                </td>
                            </tr>
                        ) : filteredLeads.length === 0 ? (
                            <tr>
                                <td colSpan="8" className="py-20 text-center text-gray-400">
                                    Nenhum lead encontrado.
                                </td>
                            </tr>
                        ) : (
                            filteredLeads.map(item => {
                                const lead = item.leads || {}
                                const isSelected = selectedLeads.includes(item.id)

                                return (
                                    <tr
                                        key={item.id}
                                        onClick={() => openDrawer(item)}
                                        className={`hover:bg-slate-50 transition-colors cursor-pointer group ${isSelected ? 'bg-indigo-50/30' : ''}`}
                                    >
                                        <td className="p-4 text-center" onClick={(e) => e.stopPropagation()}>
                                            <button
                                                onClick={() => toggleSelectOne(item.id)}
                                                className="text-slate-300 hover:text-indigo-600 transition-colors"
                                            >
                                                {isSelected ? (
                                                    <CheckSquare size={20} className="text-indigo-600" />
                                                ) : (
                                                    <Square size={20} />
                                                )}
                                            </button>
                                        </td>
                                        <td className="p-4">
                                            <div className="flex items-center gap-3">
                                                <div className="w-9 h-9 rounded-full bg-slate-200 border border-white shadow-sm flex items-center justify-center text-xs font-bold text-slate-500 overflow-hidden shrink-0">
                                                    {lead.avatar_url ? (
                                                        <img src={lead.avatar_url} alt="" className="w-full h-full object-cover" />
                                                    ) : (
                                                        lead.nome?.charAt(0).toUpperCase() || '?'
                                                    )}
                                                </div>
                                                <div className="font-bold text-slate-800 text-sm truncate max-w-[150px]" title={lead.nome}>
                                                    {lead.nome || 'Sem Nome'}
                                                </div>
                                            </div>
                                        </td>
                                        <td className="p-4">
                                            <div className="text-xs text-slate-500 font-medium truncate max-w-[200px]" title={lead.headline}>
                                                {lead.headline || '-'}
                                            </div>
                                        </td>
                                        <td className="p-4">
                                            <div className="flex items-center gap-1.5 text-xs font-semibold text-slate-700">
                                                <Building size={12} className="text-slate-400" />
                                                <span className="truncate max-w-[140px]">{lead.company_name || '-'}</span>
                                            </div>
                                        </td>
                                        <td className="p-4">
                                            <div className="flex items-center gap-1.5 text-xs text-slate-500">
                                                <MapPin size={12} className="text-slate-400" />
                                                <span className="truncate max-w-[120px]">{lead.location || '-'}</span>
                                            </div>
                                        </td>
                                        <td className="p-4 text-center">
                                            {getICPBadge(lead.icp_reason)}
                                        </td>
                                        <td className="p-4 text-center">
                                            {getStatusBadge(item.status_pipeline)}
                                        </td>
                                        <td className="p-4 text-right">
                                            <button className="p-1.5 rounded-md hover:bg-gray-100 text-gray-400 hover:text-slate-600">
                                                <MoreHorizontal size={18} />
                                            </button>
                                        </td>
                                    </tr>
                                )
                            })
                        )}
                    </tbody>
                </table>
            </div>

            {/* LEADS CURATION DRAWER */}
            {
                selectedLead && selectedLead.leads && (
                    <div className="fixed inset-0 z-50 flex justify-end">
                        <div
                            className="absolute inset-0 bg-slate-900/20 backdrop-blur-sm transition-opacity"
                            onClick={() => setSelectedLead(null)}
                        />
                        <div className="relative w-full max-w-lg bg-white h-full shadow-2xl flex flex-col animate-slide-in-right overflow-hidden border-l border-gray-200">

                            {/* HEADER */}
                            <div className="p-6 border-b border-gray-100 flex justify-between items-start bg-slate-50/50">
                                <div className="flex gap-4">
                                    <div className="w-14 h-14 rounded-full bg-white border border-gray-200 shadow-sm flex items-center justify-center text-xl font-bold text-slate-500 overflow-hidden shrink-0">
                                        {selectedLead.leads.avatar_url ? (
                                            <img src={selectedLead.leads.avatar_url} className="w-full h-full object-cover" />
                                        ) : (selectedLead.leads.nome?.charAt(0).toUpperCase())}
                                    </div>
                                    <div>
                                        <h2 className="text-xl font-bold text-slate-900 leading-tight">
                                            {selectedLead.leads.nome || 'Lead sem nome'}
                                        </h2>
                                        <p className="text-sm text-slate-500 font-medium mb-1">
                                            {selectedLead.leads.headline || 'Sem cargo'}
                                        </p>
                                        {selectedLead.leads.linkedin_profile && (
                                            <a
                                                href={selectedLead.leads.linkedin_profile}
                                                target="_blank"
                                                rel="noopener noreferrer"
                                                className="inline-flex items-center gap-1 text-xs font-bold text-blue-600 hover:text-blue-700 hover:underline"
                                            >
                                                <ExternalLink size={12} /> Ver LinkedIn
                                            </a>
                                        )}
                                    </div>
                                </div>
                                <button onClick={() => setSelectedLead(null)} className="p-2 rounded-full hover:bg-white text-gray-400 hover:text-slate-600 transition-all border border-transparent hover:border-gray-200 hover:shadow-sm">
                                    <X size={20} />
                                </button>
                            </div>

                            {/* BODY */}
                            <div className="flex-1 overflow-y-auto p-6 space-y-6 custom-scrollbar">

                                {/* SECTION 1: CONTEXT */}
                                <div className="space-y-3">
                                    <div className="flex items-center gap-2">
                                        {selectedLead.leads.is_high_ticket && (
                                            <span className="px-2.5 py-1 bg-purple-50 text-purple-700 text-xs font-bold rounded-lg border border-purple-100 flex items-center gap-1.5">
                                                <Gem size={12} /> High Ticket
                                            </span>
                                        )}
                                        <span className="px-2.5 py-1 bg-green-50 text-green-700 text-xs font-bold rounded-lg border border-green-100">
                                            ICP Score: A
                                        </span>
                                    </div>

                                    <div className="p-4 bg-slate-50 rounded-xl border border-slate-200">
                                        <h4 className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2">
                                            An√°lise da IA
                                        </h4>
                                        <p className="text-sm text-slate-600 leading-relaxed">
                                            {selectedLead.leads.analysis_reasoning || selectedLead.leads.icp_reason || "Sem an√°lise dispon√≠vel para este lead."}
                                        </p>
                                    </div>
                                </div>

                                {/* SECTION 2: ICEBREAKER */}
                                <div>
                                    <label className="flex justify-between items-center mb-2">
                                        <span className="text-sm font-bold text-slate-800">Icebreaker (Mensagem de Conex√£o)</span>
                                        <span className={`text-xs font-bold ${icebreakerText.length > 300 ? 'text-red-500' : 'text-slate-400'}`}>
                                            {icebreakerText.length}/300
                                        </span>
                                    </label>
                                    <textarea
                                        className="w-full h-48 p-4 bg-white border border-gray-200 rounded-xl text-slate-700 focus:outline-none focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/10 transition-all font-medium leading-relaxed resize-none text-sm shadow-sm"
                                        placeholder="Escreva ou edite o icebreaker aqui..."
                                        value={icebreakerText}
                                        onChange={(e) => setIcebreakerText(e.target.value)}
                                    />
                                    <p className="text-xs text-gray-400 mt-2">
                                        Dica: Personalize a mensagem com base na an√°lise da IA acima.
                                    </p>
                                </div>

                            </div>

                            {/* FOOTER */}
                            <div className="p-6 border-t border-gray-100 bg-white shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)]">
                                <button
                                    onClick={handleSaveIcebreaker}
                                    disabled={isSaving}
                                    className="w-full py-3 rounded-xl bg-indigo-600 text-white font-bold text-sm shadow-lg shadow-indigo-200 hover:bg-indigo-700 hover:shadow-indigo-300 transition-all active:scale-[0.98] flex items-center justify-center gap-2"
                                >
                                    {isSaving ? <Loader2 size={18} className="animate-spin" /> : <Save size={18} />}
                                    {isSaving ? 'Salvando...' : 'Salvar Altera√ß√µes'}
                                </button>
                            </div>
                        </div>
                    </div>
                )
            }
        </div>
    )
}

export default CampaignLeadsPage

```

---

## Arquivo: src\pages\CampaignLeadsView.jsx
```jsx
import React, { useState, useEffect, useRef } from 'react'
import { supabase } from '../services/supabaseClient'
import { useClientSelection } from '../contexts/ClientSelectionContext'
import { useParams, useNavigate } from 'react-router-dom'
import {
    Search,
    Loader2,
    Sparkles,
    Briefcase,
    Gem,
    Building2,
    Globe,
    Send,
    Bot,
    Plus,
    Check,
    Zap,
    RefreshCw,
    X,
    Trash2,
    MapPin,
    Copy,
    ExternalLink,
    ArrowUpDown,
    Filter,
    ChevronsUpDown,
    ArrowLeft,
    Users,
    MessageSquare,
    History,
    Clock,
    ChevronLeft,
    ChevronRight,
    MessageCircle,
    Trophy,
    Medal,
    Brain
} from 'lucide-react'
import AddLeadsModal from '../components/AddLeadsModal'
import LeadDetailModal from '../components/LeadDetailModal'

const CampaignLeadsView = () => {
    const { id: campaignId } = useParams()
    const navigate = useNavigate()
    const { selectedClientId } = useClientSelection()

    const [campaign, setCampaign] = useState(null)
    const [leads, setLeads] = useState([]) // Stores the JOINED object: { ...campaign_lead, leads: { ...lead_data } }
    const [loading, setLoading] = useState(false)
    const [selectedLead, setSelectedLead] = useState(null) // This will store the full enriched object for the drawer
    const [searchTerm, setSearchTerm] = useState('')
    const [debouncedSearch, setDebouncedSearch] = useState('')
    const [stats, setStats] = useState({ total: 0, hot: 0, interactions: 0 })
    const [totalMessages, setTotalMessages] = useState(0)
    const [topLeads, setTopLeads] = useState([])

    // Chat/Interactions State
    const [interactions, setInteractions] = useState([])
    const [loadingChat, setLoadingChat] = useState(false)

    // Data Table State
    const [selectedLeads, setSelectedLeads] = useState(new Set())
    const [sortConfig, setSortConfig] = useState({ key: 'added_at', direction: 'desc' })
    const [filters, setFilters] = useState({
        status: [],
        qualification: [],
        company: '',
        role: '',
        hasMessages: '' // 'yes', 'no', or ''
    })
    const [isFilterOpen, setIsFilterOpen] = useState(false)

    // Pagination State
    const [page, setPage] = useState(0)
    const [hasMore, setHasMore] = useState(true)
    const [loadingMore, setLoadingMore] = useState(false)
    const ITEMS_per_PAGE = 100

    // Logic State
    const [enrichmentLoading, setEnrichmentLoading] = useState(false)
    const [notification, setNotification] = useState(null)
    const [sendingMessage, setSendingMessage] = useState(false)
    const [icebreakerLoading, setIcebreakerLoading] = useState(null) // ID of lead being processed
    const [messageDraft, setMessageDraft] = useState('')
    const [isAddLeadsModalOpen, setIsAddLeadsModalOpen] = useState(false)
    const [syncLoading, setSyncLoading] = useState(false)
    const [clientSyncTimestamp, setClientSyncTimestamp] = useState(null) // from clients.last_sync_timestamp

    // NEW: Bulk History Import State
    const [importQueue, setImportQueue] = useState({
        active: false,
        current: 0,
        total: 0,
        failures: 0,
        currentLeadName: ''
    })
    const [showImportConfirm, setShowImportConfirm] = useState(false)



    // Helper function for delay (Safe Queue Pattern)
    const sleep = (ms) => new Promise(resolve => setTimeout(resolve, ms))



    // Debounce Search
    useEffect(() => {
        const timer = setTimeout(() => {
            setDebouncedSearch(searchTerm)
        }, 500)
        return () => clearTimeout(timer)
    }, [searchTerm])

    useEffect(() => {
        if (selectedLead && selectedLead.leads) {
            setMessageDraft(selectedLead.leads.suggested_message || '')
        }

        // Fetch Interactions (Chat History)
        if (!selectedLead?.leads?.id) {
            setInteractions([])
            return // Don't fetch if no lead
        }

        const fetchInteractions = async () => {
            setLoadingChat(true)
            try {
                const { data, error } = await supabase
                    .from('interactions')
                    .select('*')
                    .eq('lead_id', selectedLead.leads.id)
                    .order('interaction_date', { ascending: false })

                if (error) throw error
                setInteractions(data || [])
            } catch (err) {
                console.error('Erro ao buscar intera√ß√µes:', err)
            } finally {
                setLoadingChat(false)
            }
        }

        fetchInteractions()
    }, [selectedLead])



    // Realtime Subscription
    useEffect(() => {
        if (!campaignId) return

        const channel = supabase
            .channel(`campaign_leads_changes_${campaignId}`)
            .on(
                'postgres_changes',
                {
                    event: '*',
                    schema: 'public',
                    table: 'campaign_leads',
                    filter: `campaign_id=eq.${campaignId}`
                },
                (payload) => {
                    // Refresh data on any change for now to be safe
                    // Optimization: handle INSERT/UPDATE locally
                    console.log('Realtime update:', payload)
                    fetchLeads(0, true) // Specific refresh might be better but this ensures consistency
                    fetchStats()
                }
            )
            .subscribe()

        return () => {
            supabase.removeChannel(channel)
        }
    }, [campaignId])


    const fetchCampaignDetails = async () => {
        const { data } = await supabase
            .from('campaigns')
            .select('*')
            .eq('id', campaignId)
            .single()
        setCampaign(data)
    }

    const fetchClientSyncTimestamp = async () => {
        if (!selectedClientId) return
        try {
            const { data } = await supabase
                .from('clients')
                .select('last_sync_timestamp')
                .eq('id', selectedClientId)
                .single()

            if (data?.last_sync_timestamp) {
                setClientSyncTimestamp(data.last_sync_timestamp)
            }
        } catch (err) {
            console.error('Error fetching client sync timestamp:', err)
        }
    }

    const fetchStats = async () => {
        if (!selectedClientId || !campaignId) return

        try {
            const { count: totalCount } = await supabase
                .from('campaign_leads')
                .select('*', { count: 'exact', head: true })
                .eq('campaign_id', campaignId)

            setStats(prev => ({ ...prev, total: totalCount || 0 }))

        } catch (error) {
            console.error('Erro ao buscar KPIs:', error)
        }
    }

    // Fetch Total Messages (Global Counter)
    const fetchTotalMessages = async () => {
        try {
            const { count, error } = await supabase
                .from('interactions')
                .select('*', { count: 'exact', head: true })

            if (error) throw error
            setTotalMessages(count || 0)
        } catch (err) {
            console.error('Erro ao buscar total de mensagens:', err)
        }
    }

    // Fetch Top Leads (Engagement Ranking)
    const fetchTopLeads = async () => {
        try {
            const { data, error } = await supabase
                .from('leads_with_stats')
                .select('id, nome, avatar_url, total_interactions, empresa')
                .gt('total_interactions', 0)
                .order('total_interactions', { ascending: false })
                .limit(5)

            if (error) throw error
            setTopLeads(data || [])
        } catch (err) {
            console.error('Erro ao buscar top leads:', err)
        }
    }

    // SIMPLIFIED FETCH: Query campaign_leads view directly (flat structure)
    const fetchLeads = async (pageIndex = 0, isRefresh = false) => {
        if (!selectedClientId || !campaignId) return

        try {
            if (pageIndex === 0) setLoading(true)
            else setLoadingMore(true)

            const from = pageIndex * ITEMS_per_PAGE
            const to = from + ITEMS_per_PAGE - 1

            // FIXED: Reverted to simple select to fix PGRST200 error (view relationship missing)
            let query = supabase
                .from('campaign_leads')
                .select('*', { count: 'exact' })
                .eq('campaign_id', campaignId)
                .range(from, to)

            // FIXED: Direct sorting (no foreignTable needed)
            if (sortConfig.key) {
                query = query.order(sortConfig.key, { ascending: sortConfig.direction === 'asc' })
            } else {
                query = query.order('added_at', { ascending: false })
            }

            // FIXED: Direct search on view columns
            if (debouncedSearch) {
                query = query.or(`nome.ilike.%${debouncedSearch}%,empresa.ilike.%${debouncedSearch}%,headline.ilike.%${debouncedSearch}%`)
            }

            // FIXED: Direct filters on view columns
            if (filters.status.length > 0) {
                console.log('[Filter] Applying status filter:', filters.status)
                query = query.in('status_pipeline', filters.status)
            }

            if (filters.qualification.length > 0) {
                console.log('[Filter] Applying qualification filter:', filters.qualification)
                query = query.in('icp_score', filters.qualification)
            }

            if (filters.hasMessages === 'yes') {
                console.log('[Filter] Applying hasMessages filter: with messages')
                query = query.gt('total_interactions', 0)
            } else if (filters.hasMessages === 'no') {
                console.log('[Filter] Applying hasMessages filter: no messages')
                query = query.eq('total_interactions', 0)
            }

            const { data, error, count } = await query

            console.log('[Fetch Results] Data:', data)
            console.log('[Fetch Results] Count:', count)
            console.log('[Fetch Results] Error:', error)

            if (error) throw error

            if (data) {
                console.log(`[Fetch Success] Retrieved ${data.length} leads`)
                setLeads(data) // Pagination: always replace
                setHasMore(data.length === ITEMS_per_PAGE)
            }
        } catch (err) {
            console.error('Erro ao buscar leads:', err)
        } finally {
            setLoading(false)
            setLoadingMore(false)
        }
    }

    useEffect(() => {
        if (campaignId && selectedClientId) {
            // Only fetch details once or if campaignId changes
            if (page === 0) {
                fetchCampaignDetails()
                fetchClientSyncTimestamp()
            }
        }
    }, [campaignId, selectedClientId])

    useEffect(() => {
        if (campaignId && selectedClientId) {
            setLeads([])
            setPage(0)
            setHasMore(true)
            fetchLeads(0, true)
            fetchStats()
        }
    }, [campaignId, selectedClientId, debouncedSearch, sortConfig, filters])

    // Fetch total messages and top leads once on mount
    useEffect(() => {
        fetchTotalMessages()
        fetchTopLeads()
    }, [])

    // --- HANDLERS ---
    const handleSort = (key) => {
        setSortConfig(current => ({
            key,
            direction: current.key === key && current.direction === 'asc' ? 'desc' : 'asc'
        }))
    }

    const toggleSelectAll = () => {
        if (selectedLeads.size === leads.length && leads.length > 0) {
            setSelectedLeads(new Set())
        } else {
            setSelectedLeads(new Set(leads.map(l => l.id)))
        }
    }

    const toggleSelectRow = (id, e) => {
        e.stopPropagation()
        const newSet = new Set(selectedLeads)
        if (newSet.has(id)) newSet.delete(id)
        else newSet.add(id)
        setSelectedLeads(newSet)
    }

    const toggleFilterStatus = (statusValue) => {
        setFilters(prev => {
            const current = prev.status
            const newStatus = current.includes(statusValue)
                ? current.filter(s => s !== statusValue)
                : [...current, statusValue]
            return { ...prev, status: newStatus }
        })
    }



    const handleCopy = (text) => {
        navigator.clipboard.writeText(text)
        setNotification({ message: 'Copiado para a √°rea de transfer√™ncia', type: 'info' })
        setTimeout(() => setNotification(null), 2000)
    }

    const handleSendMessage = async () => {
        if (!selectedLead) return
        setSendingMessage(true)

        try {
            await new Promise(resolve => setTimeout(resolve, 1500))
            setNotification({ message: 'Conex√£o enviada com sucesso!', type: 'success' })
            setSelectedLead(null)
        } catch (e) {
            setNotification({ message: 'Erro ao enviar.', type: 'error' })
        } finally {
            setSendingMessage(false)
            setTimeout(() => setNotification(null), 3000)
        }
    }

    // UPDATED: Start Connections Sync (Queue Workflow A)
    const handleEnrichmentQueue = async () => {
        if (!selectedClientId) return
        setEnrichmentLoading(true)
        setNotification({ message: 'Iniciando coleta em segundo plano...', type: 'info' })

        try {
            const response = await fetch('https://n8n-n8n-start.kfocge.easypanel.host/webhook/start-connections-sync', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    client_id: selectedClientId,
                    campaign_id: campaignId
                })
            })

            if (response.ok) {
                setNotification({ message: 'Coleta iniciada! Os leads ser√£o processados em breve.', type: 'success' })
            } else {
                throw new Error('Falha no webhook')
            }

        } catch (error) {
            console.error(error)
            setNotification({ message: 'Erro ao iniciar fila de enriquecimento.', type: 'error' })
        } finally {
            setEnrichmentLoading(false)
            setTimeout(() => setNotification(null), 5000)
        }
    }

    const handleSyncConnections = async () => {
        if (!selectedClientId || !campaignId) return

        try {
            // 1. Fetch Client Unipile ID
            const { data: client, error } = await supabase
                .from('clients')
                .select('unipile_account_id')
                .eq('id', selectedClientId)
                .single()

            if (error || !client?.unipile_account_id) {
                setNotification({ message: 'Erro: Cliente sem conta Unipile conectada.', type: 'error' })
                return
            }

            // 2. Call Webhook
            const response = await fetch('https://n8n-n8n-start.kfocge.easypanel.host/webhook-test/sync-connections', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    client_id: selectedClientId,
                    unipile_account_id: client.unipile_account_id,
                    campaign_id: campaignId
                })
            })

            if (response.ok) {
                setNotification({ message: 'Iniciando captura e qualifica√ß√£o de leads...', type: 'info' })
            } else {
                throw new Error('Falha na API')
            }
        } catch (e) {
            console.error(e)
            setNotification({ message: 'Erro ao iniciar sincroniza√ß√£o.', type: 'error' })
        }
        setTimeout(() => setNotification(null), 5000)
    }

    // NEW: Sync Messages Manual Trigger
    const handleSyncMessages = async () => {
        if (!selectedClientId) return

        setSyncLoading(true)
        setNotification({ message: 'Iniciando sincroniza√ß√£o de mensagens...', type: 'info' })

        try {
            // 1. Fetch Client Unipile ID & Current User
            const { data: { user } } = await supabase.auth.getUser()

            const { data: client, error } = await supabase
                .from('clients')
                .select('unipile_account_id')
                .eq('id', selectedClientId)
                .single()

            if (error || !client?.unipile_account_id) {
                setNotification({ message: 'Erro: Cliente sem conta Unipile conectada.', type: 'error' })
                setSyncLoading(false)
                setTimeout(() => setNotification(null), 5000)
                return
            }

            // 2. Call Webhook with Enriched Payload
            const response = await fetch('https://n8n-n8n-start.kfocge.easypanel.host/webhook-test/sync-messages', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    account_id: client.unipile_account_id,
                    user_id: user?.id || 'system_user',
                    client_id: selectedClientId
                })
            })

            if (response.ok) {
                // Parse JSON response
                const result = await response.json()

                if (result.success) {
                    const messageCount = result.data?.messages_synced || 0
                    const timestamp = result.data?.last_sync_timestamp || new Date().toISOString()

                    // Update local timestamp (backend saves to DB)
                    setClientSyncTimestamp(timestamp)

                    // Show success with message count
                    setNotification({
                        message: `Sincroniza√ß√£o conclu√≠da! ${messageCount} mensagens processadas.`,
                        type: 'success'
                    })

                    // Refresh data
                    fetchLeads(0, true)
                    fetchTotalMessages()
                } else {
                    throw new Error(result.message || 'Falha na sincroniza√ß√£o')
                }
            } else {
                throw new Error('Erro ao sincronizar. Tente novamente.')
            }
        } catch (error) {
            console.error(error)
            setNotification({
                message: error.message || 'Erro ao sincronizar. Tente novamente.',
                type: 'error'
            })
        } finally {
            setSyncLoading(false)
            setTimeout(() => setNotification(null), 5000)
        }
    }

    // NEW: Generate Icebreaker (Workflow D)
    const handleGenerateIcebreaker = async (leadId, e) => {
        e.stopPropagation() // Prevent row click
        if (!selectedClientId || !leadId) return

        setIcebreakerLoading(leadId)
        setNotification({ message: 'Gerando Icebreaker personalizado...', type: 'info' })

        try {
            const response = await fetch('https://n8n-n8n-start.kfocge.easypanel.host/webhook/generate-icebreaker', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    lead_id: leadId,
                    client_id: selectedClientId
                })
            })

            if (response.ok) {
                setNotification({ message: 'Icebreaker gerado com sucesso!', type: 'success' })
                // Realtime should update the UI
            } else {
                setNotification({ message: 'Erro ao gerar Icebreaker.', type: 'error' })
            }

        } catch (error) {
            console.error(error)
            setNotification({ message: 'Erro de conex√£o.', type: 'error' })
        } finally {
            setIcebreakerLoading(null)
            setTimeout(() => setNotification(null), 3000)
        }

    }

    const handleDeleteLead = async (id, e) => {
        e.stopPropagation()
        if (!confirm('Tem certeza que deseja remover este lead da campanha?')) return

        try {
            const { error } = await supabase
                .from('campaign_leads')
                .delete()
                .eq('id', id)

            if (error) throw error

            setLeads(prev => prev.filter(l => l.id !== id))
            setStats(prev => ({ ...prev, total: prev.total - 1 }))
            setNotification({ message: 'Lead removido com sucesso.', type: 'success' })
        } catch (error) {
            console.error('Error deleting lead:', error)
            setNotification({ message: 'Erro ao remover lead.', type: 'error' })
        }
    }

    // NEW: Force History Import (Workflow B - Manual Trigger)
    const handleForceHistoryImport = async (lead) => {
        if (!selectedClientId || !lead) return

        // Check if we have the client object to get unipile_account_id
        // Ideally we should have it from context or fetch it effectively.
        // We will fetch it again to be safe or assuming we have it.

        setNotification({ message: 'Solicitando importa√ß√£o de hist√≥rico...', type: 'info' })

        try {
            // 1. Fetch Client Unipile ID
            const { data: client, error } = await supabase
                .from('clients')
                .select('unipile_account_id')
                .eq('id', selectedClientId)
                .single()

            if (error || !client?.unipile_account_id) {
                setNotification({ message: 'Erro: Cliente sem conta Unipile conectada.', type: 'error' })
                return
            }

            // 2. Trigger Webhook
            const response = await fetch('https://n8n-n8n-start.kfocge.easypanel.host/webhook/import-history', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    lead_id: lead.id,
                    account_id: client.unipile_account_id
                })
            })

            if (response.ok) {
                setNotification({ message: 'Hist√≥rico sendo importado! Pode levar alguns minutos.', type: 'success' })
            } else {
                setNotification({ message: 'Erro ao acionar importa√ß√£o de hist√≥rico.', type: 'error' })
            }
        } catch (e) {
            console.error('Error importing history:', e)
            setNotification({ message: 'Erro de conex√£o.', type: 'error' })
        }
    }

    // NEW: Manual Sync Recent (Workflow A - Manual Trigger)
    const handleSyncRecent = async (lead, e) => {
        e.stopPropagation()
        if (!selectedClientId || !lead) return

        setNotification({ message: 'Verificando novas mensagens...', type: 'info' })

        try {
            const response = await fetch('https://n8n-n8n-start.kfocge.easypanel.host/webhook/sync-recent-manual', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    lead_id: lead.id,
                    action: 'quick_sync'
                })
            })

            if (response.ok) {
                setNotification({ message: 'Sincroniza√ß√£o r√°pida iniciada!', type: 'success' })
            } else {
                setNotification({ message: 'Erro ao sincronizar.', type: 'error' })
            }
        } catch (e) {
            console.error('Error syncing recent:', e)
            setNotification({ message: 'Erro de conex√£o.', type: 'error' })
        }
    }

    // NEW: Manual Sync History (Workflow B - Manual Trigger from Table)
    const handleSyncHistory = async (lead, e) => {
        e.stopPropagation()
        if (!selectedClientId || !lead) return

        if (!confirm('Aten√ß√£o: Essa a√ß√£o far√° uma varredura profunda no hist√≥rico de conversas do √∫ltimo ano.\\n\\nIsso pode levar alguns minutos. Deseja continuar?')) return

        setNotification({ message: 'Iniciando importa√ß√£o completa de hist√≥rico...', type: 'info' })

        try {
            // 1. Fetch Client Unipile Account ID (REQUIRED by webhook)
            const { data: client, error } = await supabase
                .from('clients')
                .select('unipile_account_id')
                .eq('id', selectedClientId)
                .single()

            if (error || !client?.unipile_account_id) {
                setNotification({
                    message: 'Conecte uma conta do LinkedIn nas configura√ß√µes deste cliente.',
                    type: 'error'
                })
                return
            }

            console.log(`[Sync History] Sending request for lead_id: ${lead.id}, account_id: ${client.unipile_account_id}`)

            // 2. Call Webhook with REQUIRED account_id
            const response = await fetch('https://n8n-n8n-start.kfocge.easypanel.host/webhook/import-history', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    lead_id: lead.id,               // ID REAL do lead (da view leads_with_stats)
                    account_id: client.unipile_account_id
                })
            })

            if (response.ok) {
                setNotification({ message: 'Importa√ß√£o iniciada! O processo rodar√° em segundo plano.', type: 'success' })
            } else {
                const errorText = await response.text()
                console.error(`Webhook Error: ${response.status}`, errorText)
                setNotification({ message: `Erro ao iniciar importa√ß√£o: ${response.status}`, type: 'error' })
            }
        } catch (e) {
            console.error('Error importing history:', e)
            setNotification({ message: 'Erro de conex√£o.', type: 'error' })
        }
    }

    // NEW: Bulk History Import Logic (Workflow B - Mass Action)
    const handleBulkHistorySync = () => {
        setShowImportConfirm(true)
    }

    const cancelImport = () => {
        setShowImportConfirm(false)
    }

    const executeHistoryImport = async () => {
        setShowImportConfirm(false)
        if (!selectedClientId || !campaignId) return

        // 1. PREPARA√á√ÉO DO CLIENTE: Fetch Unipile Account ID (OBRIGAT√ìRIO antes de qualquer loop)
        let clientAccountId
        try {
            const { data: client, error } = await supabase
                .from('clients')
                .select('unipile_account_id')
                .eq('id', selectedClientId)
                .single()

            if (error || !client?.unipile_account_id) {
                setNotification({
                    message: 'Conecte uma conta do LinkedIn nas configura√ß√µes deste cliente.',
                    type: 'error'
                })
                return
            }
            clientAccountId = client.unipile_account_id
        } catch (err) {
            console.error("Error fetching client account ID", err)
            setNotification({ message: 'Erro ao buscar conta Unipile do cliente.', type: 'error' })
            return
        }

        // 2. PREPARA√á√ÉO DOS LEADS: Buscar IDs REAIS diretamente do banco
        let realLeadIds = []
        setNotification({ message: 'Buscando IDs reais dos leads no banco...', type: 'info' })

        try {
            if (selectedLeads.size > 0) {
                // Se h√° sele√ß√£o, buscar apenas os leads selecionados
                // Precisamos mapear os IDs selecionados (que s√£o de campaign_leads) para os IDs reais dos leads
                const selectedCampaignLeadIds = Array.from(selectedLeads)

                const { data, error } = await supabase
                    .from('campaign_leads')
                    .select('lead_id, leads!inner(id, nome)')
                    .in('id', selectedCampaignLeadIds)
                    .eq('campaign_id', campaignId)

                if (error) throw error

                // Extrair os IDs REAIS da tabela leads
                realLeadIds = data.map(item => ({
                    id: item.leads.id,  // ID REAL do lead na tabela leads
                    nome: item.leads.nome
                }))
            } else {
                // Buscar TODOS os leads da campanha diretamente da tabela leads
                const { data, error } = await supabase
                    .from('campaign_leads')
                    .select('lead_id, leads!inner(id, nome)')
                    .eq('campaign_id', campaignId)

                if (error) throw error

                // Extrair os IDs REAIS
                realLeadIds = data.map(item => ({
                    id: item.leads.id,  // ID REAL do lead
                    nome: item.leads.nome
                }))
            }
        } catch (err) {
            console.error("Error fetching real lead IDs", err)
            setNotification({ message: 'Erro ao buscar IDs reais dos leads.', type: 'error' })
            return
        }

        if (realLeadIds.length === 0) {
            setNotification({ message: 'Nenhum lead encontrado para processar.', type: 'error' })
            return
        }

        console.log(`[Bulk Sync] Starting import for ${realLeadIds.length} leads with account ${clientAccountId}`)
        console.log(`[Bulk Sync] Lead IDs:`, realLeadIds.map(l => l.id))

        // 3. Initialize Queue
        setImportQueue({
            active: true,
            current: 0,
            total: realLeadIds.length,
            failures: 0,
            currentLeadName: ''
        })

        // 4. O LOOP DE ENVIO: Process Queue (Sequential Loop with Delay)
        let failures = 0

        for (let i = 0; i < realLeadIds.length; i++) {
            const lead = realLeadIds[i]
            const leadName = lead.nome || 'Lead #' + lead.id

            setImportQueue(prev => ({ ...prev, current: i + 1, currentLeadName: leadName }))

            try {
                console.log(`[Bulk Sync] Sending request for lead_id: ${lead.id}`)

                const response = await fetch('https://n8n-n8n-start.kfocge.easypanel.host/webhook/import-history', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        lead_id: lead.id,           // ID REAL do lead (ex: 480)
                        account_id: clientAccountId  // ID da conta Unipile do Cliente
                    })
                })

                if (!response.ok) {
                    throw new Error(`Webhook failed with status ${response.status}`)
                }
            } catch (error) {
                console.error(`Failed to import history for ${leadName} (ID: ${lead.id})`, error)
                failures++
                setImportQueue(prev => ({ ...prev, failures: prev.failures + 1 }))
            }

            // 4. PAUSA DE SEGURAN√áA (3 segundos para evitar Rate Limit 429)
            if (i < realLeadIds.length - 1) {
                console.log(`[Bulk Sync] Waiting 3 seconds before next request...`)
                await sleep(3000)
            }
        }

        // 5. Finish
        setImportQueue(prev => ({ ...prev, active: false }))
        setNotification({
            message: `Processamento conclu√≠do! ${realLeadIds.length - failures} sucessos, ${failures} falhas.`,
            type: failures > 0 ? 'info' : 'success'
        })
        setTimeout(() => setNotification(null), 5000)
    }

    // --- HELPER COMPONENTS ---
    const QualificationBadge = ({ isHighTicket, isB2B, companySize }) => {
        return (
            <div className="flex flex-wrap gap-1.5 justify-start">
                {isHighTicket && (
                    <div className="w-6 h-6 rounded-md bg-purple-50 text-purple-600 border border-purple-100 flex items-center justify-center shadow-sm" title="High Ticket Potential">
                        <Gem size={14} />
                    </div>
                )}
                {isB2B && (
                    <span className="px-1.5 py-0.5 rounded-md bg-blue-50 text-blue-700 text-[10px] font-extrabold border border-blue-100 flex items-center shadow-sm">
                        B2B
                    </span>
                )}
                {companySize && (
                    <span className={`px-1.5 py-0.5 rounded-md text-[10px] font-bold border flex items-center shadow-sm ${companySize === 'Enterprise'
                        ? 'bg-purple-100 text-purple-700 border-purple-200'
                        : companySize === 'Mid-Market'
                            ? 'bg-indigo-50 text-indigo-600 border-indigo-100'
                            : 'bg-gray-100 text-gray-600 border-gray-200'
                        }`}>
                        {companySize}
                    </span>
                )}
            </div>
        )
    }

    return (
        <div className="min-h-screen bg-slate-50 p-6 md:p-8 font-sans text-slate-800">

            {/* NOTIFICATION TOAST */}
            {notification && (
                <div className={`fixed top-6 right-6 z-50 px-5 py-4 rounded-xl shadow-2xl border-2 flex items-center gap-3 animate-slide-in-right min-w-[300px] ${notification.type === 'error'
                    ? 'bg-red-50 border-red-300 text-red-700'
                    : notification.type === 'success'
                        ? 'bg-emerald-50 border-emerald-300 text-emerald-700'
                        : 'bg-blue-50 border-blue-300 text-blue-700'
                    }`}>
                    {notification.type === 'error' ? (
                        <X size={20} className="shrink-0" />
                    ) : notification.type === 'success' ? (
                        <Check size={20} className="shrink-0" />
                    ) : (
                        <RefreshCw size={20} className="animate-spin shrink-0" />
                    )}
                    <span className="text-sm font-semibold flex-1">{notification.message}</span>
                </div>
            )}

            {/* LEAD DETAIL MODAL */}
            {selectedLead && (
                <LeadDetailModal
                    lead={selectedLead.leads_with_stats}
                    campaignLead={selectedLead}
                    onClose={() => setSelectedLead(null)}
                />
            )}

            {/* HEADER */}

            {/* BULK IMPORT PROGRESS BANNER */}
            {importQueue.active && (
                <div className="fixed bottom-6 left-1/2 -translate-x-1/2 z-50 bg-slate-900 text-white px-6 py-4 rounded-xl shadow-2xl flex items-center gap-6 animate-slide-up w-[90%] max-w-2xl border border-slate-700">
                    <Loader2 className="animate-spin text-orange-500 shrink-0" size={24} />
                    <div className="flex-1">
                        <div className="flex justify-between items-center mb-1">
                            <h3 className="font-bold text-sm">Importando Hist√≥rico...</h3>
                            <span className="text-xs text-slate-400">{importQueue.current} de {importQueue.total}</span>
                        </div>
                        <div className="w-full bg-slate-700 rounded-full h-2 overflow-hidden">
                            <div
                                className="bg-orange-500 h-full transition-all duration-300 ease-out"
                                style={{ width: `${(importQueue.current / importQueue.total) * 100}%` }}
                            />
                        </div>
                        <p className="text-xs text-slate-400 mt-1 truncate">Processando: <span className="text-white">{importQueue.currentLeadName}</span></p>
                    </div>
                </div>
            )}

            {/* CONFIRMATION MODAL */}
            {showImportConfirm && (
                <div className="fixed inset-0 z-[60] flex items-center justify-center bg-slate-900/50 backdrop-blur-sm px-4">
                    <div className="bg-white rounded-2xl shadow-2xl p-6 max-w-md w-full animate-scale-in">
                        <div className="flex justify-center mb-4">
                            <div className="p-3 bg-amber-50 text-amber-600 rounded-full">
                                <History size={32} />
                            </div>
                        </div>
                        <h3 className="text-xl font-bold text-center text-slate-900 mb-2">Importar Hist√≥rico em Massa</h3>
                        <p className="text-slate-600 text-center mb-6 text-sm">
                            {selectedLeads.size > 0
                                ? `Voc√™ selecionou ${selectedLeads.size} leads para atualiza√ß√£o.`
                                : `Voc√™ n√£o selecionou nenhum lead. Isso iniciar√° a importa√ß√£o para TODOS os ${stats.total} leads desta campanha.`}
                            <br /><br />
                            <span className="font-bold text-slate-800">Aten√ß√£o:</span> O processo ser√° feito sequencialmente (um por um) para evitar bloqueios, levando cerca de <span className="text-orange-600 font-bold">3 segundos por lead</span>.
                        </p>
                        <div className="flex gap-3">
                            <button
                                onClick={cancelImport}
                                className="flex-1 py-3 rounded-lg border border-slate-200 font-bold text-slate-600 hover:bg-slate-50 transition-colors"
                            >
                                Cancelar
                            </button>
                            <button
                                onClick={executeHistoryImport}
                                className="flex-1 py-3 rounded-lg bg-orange-600 font-bold text-white hover:bg-orange-700 transition-colors shadow-lg shadow-orange-200"
                            >
                                Confirmar e Iniciar
                            </button>
                        </div>
                    </div>
                </div>
            )}

            <div className="px-4 mb-6">
                <button
                    onClick={() => navigate('/campaigns')}
                    className="flex items-center gap-2 text-slate-500 hover:text-orange-600 transition-colors text-sm font-semibold mb-4"
                >
                    <ArrowLeft size={16} /> Voltar para Campanhas
                </button>

                <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-2 mb-5">
                    <div>
                        <h1 className="text-2xl font-bold text-slate-900 tracking-tight mb-1">
                            {campaign ? campaign.name : 'Carregando campanha...'}
                        </h1>
                        <p className="text-slate-600 text-base font-medium">Gerencie os leads e cad√™ncia desta campanha.</p>
                    </div>
                </div>

                {/* KPI CARDS */}
                <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-5">
                    <div className="bg-white p-4 rounded-xl border border-slate-200 shadow-sm">
                        <div className="flex items-center gap-3 mb-2 text-slate-600 text-sm font-bold uppercase tracking-wider">
                            <Users size={16} /> Leads na Campanha
                        </div>
                        <div className="text-3xl font-extrabold text-slate-900">{stats.total}</div>
                    </div>

                    <div className="bg-white p-4 rounded-xl border border-slate-200 shadow-sm">
                        <div className="flex items-center gap-3 mb-2 text-slate-600 text-sm font-bold uppercase tracking-wider">
                            <MessageCircle size={16} /> Total de Mensagens na Base
                        </div>
                        <div className="text-3xl font-extrabold text-blue-600">{totalMessages.toLocaleString()}</div>
                        <div className="text-xs text-slate-500 mt-1">Intera√ß√µes registradas no sistema</div>
                    </div>

                    {/* TOP LEADS RANKING */}
                    <div className="bg-white p-4 rounded-xl border border-slate-200 shadow-sm">
                        <div className="flex items-center gap-3 mb-4 text-slate-600 text-sm font-bold uppercase tracking-wider">
                            <Trophy size={16} className="text-amber-500" /> Top Leads (Engajamento)
                        </div>
                        {topLeads.length > 0 ? (
                            <div className="space-y-2">
                                {topLeads.map((lead, idx) => (
                                    <div key={lead.id} className="flex items-center gap-3 py-1.5 px-2 rounded-lg hover:bg-slate-50 transition-colors">
                                        <div className={`w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold shrink-0 ${idx === 0 ? 'bg-amber-100 text-amber-700' :
                                            idx === 1 ? 'bg-slate-100 text-slate-600' :
                                                idx === 2 ? 'bg-orange-100 text-orange-700' :
                                                    'bg-slate-50 text-slate-500'
                                            }`}>
                                            {idx === 0 ? 'ü•á' : idx === 1 ? 'ü•à' : idx === 2 ? 'ü•â' : idx + 1}
                                        </div>
                                        <div className="w-7 h-7 rounded-full bg-slate-200 flex items-center justify-center text-xs font-semibold overflow-hidden shrink-0">
                                            {lead.avatar_url ? (
                                                <img src={lead.avatar_url} className="w-full h-full object-cover" alt="" />
                                            ) : (
                                                lead.nome?.charAt(0) || '?'
                                            )}
                                        </div>
                                        <div className="flex-1 min-w-0">
                                            <div className="text-sm font-medium text-slate-800 truncate">{lead.nome}</div>
                                        </div>
                                        <div className="text-xs font-bold text-blue-600 bg-blue-50 px-2 py-0.5 rounded-full">
                                            {lead.total_interactions} msg
                                        </div>
                                    </div>
                                ))}
                            </div>
                        ) : (
                            <p className="text-sm text-slate-400 text-center py-4">Nenhum lead com intera√ß√µes</p>
                        )}
                    </div>
                </div>

                {/* CONTROLS */}
                {/* HEADER CONTROLS */}
                <div className="bg-white border-b border-gray-200 p-3 md:p-4 mb-4 rounded-xl shadow-sm">
                    <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                        {/* SEARCH & FILTER */}
                        <div className="flex items-center gap-3 w-full md:w-auto">
                            <div className="relative flex-1 md:w-80">
                                <div className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">
                                    <Search size={18} />
                                </div>
                                <input
                                    type="text"
                                    placeholder="Buscar lead, cargo ou empresa..."
                                    className="w-full pl-10 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-800 focus:outline-none focus:border-orange-500 focus:ring-2 focus:ring-orange-200 transition-colors"
                                    value={searchTerm}
                                    onChange={(e) => setSearchTerm(e.target.value)}
                                />
                            </div>
                            <button
                                onClick={() => setIsFilterOpen(!isFilterOpen)}
                                className={`p-3 rounded-xl border transition-colors ${isFilterOpen ? 'bg-orange-50 border-orange-200 text-orange-600' : 'bg-white border-slate-200 text-slate-500 hover:border-orange-200 hover:text-orange-500'}`}>
                                <Filter size={20} />
                            </button>
                        </div>

                        {/* ACTION BUTTONS */}
                        <div className="flex items-center gap-3 w-full md:w-auto justify-end">
                            {selectedLeads.size > 0 && (
                                <span className="text-xs font-bold text-orange-600 animate-fade-in mr-2">
                                    {selectedLeads.size} selecionados
                                </span>
                            )}


                            <div className="flex flex-col items-end gap-1">
                                {clientSyncTimestamp && !syncLoading && (
                                    <div className="text-[10px] text-slate-500 flex items-center gap-1 mb-1">
                                        <Clock size={10} />
                                        <span>
                                            √öltima sync: {new Date(clientSyncTimestamp).toLocaleString('pt-BR', {
                                                day: '2-digit',
                                                month: '2-digit',
                                                hour: '2-digit',
                                                minute: '2-digit'
                                            })}
                                        </span>
                                    </div>
                                )}
                                <button
                                    onClick={handleSyncMessages}
                                    disabled={syncLoading}
                                    className={`flex items-center gap-2 px-4 py-2.5 rounded-lg font-semibold text-sm transition-all ${syncLoading
                                        ? 'bg-blue-50 text-blue-400 cursor-not-allowed'
                                        : 'bg-blue-50 text-blue-600 hover:bg-blue-100 hover:text-blue-700 border border-blue-200'
                                        }`}
                                >
                                    <RefreshCw size={16} className={syncLoading ? "animate-spin" : ""} />
                                    {syncLoading ? 'Sincronizando...' : 'Sync Mensagens'}
                                </button>
                            </div>


                            <button
                                onClick={handleBulkHistorySync}
                                disabled={importQueue.active}
                                className={`flex items-center gap-2 px-4 py-2.5 rounded-lg font-semibold text-sm transition-all ${importQueue.active
                                    ? 'bg-amber-50 text-amber-400 cursor-not-allowed'
                                    : 'bg-amber-50 text-amber-600 hover:bg-amber-100 hover:text-amber-700 border border-amber-200'
                                    }`}
                            >
                                <History size={16} className={importQueue.active ? "animate-spin" : ""} />
                                {importQueue.active ? 'Processando...' : 'Sync Hist√≥rico'}
                            </button>

                            <button
                                onClick={() => setIsAddLeadsModalOpen(true)}
                                className="flex items-center gap-2 px-4 py-2.5 rounded-lg bg-orange-600 text-white border border-orange-600 hover:bg-orange-700 font-bold text-sm transition-all shadow-md shadow-orange-100">
                                <Plus size={16} /> Adicionar Leads
                            </button>
                        </div>
                    </div>

                    {/* FILTER PANEL */}
                    {isFilterOpen && (
                        <div className="mt-4 p-4 bg-slate-50 rounded-xl border border-slate-200 animate-fade-in">
                            <div className="flex flex-wrap items-end gap-4">
                                {/* STATUS FILTER */}
                                <div className="flex-1 min-w-[200px]">
                                    <label className="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2">
                                        Status
                                    </label>
                                    <select
                                        value={filters.status[0] || ''}
                                        onChange={(e) => setFilters(prev => ({
                                            ...prev,
                                            status: e.target.value ? [e.target.value] : []
                                        }))}
                                        className="w-full px-4 py-2.5 bg-white border border-slate-200 rounded-lg text-slate-800 focus:outline-none focus:border-orange-500 focus:ring-2 focus:ring-orange-200 transition-colors text-sm"
                                    >
                                        <option value="">Todos os Status</option>
                                        <option value="NOT_CONTACTED">Not Contacted</option>
                                        <option value="PENDING_ENRICHMENT">In Queue</option>
                                        <option value="PROCESSING">Processing</option>
                                        <option value="QUALIFIED_NO_ICEBREAKER">Qualified</option>
                                        <option value="QUALIFIED_WITH_ICEBREAKER">Icebreaker Ready</option>
                                        <option value="CONTACTED">Contacted</option>
                                        <option value="REPLIED">Replied</option>
                                        <option value="MEETING_SCHEDULED">Meeting</option>
                                        <option value="WON">Won</option>
                                        <option value="LOST">Lost</option>
                                    </select>
                                </div>

                                {/* QUALIFICATION FILTER */}
                                <div className="flex-1 min-w-[200px]">
                                    <label className="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2">
                                        Qualifica√ß√£o
                                    </label>
                                    <select
                                        value={filters.qualification[0] || ''}
                                        onChange={(e) => setFilters(prev => ({
                                            ...prev,
                                            qualification: e.target.value ? [e.target.value] : []
                                        }))}
                                        className="w-full px-4 py-2.5 bg-white border border-slate-200 rounded-lg text-slate-800 focus:outline-none focus:border-orange-500 focus:ring-2 focus:ring-orange-200 transition-colors text-sm"
                                    >
                                        <option value="">Todas as Qualifica√ß√µes</option>
                                        <option value="A">A-Tier (High Ticket)</option>
                                        <option value="B">B-Tier (Enterprise)</option>
                                        <option value="C">C-Tier (Standard)</option>
                                    </select>
                                </div>

                                {/* HAS MESSAGES FILTER */}
                                <div className="flex-1 min-w-[180px]">
                                    <label className="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2">
                                        Mensagens
                                    </label>
                                    <select
                                        value={filters.hasMessages || ''}
                                        onChange={(e) => setFilters(prev => ({
                                            ...prev,
                                            hasMessages: e.target.value
                                        }))}
                                        className="w-full px-4 py-2.5 bg-white border border-slate-200 rounded-lg text-slate-800 focus:outline-none focus:border-orange-500 focus:ring-2 focus:ring-orange-200 transition-colors text-sm"
                                    >
                                        <option value="">Todos</option>
                                        <option value="yes">Com mensagens</option>
                                        <option value="no">Sem mensagens</option>
                                    </select>
                                </div>

                                {/* CLEAR FILTERS */}
                                <button
                                    onClick={() => setFilters({ status: [], qualification: [], company: '', role: '', hasMessages: '' })}
                                    className="px-4 py-2.5 bg-white border border-slate-200 rounded-lg text-slate-600 hover:bg-slate-100 hover:border-slate-300 font-medium text-sm transition-colors"
                                >
                                    Limpar Filtros
                                </button>
                            </div>

                            {/* Active Filters Tags */}
                            {(filters.status.length > 0 || filters.qualification.length > 0 || filters.hasMessages) && (
                                <div className="mt-3 flex flex-wrap gap-2">
                                    {filters.status.map(s => (
                                        <span key={s} className="inline-flex items-center gap-1 px-2 py-1 bg-orange-100 text-orange-700 rounded-full text-xs font-medium">
                                            Status: {s}
                                            <button onClick={() => setFilters(prev => ({ ...prev, status: prev.status.filter(x => x !== s) }))} className="hover:text-orange-900">
                                                <X size={12} />
                                            </button>
                                        </span>
                                    ))}
                                    {filters.qualification.map(q => (
                                        <span key={q} className="inline-flex items-center gap-1 px-2 py-1 bg-purple-100 text-purple-700 rounded-full text-xs font-medium">
                                            Tier: {q}
                                            <button onClick={() => setFilters(prev => ({ ...prev, qualification: prev.qualification.filter(x => x !== q) }))} className="hover:text-purple-900">
                                                <X size={12} />
                                            </button>
                                        </span>
                                    ))}
                                    {filters.hasMessages && (
                                        <span className="inline-flex items-center gap-1 px-2 py-1 bg-blue-100 text-blue-700 rounded-full text-xs font-medium">
                                            {filters.hasMessages === 'yes' ? 'Com mensagens' : 'Sem mensagens'}
                                            <button onClick={() => setFilters(prev => ({ ...prev, hasMessages: '' }))} className="hover:text-blue-900">
                                                <X size={12} />
                                            </button>
                                        </span>
                                    )}
                                </div>
                            )}
                        </div>
                    )}
                </div>

                <AddLeadsModal
                    isOpen={isAddLeadsModalOpen}
                    onClose={() => setIsAddLeadsModalOpen(false)}
                    campaignId={campaignId}
                    clientId={selectedClientId}
                    onImportConnections={handleSyncConnections}
                />





                {/* ========== TABLE/LIST VIEW ========== */}
                {
                    <div className="bg-white border border-slate-200 rounded-xl shadow-sm overflow-hidden flex flex-col">
                        <div className="overflow-x-auto min-h-[400px]">
                            <table className="w-full text-left border-collapse">
                                <thead className="bg-slate-50 sticky top-0 z-10 shadow-sm">
                                    <tr className="border-b border-slate-200 text-xs font-bold text-slate-500 uppercase tracking-wider">
                                        <th className="py-4 px-4 w-[40px] text-center">
                                            <div
                                                onClick={toggleSelectAll}
                                                className={`w-4 h-4 rounded border flex items-center justify-center cursor-pointer transition-colors mx-auto ${selectedLeads.size > 0 && selectedLeads.size === leads.length ? 'bg-orange-500 border-orange-500' : 'bg-white border-slate-300'
                                                    }`}>
                                                {selectedLeads.size > 0 && selectedLeads.size === leads.length && <Check size={10} className="text-white" />}
                                                {selectedLeads.size > 0 && selectedLeads.size < leads.length && <div className="w-2 h-0.5 bg-orange-500 rounded-full" />}
                                            </div>
                                        </th>

                                        <th
                                            className="py-4 px-4 w-[30%] cursor-pointer hover:bg-slate-100 transition-colors group"
                                            onClick={() => handleSort('nome')}
                                        >
                                            <div className="flex items-center gap-1">
                                                Lead
                                                <ArrowUpDown size={12} className={`text-slate-400 ${sortConfig.key === 'nome' ? 'opacity-100 text-orange-500' : 'opacity-0 group-hover:opacity-100'}`} />
                                            </div>
                                        </th>

                                        <th
                                            className="py-4 px-4 w-[15%] cursor-pointer hover:bg-slate-100 transition-colors group"
                                            onClick={() => handleSort('empresa')}
                                        >
                                            <div className="flex items-center gap-1">
                                                Empresa
                                                <ArrowUpDown size={12} className={`text-slate-400 ${sortConfig.key === 'empresa' ? 'opacity-100 text-orange-500' : 'opacity-0 group-hover:opacity-100'}`} />
                                            </div>
                                        </th>

                                        <th className="py-4 px-4 w-[10%]">Qualifica√ß√£o</th>

                                        <th
                                            className="py-4 px-4 w-[15%] cursor-pointer hover:bg-slate-100 transition-colors group"
                                            onClick={() => handleSort('location')}
                                        >
                                            <div className="flex items-center gap-1">
                                                Local
                                                <ArrowUpDown size={12} className={`text-slate-400 ${sortConfig.key === 'location' ? 'opacity-100 text-orange-500' : 'opacity-0 group-hover:opacity-100'}`} />
                                            </div>
                                        </th>

                                        <th
                                            className="py-4 px-4 w-[10%] text-center cursor-pointer hover:bg-slate-100 transition-colors group"
                                            onClick={() => handleSort('status_pipeline')}
                                        >
                                            <div className="flex items-center justify-center gap-1">
                                                Status
                                                <ArrowUpDown size={12} className={`text-slate-400 ${sortConfig.key === 'status_pipeline' ? 'opacity-100 text-orange-500' : 'opacity-0 group-hover:opacity-100'}`} />
                                            </div>
                                        </th>

                                        <th
                                            className="py-4 px-4 w-[10%] text-center cursor-pointer hover:bg-slate-100 transition-colors group"
                                            onClick={() => handleSort('total_interactions')}
                                        >
                                            <div className="flex items-center justify-center gap-1">
                                                Engagement
                                                <ArrowUpDown size={12} className={`text-slate-400 ${sortConfig.key === 'total_interactions' ? 'opacity-100 text-orange-500' : 'opacity-0 group-hover:opacity-100'}`} />
                                            </div>
                                        </th>

                                        <th
                                            className="py-4 px-4 w-[8%] text-center cursor-pointer hover:bg-slate-100 transition-colors group"
                                            onClick={() => handleSort('sentiment')}
                                        >
                                            <div className="flex items-center justify-center gap-1">
                                                <Brain size={14} className="text-violet-500" />
                                                IA
                                                <ArrowUpDown size={12} className={`text-slate-400 ${sortConfig.key === 'sentiment' ? 'opacity-100 text-orange-500' : 'opacity-0 group-hover:opacity-100'}`} />
                                            </div>
                                        </th>

                                        <th className="py-4 px-4 w-[8%] text-right">A√ß√µes</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {loading && leads.length === 0 ? (
                                        <tr><td colSpan="7" className="py-20 text-center text-gray-400"><Loader2 className="animate-spin mx-auto mb-2" />Carregando Leads...</td></tr>
                                    ) : leads.map((item, index) => {
                                        console.log(`[Render ${index + 1}/${leads.length}] Full item:`, item)

                                        // FIXED: campaign_leads view is flat - all data is directly on item
                                        const lead = item
                                        console.log(`[Render ${index + 1}] Using lead data:`, lead)

                                        const campaignStatus = item.status_pipeline
                                        const totalInteractions = lead.total_interactions || 0

                                        // Dynamic Status based on interactions
                                        let statusLabel = 'A Contatar'
                                        let statusColor = 'text-slate-500 bg-slate-100'

                                        if (totalInteractions > 0) {
                                            statusLabel = 'Em Conversa'
                                            statusColor = 'text-blue-600 bg-blue-50'
                                        }

                                        // Override with pipeline status if disqualified
                                        if (campaignStatus === 'DISQUALIFIED') {
                                            statusLabel = 'Desqualificado'
                                            statusColor = 'text-red-600 bg-red-50'
                                        }

                                        const isDisqualified = campaignStatus === 'DISQUALIFIED'
                                        const needsIcebreaker = campaignStatus === 'QUALIFIED_NO_ICEBREAKER'
                                        const isSelected = selectedLeads.has(item.id)

                                        // Professional Zebra Striping
                                        let rowClass = "group cursor-pointer border-b border-slate-100 hover:brightness-95"
                                        if (index % 2 === 0) rowClass += " bg-white"
                                        else rowClass += " bg-slate-50/50"
                                        if (isSelected) rowClass += " !bg-blue-50"

                                        return (
                                            <tr key={item.id} onClick={() => !isDisqualified && setSelectedLead(item)} className={rowClass}>
                                                <td className="py-3 px-4 text-center" onClick={(e) => e.stopPropagation()}>
                                                    <div onClick={(e) => toggleSelectRow(item.id, e)} className={`w-4 h-4 rounded border flex items-center justify-center cursor-pointer transition-colors mx-auto ${isSelected ? 'bg-blue-600 border-blue-600' : 'bg-white border-slate-300 hover:border-blue-400'}`}>
                                                        {isSelected && <Check size={10} className="text-white" />}
                                                    </div>
                                                </td>

                                                <td className="py-3 px-4">
                                                    <div className="flex items-center gap-3">
                                                        <div className="w-9 h-9 rounded-full bg-slate-200 flex items-center justify-center text-slate-600 font-semibold text-sm border border-slate-300 overflow-hidden shrink-0">
                                                            {lead.avatar_url ? <img src={lead.avatar_url} className="w-full h-full object-cover" alt="" /> : (lead.nome?.charAt(0) || '?')}
                                                        </div>
                                                        <div className="min-w-0">
                                                            <div className="font-semibold text-slate-900 text-sm truncate max-w-[220px]" title={lead.nome}>{lead.nome || 'Lead #' + item.id}</div>
                                                            <div className="text-xs text-slate-500 truncate max-w-[220px]" title={lead.headline}>{lead.headline || 'No headline'}</div>
                                                        </div>
                                                    </div>
                                                </td>

                                                <td className="py-3 px-4">
                                                    <div className="text-sm text-slate-700 truncate max-w-[180px]" title={lead.empresa}>
                                                        {lead.empresa || 'None'}
                                                    </div>
                                                </td>

                                                <td className="py-3 px-4">
                                                    <div className="text-sm text-slate-600">
                                                        {lead.icp_score ? `${lead.icp_score}-Tier` : 'N/A'}
                                                    </div>
                                                </td>

                                                <td className="py-3 px-4">
                                                    <div className="text-sm text-slate-600 truncate max-w-[140px]" title={lead.location}>
                                                        {lead.location || 'N/A'}
                                                    </div>
                                                </td>

                                                {/* ENGAGEMENT HEAT INDICATOR */}
                                                <td className="py-3 px-4">
                                                    {(() => {
                                                        const count = lead.total_interactions || 0
                                                        const sentiment = lead.last_sentiment

                                                        // Determine heat level based on sentiment
                                                        let heatConfig = {
                                                            bars: 1,
                                                            color: 'bg-slate-300',
                                                            textColor: 'text-slate-500',
                                                            label: 'Cold'
                                                        }

                                                        if (count === 0) {
                                                            heatConfig = { bars: 0, color: 'bg-slate-200', textColor: 'text-slate-400', label: 'No Activity' }
                                                        } else if (sentiment === 'POSITIVE') {
                                                            heatConfig = { bars: 3, color: 'bg-emerald-500', textColor: 'text-emerald-600', label: 'Hot' }
                                                        } else if (sentiment === 'NEGATIVE') {
                                                            heatConfig = { bars: 1, color: 'bg-rose-400', textColor: 'text-rose-500', label: 'Cold' }
                                                        } else if (sentiment === 'NEUTRAL') {
                                                            heatConfig = { bars: 2, color: 'bg-amber-400', textColor: 'text-amber-600', label: 'Warm' }
                                                        } else if (count > 0) {
                                                            heatConfig = { bars: 2, color: 'bg-slate-400', textColor: 'text-slate-600', label: 'Active' }
                                                        }

                                                        return (
                                                            <div className="flex items-center justify-center gap-2">
                                                                {/* Signal Strength Bars */}
                                                                <div className="flex items-end gap-0.5 h-4" title={`Sentiment: ${sentiment || 'Unknown'}`}>
                                                                    <div className={`w-1 rounded-sm transition-all ${heatConfig.bars >= 1 ? heatConfig.color : 'bg-slate-200'}`} style={{ height: '6px' }} />
                                                                    <div className={`w-1 rounded-sm transition-all ${heatConfig.bars >= 2 ? heatConfig.color : 'bg-slate-200'}`} style={{ height: '10px' }} />
                                                                    <div className={`w-1 rounded-sm transition-all ${heatConfig.bars >= 3 ? heatConfig.color : 'bg-slate-200'}`} style={{ height: '14px' }} />
                                                                </div>

                                                                {/* Count Badge */}
                                                                <span className={`text-sm font-semibold ${heatConfig.textColor}`}>
                                                                    {count}
                                                                </span>
                                                            </div>
                                                        )
                                                    })()}
                                                </td>

                                                <td className="py-3 px-4 text-center">
                                                    <span className={`text-xs font-semibold px-2.5 py-1 rounded-full ${statusColor}`}>
                                                        {statusLabel}
                                                    </span>
                                                </td>

                                                {/* AI STATUS BADGE */}
                                                <td className="py-3 px-4 text-center">
                                                    {(() => {
                                                        // Loading state
                                                        if (lead.ready_for_analysis) {
                                                            return (
                                                                <div className="flex items-center justify-center" title="IA analisando...">
                                                                    <div className="px-2 py-1 rounded-full bg-violet-50 border border-violet-200 flex items-center gap-1">
                                                                        <Sparkles size={12} className="text-violet-500 animate-pulse" />
                                                                        <span className="text-xs text-violet-600 font-medium">Analisando</span>
                                                                    </div>
                                                                </div>
                                                            )
                                                        }

                                                        const sentiment = lead.sentiment
                                                        const reasoning = lead.sentiment_reasoning

                                                        if (!sentiment) {
                                                            return (
                                                                <span className="text-xs text-slate-400">‚Äî</span>
                                                            )
                                                        }

                                                        let badgeConfig = {
                                                            bg: 'bg-slate-100',
                                                            border: 'border-slate-200',
                                                            text: 'text-slate-600',
                                                            label: '‚Äî',
                                                            icon: null
                                                        }

                                                        if (sentiment === 'POSITIVE') {
                                                            badgeConfig = {
                                                                bg: 'bg-emerald-50',
                                                                border: 'border-emerald-200',
                                                                text: 'text-emerald-700',
                                                                label: 'üî• Quente',
                                                                icon: null
                                                            }
                                                        } else if (sentiment === 'NEGATIVE') {
                                                            badgeConfig = {
                                                                bg: 'bg-rose-50',
                                                                border: 'border-rose-200',
                                                                text: 'text-rose-700',
                                                                label: '‚ùÑÔ∏è Frio',
                                                                icon: null
                                                            }
                                                        } else if (sentiment === 'NEUTRAL') {
                                                            badgeConfig = {
                                                                bg: 'bg-amber-50',
                                                                border: 'border-amber-200',
                                                                text: 'text-amber-700',
                                                                label: 'üå°Ô∏è Morno',
                                                                icon: null
                                                            }
                                                        }

                                                        return (
                                                            <div className="relative group/tooltip inline-block">
                                                                <div className={`px-2 py-1 rounded-full ${badgeConfig.bg} border ${badgeConfig.border} cursor-help`}>
                                                                    <span className={`text-xs font-semibold ${badgeConfig.text}`}>
                                                                        {badgeConfig.label}
                                                                    </span>
                                                                </div>
                                                                {/* Tooltip */}
                                                                {reasoning && (
                                                                    <div className="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-3 py-2 bg-slate-800 text-white text-xs rounded-lg opacity-0 invisible group-hover/tooltip:opacity-100 group-hover/tooltip:visible transition-all z-50 w-48 text-center shadow-lg">
                                                                        {reasoning}
                                                                        <div className="absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-slate-800" />
                                                                    </div>
                                                                )}
                                                            </div>
                                                        )
                                                    })()}
                                                </td>

                                                <td className="py-3 px-4 text-right">
                                                    <div className="flex justify-end items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity" onClick={e => e.stopPropagation()}>
                                                        <button onClick={(e) => handleSyncRecent(lead, e)} className="p-1.5 rounded text-slate-400 hover:text-blue-600 hover:bg-blue-50" title="Sync Recente"><RefreshCw size={14} /></button>
                                                        <button onClick={(e) => handleSyncHistory(lead, e)} className="p-1.5 rounded text-slate-400 hover:text-amber-600 hover:bg-amber-50" title="Importar Hist√≥rico"><History size={14} /></button>

                                                        <div className="w-px h-3 bg-slate-200 mx-1"></div>

                                                        {needsIcebreaker && (
                                                            <button onClick={(e) => handleGenerateIcebreaker(lead.id, e)} className="p-1.5 rounded bg-indigo-50 text-indigo-600 hover:bg-indigo-100" title="Gerar Icebreaker">
                                                                {icebreakerLoading === lead.id ? <Loader2 className="animate-spin" size={14} /> : <Bot size={14} />}
                                                            </button>
                                                        )}
                                                        <button onClick={(e) => handleDeleteLead(item.id, e)} className="p-1.5 rounded text-slate-400 hover:text-red-600 hover:bg-red-50" title="Remover"><Trash2 size={14} /></button>
                                                    </div>
                                                </td>
                                            </tr>
                                        )
                                    })}
                                </tbody>
                            </table>
                        </div>

                        {/* PAGINATION */}
                        <div className="border-t border-slate-200 bg-slate-50 p-4 flex justify-between items-center sticky bottom-0 z-10 w-full">
                            <span className="text-sm text-slate-600">
                                Showing {page * ITEMS_per_PAGE + 1} - {Math.min((page + 1) * ITEMS_per_PAGE, stats.total)} out of {stats.total} results
                            </span>

                            <div className="flex items-center gap-2">
                                <button
                                    onClick={() => {
                                        const newPage = Math.max(0, page - 1);
                                        setPage(newPage);
                                        fetchLeads(newPage, false);
                                    }}
                                    disabled={page === 0 || loading}
                                    className="p-2 rounded-lg border bg-white text-slate-600 hover:bg-slate-50 disabled:opacity-50 disabled:cursor-not-allowed shadow-sm transition-all"
                                >
                                    <ChevronLeft size={16} />
                                </button>
                                <span className="text-sm font-bold text-slate-700 min-w-[20px] text-center">{page + 1}</span>
                                <button
                                    onClick={() => {
                                        const newPage = page + 1;
                                        setPage(newPage);
                                        fetchLeads(newPage, false);
                                    }}
                                    disabled={!hasMore || loading}
                                    className="p-2 rounded-lg border bg-white text-slate-600 hover:bg-slate-50 disabled:opacity-50 disabled:cursor-not-allowed shadow-sm transition-all"
                                >
                                    <ChevronRight size={16} />
                                </button>
                            </div>
                        </div>
                    </div>
                }

            </div>

            {/* DRAWER (Slide-Over) */}
            {selectedLead && selectedLead.leads && (
                <div className="fixed inset-0 z-50 flex justify-end">
                    <div className="absolute inset-0 bg-slate-900/20 backdrop-blur-sm transition-opacity" onClick={() => setSelectedLead(null)} />
                    <div className="relative w-full max-w-lg bg-white h-full shadow-2xl flex flex-col animate-slide-in-right overflow-hidden border-l border-gray-200">
                        {/* Drawer Header */}
                        <div className="p-6 border-b border-gray-100 flex justify-between items-center bg-white">
                            <div>
                                <h2 className="text-xl font-bold text-slate-800">Cad√™ncia de Venda</h2>
                                <p className="text-xs text-gray-500 mt-1">Gerencie a intera√ß√£o com este lead</p>
                            </div>
                            <button onClick={() => setSelectedLead(null)} className="p-2 rounded-full hover:bg-gray-100 text-gray-400 hover:text-slate-600 transition-colors">
                                <X size={20} />
                            </button>
                        </div>

                        {/* Drawer Body - Split into Context and Action */}
                        <div className="flex-1 overflow-y-auto p-6 space-y-8 custom-scrollbar bg-slate-50/50">

                            {/* BLOCK 1: CONTEXT (Why is this lead here?) */}
                            <div className="bg-white p-5 rounded-xl border border-orange-100 shadow-sm">
                                <div className="flex items-start gap-4 mb-4">
                                    <div className="w-14 h-14 rounded-full bg-slate-100 flex items-center justify-center text-lg font-bold text-slate-500 shrink-0 border border-gray-200">
                                        {selectedLead.leads.avatar_url ? <img src={selectedLead.leads.avatar_url} className="w-full h-full object-cover rounded-full" /> : (selectedLead.leads.nome?.charAt(0) || '?')}
                                    </div>
                                    <div className="flex-1">
                                        <div className="flex justify-between items-start">
                                            <h3 className="text-lg font-bold text-slate-900 leading-tight">{selectedLead.leads.nome}</h3>
                                            {selectedLead.leads.company_website && (
                                                <a href={selectedLead.leads.company_website} target="_blank" rel="noopener noreferrer" className="text-gray-400 hover:text-blue-600 transition-colors" title="Visitar Site">
                                                    <Globe size={18} />
                                                </a>
                                            )}
                                        </div>
                                        <p className="text-sm text-gray-500 mb-1">{selectedLead.leads.headline}</p>
                                        <div className="flex flex-wrap gap-2 mt-2">
                                            {selectedLead.leads.is_high_ticket && <span className="px-2 py-0.5 bg-indigo-50 text-indigo-700 text-[10px] font-bold rounded border border-indigo-100 flex items-center gap-1"><Gem size={10} /> High Ticket</span>}
                                            {selectedLead.leads.company_size_type && <span className="px-2 py-0.5 bg-gray-100 text-gray-600 text-[10px] font-bold rounded border border-gray-200"><Building2 size={10} className="inline mr-1" />{selectedLead.leads.company_size_type}</span>}
                                        </div>
                                    </div>
                                </div>

                                {/* ICP REASON */}
                                <div className="p-3 bg-orange-50 rounded-lg border border-orange-100/60">
                                    <h4 className="flex items-center gap-2 text-[10px] font-bold text-orange-600 uppercase tracking-wider mb-1">
                                        <Sparkles size={12} /> Motivo da Qualifica√ß√£o
                                    </h4>
                                    <p className="text-sm text-slate-700 leading-relaxed font-medium">
                                        {selectedLead.leads.icp_reason || "Este perfil apresenta alta ader√™ncia com seu ICP ideal, ocupando cargo de decis√£o em setor estrat√©gico."}
                                    </p>
                                </div>
                            </div>

                            {/* Skills Tag Cloud (Collapsed/Secondary) */}
                            {selectedLead.leads.skills && (
                                <div>
                                    <h4 className="text-xs font-bold text-gray-400 uppercase tracking-wider mb-3 px-2">Habilidades Detectadas</h4>
                                    <div className="flex flex-wrap gap-2 px-2">
                                        {(() => {
                                            try {
                                                const tags = typeof selectedLead.leads.skills === 'string' ? JSON.parse(selectedLead.leads.skills) : selectedLead.leads.skills
                                                return tags.slice(0, 5).map((t, i) => (
                                                    <span key={i} className="px-2 py-1 rounded-md bg-white text-slate-500 text-xs font-medium border border-gray-200 shadow-sm">
                                                        {typeof t === 'string' ? t : t.name}
                                                    </span>
                                                ))
                                            } catch (e) { return null }
                                        })()}
                                    </div>
                                </div>
                            )}



                            {/* TIMELINE / INTERACTIONS */}
                            <div className="pt-4 border-t border-gray-100">
                                <h4 className="text-xs font-bold text-gray-400 uppercase tracking-wider mb-3 px-2 flex items-center gap-2">
                                    <MessageSquare size={12} /> Hist√≥rico de Intera√ß√µes
                                </h4>
                                <div className="space-y-3 px-2">
                                    {loadingChat ? (
                                        <div className="text-center text-xs text-gray-400 py-4">
                                            <Loader2 className="animate-spin inline mr-1" size={12} /> Carregando...
                                        </div>
                                    ) : interactions.length === 0 ? (
                                        <div className="text-center text-xs text-gray-400 py-4 italic bg-slate-50 rounded-lg border border-slate-100">
                                            Nenhuma intera√ß√£o registrada.
                                        </div>
                                    ) : (
                                        interactions.map(msg => (
                                            <div key={msg.id} className={`flex flex-col max-w-[90%] ${msg.direction === 'inbound' ? 'self-start' : 'self-end ml-auto'}`}>
                                                <div className={`p-3 rounded-xl text-xs leading-relaxed shadow-sm ${msg.direction === 'inbound'
                                                    ? 'bg-white border border-gray-200 text-slate-700 rounded-bl-none'
                                                    : 'bg-indigo-50 border border-indigo-100 text-indigo-900 rounded-br-none'
                                                    }`}>
                                                    {msg.content}
                                                </div>
                                                <span className="text-[10px] text-gray-400 mt-1 px-1 text-right">
                                                    {new Date(msg.interaction_date).toLocaleDateString()} {new Date(msg.interaction_date).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}
                                                </span>
                                            </div>
                                        ))
                                    )}
                                </div>
                            </div>
                        </div>

                        {/* BLOCK 2: ACTION (Bottom Fixed) */}
                        <div className="p-6 border-t border-gray-200 bg-white">
                            <label className="block text-xs font-bold text-gray-500 uppercase tracking-wider mb-2">Mensagem de Conex√£o</label>

                            <div className="relative mb-4">
                                <textarea
                                    className="w-full h-32 p-3 bg-slate-50 border border-gray-300 rounded-lg text-sm text-slate-700 focus:outline-none focus:border-orange-500 focus:ring-1 focus:ring-orange-500 resize-none font-medium leading-relaxed"
                                    value={messageDraft}
                                    onChange={(e) => setMessageDraft(e.target.value)}
                                    placeholder="Escreva sua mensagem de conex√£o..."
                                />
                                <button
                                    onClick={() => handleCopy(messageDraft)}
                                    className="absolute top-2 right-2 p-1.5 rounded-md bg-white text-gray-400 hover:text-orange-600 border border-gray-200 shadow-sm transition-all"
                                    title="Copiar texto"
                                >
                                    <Copy size={14} />
                                </button>
                            </div>

                            <button
                                onClick={handleSendMessage}
                                disabled={sendingMessage}
                                className={`w-full py-3.5 rounded-xl text-white font-bold shadow-lg transition-all transform active:scale-95 flex items-center justify-center gap-2 ${sendingMessage
                                    ? 'bg-orange-300 cursor-not-allowed'
                                    : 'bg-orange-600 hover:bg-orange-700 shadow-orange-200 hover:shadow-orange-300'
                                    }`}
                            >
                                {sendingMessage ? <Loader2 className="animate-spin" size={20} /> : <Send size={18} />}
                                {sendingMessage ? 'Enviando...' : 'Enviar Conex√£o'}
                            </button>

                            <p className="text-center text-[10px] text-gray-400 mt-2">
                                Esta a√ß√£o enviar√° um convite de conex√£o via LinkedIn.
                            </p>
                        </div>
                    </div>
                </div>
            )}

            {/* LEAD DETAIL MODAL - AI INSIGHTS */}
            {selectedLead && (
                <LeadDetailModal
                    lead={selectedLead}
                    onClose={() => setSelectedLead(null)}
                />
            )}
        </div>
    )
}

export default CampaignLeadsView


```

---

## Arquivo: src\pages\CampaignsPage.jsx
```jsx
import React, { useState, useEffect } from 'react'
import { supabase } from '../services/supabaseClient'
import { useClientSelection } from '../contexts/ClientSelectionContext'
import { useNavigate } from 'react-router-dom'
import {
    Plus,
    Search,
    Filter,
    MoreHorizontal,
    Calendar,
    ArrowRight,
    Loader2,
    Target,
    Users,
    MessageSquare,
    BarChart3
} from 'lucide-react'

const CampaignsPage = () => {
    const { selectedClientId } = useClientSelection()
    const navigate = useNavigate()
    const [campaigns, setCampaigns] = useState([])
    const [loading, setLoading] = useState(false)
    const [searchTerm, setSearchTerm] = useState('')
    const [isCreateModalOpen, setIsCreateModalOpen] = useState(false)
    const [newCampaignName, setNewCampaignName] = useState('')
    const [createLoading, setCreateLoading] = useState(false)

    useEffect(() => {
        if (selectedClientId) {
            fetchCampaigns()
        }
    }, [selectedClientId])

    const fetchCampaigns = async () => {
        setLoading(true)
        try {
            const { data, error } = await supabase
                .from('campaigns')
                .select('*')
                .eq('client_id', selectedClientId)
                .order('created_at', { ascending: false })

            if (error) throw error
            setCampaigns(data || [])
        } catch (error) {
            console.error('Error fetching campaigns:', error)
        } finally {
            setLoading(false)
        }
    }

    const handleCreateCampaign = async (e) => {
        e.preventDefault()
        if (!newCampaignName.trim() || !selectedClientId) return

        setCreateLoading(true)
        try {
            const { data, error } = await supabase
                .from('campaigns')
                .insert([
                    {
                        name: newCampaignName,
                        client_id: selectedClientId,
                        status: 'active'
                    }
                ])
                .select()

            if (error) throw error

            if (data) {
                setCampaigns([data[0], ...campaigns])
                setIsCreateModalOpen(false)
                setNewCampaignName('')
            }
        } catch (error) {
            console.error('Error creating campaign:', error)
        } finally {
            setCreateLoading(false)
        }
    }

    // Filter campaigns
    const filteredCampaigns = campaigns.filter(c =>
        c.name.toLowerCase().includes(searchTerm.toLowerCase())
    )

    return (
        <div className="min-h-screen bg-slate-50 p-6 md:p-8 font-sans text-slate-800">
            {/* HEADER */}
            <div className="max-w-7xl mx-auto mb-10">
                <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-8">
                    <div>
                        <h1 className="text-3xl font-bold text-slate-900 tracking-tight mb-2">Campanhas de Vendas</h1>
                        <p className="text-slate-500 text-lg">Gerencie suas estrat√©gias de prospec√ß√£o e acompanhe resultados.</p>
                    </div>
                    <button
                        onClick={() => setIsCreateModalOpen(true)}
                        className="flex items-center gap-2 px-5 py-2.5 rounded-xl bg-orange-600 text-white font-bold hover:bg-orange-700 transition-all shadow-lg shadow-orange-100"
                    >
                        <Plus size={20} /> Nova Campanha
                    </button>
                </div>

                {/* CONTROLS */}
                <div className="bg-white p-4 rounded-xl border border-slate-200 shadow-sm mb-6 flex flex-col md:flex-row justify-between items-center gap-4">
                    <div className="relative w-full md:w-96">
                        <Search className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400" size={18} />
                        <input
                            type="text"
                            placeholder="Buscar campanhas..."
                            value={searchTerm}
                            onChange={e => setSearchTerm(e.target.value)}
                            className="w-full pl-10 pr-4 py-2.5 bg-slate-50 border border-slate-200 rounded-lg text-slate-800 focus:outline-none focus:border-orange-500 focus:ring-1 focus:ring-orange-500 transition-all font-medium placeholder:text-slate-400"
                        />
                    </div>
                </div>

                {/* CAMPAIGN LIST */}
                {loading ? (
                    <div className="py-20 flex justify-center text-gray-400">
                        <Loader2 className="animate-spin" size={32} />
                    </div>
                ) : filteredCampaigns.length === 0 ? (
                    <div className="text-center py-20 bg-white rounded-2xl border border-gray-200 border-dashed">
                        <Target className="mx-auto text-gray-300 mb-4" size={48} />
                        <h3 className="text-lg font-bold text-slate-700 mb-2">Nenhuma campanha encontrada</h3>
                        <p className="text-gray-500 mb-6">Comece criando sua primeira campanha de prospec√ß√£o.</p>
                        <button
                            onClick={() => setIsCreateModalOpen(true)}
                            className="px-5 py-2 rounded-lg bg-orange-50 text-orange-600 font-bold hover:bg-orange-100 transition-colors"
                        >
                            Criar Campanha
                        </button>
                    </div>
                ) : (
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        {filteredCampaigns.map(campaign => (
                            <div
                                key={campaign.id}
                                onClick={() => navigate(`/campaigns/${campaign.id}`)}
                                className="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm hover:shadow-md hover:border-orange-200 transition-all cursor-pointer group"
                            >
                                <div className="flex justify-between items-start mb-4">
                                    <div className={`w-10 h-10 rounded-lg flex items-center justify-center ${campaign.status === 'active' ? 'bg-green-100 text-green-600' : 'bg-gray-100 text-slate-500'
                                        }`}>
                                        <Target size={20} />
                                    </div>
                                    <span className={`px-2.5 py-1 rounded-full text-xs font-bold uppercase tracking-wide border ${campaign.status === 'active'
                                        ? 'bg-green-50 text-green-600 border-green-100'
                                        : 'bg-slate-100 text-slate-500 border-slate-200'
                                        }`}>
                                        {campaign.status === 'active' ? 'Ativa' : 'Pausada'}
                                    </span>
                                </div>

                                <h3 className="text-xl font-bold text-slate-900 mb-2 group-hover:text-orange-600 transition-colors line-clamp-1">
                                    {campaign.name}
                                </h3>
                                <p className="text-sm text-slate-600 font-medium mb-6 line-clamp-2">
                                    {campaign.description || "Sem descri√ß√£o definida."}
                                </p>

                                <div className="flex items-center gap-4 text-xs font-bold text-slate-500 border-t border-slate-100 pt-4">
                                    <div className="flex items-center gap-1.5">
                                        <Calendar size={14} />
                                        {new Date(campaign.created_at).toLocaleDateString()}
                                    </div>
                                    <div className="flex items-center gap-1.5 ml-auto text-orange-600 opacity-0 group-hover:opacity-100 transition-opacity">
                                        Acessar <ArrowRight size={14} />
                                    </div>
                                </div>
                            </div>
                        ))}
                    </div>
                )}
            </div>

            {/* CREATE MODAL */}
            {isCreateModalOpen && (
                <div className="fixed inset-0 z-50 flex items-center justify-center bg-slate-900/50 backdrop-blur-sm p-4">
                    <div className="bg-white w-full max-w-md rounded-2xl shadow-2xl overflow-hidden animate-scale-in">
                        <div className="p-6 border-b border-gray-100">
                            <h2 className="text-xl font-bold text-slate-800">Nova Campanha</h2>
                            <p className="text-sm text-gray-500 mt-1">D√™ um nome para sua nova campanha de prospec√ß√£o.</p>
                        </div>
                        <form onSubmit={handleCreateCampaign} className="p-6">
                            <div className="mb-6">
                                <label className="block text-sm font-bold text-slate-700 mb-2">Nome da Campanha</label>
                                <input
                                    autoFocus
                                    type="text"
                                    value={newCampaignName}
                                    onChange={e => setNewCampaignName(e.target.value)}
                                    placeholder="Ex: Prospec√ß√£o CEO Tech Q1"
                                    className="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl text-slate-800 focus:outline-none focus:border-orange-500 focus:ring-2 focus:ring-orange-200 transition-all font-medium"
                                />
                            </div>
                            <div className="flex gap-3 justify-end">
                                <button
                                    type="button"
                                    onClick={() => setIsCreateModalOpen(false)}
                                    className="px-5 py-2.5 rounded-xl text-slate-600 font-bold hover:bg-gray-100 transition-colors"
                                >
                                    Cancelar
                                </button>
                                <button
                                    type="submit"
                                    disabled={!newCampaignName.trim() || createLoading}
                                    className="px-5 py-2.5 rounded-xl bg-orange-600 text-white font-bold hover:bg-orange-700 transition-all shadow-lg shadow-orange-200 disabled:opacity-70 disabled:cursor-not-allowed flex items-center gap-2"
                                >
                                    {createLoading && <Loader2 className="animate-spin" size={18} />}
                                    Criar Campanha
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            )}
        </div>
    )
}

export default CampaignsPage

```

---

## Arquivo: src\pages\ClientDashboard.css
```css
/* 
  DEPRECATED: Styles have been moved to Tailwind classes in ClientDashboard.jsx
  as part of the Obsidian Glass visual overhaul.
*/
```

---

## Arquivo: src\pages\ClientDashboard.jsx
```jsx
import React, { useState, useEffect } from 'react'
import { useNavigate } from 'react-router-dom'
import { supabase } from '../services/supabaseClient'
import { useAuth } from '../contexts/AuthContext'
import { Loader2, Camera, ArrowRight, RefreshCw, LayoutGrid } from 'lucide-react'

const ClientDashboard = () => {
    const { profile } = useAuth()
    const [posts, setPosts] = useState([])
    const [loading, setLoading] = useState(true)
    const navigate = useNavigate()

    useEffect(() => {
        if (profile?.nome_empresa) {
            fetchClientPosts(profile.nome_empresa)
        }
    }, [profile])


    const fetchClientPosts = async (clientName) => {
        setLoading(true)
        try {
            const { data, error } = await supabase
                .from('tabela_projetofred1')
                .select('*')
                .eq('nome_cliente', clientName)
                .order('id', { ascending: false })

            if (error) throw error
            setPosts(data || [])
        } catch (err) {
            console.error('Erro ao buscar posts:', err)
        } finally {
            setLoading(false)
        }
    }

    const clientName = profile?.nome_empresa

    return (
        <div className="p-2 md:p-6 animate-fade-in-up">
            {/* Header */}
            <div className="mb-8 flex flex-col md:flex-row justify-between items-end gap-4 glass-panel p-6 rounded-2xl border-glass-border bg-gradient-to-r from-white/5 to-transparent">
                <div>
                    <h1 className="text-3xl font-bold text-white mb-2 flex items-center gap-3">
                        Ol√°, {clientName || 'Cliente'} <span className="text-2xl">üëã</span>
                    </h1>
                    <p className="text-gray-400">
                        Voc√™ tem <span className="text-primary font-bold">{posts.length} posts</span> no hist√≥rico.
                    </p>
                </div>
                <button
                    onClick={() => window.location.reload()}
                    className="flex items-center gap-2 px-4 py-2 rounded-xl bg-white/5 hover:bg-white/10 text-gray-300 hover:text-white transition-all text-sm font-medium border border-glass-border hover:border-white/20"
                >
                    <RefreshCw size={14} /> Atualizar Dados
                </button>
            </div>

            {loading ? (
                <div className="flex flex-col items-center justify-center py-20 text-gray-500">
                    <Loader2 className="animate-spin mb-4 text-primary" size={32} />
                    <p className="text-sm font-medium">Carregando galeria...</p>
                </div>
            ) : (
                /* Grid de Cards */
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    {posts.map((post) => (
                        <div key={post.id} className="group glass-panel rounded-2xl border-glass-border overflow-hidden flex flex-col hover:border-primary/30 transition-all duration-300 hover:shadow-lg hover:shadow-primary/5">

                            {/* √Årea da Imagem */}
                            <div className="h-48 bg-black/40 relative overflow-hidden">
                                {post.image_url ? (
                                    <img src={post.image_url} alt="Post" className="w-full h-full object-cover opacity-80 group-hover:opacity-100 group-hover:scale-105 transition-all duration-500" />
                                ) : (
                                    <div className="w-full h-full flex items-center justify-center bg-white/5 text-gray-600">
                                        <Camera className="w-12 h-12 opacity-20" />
                                    </div>
                                )}

                                {/* Badge de Status */}
                                <div className="absolute top-3 right-3">
                                    <span className={`px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-wider backdrop-blur-md border ${(() => {
                                        const s = (post.status || '').toUpperCase();
                                        if (s === 'APPROVED' || s.includes('APPROV')) return 'bg-green-500/20 text-green-400 border-green-500/30';
                                        if (s.includes('WAITING') || s.includes('PEND')) return 'bg-amber-500/20 text-amber-400 border-amber-500/30';
                                        return 'bg-gray-500/20 text-gray-400 border-gray-500/30';
                                    })()}`}>
                                        {(() => {
                                            const s = (post.status || '').toUpperCase();
                                            if (s === 'APPROVED' || s.includes('APPROV')) return 'Aprovado';
                                            if (s.includes('WAITING') || s.includes('PEND')) return 'Pendente';
                                            return 'Em Revis√£o';
                                        })()}
                                    </span>
                                </div>
                            </div>

                            {/* Conte√∫do do Card */}
                            <div className="p-5 flex-1 flex flex-col bg-gradient-to-b from-transparent to-black/20">
                                <div className="flex-1">
                                    <h3 className="font-bold text-lg text-white leading-tight mb-2 line-clamp-2">
                                        {post.titulo_hook || post.tema || "Sem t√≠tulo"}
                                    </h3>
                                    <p className="text-xs text-gray-500 font-medium mb-4 flex items-center gap-2">
                                        <span className="w-1 h-1 rounded-full bg-gray-600"></span>
                                        {new Date(post.created_at).toLocaleDateString('pt-BR')}
                                    </p>
                                </div>

                                <button
                                    onClick={() => navigate(`/post-feedback/${post.id}`)}
                                    className="w-full mt-4 py-3 rounded-xl bg-white/5 hover:bg-white/10 text-gray-300 hover:text-white border border-glass-border hover:border-primary/50 font-medium text-sm transition-all duration-300 flex items-center justify-center gap-2 group-hover:bg-primary/10 group-hover:text-primary group-hover:border-primary/30"
                                >
                                    {(post.status || '').toUpperCase().includes('APPROV') ? 'Ver Detalhes' : 'Revisar Conte√∫do'}
                                    <ArrowRight size={14} className="group-hover:translate-x-1 transition-transform" />
                                </button>
                            </div>
                        </div>
                    ))}

                    {posts.length === 0 && (
                        <div className="col-span-full py-20 glass-panel rounded-2xl border-glass-border border-dashed flex flex-col items-center justify-center text-center">
                            <LayoutGrid className="w-16 h-16 text-gray-700 mb-4" />
                            <h3 className="text-gray-300 font-medium text-lg">Nenhum post encontrado.</h3>
                            <p className="text-sm text-gray-500 mt-2">Seu hist√≥rico est√° vazio por enquanto.</p>
                        </div>
                    )}
                </div>
            )}
        </div>
    )
}

export default ClientDashboard

```

---

## Arquivo: src\pages\ClientInsightsPage.jsx
```jsx
import React, { useState, useEffect, useRef } from 'react'
import { useClientAuth } from '../contexts/ClientAuthContext'
import { supabase } from '../services/supabaseClient'
import { useParams } from 'react-router-dom'
import {
    LayoutDashboard,
    CheckCircle2,
    AlertCircle,
    Mic,
    StopCircle,
    Play,
    Trash2,
    Send,
    Loader2,
    X,
    ChevronRight,
    MessageSquare,
    Image as ImageIcon,
    Clock,
    MoreHorizontal,
    FileText,
    CalendarClock
} from 'lucide-react'
import ContentCalendar from '../components/ContentCalendar'

// --- STYLES (Responsive Grid & UI) ---
const pageStyles = `
  .insights-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 2rem 1.5rem 6rem;
    font-family: 'Inter', system-ui, sans-serif;
    color: #1e293b;
  }
  
  /* Header */
  .insights-header {
    margin-bottom: 3rem;
  }
  .insights-header h1 {
    font-size: 2rem;
    font-weight: 800;
    color: #111827;
    margin-bottom: 0.5rem;
    letter-spacing: -0.025em;
  }
  .insights-header p {
    font-size: 1.125rem;
    color: #64748b;
    line-height: 1.6;
  }
  .highlight-stats {
    color: #7c3aed; /* Purple brand */
    font-weight: 700;
  }

  /* Grid Layout */
  .insights-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 2rem;
    margin-bottom: 4rem;
  }
  @media (min-width: 768px) {
    .insights-grid { grid-template-columns: repeat(2, 1fr); }
  }
  @media (min-width: 1024px) {
    .insights-grid { grid-template-columns: repeat(3, 1fr); }
  }

  /* Card Component */
  .insight-card {
    background: #ffffff;
    border-radius: 20px;
    border: 1px solid #e2e8f0;
    overflow: hidden;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
    transition: all 0.3s ease;
    display: flex;
    flex-direction: column;
    height: 100%;
    position: relative;
  }
  .insight-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
    border-color: #cbd5e1;
  }

  /* Card Image */
  .card-image-wrapper {
    height: 200px;
    background: #f1f5f9;
    position: relative;
    overflow: hidden;
  }
  .card-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.5s ease;
  }
  .insight-card:hover .card-image {
    transform: scale(1.05);
  }
  .card-placeholder {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
    color: #94a3b8;
  }

  /* Floating Badge */
  .status-badge-float {
    position: absolute;
    top: 1rem;
    right: 1rem;
    padding: 0.35rem 0.85rem;
    border-radius: 9999px;
    font-size: 0.75rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    backdrop-filter: blur(8px);
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
  }

  /* Card Content */
  .card-body {
    padding: 1.5rem;
    flex: 1;
    display: flex;
    flex-direction: column;
  }
  .card-title {
    font-size: 1.125rem;
    font-weight: 700;
    color: #0f172a;
    line-height: 1.4;
    margin-bottom: 0.75rem;
    
    /* Line Clamp 2 */
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  .card-meta {
    font-size: 0.825rem;
    color: #94a3b8;
    display: flex;
    align-items: center;
    gap: 6px;
    margin-bottom: auto; /* Pushes footer down */
  }

  /* Card Actions */
  .card-actions {
    margin-top: 1.5rem;
    padding-top: 1.25rem;
    border-top: 1px solid #f1f5f9;
  }
  .btn-action {
    width: 100%;
    padding: 0.75rem;
    border-radius: 12px;
    font-weight: 600;
    font-size: 0.875rem;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    border: none;
    cursor: pointer;
    transition: background 0.2s;
  }
  /* Primary Action (Purple) */
  .btn-primary {
    background: #7c3aed;
    color: white;
  }
  .btn-primary:hover {
    background: #6d28d9;
  }
  /* Secondary Action (Outline) */
  .btn-outline {
    background: transparent;
    color: #7c3aed;
    border: 1px solid #e9d5ff;
  }
  .btn-outline:hover {
    background: #faf5ff;
    border-color: #d8b4fe;
  }

  /* Questions List */
  .questions-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }
  .question-item {
    background: white;
    padding: 1.5rem;
    border-radius: 16px;
    border: 1px solid #e2e8f0;
    display: flex;
    justify-content: space-between;
    align-items: center;
    transition: transform 0.2s;
  }
  .question-item:hover {
    transform: translateX(4px);
    border-color: #cbd5e1;
  }

  /* Image Count Badge */
  .image-count-badge {
    position: absolute;
    bottom: 0.5rem;
    right: 0.5rem;
    background: rgba(0, 0, 0, 0.7);
    color: white;
    padding: 0.25rem 0.6rem;
    border-radius: 8px;
    font-size: 0.75rem;
    font-weight: 700;
    backdrop-filter: blur(4px);
    display: flex;
    align-items: center;
    gap: 4px;
  }
`

// --- HELPERS ---
const getImagesFromPost = (post) => {
    if (!post.sugestao_imagem) return []

    // 1. If it's already an array (Supabase JSON/Array column), return it
    if (Array.isArray(post.sugestao_imagem)) {
        return post.sugestao_imagem
    }

    try {
        const val = String(post.sugestao_imagem).trim()
        // 2. Check if it looks like a JSON array
        if (val.startsWith('[')) {
            const parsed = JSON.parse(val)
            if (Array.isArray(parsed)) return parsed
        }
        // 3. Fallback for single string URL
        return [val]
    } catch (e) {
        // Failsafe
        return [post.sugestao_imagem]
    }
}

// --- SUB-COMPONENT: QUESTION RESPONSE MODAL ---
const QuestionResponseModal = ({ question, onClose, onResponseSent }) => {
    const [answerText, setAnswerText] = useState('')
    const [isRecording, setIsRecording] = useState(false)
    const [audioBlob, setAudioBlob] = useState(null)
    const [audioUrl, setAudioUrl] = useState(null)
    const [publicAudioUrl, setPublicAudioUrl] = useState(null)
    const [recordingTime, setRecordingTime] = useState(0)

    const [isProcessing, setIsProcessing] = useState(false)
    const [isReviewing, setIsReviewing] = useState(false)
    const [isSaving, setIsSaving] = useState(false)

    const mediaRecorderRef = useRef(null)
    const timerRef = useRef(null)

    useEffect(() => { return () => { if (audioUrl) URL.revokeObjectURL(audioUrl) } }, [audioUrl])

    const startRecording = async () => {
        try {
            const stream = await navigator.mediaDevices.getUserMedia({ audio: true })
            const mediaRecorder = new MediaRecorder(stream)
            mediaRecorderRef.current = mediaRecorder
            const chunks = []
            mediaRecorder.ondataavailable = (e) => { if (e.data.size > 0) chunks.push(e.data) }
            mediaRecorder.onstop = () => {
                const blob = new Blob(chunks, { type: 'audio/webm' })
                const url = URL.createObjectURL(blob)
                setAudioBlob(blob)
                setAudioUrl(url)
                stream.getTracks().forEach(track => track.stop())
            }
            mediaRecorder.start()
            setIsRecording(true)
            setRecordingTime(0)
            timerRef.current = setInterval(() => { setRecordingTime(prev => prev + 1) }, 1000)
        } catch (err) { alert('Erro microfone: ' + err.message) }
    }

    // Cleanup interval on unmount
    useEffect(() => {
        return () => {
            if (timerRef.current) clearInterval(timerRef.current)
        }
    }, [])

    const stopRecording = () => {
        if (mediaRecorderRef.current && isRecording) {
            mediaRecorderRef.current.stop()
            setIsRecording(false)
            clearInterval(timerRef.current)
        }
    }

    const discardRecording = () => {
        setAudioBlob(null); setAudioUrl(null); setRecordingTime(0); setIsReviewing(false); setPublicAudioUrl(null)
    }

    const handleProcessAudio = async () => {
        if (!audioBlob) return alert("√Åudio vazio.")
        if (audioBlob.size > 50 * 1024 * 1024) return alert("O arquivo de √°udio excede o limite de 50MB.")
        setIsProcessing(true)
        try {
            const fileName = "audio_" + Date.now() + ".webm"
            const audioFile = new File([audioBlob], fileName, { type: 'audio/webm' })
            const { error: upErr } = await supabase.storage.from('audio-responses').upload(fileName, audioFile)
            if (upErr) throw upErr
            const { data: pubData } = supabase.storage.from('audio-responses').getPublicUrl(fileName)
            const generatedUrl = pubData.publicUrl
            setPublicAudioUrl(generatedUrl)

            const response = await fetch('https://n8n-n8n-start.kfocge.easypanel.host/webhook/transcrever-audio', {
                method: 'POST', headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ question_id: question.id, audio_url: generatedUrl })
            })
            if (response.ok) {
                const webData = await response.json()
                if (webData?.transcription) setAnswerText(webData.transcription)
            }
            setIsReviewing(true)
        } catch (err) { alert("Erro processar: " + err.message) } finally { setIsProcessing(false) }
    }

    const handleConfirmSend = async () => {
        if (!answerText.trim() && !audioBlob) return alert('Escreva ou grave algo.')
        setIsSaving(true)
        try {
            const { error } = await supabase.from('interview_questions').update({
                answer_text: answerText, answer_audio_url: publicAudioUrl, status: 'answered'
            }).eq('id', question.id)
            if (error) throw error
            onResponseSent(question.id); onClose()
        } catch (err) { alert('Erro salvar: ' + err.message) } finally { setIsSaving(false) }
    }

    return (
        <div style={{ position: 'fixed', top: 0, left: 0, right: 0, bottom: 0, background: 'rgba(0,0,0,0.5)', display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 10000 }}>
            <div style={{ background: 'white', padding: '2rem', borderRadius: '24px', width: '90%', maxWidth: '600px', position: 'relative' }}>
                <button onClick={onClose} style={{ position: 'absolute', top: '1.5rem', right: '1.5rem', background: 'none', border: 'none', cursor: 'pointer' }}><X size={24} color="#94a3b8" /></button>
                <h3 style={{ fontSize: '1.25rem', fontWeight: 700, color: '#1e293b', marginBottom: '1.5rem', paddingRight: '2rem' }}>{question.question_text}</h3>

                {!isReviewing ? (
                    <div style={{ display: 'flex', flexDirection: 'column', gap: '1rem' }}>
                        {!audioBlob && <textarea placeholder="Escreva sua resposta..." value={answerText} onChange={e => setAnswerText(e.target.value)} style={{ width: '100%', minHeight: '120px', padding: '1rem', borderRadius: '12px', border: '1px solid #e2e8f0' }} />}
                        <div style={{ display: 'flex', gap: '1rem', alignItems: 'center', background: '#f8fafc', padding: '1rem', borderRadius: '12px' }}>
                            {!isRecording && !audioBlob && <button onClick={startRecording} style={{ display: 'flex', gap: '8px', color: '#ef4444', fontWeight: 600, border: 'none', background: 'none', cursor: 'pointer' }}><Mic /> Gravar √Åudio</button>}
                            {isRecording && <span style={{ color: '#ef4444', fontWeight: 600 }}>Gravando... {Math.floor(recordingTime / 60)}:{recordingTime % 60 < 10 ? '0' : ''}{recordingTime % 60}</span>}
                            {isRecording && <button onClick={stopRecording} style={{ marginLeft: 'auto', background: '#ef4444', color: 'white', border: 'none', padding: '0.4rem 1rem', borderRadius: '99px' }}>Parar</button>}
                            {audioBlob && <div style={{ display: 'flex', gap: '1rem', width: '100%', alignItems: 'center' }}><audio src={audioUrl} controls style={{ flex: 1, height: 36 }} /><button onClick={discardRecording} style={{ border: 'none', background: 'none' }}><Trash2 color="#64748b" /></button></div>}
                        </div>
                        <button onClick={audioBlob ? handleProcessAudio : handleConfirmSend} disabled={(!answerText.trim() && !audioBlob) || isProcessing || isSaving} style={{ width: '100%', padding: '1rem', background: '#7c3aed', color: 'white', border: 'none', borderRadius: '12px', fontWeight: 600, opacity: (!answerText.trim() && !audioBlob) ? 0.5 : 1 }}>{isProcessing ? 'Processando...' : isSaving ? 'Enviando...' : audioBlob ? 'Transcrever e Revisar' : 'Enviar Resposta'}</button>
                    </div>
                ) : (
                    <div style={{ display: 'flex', flexDirection: 'column', gap: '1rem' }}>
                        <div style={{ background: '#f0fdf4', color: '#16a34a', padding: '1rem', borderRadius: '12px', display: 'flex', gap: '8px' }}><CheckCircle2 /> Transcri√ß√£o pronta!</div>
                        <textarea value={answerText} onChange={e => setAnswerText(e.target.value)} style={{ width: '100%', minHeight: '150px', padding: '1rem', borderRadius: '12px', border: '1px solid #e2e8f0' }} />
                        <div style={{ display: 'flex', gap: '1rem' }}><button onClick={() => setIsReviewing(false)} style={{ flex: 1, padding: '1rem', background: 'white', border: '1px solid #e2e8f0', borderRadius: '12px' }}>Voltar</button><button onClick={handleConfirmSend} style={{ flex: 1, padding: '1rem', background: '#16a34a', color: 'white', border: 'none', borderRadius: '12px', fontWeight: 600 }}>Confirmar Envio</button></div>
                    </div>
                )}
            </div>
        </div>
    )
}

// --- SUB-COMPONENT: POST REVIEW MODAL ---
const PostReviewModal = ({ post, onClose, onReview }) => {
    const [comment, setComment] = useState('')
    const [isSubmitting, setIsSubmitting] = useState(false)
    const [currentImgIndex, setCurrentImgIndex] = useState(0)

    const images = getImagesFromPost(post)
    const currentImage = images[currentImgIndex]

    const handleAction = async (action) => {
        setIsSubmitting(true)
        try {
            await onReview(post.id, action === 'approve' ? 'aprovado' : 'revis√£o', comment)
            onClose()
        } catch (err) { alert(err.message) } finally { setIsSubmitting(false) }
    }

    return (
        <div style={{ position: 'fixed', top: 0, left: 0, right: 0, bottom: 0, background: 'rgba(0,0,0,0.85)', display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 10000 }}>
            <div style={{ background: 'white', width: '95%', maxWidth: '1000px', height: '85vh', borderRadius: '24px', overflow: 'hidden', display: 'flex', flexDirection: window.innerWidth < 768 ? 'column' : 'row' }}>
                <div style={{ flex: 1.5, background: 'black', display: 'flex', alignItems: 'center', justifyContent: 'center', position: 'relative' }}>

                    {/* Image */}
                    {currentImage ? (
                        <img src={currentImage} style={{ maxWidth: '100%', maxHeight: '100%', objectFit: 'contain' }} alt="Post" />
                    ) : (
                        <div style={{ color: 'white' }}>Sem Imagem</div>
                    )}

                    {/* Navigation Buttons */}
                    {images.length > 1 && (
                        <>
                            <button
                                onClick={(e) => { e.stopPropagation(); setCurrentImgIndex(prev => prev > 0 ? prev - 1 : images.length - 1) }}
                                style={{ position: 'absolute', left: '1rem', background: 'rgba(255,255,255,0.2)', color: 'white', border: 'none', borderRadius: '50%', padding: '0.5rem', cursor: 'pointer', backdropFilter: 'blur(4px)' }}
                            >
                                <ChevronRight style={{ transform: 'rotate(180deg)' }} />
                            </button>
                            <button
                                onClick={(e) => { e.stopPropagation(); setCurrentImgIndex(prev => prev < images.length - 1 ? prev + 1 : 0) }}
                                style={{ position: 'absolute', right: '1rem', background: 'rgba(255,255,255,0.2)', color: 'white', border: 'none', borderRadius: '50%', padding: '0.5rem', cursor: 'pointer', backdropFilter: 'blur(4px)' }}
                            >
                                <ChevronRight />
                            </button>
                            {/* Dots */}
                            <div style={{ position: 'absolute', bottom: '1rem', display: 'flex', gap: '6px' }}>
                                {images.map((_, idx) => (
                                    <div key={idx} style={{ width: 8, height: 8, borderRadius: '50%', background: idx === currentImgIndex ? 'white' : 'rgba(255,255,255,0.4)' }} />
                                ))}
                            </div>
                        </>
                    )}
                </div>
                <div style={{ flex: 1, padding: '2rem', display: 'flex', flexDirection: 'column', background: 'white' }}>
                    <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '1.5rem' }}>
                        <h3 style={{ fontSize: '1.25rem', fontWeight: 700 }}>Revis√£o de Conte√∫do</h3>
                        <button onClick={onClose} style={{ border: 'none', background: 'none', cursor: 'pointer' }}><X /></button>
                    </div>
                    <div style={{ flex: 1, overflowY: 'auto' }}>
                        <p style={{ whiteSpace: 'pre-wrap', color: '#334155', lineHeight: 1.6 }}>{post.corpo_post}</p>
                    </div>
                    <div style={{ borderTop: '1px solid #e2e8f0', paddingTop: '1.5rem', marginTop: '1rem' }}>
                        {post.status.includes('approv') ? <div style={{ textAlign: 'center', padding: '1rem', background: '#dcfce7', color: '#166534', borderRadius: '12px', fontWeight: 600 }}>Este post j√° est√° aprovado! üöÄ</div> : (
                            <>
                                <textarea value={comment} onChange={e => setComment(e.target.value)} placeholder="Deixe um coment√°rio se precisar de ajustes..." style={{ width: '100%', height: '80px', padding: '0.75rem', border: '1px solid #cbd5e1', borderRadius: '8px', marginBottom: '1rem' }} />
                                <div style={{ display: 'flex', gap: '1rem' }}>
                                    <button onClick={() => handleAction('reject')} disabled={isSubmitting} style={{ flex: 1, padding: '1rem', border: '1px solid #ef4444', color: '#ef4444', background: 'white', borderRadius: '12px', fontWeight: 600, cursor: 'pointer' }}>Solicitar Ajuste</button>
                                    <button onClick={() => handleAction('approve')} disabled={isSubmitting} style={{ flex: 1, padding: '1rem', background: '#ea580c', color: 'white', border: 'none', borderRadius: '12px', fontWeight: 600, cursor: 'pointer' }}>Aprovar Agora</button>
                                </div>
                            </>
                        )}
                    </div>
                </div>
            </div>
        </div>
    )
}

// --- MAIN PAGE ---
const ClientInsightsPage = () => {
    // Legacy/Context access (still used for Admin Emulation or Standard Login)
    const { clientId: contextId, clientLegacyId, clientName: contextName } = useClientAuth()

    const [posts, setPosts] = useState([])
    const [questions, setQuestions] = useState([])
    const [status, setStatus] = useState('loading') // 'loading', 'success', 'error'
    const [errorMessage, setErrorMessage] = useState('')
    const [clientData, setClientData] = useState(null) // Local client data for Magic Link

    const [selectedQuestion, setSelectedQuestion] = useState(null)
    const [selectedPost, setSelectedPost] = useState(null)

    // "RADICAL SIMPLIFICATION" - Single Load Logic
    useEffect(() => {
        let isMounted = true

        const carregarDados = async () => {
            // 1. Detect Token Mode
            const pathname = window.location.pathname;
            const isMagicLink = pathname.includes('/portal/') && !pathname.includes('insights') && !pathname.includes('login');

            if (!isMagicLink) {
                // Not Magic Link -> Standard Context logic
                if (contextName && status !== 'success') {
                    // Check if context has valid data
                    supabase.from('tabela_projetofred1')
                        .select('*')
                        .eq('nome_cliente', contextName)
                        .order('created_at', { ascending: false })
                        .range(0, 49) // Pagina√ß√£o Auto (Limit 50)
                        .then(({ data }) => {
                            if (isMounted) {
                                setPosts(data || [])
                                setClientData({ name: contextName })
                                setStatus('success')
                            }
                        })
                }
                return;
            }

            console.log("Iniciando carga √∫nica (Magic Link)...");

            const token = pathname.split('/').pop();

            // 2. Busca Cliente
            const { data: cliente, error: erroCliente } = await supabase
                .from('clients')
                .select('*')
                .eq('access_token', token)
                .maybeSingle();

            if (erroCliente) console.error("Erro Cliente:", erroCliente);

            if (!cliente) {
                if (isMounted) {
                    setStatus('error');
                    setErrorMessage("Link inv√°lido ou expirado.");
                }
                return;
            }

            // 3. Busca Posts (Cruzando nome)
            const { data: postsData, error: erroPosts } = await supabase
                .from('tabela_projetofred1')
                .select('*')
                .eq('nome_cliente', cliente.name)
                .order('created_at', { ascending: false })
                .range(0, 49); // Pagina√ß√£o Auto

            if (erroPosts) console.error("Erro Posts:", erroPosts);

            // 4. Busca Perguntas (Via UUID id_client)
            let questionsData = [];
            if (cliente.id_client) {
                const { data: qData, error: qError } = await supabase
                    .from('interview_questions')
                    .select('*')
                    .eq('id_client', cliente.id_client)
                    .eq('status', 'pending')
                    .order('created_at', { ascending: false })
                    .range(0, 49); // Pagina√ß√£o Auto

                if (qError) console.error("Erro Questions:", qError);
                questionsData = qData || [];
            } else {
                console.warn("Cliente sem id_client (UUID) para buscar perguntas.");
            }

            if (isMounted) {
                setClientData(cliente);
                setPosts(postsData || []);
                setQuestions(questionsData);
                setStatus('success');
            }
        };

        carregarDados();

        return () => {
            isMounted = false
        }
    }, [contextName]); // Dependency on contextName helps trigger standard auth load if needed

    // --- HELPERS ---
    const handlePostReview = async (postId, status, comment) => {
        const { error } = await supabase.from('tabela_projetofred1').update({ status }).eq('id', postId)
        if (!error) {
            setPosts(prev => prev.map(p => p.id === postId ? { ...p, status } : p))
            if (status === 'aprovado') alert("Post aprovado com sucesso! üöÄ")
        }
    }
    const handleQuestionResponse = (qId) => setQuestions(prev => prev.filter(q => q.id !== qId))
    const getStatusStyle = (status) => {
        const s = (status || '').toUpperCase()
        if (s === 'WAITING_APPROVAL' || s === 'PENDING') return { bg: '#fef3c7', color: '#b45309', label: 'Aguardando Aprova√ß√£o', icon: <Clock size={12} /> }
        if (s === 'APPROVED' || s === 'APROVADO') return { bg: '#dcfce7', color: '#166534', label: 'Aprovado', icon: <CheckCircle2 size={12} /> }
        if (s === 'CHANGES_REQUESTED' || s.includes('REVI')) return { bg: '#f3e8ff', color: '#7e22ce', label: 'Altera√ß√£o Solicitada', icon: <Mic size={12} /> }
        if (s === 'POSTADO') return { bg: '#e0f2fe', color: '#0369a1', label: 'Publicado', icon: <Send size={12} /> }
        return { bg: '#f1f5f9', color: '#64748b', label: 'Status: ' + status, icon: <AlertCircle size={12} /> }
    }

    // MOVED TO TOP LEVEL SCOPE

    if (status === 'loading') {
        return (
            <div style={{ padding: '4rem', textAlign: 'center', color: '#64748b' }}>
                <h1>Carregando Portal... <Loader2 className="animate-spin inline ml-2" /></h1>
            </div>
        )
    }

    if (status === 'error') {
        return (
            <div style={{ padding: '4rem', textAlign: 'center' }}>
                <h1 style={{ color: '#ef4444' }}>Erro: {errorMessage}</h1>
            </div>
        )
    }

    // --- Filtering Logic ---
    const pendingPosts = posts.filter(p => {
        const s = (p.status || '').toUpperCase()
        return (s === 'WAITING_APPROVAL' || s === 'CHANGES_REQUESTED') && s !== 'POSTADO'
    })

    const scheduledPosts = posts.filter(p => {
        const s = (p.status || '').toUpperCase()
        return (s === 'APPROVED' || s === 'AGENDADO' || s === 'APROVADO') && s !== 'POSTADO'
    })

    const displayName = clientData?.name || contextName || 'Cliente';

    // SUCCESS RENDER
    return (
        <div className="insights-container">
            <style>{pageStyles}</style>

            {/* Header */}
            <div className="insights-header">
                <h1>Ol√°, {displayName}</h1>
                <p>
                    Voc√™ tem <span className="highlight-stats">{questions.length} perguntas pendentes</span> e <span className="highlight-stats">{posts.length} posts</span> na sua galeria.
                </p>
            </div>

            {/* Section: Posts Grid (MOVED TO TOP) */}
            {/* --- SE√á√ÉO: POSTAGENS PENDENTES --- */}
            <div className="mb-12">
                <h2 className="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                    <div className="w-2 h-8 bg-orange-500 rounded-full"></div>
                    Postagens Pendentes ({pendingPosts.length})
                </h2>

                <div className="flex flex-col gap-3">
                    {pendingPosts.length > 0 ? (
                        pendingPosts.map(post => (
                            <div key={post.id} className="bg-white border border-gray-200 rounded-lg p-4 flex items-center justify-between shadow-sm hover:shadow-md transition-all">
                                <div className="flex-1 pr-4">
                                    <h3 className="font-semibold text-gray-800 text-lg mb-1 line-clamp-1">{post.tema || 'Sem T√≠tulo'}</h3>
                                    <p className="text-sm text-gray-500 flex items-center gap-2">
                                        <Clock size={14} />
                                        {post.data_criacao ? new Date(post.data_criacao).toLocaleDateString('pt-BR') : 'Data N/A'}
                                        <span className="text-xs bg-orange-100 text-orange-700 px-2 py-0.5 rounded-full font-medium ml-2">
                                            {getStatusStyle(post.status).label}
                                        </span>
                                    </p>
                                </div>
                                <button
                                    onClick={() => window.location.href = `/post-feedback/${post.id}`}
                                    className="bg-gray-900 text-white px-6 py-2 rounded-lg font-medium text-sm hover:bg-gray-800 transition-colors shrink-0"
                                >
                                    Verificar
                                </button>
                            </div>
                        ))
                    ) : (
                        <div className="text-center py-8 bg-gray-50 rounded-lg border border-dashed border-gray-300">
                            <p className="text-gray-500">Nenhuma postagem pendente no momento.</p>
                        </div>
                    )}
                </div>
            </div>

            {/* --- SE√á√ÉO: POSTAGENS AGENDADAS / APROVADAS --- */}
            <div style={{ marginBottom: '4rem' }}>
                <h2 className="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                    <div className="w-2 h-8 bg-green-500 rounded-full"></div>
                    Postagens Agendadas ({scheduledPosts.length})
                </h2>

                <div className="flex flex-col gap-3">
                    {scheduledPosts.length > 0 ? (
                        scheduledPosts.map(post => (
                            <div key={post.id} className="bg-white border border-gray-200 rounded-lg p-4 flex items-center justify-between shadow-sm hover:shadow-md transition-all">
                                <div className="flex-1 pr-4">
                                    <h3 className="font-semibold text-gray-800 text-lg mb-1 line-clamp-1">{post.tema || 'Sem T√≠tulo'}</h3>
                                    <p className="text-sm text-gray-500 flex items-center gap-2">
                                        <CalendarClock size={14} />
                                        {post.data_agendamento ? new Date(post.data_agendamento).toLocaleDateString('pt-BR') : 'Agendamento N/A'}
                                        <span className="text-xs bg-green-100 text-green-700 px-2 py-0.5 rounded-full font-medium ml-2">
                                            {getStatusStyle(post.status).label}
                                        </span>
                                    </p>
                                </div>
                                <button
                                    onClick={() => window.location.href = `/post-feedback/${post.id}`}
                                    className="bg-white border border-gray-300 text-gray-700 px-6 py-2 rounded-lg font-medium text-sm hover:bg-gray-50 transition-colors shrink-0"
                                >
                                    Ver Detalhes
                                </button>
                            </div>
                        ))
                    ) : (
                        <div className="text-center py-8 bg-gray-50 rounded-lg border border-dashed border-gray-300">
                            <p className="text-gray-500">Nenhuma postagem agendada no momento.</p>
                        </div>
                    )}
                </div>
            </div>

            {/* Section: Questions (Pending) */}
            {questions.length > 0 && (
                <div style={{ marginBottom: '4rem' }}>
                    <h3 style={{ fontSize: '1.25rem', fontWeight: 700, color: '#334155', marginBottom: '1.5rem', display: 'flex', alignItems: 'center', gap: '8px' }}>
                        <Mic size={20} /> Perguntas Pendentes
                    </h3>
                    <div className="questions-list">
                        {questions.map(q => (
                            <div key={q.id} className="question-item">
                                <div style={{ display: 'flex', gap: '1rem', alignItems: 'center' }}>
                                    <div style={{ background: '#fef3c7', padding: '0.75rem', borderRadius: '50%', color: '#d97706' }}>
                                        <MessageSquare size={20} />
                                    </div>
                                    <div>
                                        <p style={{ fontWeight: 600, color: '#1e293b', marginBottom: '4px' }}>{q.question_text}</p>
                                        <span style={{ fontSize: '0.875rem', color: '#64748b' }}>Aguardando sua resposta</span>
                                    </div>
                                </div>
                                <button
                                    onClick={() => setSelectedQuestion(q)}
                                    style={{ padding: '0.75rem 1.5rem', background: '#7c3aed', color: 'white', border: 'none', borderRadius: '12px', fontWeight: 600, cursor: 'pointer', display: 'flex', alignItems: 'center', gap: '8px' }}
                                >
                                    Responder <ChevronRight size={16} />
                                </button>
                            </div>
                        ))}
                    </div>
                </div>
            )}

            {/* Section: Content Calendar (MOVED TO BOTTOM) */}
            {posts.length > 0 && (
                <ContentCalendar posts={posts} />
            )}

            {/* Modals */}
            {selectedQuestion && <QuestionResponseModal question={selectedQuestion} onClose={() => setSelectedQuestion(null)} onResponseSent={handleQuestionResponse} />}
            {selectedPost && <PostReviewModal post={selectedPost} onClose={() => setSelectedPost(null)} onReview={handlePostReview} />}
        </div >
    )
}

export default ClientInsightsPage

```

---

## Arquivo: src\pages\ClientLoginPage.jsx
```jsx
import React, { useState } from 'react'
import { supabase } from '../services/supabaseClient'
import { useNavigate } from 'react-router-dom'
import { Loader2, Lock } from 'lucide-react'

const ClientLoginPage = () => {
    const [email, setEmail] = useState('')
    const [password, setPassword] = useState('')
    const [loading, setLoading] = useState(false)
    const [error, setError] = useState(null)
    const navigate = useNavigate()

    const handleLogin = async (e) => {
        e.preventDefault()
        setLoading(true)
        setError(null)

        try {
            const { data, error: signInError } = await supabase.auth.signInWithPassword({
                email,
                password
            })

            if (signInError) throw signInError

            // Check if user is actually a client
            const { data: profile, error: profileError } = await supabase
                .from('profiles')
                .select('role')
                .eq('id', data.user.id)
                .single()

            if (profileError) throw profileError

            if (profile.role !== 'client') {
                await supabase.auth.signOut()
                throw new Error('Acesso n√£o autorizado. Apenas clientes podem acessar esta √°rea.')
            }

            // Success redirect
            navigate('/portal/insights')

        } catch (err) {
            console.error(err)
            setError(err.message || 'Falha no login')
        } finally {
            setLoading(false)
        }
    }

    return (
        <div style={{
            minHeight: '100vh',
            display: 'flex',
            flexDirection: 'column',
            justifyContent: 'center',
            alignItems: 'center',
            background: 'linear-gradient(to bottom, #f3f4f6, #ffffff)', // bg-gray-100 to white
            fontFamily: "'Inter', sans-serif",
            padding: '1rem'
        }}>

            {/* --- LOGO (OUTSIDE CARD) --- */}
            <img
                src="/logo-linklead.png"
                alt="Link&Lead Logo"
                style={{
                    height: '64px', // h-16
                    width: 'auto',
                    marginBottom: '2rem', // mb-8
                    display: 'block'
                }}
            />

            {/* --- MAIN CARD --- */}
            <div style={{
                background: '#ffffff',
                width: '100%',
                maxWidth: '480px', // max-w-md (approx)
                borderRadius: '16px', // rounded-2xl
                boxShadow: '0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1)', // shadow-xl
                padding: '3rem', // p-10/12
                boxSizing: 'border-box'
            }}>
                <div style={{ textAlign: 'center', marginBottom: '2rem' }}>
                    <h1 style={{
                        fontSize: '1.875rem', // text-3xl
                        fontWeight: 700,
                        color: '#111827', // text-gray-900
                        marginBottom: '0.5rem'
                    }}>
                        Bem-vindo de volta
                    </h1>
                    <p style={{
                        color: '#4b5563', // text-gray-600
                        fontSize: '0.95rem'
                    }}>
                        Acesse o Portal do Cliente Link&Lead
                    </p>
                </div>

                {error && (
                    <div style={{
                        background: '#fef2f2',
                        border: '1px solid #fee2e2',
                        color: '#ef4444',
                        padding: '1rem',
                        borderRadius: '8px',
                        marginBottom: '1.5rem',
                        fontSize: '0.875rem',
                        textAlign: 'center'
                    }}>
                        {error}
                    </div>
                )}

                <form onSubmit={handleLogin}>
                    <div style={{ marginBottom: '1.5rem' }}>
                        <label style={{
                            display: 'block',
                            fontSize: '0.875rem',
                            fontWeight: 600,
                            color: '#374151', // text-gray-700
                            marginBottom: '0.5rem'
                        }}>
                            Email Corporativo
                        </label>
                        <input
                            type="email"
                            value={email}
                            onChange={e => setEmail(e.target.value)}
                            required
                            className="clean-input"
                            placeholder="seu@empresa.com"
                        />
                    </div>

                    <div style={{ marginBottom: '2rem' }}>
                        <label style={{
                            display: 'block',
                            fontSize: '0.875rem',
                            fontWeight: 600,
                            color: '#374151',
                            marginBottom: '0.5rem'
                        }}>
                            Senha
                        </label>
                        <input
                            type="password"
                            value={password}
                            onChange={e => setPassword(e.target.value)}
                            required
                            className="clean-input"
                            placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                        />
                    </div>

                    <button
                        type="submit"
                        disabled={loading}
                        className="clean-button"
                    >
                        {loading && <Loader2 className="spinner" size={20} />}
                        {loading ? 'Validando...' : 'Entrar na Plataforma'}
                    </button>
                </form>
            </div>

            <style>{`
                .clean-input {
                    display: block;
                    width: 100%;
                    padding: 0.875rem 1rem; /* py-3.5 */
                    background-color: #f9fafb; /* bg-gray-50 */
                    border: 1px solid #d1d5db; /* border-gray-300 */
                    border-radius: 8px;
                    color: #111827; /* text-gray-900 */
                    font-size: 1rem;
                    line-height: 1.5;
                    outline: none;
                    transition: all 0.2s ease-in-out;
                }
                .clean-input:focus {
                    background-color: #ffffff;
                    border-color: #f97316; /* orange-500 */
                    box-shadow: 0 0 0 4px rgba(249, 115, 22, 0.15); /* ring-orange-500/15 */
                }
                .clean-input::placeholder {
                    color: #9ca3af; /* text-gray-400 */
                }

                .clean-button {
                    width: 100%;
                    padding: 0.875rem;
                    background: linear-gradient(to right, #ea580c, #fb923c); /* brand gradient */
                    color: white;
                    border: none;
                    border-radius: 8px;
                    font-weight: 600;
                    font-size: 1.125rem; /* text-lg */
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    gap: 10px;
                    transition: all 0.2s ease;
                    box-shadow: 0 4px 6px -1px rgba(234, 88, 12, 0.4);
                }
                .clean-button:hover:not(:disabled) {
                    filter: brightness(1.05); /* slightly lighter */
                    transform: translateY(-1px);
                    box-shadow: 0 10px 15px -3px rgba(234, 88, 12, 0.3);
                }
                .clean-button:disabled {
                    opacity: 0.7;
                    cursor: not-allowed;
                    filter: grayscale(1);
                }

                .spinner {
                    animation: spin 1s linear infinite;
                }
                @keyframes spin { 
                    to { transform: rotate(360deg); } 
                }
            `}</style>
        </div>
    )
}

export default ClientLoginPage

```

---

## Arquivo: src\pages\ClientPortal.css
```css
.client-container {
    min-height: 100vh;
    background-color: #f3f4f6;
    font-family: 'Inter', system-ui, -apple-system, sans-serif;
    padding-bottom: 120px;
    /* Space for fixed footer/banners */
}

.client-header {
    background: white;
    padding: 1rem 1.5rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid #e5e7eb;
    position: sticky;
    top: 0;
    z-index: 10;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
}

.logo-area {
    font-weight: 700;
    color: #111827;
    font-size: 1.1rem;
}

.status-badge {
    padding: 0.25rem 0.75rem;
    border-radius: 999px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
}

.status-aprovado {
    background-color: #dcfce7;
    color: #166534;
}

.status-revis√£o,
.status-revisao {
    background-color: #fef9c3;
    color: #854d0e;
}

.status-aguardando,
.status-aguardando-aprova√ß√£o {
    background-color: #e0f2fe;
    color: #075985;
}

.status-postado {
    background-color: #f3e8ff;
    color: #6b21a8;
}

.post-view {
    max-width: 600px;
    margin: 2rem auto;
    padding: 0 1rem;
}

.post-card {
    background: white;
    border-radius: 12px;
    padding: 2rem;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
}

.post-title {
    font-size: 1.5rem;
    font-weight: 800;
    color: #111827;
    margin-top: 0;
    margin-bottom: 0.5rem;
    line-height: 1.3;
}

.post-meta {
    margin-bottom: 1.5rem;
}

.post-meta span {
    background-color: #f3f4f6;
    color: #4b5563;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.8rem;
    font-weight: 500;
}

.post-body p {
    line-height: 1.7;
    color: #374151;
    margin-bottom: 1rem;
    font-size: 1.05rem;
}

.post-body ul {
    padding-left: 1.25rem;
    margin-bottom: 1rem;
}

.post-body li {
    margin-bottom: 0.5rem;
    color: #374151;
}

.post-body strong {
    color: #111827;
}

.image-suggestion-box {
    background-color: #f8fafc;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    padding: 1.25rem;
    display: flex;
    gap: 1rem;
    margin-top: 2rem;
    align-items: flex-start;
}

.box-icon {
    color: #64748b;
}

.box-content strong {
    display: block;
    font-size: 0.9rem;
    color: #0f172a;
    margin-bottom: 0.25rem;
}

.box-content p {
    margin: 0;
    color: #475569;
    font-size: 0.95rem;
    line-height: 1.5;
}

/* Footer Actions */
.action-footer {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    background: white;
    border-top: 1px solid #e5e7eb;
    padding: 1rem;
    box-shadow: 0 -4px 6px -1px rgba(0, 0, 0, 0.05);
    box-sizing: border-box;
    z-index: 20;
}

.button-group {
    display: flex;
    gap: 1rem;
    max-width: 600px;
    margin: 0 auto;
}

.button-group button,
.feedback-actions button {
    flex: 1;
    padding: 0.875rem;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    border: none;
    font-size: 1rem;
    transition: transform 0.1s;
}

.button-group button:active {
    transform: scale(0.98);
}

.btn-approve {
    background-color: #10b981;
    color: white;
}

.btn-revise {
    background-color: #ffffff;
    border: 1px solid #e5e7eb !important;
    color: #374151;
}

.btn-revise:hover {
    background-color: #f9fafb;
}

/* Feedback Mode */
.feedback-area {
    max-width: 600px;
    margin: 0 auto;
}

.feedback-area textarea {
    width: 100%;
    height: 100px;
    border: 1px solid #cbd5e1;
    border-radius: 8px;
    padding: 0.75rem;
    margin-bottom: 1rem;
    font-family: inherit;
    font-size: 1rem;
    resize: vertical;
    box-sizing: border-box;
}

.feedback-actions {
    display: flex;
    gap: 0.75rem;
}

.btn-cancel {
    background: transparent;
    color: #64748b;
    border: 1px solid transparent !important;
}

.btn-confirm-change {
    background-color: #2563eb;
    color: white;
}

/* ALERTS & BANNERS */
.success-banner {
    position: fixed;
    bottom: 2rem;
    left: 50%;
    transform: translateX(-50%);
    background-color: #10b981;
    color: white;
    padding: 1rem 2rem;
    border-radius: 999px;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-weight: 600;
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    animation: slideUp 0.3s ease-out;
    z-index: 30;
    width: max-content;
}

.info-banner {
    max-width: 600px;
    margin: 2rem auto;
    padding: 1.5rem;
    border-radius: 8px;
    display: flex;
    align-items: center;
    gap: 1rem;
    font-weight: 600;
}

.info-banner.success {
    background-color: #dcfce7;
    color: #166534;
    border: 1px solid #bbf7d0;
}

.info-banner.purple {
    background-color: #f3e8ff;
    color: #6b21a8;
    border: 1px solid #e9d5ff;
}

@keyframes slideUp {
    from {
        transform: translate(-50%, 100%);
        opacity: 0;
    }

    to {
        transform: translate(-50%, 0);
        opacity: 1;
    }
}

.loading-screen,
.error-screen {
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #64748b;
    gap: 0.5rem;
}

/* Mobile Adjustments */
@media (max-width: 640px) {
    .post-card {
        padding: 1.5rem;
        border-radius: 0;
        box-shadow: none;
    }

    .post-view {
        margin: 0;
        padding: 0;
    }
}

.client-badge-display {
    display: inline-block;
    background-color: #f1f5f9;
    color: #475569;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    margin-bottom: 0.5rem;
}
```

---

## Arquivo: src\pages\ClientPortal.jsx
```jsx

import React, { useEffect, useState } from 'react'
import { useSearchParams } from 'react-router-dom'
import { supabase } from '../services/supabaseClient'
import { CheckCircle, Edit3, Image as ImageIcon, Loader2 } from 'lucide-react'
import ReactMarkdown from 'react-markdown'
import './ClientPortal.css'

const ClientPortal = () => {
    const [searchParams] = useSearchParams()
    const id = searchParams.get('id')

    const [post, setPost] = useState(null)
    const [loading, setLoading] = useState(true)
    const [error, setError] = useState(null)

    const [feedbackMode, setFeedbackMode] = useState(false)
    const [feedbackText, setFeedbackText] = useState('')
    const [actionLoading, setActionLoading] = useState(false)
    const [successMessage, setSuccessMessage] = useState(null)

    useEffect(() => {
        const numericId = parseInt(id, 10);
        if (!id || isNaN(numericId)) {
            setError('ID do projeto inv√°lido ou n√£o fornecido.');
            setLoading(false);
            return;
        }
        fetchPost(numericId);
    }, [id]);

    const fetchPost = async (numericId) => {
        setLoading(true);
        try {
            const { data, error } = await supabase
                .from('tabela_projetofred1')
                .select('*')
                .eq('id', numericId)
                .single();

            if (error) {
                // PGRST116 means no rows returned (JSON) or row count 0
                if (error.code === 'PGRST116') {
                    throw new Error('Post n√£o encontrado ou acesso negado.');
                }
                throw error;
            }

            if (!data) {
                throw new Error('Post n√£o encontrado.');
            }

            setPost(data);
        } catch (err) {
            console.error(err);
            setError(err.message || 'Erro ao carregar o post.');
        } finally {
            setLoading(false);
        }
    }

    const handleApprove = async () => {
        setActionLoading(true)
        try {
            const { error } = await supabase
                .from('tabela_projetofred1')
                .update({ status: 'Aprovado' })
                .eq('id', id)

            if (error) throw error

            setPost(prev => ({ ...prev, status: 'Aprovado' }))
            setSuccessMessage('Conte√∫do aprovado! Em breve ser√° publicado.')
        } catch (err) {
            alert('Erro ao aprovar: ' + err.message)
        } finally {
            setActionLoading(false)
        }
    }

    const handleRequestChange = async () => {
        if (!feedbackText.trim()) return

        setActionLoading(true)
        try {
            const { error } = await supabase
                .from('tabela_projetofred1')
                .update({
                    status: 'Revis√£o',
                    feedback_cliente: feedbackText
                })
                .eq('id', id)

            if (error) throw error

            setPost(prev => ({ ...prev, status: 'Revis√£o', feedback_cliente: feedbackText }))
            setFeedbackMode(false)
            setSuccessMessage('Solicita√ß√£o enviada. Vamos ajustar para voc√™!')
        } catch (err) {
            alert('Erro ao enviar feedback: ' + err.message)
        } finally {
            setActionLoading(false)
        }
    }

    if (loading) return <div className="loading-screen"><Loader2 className="spinner" /> Carregando post...</div>
    if (error) return <div className="error-screen">{error}</div>
    if (!post) return null

    // Logic to determine if footer info should be shown or if actions are available
    const isApproved = post.status?.toLowerCase().includes('aprovado')
    const isPosted = post.status?.toLowerCase().includes('postado')
    const isActionable = !isApproved && !isPosted && !successMessage

    return (
        <div className="client-container">
            <header className="client-header">
                <div className="logo-area">Portal de Aprova√ß√£o</div>
                <div className={`status-badge status-${post.status?.toLowerCase().replace(/\s/g, '-')}`}>
                    {post.status || 'Aguardando'}
                </div>
            </header>

            <main className="post-view">
                <article className="post-card">
                    {post.nome_cliente && (
                        <div className="client-badge-display">
                            Cliente: {post.nome_cliente}
                        </div>
                    )}
                    <h1 className="post-title">{post.titulo_hook || 'Sem T√≠tulo'}</h1>

                    <div className="post-meta">
                        <span>#{post.tema}</span>
                    </div>

                    <div className="post-body">
                        <ReactMarkdown>{post.corpo_post || 'Conte√∫do vazio...'}</ReactMarkdown>
                    </div>

                    {post.sugestao_imagem && (
                        <div className="image-suggestion-box">
                            <div className="box-icon">
                                <ImageIcon size={24} />
                            </div>
                            <div className="box-content">
                                <strong>Sugest√£o de Imagem:</strong>
                                <p>{post.sugestao_imagem}</p>
                            </div>
                        </div>
                    )}
                </article>
            </main>

            {/* Success Banner (after action in this session) */}
            {successMessage && (
                <div className="success-banner">
                    <CheckCircle /> {successMessage}
                </div>
            )}

            {/* Permanent State Banners (if status loaded from DB) */}
            {!successMessage && isApproved && (
                <div className="info-banner success">
                    <CheckCircle size={20} /> Este post j√° foi aprovado.
                </div>
            )}

            {!successMessage && isPosted && (
                <div className="info-banner purple">
                    <CheckCircle size={20} /> Este conte√∫do j√° foi publicado no LinkedIn.
                </div>
            )}

            {/* Actions Footer */}
            {isActionable && (
                <footer className="action-footer">
                    {feedbackMode ? (
                        <div className="feedback-area">
                            <textarea
                                placeholder="Descreva o que precisa ser alterado..."
                                value={feedbackText}
                                onChange={(e) => setFeedbackText(e.target.value)}
                            />
                            <div className="feedback-actions">
                                <button className="btn-cancel" onClick={() => setFeedbackMode(false)}>Cancelar</button>
                                <button className="btn-confirm-change" onClick={handleRequestChange} disabled={actionLoading}>
                                    {actionLoading ? 'Enviando...' : 'Enviar Feedback'}
                                </button>
                            </div>
                        </div>
                    ) : (
                        <div className="button-group">
                            <button
                                className="btn-revise"
                                onClick={() => setFeedbackMode(true)}
                            >
                                <Edit3 size={18} /> Solicitar Altera√ß√£o
                            </button>
                            <button
                                className="btn-approve"
                                onClick={handleApprove}
                            >
                                <CheckCircle size={18} /> Aprovar Post
                            </button>
                        </div>
                    )}
                </footer>
            )}
        </div>
    )
}

export default ClientPortal

```

---

## Arquivo: src\pages\ClientsPage.jsx
```jsx
import React, { useEffect, useState } from 'react';
import { supabase } from '../services/supabaseClient';
import { useAuth } from '../contexts/AuthContext'; // Import Auth
import { Pencil, Upload, FileText, X, Check, Link as LinkIcon, Info, AlertTriangle, Linkedin } from 'lucide-react';

const N8N_UPLOAD_DOC_URL = 'https://n8n-n8n-start.kfocge.easypanel.host/webhook/upload-client-doc'

export default function ClientsPage() {
    const { user } = useAuth(); // Hook Auth
    const [clients, setClients] = useState([]);
    const [loading, setLoading] = useState(true);
    const [showModal, setShowModal] = useState(false);
    const [saving, setSaving] = useState(false);
    const [editingClient, setEditingClient] = useState(null);
    const [toast, setToast] = useState(null); // { message, type }

    // ... (rest of local state) ...
    // Note: I am NOT changing the lines between 14-27, just re-stating them if needed for context but 'replace_file_content' replaces the block.
    // To minimize context, I will target specific blocks if possible, but multiple edits are needed.
    // Better to use a single large block or multiple chunks?
    // I will use multiple chunks with multi_replace_file_content logic simulated via single call if continuous, or just use replace_file_content for the whole file? No, too large.
    // I will use replace_file_content for the imports and state first.
    // Wait, I can't do multiple disparate chunks with replace_file_content.
    // I should use `multi_replace_file_content` if available? 
    // Checking tools... `multi_replace_file_content` IS available. 
    // I will use `default_api:multi_replace_file_content`.
    // Wait, the user prompt showed `default_api:replace_file_content` and `default_api:multi_replace_file_content` descriptors.
    // Yes, I have `multi_replace_file_content`.

    // Proceeding with `multi_replace_file_content`.

    // Chunk 1: Imports
    // Chunk 2: Toast State
    // Chunk 3: handleCopyLink function
    // Chunk 4: Button in Table
    // Chunk 5: Toast UI render


    // ... (rest of local state) ...

    // File Upload State
    const [filesToUpload, setFilesToUpload] = useState([]);
    const [existingFiles, setExistingFiles] = useState([]);

    const [formData, setFormData] = useState({
        name: '',
        description: '',
        tone_of_voice: 'Profissional',
        target_audience_default: '',
        pain_points: '',
        unipile_account_id: ''
    });

    useEffect(() => {
        fetchClients();
    }, []);

    async function fetchClients() {
        try {
            setLoading(true);
            const { data, error } = await supabase.from('clients').select('*').order('created_at', { ascending: false });
            if (error) throw error;
            setClients(data || []);
        } catch (error) {
            console.error('Erro ao buscar clientes:', error);
        } finally {
            setLoading(false);
        }
    }

    async function fetchClientFiles(clientId) {
        try {
            const { data, error } = await supabase
                .from('client_knowledge')
                .select('*')
                .eq('client_id', clientId);

            if (error) throw error;
            setExistingFiles(data || []);
        } catch (error) {
            console.error('Erro ao buscar arquivos do cliente:', error);
        }
    }

    const handleInputChange = (e) => {
        const { name, value } = e.target;
        setFormData(prev => ({
            ...prev,
            [name]: value
        }));
    };

    const handleFileChange = (e) => {
        if (e.target.files && e.target.files.length > 0) {
            const newFiles = Array.from(e.target.files);
            setFilesToUpload(prev => [...prev, ...newFiles]);
        }
    };

    const removeFileToUpload = (index) => {
        setFilesToUpload(prev => prev.filter((_, i) => i !== index));
    };

    const handleEdit = (client) => {
        setEditingClient(client);
        setFormData({
            name: client.name || '',
            description: client.description || '',
            tone_of_voice: client.tone_of_voice || 'Profissional',
            target_audience_default: client.target_audience_default || '',
            pain_points: client.pain_points || '',
            unipile_account_id: client.unipile_account_id || ''
        });
        setFilesToUpload([]);
        setExistingFiles([]);
        fetchClientFiles(client.id);
        setShowModal(true);
    };

    const handleNew = () => {
        setEditingClient(null);
        setFormData({
            name: '',
            description: '',
            tone_of_voice: 'Profissional',
            target_audience_default: '',
            pain_points: '',
            unipile_account_id: ''
        });
        setFilesToUpload([]);
        setExistingFiles([]);
        setShowModal(true);
    };

    const handleDelete = async () => {
        if (!editingClient || !window.confirm('Tem certeza que deseja excluir este cliente? Esta a√ß√£o n√£o pode ser desfeita.')) return;

        setSaving(true);
        try {
            const { error } = await supabase
                .from('clients')
                .delete()
                .eq('id', editingClient.id);

            if (error) throw error;

            setShowModal(false);
            fetchClients();
            alert('Cliente exclu√≠do com sucesso!');
        } catch (error) {
            console.error('Erro ao excluir:', error);
            alert('Erro ao excluir: ' + error.message);
        } finally {
            setSaving(false);
        }
    };

    const handleCopyLink = (client) => {
        if (!client.access_token) {
            alert("Este cliente n√£o possui um token de acesso.");
            return;
        }
        const link = `${window.location.origin}/portal/${client.access_token}`;
        navigator.clipboard.writeText(link);

        setToast({ message: "Link de acesso copiado!", type: "success" });
        setTimeout(() => setToast(null), 3000);
    };

    const sanitizeFileName = (originalName) => {
        return originalName.replace(/[^a-zA-Z0-9.]/g, '_');
    };

    const uploadFiles = async (clientId) => {
        if (!filesToUpload || filesToUpload.length === 0) return;

        console.log(`[DEBUG] uploadFiles chamado com clientID: ${clientId} (Tipo: ${typeof clientId})`);

        for (const file of filesToUpload) {
            if (!file) continue;

            console.log(`[DEBUG] Preparando envio de ${file.name} para webhook`);

            // Create FormData with file and clientId
            const formData = new FormData();
            formData.append('file', file);
            formData.append('clientId', clientId);

            console.log(`[DEBUG] Enviando para webhook: ${N8N_UPLOAD_DOC_URL}`);

            try {
                const response = await fetch(N8N_UPLOAD_DOC_URL, {
                    method: 'POST',
                    body: formData
                    // Note: Do NOT set Content-Type header - browser will set it automatically with boundary
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`Webhook retornou erro ${response.status}: ${errorText}`);
                }

                const result = await response.json();
                console.log(`[DEBUG] Upload de ${file.name} conclu√≠do:`, result);

            } catch (error) {
                console.error(`[DEBUG] Erro ao enviar ${file.name} para webhook:`, error);
                throw new Error(`Falha no upload de "${file.name}": ${error.message}`);
            }
        }
    };

    const handleSubmit = async (e) => {
        e.preventDefault(); // 1. Prevent Default
        console.log("1. Iniciou handleSave");
        setSaving(true);

        try {
            console.log("2. User ID:", user?.id);

            // PAYLOAD CONSTRUCTION & LOGGING
            let payload = {};
            try {
                payload = {
                    name: formData.name,
                    description: formData.description,
                    tone_of_voice: formData.tone_of_voice,
                    target_audience_default: formData.target_audience_default,
                    pain_points: formData.pain_points,
                    unipile_account_id: formData.unipile_account_id
                    // Add other fields here if needed
                };
                console.log("3. Payload montado:", payload);
            } catch (payloadError) {
                throw new Error("Erro ao montar o payload: " + payloadError.message);
            }

            // --- EXECUTE SUPABASE CALLS AFTER PAYLOAD IS READY ---
            let clientData = null;
            let realClientId = null;

            if (editingClient) {
                console.log("[DEBUG] Atualizando cliente existente...", editingClient.id);
                const { data, error } = await supabase
                    .from('clients')
                    .update(payload) // Use the constructed payload
                    .eq('id', editingClient.id)
                    .select()
                    .single();

                if (error) throw error;
                clientData = data;
            } else {
                console.log("[DEBUG] Criando novo cliente...");
                const { data, error } = await supabase
                    .from('clients')
                    .insert([payload]) // Use the constructed payload
                    .select()
                    .single();

                if (error) throw error;
                clientData = data;
            }

            // SAFETY CHECKS
            if (!clientData) throw new Error("Erro cr√≠tico: Dados do cliente n√£o retornaram do banco.");
            realClientId = clientData.id;
            console.log("[DEBUG] ID Num√©rico capturado:", realClientId);
            if (!realClientId) throw new Error("Erro cr√≠tico: ID do cliente √© inv√°lido.");

            // UPLOAD
            if (filesToUpload.length > 0) {
                console.log(`[DEBUG] Iniciando uploads para ID: ${realClientId}`);
                await uploadFiles(realClientId);
            }

            // SUCCESS
            alert(editingClient ? 'Cliente atualizado com sucesso!' : 'Cliente cadastrado com sucesso!');
            setShowModal(false);
            fetchClients();

        } catch (error) {
            console.error("ERRO CR√çTICO NO SALVAMENTO:", error);
            alert("Erro: " + (error.message || "Erro desconhecido"));
        } finally {
            console.log("[DEBUG] Finalizando processo (finally).");
            setSaving(false);
        }
    };

    return (
        <div style={{ padding: '2rem' }}>
            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1.5rem' }}>
                <h1 style={{ fontSize: '1.5rem', fontWeight: 'bold', color: '#1f2937' }}>Gerenciar Clientes</h1>
                <button
                    onClick={handleNew}
                    style={{
                        backgroundColor: '#ea580c',
                        color: 'white',
                        padding: '0.5rem 1rem',
                        borderRadius: '0.25rem',
                        border: 'none',
                        cursor: 'pointer'
                    }}
                >
                    + Novo Cliente
                </button>
            </div>

            {loading ? (
                <p>Carregando...</p>
            ) : (
                <div style={{ background: 'white', boxShadow: '0 1px 3px 0 rgba(0, 0, 0, 0.1)', borderRadius: '0.5rem', overflow: 'hidden' }}>
                    <table style={{ width: '100%', textAlign: 'left', borderCollapse: 'collapse' }}>
                        <thead style={{ background: '#f9fafb', borderBottom: '1px solid #e5e7eb' }}>
                            <tr>
                                <th style={{ padding: '1rem', fontWeight: '600', color: '#4b5563' }}>Empresa</th>
                                <th style={{ padding: '1rem', fontWeight: '600', color: '#4b5563' }}>Descri√ß√£o</th>
                                <th style={{ padding: '1rem', fontWeight: '600', color: '#4b5563' }}>Tom de Voz</th>
                                <th style={{ padding: '1rem', fontWeight: '600', color: '#4b5563', width: '120px' }}>Conex√£o</th>
                                <th style={{ padding: '1rem', fontWeight: '600', color: '#4b5563', textAlign: 'right' }}>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody>
                            {clients.length === 0 ? (
                                <tr>
                                    <td colSpan="4" style={{ padding: '2rem', textAlign: 'center', color: '#6b7280' }}>
                                        Nenhum cliente cadastrado.
                                    </td>
                                </tr>
                            ) : (
                                clients.map((client) => (
                                    <tr key={client.id} style={{ borderBottom: '1px solid #e5e7eb' }}>
                                        <td style={{ padding: '1rem', fontWeight: '500' }}>{client.name}</td>
                                        <td style={{ padding: '1rem', color: '#6b7280', fontSize: '0.875rem', maxWidth: '20rem', whiteSpace: 'nowrap', overflow: 'hidden', textOverflow: 'ellipsis' }}>
                                            {client.description}
                                        </td>
                                        <td style={{ padding: '1rem', fontSize: '0.875rem' }}>{client.tone_of_voice}</td>
                                        <td style={{ padding: '1rem' }}>
                                            {client.unipile_account_id ? (
                                                <div style={{ display: 'flex', alignItems: 'center', gap: '4px', color: '#0077b5', fontSize: '0.8rem', fontWeight: '600' }}>
                                                    <Linkedin size={16} /> OK
                                                </div>
                                            ) : (
                                                <div style={{ display: 'flex', alignItems: 'center', gap: '4px', color: '#9ca3af', fontSize: '0.8rem' }} title="Pendente Unipile ID">
                                                    <AlertTriangle size={16} /> Pendente
                                                </div>
                                            )}
                                        </td>
                                        <td style={{ padding: '1rem', textAlign: 'right' }}>
                                            <button
                                                onClick={() => handleCopyLink(client)}
                                                style={{
                                                    background: 'transparent',
                                                    border: 'none',
                                                    cursor: 'pointer',
                                                    color: '#16a34a', // Green
                                                    padding: '0.25rem',
                                                    marginRight: '0.5rem'
                                                }}
                                                title="Copiar Link de Acesso"
                                            >
                                                <LinkIcon size={18} />
                                            </button>
                                            <button
                                                onClick={() => handleEdit(client)}
                                                style={{
                                                    background: 'transparent',
                                                    border: 'none',
                                                    cursor: 'pointer',
                                                    color: '#2563eb',
                                                    padding: '0.25rem'
                                                }}
                                                title="Editar / Ver Detalhes"
                                            >
                                                <Pencil size={18} />
                                            </button>
                                        </td>
                                    </tr>
                                ))
                            )}
                        </tbody>
                    </table>
                </div>
            )}

            {/* TOAST */}
            {toast && (
                <div style={{
                    position: 'fixed',
                    bottom: '2rem',
                    right: '2rem',
                    background: toast.type === 'error' ? '#ef4444' : '#22c55e',
                    color: 'white',
                    padding: '1rem 1.5rem',
                    borderRadius: '8px',
                    boxShadow: '0 4px 6px rgba(0,0,0,0.1)',
                    display: 'flex',
                    alignItems: 'center',
                    gap: '8px',
                    zIndex: 100,
                    animation: 'slideIn 0.3s ease-out'
                }}>
                    <Check size={18} />
                    <span style={{ fontWeight: 600 }}>{toast.message}</span>
                </div>
            )}

            {/* MODAL */}
            {showModal && (
                <div style={{
                    position: 'fixed', top: 0, left: 0, right: 0, bottom: 0,
                    background: 'rgba(0,0,0,0.5)', display: 'flex', justifyContent: 'center', alignItems: 'center', zIndex: 50
                }}>
                    <div style={{ background: 'white', padding: '2rem', borderRadius: '0.5rem', width: '100%', maxWidth: '500px', maxHeight: '90vh', overflowY: 'auto' }}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1rem' }}>
                            <h2 style={{ margin: 0 }}>
                                {editingClient ? 'Editar Cliente' : 'Novo Cliente'}
                            </h2>
                            <button
                                type="button"
                                onClick={() => setShowModal(false)}
                                style={{
                                    background: 'transparent',
                                    border: 'none',
                                    cursor: 'pointer',
                                    color: '#6b7280',
                                    padding: '4px',
                                    borderRadius: '50%',
                                    display: 'flex',
                                    alignItems: 'center',
                                    justifyContent: 'center',
                                    transition: 'background 0.2s'
                                }}
                                onMouseEnter={(e) => e.currentTarget.style.background = '#f3f4f6'}
                                onMouseLeave={(e) => e.currentTarget.style.background = 'transparent'}
                            >
                                <X size={24} />
                            </button>
                        </div>
                        <form onSubmit={handleSubmit} style={{ display: 'flex', flexDirection: 'column', gap: '1rem' }}>

                            {/* Unipile ID Section - Priority */}
                            <div style={{ background: '#eff6ff', border: '1px solid #bfdbfe', borderRadius: '6px', padding: '1rem' }}>
                                <div style={{ display: 'flex', gap: '0.75rem', marginBottom: '0.75rem' }}>
                                    <Info style={{ color: '#2563eb', flexShrink: 0, marginTop: '2px' }} size={20} />
                                    <div>
                                        <h4 style={{ margin: '0 0 0.25rem 0', fontSize: '0.9rem', color: '#1e40af' }}>Integra√ß√£o LinkedIn (Obrigat√≥rio)</h4>
                                        <p style={{ margin: 0, fontSize: '0.8rem', color: '#1e3a8a', lineHeight: '1.4' }}>
                                            ‚ö†Ô∏è Importante: Para obter este ID, voc√™ deve primeiro conectar o perfil do LinkedIn deste cliente manualmente atrav√©s do Dashboard da Unipile. Copie o <strong>'Account ID'</strong> gerado l√° e cole abaixo.
                                        </p>
                                    </div>
                                </div>
                                <div>
                                    <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.85rem', fontWeight: 'bold', color: '#1e3a8a' }}>
                                        ID da Conta Unipile (LinkedIn)
                                    </label>
                                    <input
                                        name="unipile_account_id"
                                        value={formData.unipile_account_id}
                                        onChange={handleInputChange}
                                        placeholder="Ex: f7NRx9..."
                                        style={{ width: '100%', padding: '0.5rem', border: '1px solid #93c5fd', borderRadius: '4px', fontFamily: 'monospace', color: '#1f2937' }}
                                    />
                                </div>
                            </div>

                            <div>
                                <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.875rem' }}>Nome da Empresa</label>
                                <input
                                    required
                                    name="name"
                                    value={formData.name}
                                    onChange={handleInputChange}
                                    style={{ width: '100%', padding: '0.5rem', border: '1px solid #d1d5db', borderRadius: '0.25rem', color: '#1f2937' }}
                                />
                            </div>

                            <div>
                                <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.875rem' }}>Descri√ß√£o do Neg√≥cio</label>
                                <textarea
                                    required
                                    name="description"
                                    value={formData.description}
                                    onChange={handleInputChange}
                                    style={{ width: '100%', padding: '0.5rem', border: '1px solid #d1d5db', borderRadius: '0.25rem', color: '#1f2937' }}
                                    rows="3"
                                />
                            </div>

                            <div>
                                <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.875rem' }}>Tom de Voz</label>
                                <select
                                    name="tone_of_voice"
                                    value={formData.tone_of_voice}
                                    onChange={handleInputChange}
                                    style={{ width: '100%', padding: '0.5rem', border: '1px solid #d1d5db', borderRadius: '0.25rem', color: '#1f2937' }}
                                >
                                    <option>Profissional</option>
                                    <option>Descontra√≠do</option>
                                    <option>Autorit√°rio</option>
                                    <option>Educativo</option>
                                </select>
                            </div>

                            <div>
                                <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.875rem' }}>P√∫blico Alvo (Padr√£o)</label>
                                <input
                                    name="target_audience_default"
                                    value={formData.target_audience_default}
                                    onChange={handleInputChange}
                                    style={{ width: '100%', padding: '0.5rem', border: '1px solid #d1d5db', borderRadius: '0.25rem', color: '#1f2937' }}
                                />
                            </div>

                            <div>
                                <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.875rem' }}>Dores e Problemas</label>
                                <textarea
                                    name="pain_points"
                                    value={formData.pain_points}
                                    onChange={handleInputChange}
                                    style={{ width: '100%', padding: '0.5rem', border: '1px solid #d1d5db', borderRadius: '0.25rem', color: '#1f2937' }}
                                    rows="3"
                                />
                            </div>

                            {/* DOCUMENT UPLOAD SECTION */}
                            <div style={{ borderTop: '1px solid #e5e7eb', paddingTop: '1rem', marginTop: '0.5rem' }}>
                                <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.875rem', fontWeight: '600' }}>
                                    Arquivos de Contexto (PDF, DOC)
                                </label>

                                <div style={{
                                    border: '1px dashed #d1d5db',
                                    borderRadius: '0.25rem',
                                    padding: '1rem',
                                    textAlign: 'center',
                                    marginBottom: '1rem',
                                    cursor: 'pointer',
                                    position: 'relative'
                                }}>
                                    <input
                                        type="file"
                                        multiple
                                        onChange={handleFileChange}
                                        style={{
                                            position: 'absolute',
                                            top: 0,
                                            left: 0,
                                            width: '100%',
                                            height: '100%',
                                            opacity: 0,
                                            cursor: 'pointer'
                                        }}
                                    />
                                    <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', gap: '0.5rem', color: '#6b7280' }}>
                                        <Upload size={24} />
                                        <span style={{ fontSize: '0.875rem' }}>Clique ou arraste arquivos aqui</span>
                                    </div>
                                </div>

                                {/* LISTA DE ARQUIVOS PENDENTES */}
                                {filesToUpload.length > 0 && (
                                    <div style={{ marginBottom: '1rem' }}>
                                        <p style={{ fontSize: '0.75rem', fontWeight: 'bold', color: '#4b5563', marginBottom: '0.25rem' }}>Prontos para enviar:</p>
                                        <ul style={{ listStyle: 'none', padding: 0, margin: 0 }}>
                                            {filesToUpload.map((file, idx) => (
                                                <li key={idx} style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', fontSize: '0.875rem', background: '#f9fafb', padding: '0.25rem 0.5rem', marginBottom: '0.25rem', borderRadius: '0.25rem' }}>
                                                    <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem', overflow: 'hidden' }}>
                                                        <FileText size={14} color="#4b5563" />
                                                        <span style={{ whiteSpace: 'nowrap', overflow: 'hidden', textOverflow: 'ellipsis' }}>{file.name}</span>
                                                    </div>
                                                    <button
                                                        type="button"
                                                        onClick={() => removeFileToUpload(idx)}
                                                        style={{ background: 'none', border: 'none', cursor: 'pointer', color: '#ef4444', padding: 0 }}
                                                    >
                                                        <X size={14} />
                                                    </button>
                                                </li>
                                            ))}
                                        </ul>
                                    </div>
                                )}

                                {/* LISTA DE ARQUIVOS J√Å EXISTENTES */}
                                {existingFiles.length > 0 && (
                                    <div>
                                        <p style={{ fontSize: '0.75rem', fontWeight: 'bold', color: '#4b5563', marginBottom: '0.25rem' }}>Arquivos Anteriores:</p>
                                        <ul style={{ listStyle: 'none', padding: 0, margin: 0 }}>
                                            {existingFiles.map((file) => (
                                                <li key={file.id} style={{ display: 'flex', alignItems: 'center', gap: '0.5rem', fontSize: '0.875rem', color: '#059669', marginBottom: '0.25rem' }}>
                                                    <Check size={14} />
                                                    <span style={{ whiteSpace: 'nowrap', overflow: 'hidden', textOverflow: 'ellipsis' }}>{file.file_name}</span>
                                                    <span style={{ fontSize: '0.75rem', color: '#6b7280' }}>- Enviado</span>
                                                </li>
                                            ))}
                                        </ul>
                                    </div>
                                )}
                            </div>

                            <div style={{ display: 'flex', gap: '0.5rem', marginTop: '1rem' }}>
                                <button
                                    type="button"
                                    onClick={() => setShowModal(false)}
                                    style={{ flex: 1, padding: '0.5rem', background: '#f3f4f6', border: 'none', borderRadius: '0.25rem', cursor: 'pointer' }}
                                >
                                    Cancelar
                                </button>
                                <button
                                    type="submit"
                                    disabled={saving}
                                    style={{ flex: 1, padding: '0.5rem', background: '#ea580c', color: 'white', border: 'none', borderRadius: '0.25rem', cursor: 'pointer' }}
                                >
                                    {saving ? 'Salvando...' : (editingClient ? 'Salvar Altera√ß√µes' : 'Salvar Cliente')}
                                </button>
                            </div>

                            {editingClient && (
                                <button
                                    type="button"
                                    onClick={handleDelete}
                                    disabled={saving}
                                    style={{ width: '100%', marginTop: '0.5rem', padding: '0.5rem', background: '#fee2e2', color: '#ef4444', border: 'none', borderRadius: '0.25rem', cursor: 'pointer', fontWeight: '500' }}
                                >
                                    Excluir Cliente
                                </button>
                            )}
                        </form>
                    </div>
                </div>
            )}
        </div>
    );
}

```

---

## Arquivo: src\pages\IdeasPage.css
```css
.ideas-page-container {
    padding: 2rem;
    height: 100%;
}

.ideas-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
}

.ideas-header h1 {
    font-size: 1.5rem;
    font-weight: 700;
    color: #1e293b;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.client-selector-container {
    margin-bottom: 2rem;
    max-width: 400px;
}

.ideas-columns {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 2rem;
    height: calc(100vh - 250px);
}

.ideas-column {
    background: #f8fafc;
    border-radius: 12px;
    padding: 1.5rem;
    display: flex;
    flex-direction: column;
    overflow-y: auto;
}

.column-header {
    font-size: 1rem;
    font-weight: 600;
    color: #475569;
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid #e2e8f0;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.column-header .badge-count {
    background: #e2e8f0;
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 0.75rem;
    color: #475569;
}

.question-card {
    background: white;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    padding: 1rem;
    margin-bottom: 1rem;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
    transition: all 0.2s ease;
}

.question-card:hover {
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
}

.question-text {
    font-size: 1rem;
    color: #0f172a;
    margin-bottom: 0.5rem;
    font-weight: 500;
    line-height: 1.5;
}

.answer-text {
    background: #f0fdf4;
    padding: 0.75rem;
    border-radius: 6px;
    color: #166534;
    font-size: 0.9rem;
    margin-top: 0.5rem;
    border-left: 3px solid #22c55e;
}

.card-actions {
    display: flex;
    justify-content: flex-end;
    gap: 0.5rem;
    margin-top: 1rem;
    padding-top: 0.75rem;
    border-top: 1px solid #f1f5f9;
}

.btn-card-action {
    background: transparent;
    border: none;
    font-size: 0.8rem;
    color: #64748b;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 4px;
    padding: 4px 8px;
    border-radius: 4px;
}

.btn-card-action:hover {
    background: #f1f5f9;
    color: #334155;
}

.btn-card-action.danger:hover {
    background: #fef2f2;
    color: #ef4444;
}

.btn-card-action.primary {
    color: #2563eb;
    font-weight: 500;
}

.btn-card-action.primary:hover {
    background: #eff6ff;
}

/* Modal styles simplified for inline usage */
.mini-modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
}

.mini-modal {
    background: white;
    padding: 2rem;
    border-radius: 12px;
    width: 90%;
    max-width: 500px;
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
}

.mini-modal h3 {
    margin-top: 0;
    margin-bottom: 1.5rem;
    color: #0f172a;
}

.mini-modal textarea {
    width: 100%;
    padding: 0.75rem;
    border: 1px solid #cbd5e1;
    border-radius: 8px;
    min-height: 100px;
    margin-bottom: 1.5rem;
    font-family: inherit;
}

.mini-modal-actions {
    display: flex;
    justify-content: flex-end;
    gap: 1rem;
}
```

---

## Arquivo: src\pages\IdeasPage.jsx
```jsx

import React, { useState, useEffect } from 'react'
import { supabase } from '../services/supabaseClient'
import { useLanguage } from '../contexts/LanguageContext'
import {
    Lightbulb,
    Plus,
    Trash2,
    MessageSquare,
    Loader2,
    Building2,
    Sparkles // Added
} from 'lucide-react'
import './IdeasPage.css'

const IdeasPage = () => {
    const { t } = useLanguage()

    // Data
    const [clients, setClients] = useState([])
    const [questions, setQuestions] = useState([])

    // Selection
    const [selectedClientId, setSelectedClientId] = useState('')

    // Loading
    const [loadingClients, setLoadingClients] = useState(true)
    const [loadingQuestions, setLoadingQuestions] = useState(false)
    const [suggesting, setSuggesting] = useState(false) // New State for AI
    const [generatingIds, setGeneratingIds] = useState([]) // State for per-insight generation loading

    // Modals
    const [isCreateModalOpen, setIsCreateModalOpen] = useState(false)
    const [isAnswerModalOpen, setIsAnswerModalOpen] = useState(false)

    // Inputs
    const [newQuestionText, setNewQuestionText] = useState('')
    const [answerText, setAnswerText] = useState('')
    const [currentQuestionId, setCurrentQuestionId] = useState(null)

    // 1. Fetch Clients on Mount
    useEffect(() => {
        const fetchClients = async () => {
            try {
                const { data, error } = await supabase
                    .from('clients')
                    .select('id, name') // Need ID for relation
                    .order('name')

                if (error) throw error
                setClients(data || [])

                // Auto-select first client if available
                if (data && data.length > 0) {
                    setSelectedClientId(data[0].id)
                }
            } catch (err) {
                console.error('Error fetching clients:', err)
            } finally {
                setLoadingClients(false)
            }
        }
        fetchClients()
    }, [])

    // 2. Fetch Questions when Client Changes
    useEffect(() => {
        if (!selectedClientId) return

        const fetchQuestions = async () => {
            setLoadingQuestions(true)
            try {
                const { data, error } = await supabase
                    .from('interview_questions')
                    .select('*')
                    .eq('client_id', selectedClientId)
                    .order('created_at', { ascending: false })

                if (error) throw error
                setQuestions(data || [])
            } catch (err) {
                console.error('Error fetching questions:', err)
            } finally {
                setLoadingQuestions(false)
            }
        }
        fetchQuestions()
    }, [selectedClientId])

    // ACTIONS

    const handleCreateQuestion = async () => {
        // 1. VALIDA√á√ÉO
        if (!selectedClientId) {
            alert('Erro: Nenhum cliente selecionado.')
            return
        }
        if (!newQuestionText.trim()) {
            alert('Por favor, digite o texto da pergunta.')
            return
        }

        try {
            // 2. GRAVA√á√ÉO NO SUPABASE
            const { error } = await supabase
                .from('interview_questions')
                .insert([
                    {
                        client_id: selectedClientId,
                        question_text: newQuestionText,
                        status: 'pending'
                    }
                ])

            if (error) throw error

            // 3. ATUALIZA√á√ÉO DA LISTA (Recarregar Perguntas)
            const { data: refreshedData, error: refreshError } = await supabase
                .from('interview_questions')
                .select('*')
                .eq('client_id', selectedClientId)
                .order('created_at', { ascending: false })

            if (refreshError) throw refreshError

            // Atualiza estado
            setQuestions(refreshedData || [])

            // Limpa e Fecha
            setNewQuestionText('')
            setIsCreateModalOpen(false)

        } catch (err) {
            console.error('Erro ao salvar pergunta:', err)
            alert('Erro ao criar pergunta: ' + err.message)
        }
    }

    const handleSuggestAI = async () => {
        if (!selectedClientId) return
        setSuggesting(true)
        try {
            const response = await fetch('https://n8n-n8n-start.kfocge.easypanel.host/webhook/gerar-pergunta', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ clientId: selectedClientId })
            })

            if (!response.ok) throw new Error('Falha na conex√£o com IA')

            const data = await response.json()
            if (data && data.question) {
                setNewQuestionText(data.question)
            } else {
                throw new Error('Formato de resposta inv√°lido (esperado: { question: "..." })')
            }

        } catch (err) {
            console.error(err)
            alert('Erro ao gerar sugest√£o: ' + err.message)
        } finally {
            setSuggesting(false)
        }
    }

    const handleGenerateFromInsight = async (question) => {
        if (generatingIds.includes(question.id)) return

        // Finds the selected client to send the name
        const selectedClientObj = clients.find(c => c.id === selectedClientId)
        const clientName = selectedClientObj ? selectedClientObj.name : 'Unknown'

        setGeneratingIds(prev => [...prev, question.id])
        try {
            const response = await fetch('https://n8n-n8n-start.kfocge.easypanel.host/webhook/criar-post-respostas', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    client_id: selectedClientId,
                    nome_cliente: clientName, // Fix: Sending client name
                    pergunta_original: question.question_text,
                    resposta_expert: question.answer_text
                })
            })

            if (!response.ok) throw new Error('Falha ao enviar solicita√ß√£o para IA')

            alert('Solicita√ß√£o enviada! O post aparecer√° em breve.')

        } catch (err) {
            console.error(err)
            alert('Erro ao criar post: ' + err.message)
        } finally {
            setGeneratingIds(prev => prev.filter(id => id !== question.id))
        }
    }

    const handleDelete = async (id) => {
        if (!window.confirm(t('delete') + '?')) return
        try {
            const { error } = await supabase.from('interview_questions').delete().eq('id', id)
            if (error) throw error
            setQuestions(prev => prev.filter(q => q.id !== id))
        } catch (err) {
            console.error(err)
        }
    }

    const openAnswerModal = (q) => {
        setCurrentQuestionId(q.id)
        setAnswerText(q.answer_text || '')
        setIsAnswerModalOpen(true)
    }

    const handleSaveAnswer = async () => {
        if (!currentQuestionId) return
        try {
            const { error } = await supabase
                .from('interview_questions')
                .update({
                    answer_text: answerText,
                    status: 'answered'
                })
                .eq('id', currentQuestionId)

            if (error) throw error

            // Update local state
            setQuestions(prev => prev.map(q => {
                if (q.id === currentQuestionId) {
                    return { ...q, answer_text: answerText, status: 'answered' }
                }
                return q
            }))

            setIsAnswerModalOpen(false)
        } catch (err) {
            alert('Erro ao salvar resposta: ' + err.message)
        }
    }

    // LISTS
    const pendingList = questions.filter(q => q.status === 'pending')
    const answeredList = questions.filter(q => q.status === 'answered')

    return (
        <div className="ideas-page-container">
            <header className="ideas-header">
                <h1><Lightbulb size={28} color="#eab308" /> {t('ideas')}</h1>
                <button className="btn-primary" onClick={() => setIsCreateModalOpen(true)} disabled={!selectedClientId}>
                    <Plus size={18} /> {t('newQuestion')}
                </button>
            </header>

            <div className="client-selector-container">
                <div className="input-wrapper" style={{ background: 'white', padding: '0.5rem', borderRadius: '8px', border: '1px solid #cbd5e1' }}>
                    <Building2 className="input-icon" size={18} color="#64748b" />
                    <select
                        value={selectedClientId}
                        onChange={(e) => setSelectedClientId(e.target.value)}
                        className="modern-input"
                        style={{ border: 'none', outline: 'none', width: '100%' }}
                    >
                        {loadingClients ? <option>{t('loading')}</option> : null}
                        {!loadingClients && clients.map(c => (
                            <option key={c.id} value={c.id}>{c.name}</option>
                        ))}
                    </select>
                </div>
            </div>

            {loadingQuestions ? (
                <div style={{ display: 'flex', gap: '1rem', alignItems: 'center', color: '#64748b' }}>
                    <Loader2 className="spinner" /> {t('loading')}
                </div>
            ) : (
                <div className="ideas-columns">
                    {/* LEFT: PENDING */}
                    <div className="ideas-column">
                        <div className="column-header">
                            {t('pendingQuestions')}
                            <span className="badge-count">{pendingList.length}</span>
                        </div>
                        {pendingList.length === 0 && <p style={{ color: '#94a3b8', fontStyle: 'italic', marginTop: '1rem' }}>Nenhuma pendente.</p>}
                        {pendingList.map(q => (
                            <div key={q.id} className="question-card">
                                <div className="question-text">{q.question_text}</div>
                                <div className="card-actions">
                                    <button className="btn-card-action danger" onClick={() => handleDelete(q.id)}>
                                        <Trash2 size={14} /> {t('delete')}
                                    </button>
                                    <button className="btn-card-action primary" onClick={() => openAnswerModal(q)}>
                                        <MessageSquare size={14} /> {t('answer')}
                                    </button>
                                </div>
                            </div>
                        ))}
                    </div>

                    {/* RIGHT: ANSWERED */}
                    <div className="ideas-column">
                        <div className="column-header">
                            {t('answeredQuestions')}
                            <span className="badge-count">{answeredList.length}</span>
                        </div>
                        {answeredList.length === 0 && <p style={{ color: '#94a3b8', fontStyle: 'italic', marginTop: '1rem' }}>Nenhuma respondida.</p>}
                        {answeredList.map(q => (
                            <div key={q.id} className="question-card">
                                <div className="question-text">{q.question_text}</div>
                                <div className="answer-text">
                                    <strong>Insight:</strong> {q.answer_text}
                                </div>
                                <div className="card-actions">
                                    <button
                                        className="btn-card-action"
                                        style={{ color: '#7c3aed', background: '#f5f3ff', border: '1px solid #ddd6fe', fontWeight: 600 }}
                                        onClick={() => handleGenerateFromInsight(q)}
                                        disabled={generatingIds.includes(q.id)}
                                        title="Gerar Post com IA"
                                    >
                                        {generatingIds.includes(q.id) ? (
                                            <>
                                                <Loader2 size={14} className="spinner" /> Gerando...
                                            </>
                                        ) : (
                                            <>
                                                <Sparkles size={14} /> Gerar Post
                                            </>
                                        )}
                                    </button>
                                    <button className="btn-card-action danger" onClick={() => handleDelete(q.id)}>
                                        <Trash2 size={14} /> {t('delete')}
                                    </button>
                                    <button className="btn-card-action" onClick={() => openAnswerModal(q)}>
                                        Edit
                                    </button>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            )}

            {/* CREATE MODAL */}
            {isCreateModalOpen && (
                <div className="mini-modal-overlay">
                    <div className="mini-modal">
                        <h3>{t('newQuestion')}</h3>

                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '0.5rem' }}>
                            <span style={{ fontSize: '0.9rem', fontWeight: 600, color: '#334155' }}>Texto da Pergunta</span>
                            <button
                                onClick={handleSuggestAI}
                                disabled={suggesting}
                                className="btn-text-primary"
                                style={{
                                    fontSize: '0.85rem',
                                    display: 'flex',
                                    alignItems: 'center',
                                    gap: '6px',
                                    color: '#7c3aed',
                                    background: '#f5f3ff',
                                    border: '1px solid #ddd6fe',
                                    borderRadius: '6px',
                                    padding: '4px 8px',
                                    cursor: suggesting ? 'wait' : 'pointer',
                                    fontWeight: 500
                                }}
                            >
                                {suggesting ? <Loader2 size={14} className="spinner" /> : <Sparkles size={14} />}
                                {suggesting ? 'Criando...' : 'Sugerir com IA'}
                            </button>
                        </div>

                        <textarea
                            value={newQuestionText}
                            onChange={e => setNewQuestionText(e.target.value)}
                            placeholder={t('questionPlaceholder')}
                            autoFocus
                            disabled={suggesting}
                        />
                        <div className="mini-modal-actions">
                            <button className="btn-secondary" onClick={() => setIsCreateModalOpen(false)} disabled={suggesting}>{t('cancel')}</button>
                            <button className="btn-primary" onClick={handleCreateQuestion} disabled={suggesting}>{t('save')}</button>
                        </div>
                    </div>
                </div>
            )}

            {/* ANSWER MODAL */}
            {isAnswerModalOpen && (
                <div className="mini-modal-overlay">
                    <div className="mini-modal">
                        <h3>{t('answer')} / Insight</h3>
                        <textarea
                            value={answerText}
                            onChange={e => setAnswerText(e.target.value)}
                            placeholder={t('answerPlaceholder')}
                            autoFocus
                        />
                        <div className="mini-modal-actions">
                            <button className="btn-secondary" onClick={() => setIsAnswerModalOpen(false)}>{t('cancel')}</button>
                            <button className="btn-primary" onClick={handleSaveAnswer}>{t('save')}</button>
                        </div>
                    </div>
                </div>
            )}
        </div>
    )
}

export default IdeasPage

```

---

## Arquivo: src\pages\LeadsPage.css
```css
/* LeadsPage.css */

.leads-container {
    padding: 2rem;
    height: calc(100vh - 64px);
    /* Full height minus header/padding estimates */
    display: flex;
    flex-direction: column;
    overflow: hidden;
    background-color: #f8fafc;
}

.leads-header {
    margin-bottom: 2rem;
}

.leads-header h1 {
    font-size: 1.875rem;
    font-weight: 700;
    color: #1e293b;
    margin-bottom: 0.5rem;
}

.leads-header p {
    color: #64748b;
}

.kanban-board {
    display: flex;
    gap: 1.5rem;
    overflow-x: auto;
    padding-bottom: 1rem;
    height: 100%;
    align-items: flex-start;
}

.kanban-column {
    background: #f1f5f9;
    border-radius: 12px;
    min-width: 300px;
    max-width: 300px;
    display: flex;
    flex-direction: column;
    max-height: 100%;
}

.column-header {
    padding: 1rem;
    border-bottom: 1px solid #e2e8f0;
    display: flex;
    justify-content: space-between;
    align-items: center;
    position: sticky;
    top: 0;
    background: inherit;
    border-radius: 12px 12px 0 0;
    z-index: 10;
}

.column-header h3 {
    font-size: 0.95rem;
    font-weight: 600;
    color: #475569;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.count-badge {
    background: #cbd5e1;
    color: #475569;
    font-size: 0.75rem;
    padding: 0.1rem 0.5rem;
    border-radius: 999px;
    font-weight: 700;
}

.column-content {
    padding: 1rem;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 1rem;
    flex: 1;
}

/* Kanban Card */
.lead-card {
    background: white;
    padding: 1rem;
    border-radius: 8px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    cursor: pointer;
    transition: all 0.2s ease;
    border: 1px solid transparent;
}

.lead-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    border-color: #cbd5e1;
}

.lead-name {
    font-weight: 600;
    color: #1e293b;
    margin-bottom: 0.25rem;
}

.lead-role {
    font-size: 0.85rem;
    color: #64748b;
    margin-bottom: 0.75rem;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.lead-meta {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 0.75rem;
    color: #94a3b8;
    border-top: 1px solid #f1f5f9;
    padding-top: 0.75rem;
}

.company-name {
    display: flex;
    align-items: center;
    gap: 0.25rem;
}

/* Modal/Drawer Styles */
.lead-modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    display: flex;
    justify-content: flex-end;
    /* Align right for Drawer feel */
    z-index: 1000;
    backdrop-filter: blur(2px);
    animation: fadeIn 0.2s ease-out;
}

.lead-modal-content {
    background: white;
    width: 500px;
    max-width: 90vw;
    height: 100%;
    padding: 2rem;
    box-shadow: -4px 0 15px rgba(0, 0, 0, 0.1);
    overflow-y: auto;
    animation: slideIn 0.3s ease-out;
    display: flex;
    flex-direction: column;
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 2rem;
    border-bottom: 1px solid #e2e8f0;
    padding-bottom: 1.5rem;
}

.profile-info h2 {
    font-size: 1.5rem;
    font-weight: 700;
    color: #1e293b;
    margin-bottom: 0.25rem;
}

.profile-actions {
    display: flex;
    gap: 0.5rem;
}

.close-btn {
    background: none;
    border: none;
    cursor: pointer;
    color: #94a3b8;
    padding: 0.5rem;
    border-radius: 6px;
    transition: all 0.2s;
}

.close-btn:hover {
    background: #f1f5f9;
    color: #ef4444;
}

.section-title {
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: #64748b;
    font-weight: 700;
    margin-bottom: 0.75rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.ai-box {
    background: #f8fafc;
    /* Lighter background */
    border: 1px solid #e2e8f0;
    border-left: 4px solid #8b5cf6;
    /* Purple accent for AI */
    padding: 1rem;
    border-radius: 8px;
    margin-bottom: 1.5rem;
}

.ai-content {
    font-size: 0.95rem;
    color: #334155;
    line-height: 1.6;
    white-space: pre-wrap;
}

.action-bar {
    margin-top: auto;
    padding-top: 2rem;
    border-top: 1px solid #e2e8f0;
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
}

.status-btn {
    flex: 1;
    padding: 0.75rem;
    border: 1px solid #e2e8f0;
    background: white;
    border-radius: 8px;
    font-weight: 600;
    color: #475569;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
}

.status-btn:hover {
    background: #f8fafc;
    border-color: #cbd5e1;
}

.status-btn.active {
    background: #eff6ff;
    border-color: #3b82f6;
    color: #2563eb;
}

.linkedin-btn {
    background: #0077b5;
    color: white;
    border: none;
    padding: 0.5rem 1rem;
    border-radius: 6px;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    text-decoration: none;
    font-size: 0.9rem;
    transition: opacity 0.2s;
}

.linkedin-btn:hover {
    opacity: 0.9;
}

.copy-btn {
    background: white;
    border: 1px solid #e2e8f0;
    padding: 0.25rem 0.75rem;
    border-radius: 6px;
    font-size: 0.8rem;
    cursor: pointer;
    margin-top: 0.5rem;
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    color: #64748b;
    transition: all 0.2s;
}

.copy-btn:hover {
    border-color: #94a3b8;
    color: #475569;
}

@keyframes slideIn {
    from {
        transform: translateX(100%);
        opacity: 0;
    }

    to {
        transform: translateX(0);
        opacity: 1;
    }
}

@keyframes fadeIn {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Colors for specific statuses if needed */
.status-pill {
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.7rem;
    font-weight: 700;
    text-transform: uppercase;
}
```

---

## Arquivo: src\pages\LeadsPage.jsx
```jsx
import React, { useState, useEffect } from 'react'
import { supabase } from '../services/supabaseClient'
import { useLanguage } from '../contexts/LanguageContext'
import { useClientSelection } from '../contexts/ClientSelectionContext'
import './LeadsPage.css'
import {
    Briefcase,
    Linkedin,
    MessageSquare,
    Calendar,
    XOctagon,
    MoreHorizontal,
    ExternalLink,
    BrainCircuit,
    Copy,
    Check,
    Search,
    Loader2
} from 'lucide-react'

// Status Configuration
const STATUS_COLUMNS = [
    { id: 'new', label: 'Novos', icon: <Briefcase size={16} />, color: '#3b82f6' },
    { id: 'contacted', label: 'Contatados', icon: <MessageSquare size={16} />, color: '#eab308' },
    { id: 'in_conversation', label: 'Em Conversa', icon: <MessageSquare size={16} strokeWidth={3} />, color: '#f97316' },
    { id: 'meeting_scheduled', label: 'Reuni√£o', icon: <Calendar size={16} />, color: '#22c55e' },
    { id: 'disqualified', label: 'Desqualificado', icon: <XOctagon size={16} />, color: '#ef4444' }
]

const LeadsPage = () => {
    const { t } = useLanguage()
    const { selectedClientId } = useClientSelection()
    // State
    const [leads, setLeads] = useState([])
    const [loading, setLoading] = useState(false)
    const [selectedLead, setSelectedLead] = useState(null)

    // Pagination
    const [page, setPage] = useState(0)
    const [hasMore, setHasMore] = useState(true)
    const [loadingMore, setLoadingMore] = useState(false)
    const ITEMS_per_PAGE = 50

    useEffect(() => {
        if (selectedClientId) {
            setLeads([])
            setPage(0)
            setHasMore(true)
            fetchLeads(0, true)
        } else {
            setLeads([])
        }
    }, [selectedClientId])

    const fetchLeads = async (pageIndex = 0, isRefresh = false) => {
        if (!selectedClientId) return

        try {
            if (pageIndex === 0) setLoading(true)
            else setLoadingMore(true)

            const from = pageIndex * ITEMS_per_PAGE
            const to = from + ITEMS_per_PAGE - 1

            const { data, error } = await supabase
                .from('leads')
                .select('*')
                .eq('client_id', selectedClientId)
                .order('created_at', { ascending: false })
                .range(from, to)

            if (error) throw error

            if (data) {
                if (isRefresh || pageIndex === 0) {
                    setLeads(data)
                } else {
                    setLeads(prev => [...prev, ...data])
                }
                setHasMore(data.length === ITEMS_per_PAGE)
            }
        } catch (err) {
            console.error('Error fetching leads:', err)
        } finally {
            setLoading(false)
            setLoadingMore(false)
        }
    }

    const loadMore = () => {
        if (!loadingMore && hasMore) {
            const nextPage = page + 1
            setPage(nextPage)
            fetchLeads(nextPage, false)
        }
    }

    // Intersection Observer
    const observerTarget = React.useRef(null);
    useEffect(() => {
        const observer = new IntersectionObserver(
            entries => {
                if (entries[0].isIntersecting && hasMore && !loading && !loadingMore) {
                    loadMore();
                }
            },
            { threshold: 1.0 }
        );
        if (observerTarget.current) observer.observe(observerTarget.current);
        return () => observer.disconnect();
    }, [hasMore, loading, loadingMore, leads]); // Re-attach on list change

    const updateLeadStatus = async (leadId, newStatus) => {
        // MAPPING: Label/Input -> Database Enum Value
        const STATUS_MAPPING = {
            'Novos': 'TO_CONTACT',
            'Contatados': 'CONTACTED',
            'Em Conversa': 'IN_CONVERSATION',
            'Reuni√£o': 'MEETING_SCHEDULED',
            'Desqualificado': 'DISQUALIFIED',
            // Fallbacks
            'to_contact': 'TO_CONTACT',
            'contacted': 'CONTACTED',
            'in_conversation': 'IN_CONVERSATION',
            'meeting_scheduled': 'MEETING_SCHEDULED',
            'disqualified': 'DISQUALIFIED',
        }

        const dbStatus = STATUS_MAPPING[newStatus] || newStatus

        // Optimistic UI Update
        const previousLeads = [...leads]
        setLeads(leads.map(l => l.id === leadId ? { ...l, status: dbStatus } : l))

        // Also update selected lead if open
        if (selectedLead && selectedLead.id === leadId) {
            setSelectedLead({ ...selectedLead, status: dbStatus })
        }

        try {
            const { error } = await supabase
                .from('leads')
                .update({ status_pipeline: dbStatus })
                .eq('id', leadId)

            if (error) throw error
        } catch (err) {
            console.error('Error updating status:', err)
            // Revert on error
            setLeads(previousLeads)
            alert('Erro ao atualizar status.')
        }
    }

    // Filter leads by status
    const getLeadsByStatus = (statusId) => {
        return leads.filter(lead => (lead.status || 'new') === statusId)
    }

    return (
        <div className="leads-container">
            <div className="leads-header">
                <h1>Gest√£o de Leads</h1>
                <p>Gerencie suas oportunidades comerciais e acompanhe o progresso.</p>
            </div>

            {!selectedClientId ? (
                <div style={{
                    marginTop: '4rem',
                    flex: 1,
                    display: 'flex',
                    flexDirection: 'column',
                    alignItems: 'center',
                    justifyContent: 'center',
                    color: '#64748b'
                }}>
                    <div style={{ background: '#f1f5f9', padding: '1rem', borderRadius: '50%', marginBottom: '1rem' }}>
                        <Search size={32} />
                    </div>
                    <h3 style={{ fontSize: '1.2rem', fontWeight: 'bold', color: '#1e293b', marginBottom: '0.5rem' }}>Nenhum Cliente Selecionado</h3>
                    <p>Selecione um cliente no topo da p√°gina para gerenciar a prospec√ß√£o.</p>
                </div>
            ) : loading ? (
                <div className="loading-state">Carregando leads...</div>
            ) : (
                <div className="kanban-board">
                    {STATUS_COLUMNS.map(column => {
                        const columnLeads = getLeadsByStatus(column.id)

                        return (
                            <div key={column.id} className="kanban-column">
                                <div className="column-header" style={{ borderTop: `4px solid ${column.color}` }}>
                                    <h3>
                                        {column.icon}
                                        {column.label}
                                    </h3>
                                    <span className="count-badge">{columnLeads.length}</span>
                                </div>

                                <div className="column-content">
                                    {columnLeads.map(lead => (
                                        <div
                                            key={lead.id}
                                            className="lead-card"
                                            onClick={() => setSelectedLead(lead)}
                                        >
                                            <div className="lead-name">{lead.nome || 'Sem Nome'}</div>
                                            <div className="lead-role" title={lead.headline}>
                                                {lead.headline || 'Cargo n√£o informado'}
                                            </div>
                                            <div className="lead-meta">
                                                <span className="company-name">
                                                    @{lead.company || '?'}
                                                </span>
                                            </div>
                                        </div>
                                    ))}
                                    {columnLeads.length === 0 && (
                                        <div style={{ textAlign: 'center', padding: '1rem', color: '#cbd5e1', fontSize: '0.9rem' }}>
                                            Vazio
                                        </div>
                                    )}
                                </div>
                            </div>
                        )
                    })}
                </div>
            )}

            {/* Sentinel */}
            {!loading && (
                <div ref={observerTarget} style={{ height: '40px', width: '100%', display: 'flex', justifyContent: 'center', alignItems: 'center', padding: '10px' }}>
                    {loadingMore && <div style={{ display: 'flex', color: '#64748b' }}><Loader2 className="spinner" size={24} /></div>}
                    {!hasMore && leads.length > 0 && <span style={{ color: '#cbd5e1' }}>Todos os leads carregados.</span>}
                </div>
            )}

            {selectedLead && (
                <LeadDetailsDrawer
                    lead={selectedLead}
                    onClose={() => setSelectedLead(null)}
                    onStatusChange={updateLeadStatus}
                />
            )}
        </div>
    )
}

const LeadDetailsDrawer = ({ lead, onClose, onStatusChange }) => {
    const [copied, setCopied] = useState(false)

    const handleCopy = (text) => {
        navigator.clipboard.writeText(text)
        setCopied(true)
        setTimeout(() => setCopied(false), 2000)
    }

    return (
        <div className="lead-modal-overlay" onClick={(e) => {
            if (e.target === e.currentTarget) onClose()
        }}>
            <div className="lead-modal-content">
                <div className="modal-header">
                    <div className="profile-info">
                        <h2>{lead.nome}</h2>
                        <p style={{ color: '#64748b', fontSize: '1.1rem' }}>{lead.headline} @ {lead.company}</p>
                        {lead.linkedin_profile_url && (
                            <a
                                href={lead.linkedin_profile_url}
                                target="_blank"
                                rel="noreferrer"
                                className="linkedin-btn"
                                style={{ marginTop: '1rem', display: 'inline-flex' }}
                            >
                                <Linkedin size={18} /> Ver Perfil LinkedIn <ExternalLink size={14} style={{ marginLeft: 'auto' }} />
                            </a>
                        )}
                    </div>
                    <button className="close-btn" onClick={onClose}>
                        <XOctagon size={24} />
                    </button>
                </div>

                <div className="modal-body">
                    {/* Origin */}
                    <div style={{ marginBottom: '2rem' }}>
                        <div className="section-title">Origem</div>
                        <div style={{
                            background: '#f1f5f9',
                            padding: '0.75rem',
                            borderRadius: '6px',
                            color: '#334155',
                            fontSize: '0.9rem'
                        }}>
                            üìç Veio do Post: <strong>{lead.post_title || 'Desconhecido'}</strong>
                        </div>
                    </div>

                    {/* AI Intelligence */}
                    <div className="ai-section">
                        <div className="section-title" style={{ color: '#7c3aed' }}>
                            <BrainCircuit size={16} /> Intelig√™ncia Artificial
                        </div>

                        {lead.ai_summary && (
                            <div className="ai-box">
                                <strong style={{ display: 'block', marginBottom: '0.5rem', color: '#5b21b6' }}>Resumo do Perfil</strong>
                                <div className="ai-content">{lead.ai_summary}</div>
                            </div>
                        )}

                        {lead.ai_icebreaker && (
                            <div className="ai-box" style={{ borderLeftColor: '#ec4899' }}>
                                <strong style={{ display: 'block', marginBottom: '0.5rem', color: '#9d174d' }}>
                                    Sugest√£o de Quebra-gelo
                                </strong>
                                <div className="ai-content" style={{ fontStyle: 'italic' }}>
                                    "{lead.ai_icebreaker}"
                                </div>
                                <button
                                    className="copy-btn"
                                    onClick={() => handleCopy(lead.ai_icebreaker)}
                                >
                                    {copied ? <Check size={14} color="green" /> : <Copy size={14} />}
                                    {copied ? 'Copiado!' : 'Copiar Mensagem'}
                                </button>
                            </div>
                        )}
                    </div>
                </div>

                <div className="action-bar">
                    {STATUS_COLUMNS.map(status => (
                        <button
                            key={status.id}
                            className={`status-btn ${lead.status === status.id ? 'active' : ''}`}
                            onClick={() => onStatusChange(lead.id, status.id)}
                            title={`Mover para ${status.label}`}
                        >
                            {status.id === lead.status && <Check size={16} />}
                            {status.label}
                        </button>
                    ))}
                </div>
            </div>
        </div>
    )
}

export default LeadsPage

```

---

## Arquivo: src\pages\LinkedInEngagementPage.jsx
```jsx
import React, { useState, useEffect, useCallback } from 'react'
import { supabase } from '../services/supabaseClient'
import { useClientSelection } from '../contexts/ClientSelectionContext'
import {
    ThumbsUp,
    MessageCircle,
    UserPlus,
    Send,
    X,
    Clock,
    Users,
    Loader2,
    MessageSquare,
    Linkedin,
    RefreshCw,
    Check
} from 'lucide-react'

// Helper: relative time in Portuguese
const timeAgo = (dateString) => {
    if (!dateString) return ''
    const now = new Date()
    const date = new Date(dateString)
    const diffMs = now - date
    const diffMins = Math.floor(diffMs / 60000)
    const diffHours = Math.floor(diffMs / 3600000)
    const diffDays = Math.floor(diffMs / 86400000)

    if (diffMins < 1) return 'Agora mesmo'
    if (diffMins < 60) return `H√° ${diffMins} min`
    if (diffHours < 24) return `H√° ${diffHours}h`
    if (diffDays === 1) return 'H√° 1 dia'
    if (diffDays < 30) return `H√° ${diffDays} dias`
    return date.toLocaleDateString('pt-BR')
}

const LinkedInEngagementPage = () => {
    const { selectedClientId } = useClientSelection()

    // Posts state
    const [posts, setPosts] = useState([])
    const [loadingPosts, setLoadingPosts] = useState(false)
    const [selectedPost, setSelectedPost] = useState(null)

    // Comments state
    const [comments, setComments] = useState([])
    const [loadingComments, setLoadingComments] = useState(false)

    // Connect modal state
    const [connectModal, setConnectModal] = useState(null) // { author_name, author_urn_id }
    const [connectNote, setConnectNote] = useState('')

    // Sync state
    const [isSyncing, setIsSyncing] = useState(false)
    const [notification, setNotification] = useState(null) // { message, type }

    // Reusable fetch function
    const fetchPosts = useCallback(async (resetSelection = true) => {
        if (!selectedClientId) return
        setLoadingPosts(true)
        try {
            const { data, error } = await supabase
                .from('linkedin_posts')
                .select('*')
                .eq('client_id', selectedClientId)
                .order('created_at_linkedin', { ascending: false })

            if (error) throw error
            setPosts(data || [])
            if (resetSelection) {
                setSelectedPost(null)
                setComments([])
            }
        } catch (err) {
            console.error('Error fetching LinkedIn posts:', err)
        } finally {
            setLoadingPosts(false)
        }
    }, [selectedClientId])

    // 1. Initial fetch
    useEffect(() => {
        if (!selectedClientId) {
            setPosts([])
            setSelectedPost(null)
            return
        }
        fetchPosts()
    }, [selectedClientId, fetchPosts])

    // 2. Fetch Comments for selected post
    useEffect(() => {
        if (!selectedPost) {
            setComments([])
            return
        }

        const fetchComments = async () => {
            setLoadingComments(true)
            try {
                const { data, error } = await supabase
                    .from('linkedin_comments')
                    .select('*')
                    .eq('post_id', selectedPost.id)
                    .order('created_at', { ascending: false })

                if (error) throw error
                setComments(data || [])
            } catch (err) {
                console.error('Error fetching comments:', err)
            } finally {
                setLoadingComments(false)
            }
        }

        fetchComments()
    }, [selectedPost?.id])

    // 3. Sync Handler
    const handleSyncLinkedIn = async () => {
        setIsSyncing(true)
        setNotification(null)
        try {
            const { data: { user } } = await supabase.auth.getUser()

            const response = await fetch('https://n8n-n8n-start.kfocge.easypanel.host/webhook-test/sync-linkedin-comments', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    user_id: user?.id || 'system_user',
                    client_id: selectedClientId
                })
            })

            if (!response.ok) throw new Error('Erro na sincroniza√ß√£o')

            // Refetch posts (keep current selection if possible)
            await fetchPosts(false)

            setNotification({ message: 'Posts e coment√°rios atualizados!', type: 'success' })
        } catch (err) {
            console.error('Sync error:', err)
            setNotification({ message: err.message || 'Erro ao sincronizar. Tente novamente.', type: 'error' })
        } finally {
            setIsSyncing(false)
            setTimeout(() => setNotification(null), 5000)
        }
    }

    // 4. Action Handlers
    const handleOpenChat = (authorUrnId) => {
        console.log('handleOpenChat:', authorUrnId)
    }

    const handleConnect = (authorUrnId, noteText) => {
        console.log('handleConnect:', authorUrnId, noteText)
        setConnectModal(null)
        setConnectNote('')
    }

    const handleSelectPost = (post) => {
        setSelectedPost(post)
    }

    // Extract metrics safely
    const getMetrics = (post) => {
        const metrics = post.metrics || {}
        return {
            likes: metrics.likes_count || 0,
            comments: metrics.comments_count || 0
        }
    }

    // No client selected
    if (!selectedClientId) {
        return (
            <div className="flex items-center justify-center h-[80vh]">
                <div className="text-center space-y-3">
                    <Users size={48} className="mx-auto text-slate-300" />
                    <h2 className="text-xl font-bold text-slate-600">Selecione um Cliente</h2>
                    <p className="text-sm text-slate-400">Escolha um cliente no seletor acima para ver o engajamento LinkedIn.</p>
                </div>
            </div>
        )
    }

    return (
        <div className="p-4 md:p-6 h-full">
            {/* TOAST NOTIFICATION */}
            {notification && (
                <div className={`fixed top-6 right-6 z-50 px-5 py-4 rounded-xl shadow-2xl border-2 flex items-center gap-3 animate-slide-in-right min-w-[300px] ${notification.type === 'error'
                    ? 'bg-red-50 border-red-300 text-red-700'
                    : 'bg-emerald-50 border-emerald-300 text-emerald-700'
                    }`}>
                    {notification.type === 'error' ? <X size={20} className="shrink-0" /> : <Check size={20} className="shrink-0" />}
                    <span className="text-sm font-semibold flex-1">{notification.message}</span>
                </div>
            )}

            {/* PAGE HEADER */}
            <div className="mb-6">
                <div className="flex items-center gap-3 mb-1">
                    <div className="w-10 h-10 rounded-xl bg-blue-100 flex items-center justify-center">
                        <Linkedin size={22} className="text-blue-600" />
                    </div>
                    <div>
                        <h1 className="text-2xl font-bold text-slate-800">Engajamento LinkedIn</h1>
                        <p className="text-sm text-slate-500">Analise posts e interaja com quem comentou</p>
                    </div>
                </div>
            </div>

            {/* SPLIT VIEW */}
            <div className="flex gap-4 h-[calc(100vh-220px)]">

                {/* LEFT COLUMN ‚Äî Posts List */}
                <div className="w-[380px] shrink-0 bg-white rounded-xl border border-slate-200 shadow-sm flex flex-col overflow-hidden">
                    <div className="p-4 border-b border-slate-100 flex items-center justify-between">
                        <div>
                            <h2 className="text-sm font-bold text-slate-700 uppercase tracking-wider">Posts Recentes</h2>
                            <p className="text-xs text-slate-400 mt-0.5">{posts.length} posts encontrados</p>
                        </div>
                        <button
                            onClick={handleSyncLinkedIn}
                            disabled={isSyncing}
                            className={`flex items-center gap-1.5 px-3 py-2 rounded-lg text-xs font-semibold transition-all ${isSyncing
                                ? 'bg-blue-50 text-blue-400 cursor-not-allowed'
                                : 'bg-blue-50 text-blue-600 hover:bg-blue-100 border border-blue-200'
                                }`}
                            title="Buscar novos posts e coment√°rios"
                        >
                            <RefreshCw size={14} className={isSyncing ? 'animate-spin' : ''} />
                            {isSyncing ? 'Atualizando...' : 'Atualizar'}
                        </button>
                    </div>

                    <div className="flex-1 overflow-y-auto">
                        {loadingPosts ? (
                            <div className="flex items-center justify-center py-16">
                                <Loader2 size={24} className="animate-spin text-blue-500" />
                            </div>
                        ) : posts.length === 0 ? (
                            <div className="text-center py-16 px-4">
                                <Linkedin size={32} className="mx-auto text-slate-300 mb-2" />
                                <p className="text-sm text-slate-400">Nenhum post encontrado</p>
                            </div>
                        ) : (
                            <div className="divide-y divide-slate-100">
                                {posts.map(post => {
                                    const { likes, comments: commentCount } = getMetrics(post)
                                    const isSelected = selectedPost?.id === post.id

                                    return (
                                        <button
                                            key={post.id}
                                            onClick={() => handleSelectPost(post)}
                                            className={`w-full text-left p-4 transition-all hover:bg-slate-50 ${isSelected
                                                ? 'bg-blue-50 border-l-4 border-l-blue-500'
                                                : 'border-l-4 border-l-transparent'
                                                }`}
                                        >
                                            <div className="flex gap-3">
                                                {/* Post Thumbnail */}
                                                {post.post_image_url && (
                                                    <img
                                                        src={post.post_image_url}
                                                        alt=""
                                                        className="w-14 h-14 rounded-lg object-cover shrink-0 border border-slate-200"
                                                        onError={(e) => { e.target.style.display = 'none' }}
                                                    />
                                                )}

                                                {/* Text content */}
                                                <div className="flex-1 min-w-0">
                                                    {/* Snippet ‚Äî max 2 lines */}
                                                    <p className="text-sm text-slate-700 font-medium line-clamp-2 leading-snug">
                                                        {post.content_snippet || 'Post sem conte√∫do'}
                                                    </p>

                                                    {/* Meta row */}
                                                    <div className="flex items-center gap-3 mt-2.5">
                                                        <span className="text-[11px] text-slate-400 flex items-center gap-1">
                                                            <Clock size={11} />
                                                            {timeAgo(post.created_at_linkedin)}
                                                        </span>
                                                        <span className="text-[11px] text-blue-600 bg-blue-50 px-2 py-0.5 rounded-full font-semibold flex items-center gap-1">
                                                            <ThumbsUp size={10} /> {likes}
                                                        </span>
                                                        <span className="text-[11px] text-emerald-600 bg-emerald-50 px-2 py-0.5 rounded-full font-semibold flex items-center gap-1">
                                                            <MessageCircle size={10} /> {commentCount}
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </button>
                                    )
                                })}
                            </div>
                        )}
                    </div>
                </div>

                {/* RIGHT COLUMN ‚Äî Comments */}
                <div className="flex-1 bg-white rounded-xl border border-slate-200 shadow-sm flex flex-col overflow-hidden">
                    {!selectedPost ? (
                        <div className="flex-1 flex items-center justify-center">
                            <div className="text-center space-y-2">
                                <MessageSquare size={40} className="mx-auto text-slate-300" />
                                <p className="text-sm text-slate-400 font-medium">Selecione um post para ver os coment√°rios</p>
                            </div>
                        </div>
                    ) : (
                        <>
                            {/* Selected Post Header */}
                            <div className="p-4 border-b border-slate-100 bg-slate-50/50">
                                <p className="text-sm text-slate-700 font-medium line-clamp-3 leading-relaxed">
                                    {selectedPost.content_snippet}
                                </p>
                                <div className="flex items-center gap-3 mt-2">
                                    <span className="text-[11px] text-slate-400">
                                        {timeAgo(selectedPost.created_at_linkedin)}
                                    </span>
                                    <span className="text-[11px] text-slate-500 font-medium">
                                        {comments.length} coment√°rios carregados
                                    </span>
                                </div>
                            </div>

                            {/* Comments List */}
                            <div className="flex-1 overflow-y-auto p-4 space-y-3">
                                {loadingComments ? (
                                    <div className="flex items-center justify-center py-16">
                                        <Loader2 size={24} className="animate-spin text-blue-500" />
                                    </div>
                                ) : comments.length === 0 ? (
                                    <div className="text-center py-16">
                                        <MessageCircle size={32} className="mx-auto text-slate-300 mb-2" />
                                        <p className="text-sm text-slate-400">Nenhum coment√°rio neste post</p>
                                    </div>
                                ) : (
                                    comments.map(comment => (
                                        <div
                                            key={comment.id}
                                            className="flex items-start gap-3 p-3 rounded-xl border border-slate-100 hover:border-slate-200 transition-colors group"
                                        >
                                            {/* Avatar */}
                                            {comment.author_image_url ? (
                                                <img
                                                    src={comment.author_image_url}
                                                    alt={comment.author_name || 'Autor'}
                                                    className="w-10 h-10 rounded-full shrink-0 object-cover border border-slate-200"
                                                    onError={(e) => {
                                                        e.target.style.display = 'none'
                                                        e.target.nextSibling.style.display = 'flex'
                                                    }}
                                                />
                                            ) : null}
                                            <div className={`w-10 h-10 rounded-full bg-gradient-to-br from-blue-400 to-blue-600 flex items-center justify-center text-white font-bold text-sm shrink-0 ${comment.author_image_url ? 'hidden' : ''}`}>
                                                {(comment.author_name || '?')[0].toUpperCase()}
                                            </div>

                                            {/* Content */}
                                            <div className="flex-1 min-w-0">
                                                <div className="flex items-start justify-between gap-2">
                                                    <div>
                                                        <a
                                                            href={comment.author_profile_url || '#'}
                                                            target="_blank"
                                                            rel="noopener noreferrer"
                                                            className="text-sm font-semibold text-slate-800 hover:text-blue-600 transition-colors"
                                                        >
                                                            {comment.author_name || 'Autor desconhecido'}
                                                        </a>
                                                        {comment.author_headline && (
                                                            <p className="text-xs text-slate-400 truncate max-w-[300px]">
                                                                {comment.author_headline}
                                                            </p>
                                                        )}
                                                    </div>

                                                    {/* Action Button */}
                                                    {comment.is_connection ? (
                                                        <button
                                                            onClick={() => handleOpenChat(comment.author_urn_id)}
                                                            className="shrink-0 flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-semibold bg-emerald-50 text-emerald-600 hover:bg-emerald-100 border border-emerald-200 transition-colors opacity-0 group-hover:opacity-100"
                                                            title="Enviar mensagem"
                                                        >
                                                            <MessageCircle size={13} />
                                                            Mensagem
                                                        </button>
                                                    ) : (
                                                        <button
                                                            onClick={() => setConnectModal({
                                                                author_name: comment.author_name,
                                                                author_urn_id: comment.author_urn_id
                                                            })}
                                                            className="shrink-0 flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-semibold bg-blue-50 text-blue-600 hover:bg-blue-100 border border-blue-200 transition-colors opacity-0 group-hover:opacity-100"
                                                            title="Enviar convite de conex√£o"
                                                        >
                                                            <UserPlus size={13} />
                                                            Conectar
                                                        </button>
                                                    )}
                                                </div>

                                                {/* Comment Text */}
                                                <div className="mt-2 p-3 bg-slate-50 rounded-lg">
                                                    <p className="text-sm text-slate-700 leading-relaxed whitespace-pre-wrap">
                                                        {comment.content}
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                    ))
                                )}
                            </div>
                        </>
                    )}
                </div>
            </div>

            {/* CONNECT MODAL */}
            {connectModal && (
                <div className="fixed inset-0 z-50 flex items-center justify-center bg-slate-900/50 backdrop-blur-sm p-4">
                    <div className="bg-white rounded-2xl shadow-2xl border border-slate-200 w-full max-w-md animate-fade-in">
                        {/* Modal Header */}
                        <div className="flex items-center justify-between p-5 border-b border-slate-100">
                            <div>
                                <h3 className="text-lg font-bold text-slate-800">Enviar Convite</h3>
                                <p className="text-sm text-slate-400 mt-0.5">
                                    Conectar com <span className="font-semibold text-slate-600">{connectModal.author_name}</span>
                                </p>
                            </div>
                            <button
                                onClick={() => { setConnectModal(null); setConnectNote('') }}
                                className="p-2 rounded-lg hover:bg-slate-100 text-slate-400 hover:text-slate-600 transition-colors"
                            >
                                <X size={18} />
                            </button>
                        </div>

                        {/* Modal Body */}
                        <div className="p-5">
                            <label className="block text-sm font-medium text-slate-700 mb-2">
                                Nota de Conex√£o (opcional)
                            </label>
                            <textarea
                                value={connectNote}
                                onChange={(e) => setConnectNote(e.target.value)}
                                placeholder="Escreva uma nota personalizada para o convite..."
                                className="w-full h-28 p-3 border border-slate-200 rounded-xl text-sm text-slate-700 placeholder-slate-400 resize-none focus:outline-none focus:ring-2 focus:ring-blue-200 focus:border-blue-400 transition-all"
                                maxLength={300}
                            />
                            <p className="text-xs text-slate-400 mt-1 text-right">{connectNote.length}/300</p>
                        </div>

                        {/* Modal Footer */}
                        <div className="flex items-center justify-end gap-3 p-5 border-t border-slate-100">
                            <button
                                onClick={() => { setConnectModal(null); setConnectNote('') }}
                                className="px-4 py-2.5 rounded-xl text-sm font-medium text-slate-600 hover:bg-slate-100 transition-colors"
                            >
                                Cancelar
                            </button>
                            <button
                                onClick={() => handleConnect(connectModal.author_urn_id, connectNote)}
                                className="flex items-center gap-2 px-5 py-2.5 rounded-xl text-sm font-semibold bg-blue-600 text-white hover:bg-blue-700 transition-colors shadow-sm"
                            >
                                <Send size={14} />
                                Enviar Convite
                            </button>
                        </div>
                    </div>
                </div>
            )}
        </div>
    )
}

export default LinkedInEngagementPage

```

---

## Arquivo: src\pages\ListDetailsPage.jsx
```jsx
import React, { useState, useEffect } from 'react'
import { supabase } from '../services/supabaseClient'
import { useParams, useNavigate } from 'react-router-dom'
import {
    ArrowLeft,
    Search,
    Loader2,
    Plus,
    Trash2,
    RefreshCw,
    Download,
    Check
} from 'lucide-react'
import ImportContactsModal from '../components/ImportContactsModal'
import { useClientSelection } from '../contexts/ClientSelectionContext'

const ListDetailsPage = () => {
    const { id } = useParams()
    const navigate = useNavigate()
    const { selectedClientId } = useClientSelection()
    const [list, setList] = useState(null)
    const [leads, setLeads] = useState([])
    const [loading, setLoading] = useState(true)
    const [searchTerm, setSearchTerm] = useState('')
    const [isImportModalOpen, setIsImportModalOpen] = useState(false)
    const [selectedLeads, setSelectedLeads] = useState([])

    useEffect(() => {
        fetchListAndLeads()

        // Polling for processing status
        let interval
        if (list?.status === 'PROCESSING') {
            interval = setInterval(() => {
                fetchListAndLeads(true) // Silent refresh
            }, 10000)
        }
        return () => clearInterval(interval)
    }, [id, list?.status])

    const fetchListAndLeads = async (silent = false) => {
        if (!silent) setLoading(true)
        try {
            // Fetch List Details
            const { data: listData, error: listError } = await supabase
                .from('contact_lists')
                .select('*')
                .eq('id', id)
                .single()

            if (listError) throw listError
            setList(listData)

            // Fetch Leads
            const { data: leadsData, error: leadsError } = await supabase
                .from('contact_list_leads')
                .select('*, leads(*)')
                .eq('list_id', id)

            if (leadsError) throw leadsError

            // Flatten structure
            const flattenedLeads = leadsData?.map(item => ({
                ...item,
                lead_data: item.leads
            })) || []

            setLeads(flattenedLeads)

        } catch (error) {
            console.error('Error fetching details:', error)
        } finally {
            setLoading(false)
        }
    }

    const filteredLeads = leads.filter(l =>
        l.lead_data?.nome?.toLowerCase().includes(searchTerm.toLowerCase()) ||
        l.lead_data?.headline?.toLowerCase().includes(searchTerm.toLowerCase())
    )

    const toggleSelectLead = (leadId) => {
        setSelectedLeads(prev =>
            prev.includes(leadId)
                ? prev.filter(id => id !== leadId)
                : [...prev, leadId]
        )
    }

    const toggleSelectAll = () => {
        if (selectedLeads.length === filteredLeads.length) {
            setSelectedLeads([])
        } else {
            setSelectedLeads(filteredLeads.map(l => l.id))
        }
    }

    const handleDeleteSelected = async () => {
        if (!selectedLeads.length || !window.confirm(`Tem certeza que deseja remover ${selectedLeads.length} leads desta lista?`)) return

        try {
            const { error } = await supabase
                .from('contact_list_leads')
                .delete()
                .in('id', selectedLeads)

            if (error) throw error

            setLeads(prev => prev.filter(l => !selectedLeads.includes(l.id)))
            setSelectedLeads([])
        } catch (error) {
            console.error('Error deleting leads:', error)
            alert('Erro ao remover leads.')
        }
    }

    return (
        <div className="min-h-screen bg-slate-50 p-6 md:p-8 font-sans text-slate-800">
            {/* HEADER */}
            <div className="max-w-7xl mx-auto mb-10">
                <button
                    onClick={() => navigate('/lists')}
                    className="flex items-center gap-2 text-slate-500 hover:text-indigo-600 transition-colors text-sm font-semibold mb-4"
                >
                    <ArrowLeft size={16} /> Voltar para Listas
                </button>

                <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-8">
                    <div>
                        <h1 className="text-3xl font-bold text-slate-900 tracking-tight mb-2">
                            {list ? list.name : 'Carregando...'}
                        </h1>
                        <p className="text-slate-500 text-lg">Detalhes e leads da lista de contatos.</p>
                    </div>
                    <div className="flex gap-3">
                        <button
                            onClick={() => setIsImportModalOpen(true)}
                            className="flex items-center gap-2 px-5 py-2.5 rounded-xl bg-indigo-600 text-white font-bold hover:bg-indigo-700 transition-all shadow-lg shadow-indigo-100"
                        >
                            <Download size={20} /> Importar Contatos
                        </button>
                    </div>

                </div>

                {/* PROGRESS BAR */}
                {list?.status === 'PROCESSING' && (
                    <div className="bg-white p-6 rounded-xl border border-blue-100 shadow-sm mb-6 animate-pulse">
                        <div className="flex justify-between items-end mb-2">
                            <div>
                                <h3 className="text-lg font-bold text-slate-800 flex items-center gap-2">
                                    <Loader2 className="animate-spin text-blue-600" size={20} />
                                    Importando Contatos...
                                </h3>
                                <p className="text-sm text-slate-500">
                                    Isso pode levar alguns minutos. Estamos capturando dados do LinkedIn.
                                </p>
                            </div>
                            <div className="text-right">
                                <span className="text-2xl font-bold text-blue-600">
                                    {Math.round((leads.length / (list.total_leads_expected || 1)) * 100)}%
                                </span>
                            </div>
                        </div>
                        <div className="w-full bg-slate-100 rounded-full h-2.5 overflow-hidden">
                            <div
                                className="bg-blue-600 h-2.5 rounded-full transition-all duration-500"
                                style={{ width: `${Math.min((leads.length / (list.total_leads_expected || 1)) * 100, 100)}%` }}
                            ></div>
                        </div>
                        {leads.length > 0 && (
                            <p className="text-xs text-slate-400 mt-2 text-right">
                                {leads.length} de {list.total_leads_expected || '?'} leads processados
                            </p>
                        )}
                    </div>
                )}

                {/* CONTROLS */}
                <div className="bg-white p-4 rounded-xl border border-slate-200 shadow-sm mb-6 flex flex-col md:flex-row justify-between items-center gap-4">
                    <div className="relative w-full md:w-96">
                        <Search className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400" size={18} />
                        <input
                            type="text"
                            placeholder="Buscar leads na lista..."
                            value={searchTerm}
                            onChange={e => setSearchTerm(e.target.value)}
                            className="w-full pl-10 pr-4 py-2.5 bg-slate-50 border border-slate-200 rounded-lg text-slate-800 focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 transition-all font-medium placeholder:text-slate-400"
                        />
                    </div>
                    {selectedLeads.length > 0 && (
                        <button
                            onClick={handleDeleteSelected}
                            className="flex items-center gap-2 px-4 py-2 rounded-lg bg-red-50 text-red-600 font-bold hover:bg-red-100 transition-colors border border-red-200"
                        >
                            <Trash2 size={16} /> Deletar ({selectedLeads.length})
                        </button>
                    )}
                </div>

                {/* TABLE */}
                <div className="bg-white border border-slate-200 rounded-xl shadow-sm overflow-hidden">
                    {loading ? (
                        <div className="py-20 flex justify-center text-gray-400">
                            <Loader2 className="animate-spin" size={32} />
                        </div>
                    ) : (
                        <table className="w-full text-left border-collapse">
                            <thead>
                                <tr className="bg-slate-50 border-b border-slate-200 text-xs font-bold text-slate-500 uppercase tracking-wider">
                                    <th className="py-4 px-6 w-12">
                                        <input
                                            type="checkbox"
                                            onChange={toggleSelectAll}
                                            checked={filteredLeads.length > 0 && selectedLeads.length === filteredLeads.length}
                                            className="w-4 h-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"
                                        />
                                    </th>
                                    <th className="py-4 px-6">Nome</th>
                                    <th className="py-4 px-6">Cargo & Empresa</th>
                                    <th className="py-4 px-6">Status na Lista</th>
                                    <th className="py-4 px-6 text-right">Adicionado em</th>
                                </tr>
                            </thead>
                            <tbody className="divide-y divide-gray-100">
                                {filteredLeads.length === 0 ? (
                                    <tr>
                                        <td colSpan="5" className="py-12 text-center text-gray-400">Nenhum lead encontrado nesta lista.</td>
                                    </tr>
                                ) : (
                                    filteredLeads.map(item => (
                                        <tr key={item.id} className="hover:bg-slate-50 transition-colors">
                                            <td className="py-4 px-6">
                                                <input
                                                    type="checkbox"
                                                    checked={selectedLeads.includes(item.id)}
                                                    onChange={() => toggleSelectLead(item.id)}
                                                    className="w-4 h-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"
                                                />
                                            </td>
                                            <td className="py-4 px-6">
                                                <div className="font-bold text-slate-900">{item.lead_data?.nome || 'Sem Nome'}</div>
                                            </td>
                                            <td className="py-4 px-6">
                                                <div className="text-sm font-medium text-slate-900">{item.lead_data?.headline}</div>
                                                <div className="text-xs text-slate-500">{item.lead_data?.company}</div>
                                            </td>
                                            <td className="py-4 px-6">
                                                <span className={`px-2 py-0.5 rounded text-xs font-bold border ${item.status === 'ENRICHED' ? 'bg-green-50 text-green-700 border-green-200' : 'bg-gray-100 text-gray-600 border-gray-200'
                                                    }`}>
                                                    {item.status || 'Pendente'}
                                                </span>
                                            </td>
                                            <td className="py-4 px-6 text-right text-sm text-slate-500">
                                                {new Date(item.created_at).toLocaleDateString()}
                                            </td>
                                        </tr>
                                    ))
                                )}
                            </tbody>
                        </table>
                    )}
                </div>
            </div>

            {/* IMPORT MODAL */}
            <ImportContactsModal
                isOpen={isImportModalOpen}
                onClose={() => setIsImportModalOpen(false)}
                listId={id}
                clientId={selectedClientId}
                accountId={list?.account_id}
                onSuccess={() => fetchListAndLeads()}
            />
        </div>
    )
}

export default ListDetailsPage

```

---

## Arquivo: src\pages\ListsPage.jsx
```jsx
import React, { useState, useEffect } from 'react'
import { supabase } from '../services/supabaseClient'
import { useNavigate } from 'react-router-dom'
import {
    Plus,
    Search,
    Loader2,
    Users,
    ArrowRight,
    RefreshCw,
    Building,
    AlertTriangle,
    CheckCircle2
} from 'lucide-react'
import { useClientSelection } from '../contexts/ClientSelectionContext'

const ListsPage = () => {
    const navigate = useNavigate()
    const { selectedClientId } = useClientSelection()
    const [lists, setLists] = useState([])
    const [loading, setLoading] = useState(false)
    const [searchTerm, setSearchTerm] = useState('')
    const [isCreateModalOpen, setIsCreateModalOpen] = useState(false)
    const [newListName, setNewListName] = useState('')
    const [createLoading, setCreateLoading] = useState(false)

    // Client Data (Unipile ID)
    const [clientUnipileId, setClientUnipileId] = useState(null)
    const [clientName, setClientName] = useState('')
    const [clientLoading, setClientLoading] = useState(false)
    const [allClients, setAllClients] = useState([])
    const [targetClientId, setTargetClientId] = useState(null)

    useEffect(() => {
        if (selectedClientId) {
            setTargetClientId(selectedClientId)
            fetchClientDetails(selectedClientId)
            fetchLists()
            fetchAllClients()
        } else {
            setLists([])
            setClientUnipileId(null)
            setClientName('')
            setTargetClientId(null)
            fetchAllClients()
        }
    }, [selectedClientId])

    const fetchAllClients = async () => {
        try {
            const { data, error } = await supabase
                .from('clients')
                .select('id, name, unipile_account_id')
                .order('name', { ascending: true })
            if (error) throw error
            setAllClients(data || [])
        } catch (error) {
            console.error('Error fetching clients:', error)
        }
    }

    const fetchClientDetails = async (clientId) => {
        if (!clientId) {
            setClientUnipileId(null)
            setClientName('')
            return
        }
        setClientLoading(true)
        try {
            // If we already have the client in allClients, use it to save a round trip
            const clientFromList = allClients.find(c => c.id == clientId)
            if (clientFromList) {
                setClientUnipileId(clientFromList.unipile_account_id)
                setClientName(clientFromList.name)
                setClientLoading(false)
                return
            }

            const { data, error } = await supabase
                .from('clients')
                .select('name, unipile_account_id')
                .eq('id', clientId)
                .single()

            if (error) throw error
            setClientUnipileId(data?.unipile_account_id || null)
            setClientName(data?.name || 'Cliente')
        } catch (error) {
            console.error('Error fetching client details:', error)
            setClientUnipileId(null)
            setClientName('')
        } finally {
            setClientLoading(false)
        }
    }

    const handleTargetClientChange = (e) => {
        const newId = e.target.value
        setTargetClientId(newId)
        fetchClientDetails(newId)
    }

    const fetchLists = async () => {
        setLoading(true)
        try {
            const { data, error } = await supabase
                .from('campaigns')
                .select('*')
                .eq('client_id', selectedClientId)
                .order('created_at', { ascending: false })

            if (error) throw error
            setLists(data || [])
        } catch (error) {
            console.error('Error fetching lists:', error)
        } finally {
            setLoading(false)
        }
    }

    const handleCreateList = async (e) => {
        e.preventDefault()
        if (!newListName.trim() || !clientUnipileId || !targetClientId) return

        setCreateLoading(true)
        try {
            const { data, error } = await supabase
                .from('campaigns')
                .insert([{
                    name: newListName,
                    status: 'EMPTY',
                    client_id: targetClientId,
                    account_id: clientUnipileId
                }])
                .select()

            if (error) throw error

            if (data) {
                // Only update list state if created for current view context
                if (targetClientId == selectedClientId) {
                    setLists([data[0], ...lists])
                } else {
                    alert('Campanha criada para outro cliente. Troque de cliente para visualizar.')
                }
                setIsCreateModalOpen(false)
                setNewListName('')
            }
        } catch (error) {
            console.error('Error creating campaign:', error)
            alert('Erro ao criar campanha: ' + error.message)
        } finally {
            setCreateLoading(false)
        }
    }

    const handlePullLeads = async (e, list) => {
        e.stopPropagation() // Prevent row click

        if (!clientUnipileId) {
            alert('Este cliente n√£o possui um ID da Unipile configurado. Configure em "Gerenciar Clientes".')
            return
        }

        try {
            const response = await fetch('https://n8n-n8n-start.kfocge.easypanel.host/webhook/pull-leads-placeholder', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    campaign_id: list.id,
                    client_id: selectedClientId,
                    unipile_account_id: clientUnipileId
                })
            })

            if (response.ok) {
                alert('Solicita√ß√£o de leads enviada com sucesso!')
            } else {
                alert('Erro ao solicitar leads.')
            }
        } catch (error) {
            console.error(error)
            alert('Erro de conex√£o ao solicitar leads.')
        }
    }

    const filteredLists = lists.filter(l =>
        l.name.toLowerCase().includes(searchTerm.toLowerCase())
    )

    // AGENCY LOCK: Block view if no client is selected
    if (!selectedClientId) {
        return (
            <div className="min-h-screen bg-slate-50 p-6 md:p-8 font-sans text-slate-800 flex items-center justify-center">
                <div className="text-center max-w-md">
                    <div className="bg-white p-6 rounded-full inline-flex mb-6 shadow-sm border border-slate-100">
                        <Building size={48} className="text-slate-300" />
                    </div>
                    <h2 className="text-2xl font-bold text-slate-800 mb-3">Selecione um Cliente</h2>
                    <p className="text-slate-500 text-lg leading-relaxed">
                        Voc√™ precisa selecionar um cliente no menu superior para visualizar ou criar listas de prospec√ß√£o.
                    </p>
                </div>
            </div>
        )
    }

    return (
        <div className="min-h-screen bg-slate-50 p-6 md:p-8 font-sans text-slate-800">
            {/* HEADER */}
            <div className="max-w-7xl mx-auto mb-10">
                <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-8">
                    <div>
                        <h1 className="text-3xl font-bold text-slate-900 tracking-tight mb-2">Campanhas e Listas</h1>
                        <p className="text-slate-500 text-lg">Gerencie suas campanhas de prospec√ß√£o.</p>
                    </div>
                    <button
                        onClick={() => setIsCreateModalOpen(true)}
                        className="flex items-center gap-2 px-5 py-2.5 rounded-xl bg-indigo-600 text-white font-bold hover:bg-indigo-700 transition-all shadow-lg shadow-indigo-100"
                    >
                        <Plus size={20} /> Nova Campanha
                    </button>
                </div>

                {/* CONTROLS */}
                <div className="bg-white p-4 rounded-xl border border-slate-200 shadow-sm mb-6 flex flex-col md:flex-row justify-between items-center gap-4">
                    <div className="relative w-full md:w-96">
                        <Search className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400" size={18} />
                        <input
                            type="text"
                            placeholder="Buscar campanhas..."
                            value={searchTerm}
                            onChange={e => setSearchTerm(e.target.value)}
                            className="w-full pl-10 pr-4 py-2.5 bg-slate-50 border border-slate-200 rounded-lg text-slate-800 focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 transition-all font-medium placeholder:text-slate-400"
                        />
                    </div>
                </div>

                {/* LIST TABLE */}
                {loading || clientLoading ? (
                    <div className="py-20 flex justify-center text-gray-400">
                        <Loader2 className="animate-spin" size={32} />
                    </div>
                ) : filteredLists.length === 0 ? (
                    <div className="text-center py-20 bg-white rounded-2xl border border-gray-200 border-dashed">
                        <Users className="mx-auto text-gray-300 mb-4" size={48} />
                        <h3 className="text-lg font-bold text-slate-700 mb-2">Nenhuma campanha encontrada</h3>
                        <p className="text-gray-500 mb-6">Crie sua primeira campanha para come√ßar.</p>
                        <button
                            onClick={() => setIsCreateModalOpen(true)}
                            className="px-5 py-2 rounded-lg bg-indigo-50 text-indigo-600 font-bold hover:bg-indigo-100 transition-colors"
                        >
                            Criar Campanha
                        </button>
                    </div>
                ) : (
                    <div className="bg-white border border-slate-200 rounded-xl shadow-sm overflow-hidden">
                        <table className="w-full text-left border-collapse">
                            <thead>
                                <tr className="bg-slate-50 border-b border-slate-200 text-xs font-bold text-slate-500 uppercase tracking-wider">
                                    <th className="py-4 px-6">Nome da Campanha</th>
                                    <th className="py-4 px-6">Status</th>
                                    <th className="py-4 px-6">Criado em</th>
                                    <th className="py-4 px-6 text-right">A√ß√£o</th>
                                </tr>
                            </thead>
                            <tbody className="divide-y divide-gray-100">
                                {filteredLists.map(list => (
                                    <tr
                                        key={list.id}
                                        className="hover:bg-slate-50 transition-colors cursor-pointer group"
                                        onClick={() => navigate(`/campaigns/${list.id}/leads`)}
                                    >
                                        <td className="py-4 px-6">
                                            <div className="font-bold text-slate-900">{list.name}</div>
                                        </td>
                                        <td className="py-4 px-6">
                                            <span className={`px-2.5 py-1 rounded-full text-xs font-bold uppercase tracking-wide border ${list.status === 'READY' ? 'bg-green-50 text-green-600 border-green-100' :
                                                list.status === 'PROCESSING' ? 'bg-blue-50 text-blue-600 border-blue-100 animate-pulse' :
                                                    'bg-gray-100 text-gray-500 border-gray-200'
                                                }`}>
                                                {list.status || 'Rascunho'}
                                            </span>
                                        </td>
                                        <td className="py-4 px-6 text-slate-500 text-sm">
                                            {new Date(list.created_at).toLocaleDateString()}
                                        </td>
                                        <td className="py-4 px-6 text-right flex items-center justify-end gap-3">
                                            <button
                                                onClick={(e) => handlePullLeads(e, list)}
                                                className={`flex items-center gap-1.5 px-3 py-1.5 rounded-lg font-bold text-xs transition-colors border ${clientUnipileId
                                                    ? 'bg-blue-50 text-blue-600 hover:bg-blue-100 border-blue-200'
                                                    : 'bg-gray-100 text-gray-400 cursor-not-allowed border-gray-200'
                                                    }`}
                                                title={clientUnipileId ? "Puxar Leads do LinkedIn" : "Cliente sem ID Unipile configurado"}
                                                disabled={!clientUnipileId}
                                            >
                                                <RefreshCw size={14} /> Puxar Leads
                                            </button>
                                            <ArrowRight size={18} className="text-gray-300 group-hover:text-indigo-600 transition-colors" />
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                )}
            </div>

            {/* CREATE MODAL */}
            {isCreateModalOpen && (
                <div className="fixed inset-0 z-50 flex items-center justify-center bg-slate-900/50 backdrop-blur-sm p-4">
                    <div className="bg-white w-full max-w-md rounded-2xl shadow-2xl overflow-hidden animate-scale-in">
                        <div className="p-6 border-b border-gray-100">
                            <h2 className="text-xl font-bold text-slate-800">Nova Campanha</h2>
                            <p className="text-sm text-gray-500 mt-1">D√™ um nome para sua nova campanha de prospec√ß√£o.</p>
                        </div>
                        <form onSubmit={handleCreateList} className="p-6">
                            <div className="mb-4">
                                <label className="block text-sm font-bold text-slate-700 mb-2">Nome da Campanha</label>
                                <input
                                    autoFocus
                                    type="text"
                                    value={newListName}
                                    onChange={e => setNewListName(e.target.value)}
                                    placeholder="Ex: Prospec√ß√£o LinkedIn - CEOs"
                                    className="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl text-slate-800 focus:outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 transition-all font-medium"
                                />
                            </div>

                            <div className="mb-6">
                                <label className="block text-sm font-bold text-slate-700 mb-2">Cliente da Campanha</label>
                                <div className="space-y-3">
                                    <select
                                        value={targetClientId || ''}
                                        onChange={handleTargetClientChange}
                                        className="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl text-slate-800 focus:outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 transition-all font-medium appearance-none"
                                    >
                                        <option value="" disabled>Selecione o Cliente...</option>
                                        {allClients.map(client => (
                                            <option key={client.id} value={client.id}>
                                                {client.name}
                                            </option>
                                        ))}
                                    </select>

                                    {targetClientId && (
                                        clientUnipileId ? (
                                            <div className="flex items-center gap-3 p-3 bg-green-50 text-green-700 rounded-lg border border-green-200 animate-fade-in">
                                                <CheckCircle2 size={20} className="shrink-0" />
                                                <div className="text-sm">
                                                    <p className="font-bold">Conta Conectada</p>
                                                    <p className="text-xs mt-0.5">ID: {clientUnipileId}</p>
                                                </div>
                                            </div>
                                        ) : (
                                            <div className="flex items-center gap-3 p-3 bg-red-50 text-red-700 rounded-lg border border-red-200 animate-fade-in">
                                                <AlertTriangle size={20} className="shrink-0" />
                                                <div className="text-sm">
                                                    <p className="font-bold">Cliente sem conex√£o</p>
                                                    <p className="text-xs mt-0.5">
                                                        Este cliente n√£o possui um ID conectado.
                                                        <br />
                                                        V√° em <strong>Gerenciar Clientes</strong> para configurar.
                                                    </p>
                                                </div>
                                            </div>
                                        )
                                    )}
                                </div>
                            </div>

                            <div className="flex gap-3 justify-end">
                                <button
                                    type="button"
                                    onClick={() => setIsCreateModalOpen(false)}
                                    className="px-5 py-2.5 rounded-xl text-slate-600 font-bold hover:bg-gray-100 transition-colors"
                                >
                                    Cancelar
                                </button>
                                <button
                                    type="submit"
                                    disabled={!newListName.trim() || !clientUnipileId || createLoading}
                                    className="px-5 py-2.5 rounded-xl bg-indigo-600 text-white font-bold hover:bg-indigo-700 transition-all shadow-lg shadow-indigo-200 disabled:opacity-70 disabled:cursor-not-allowed flex items-center gap-2"
                                >
                                    {createLoading && <Loader2 className="animate-spin" size={18} />}
                                    Criar Campanha
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            )}
        </div>
    )
}

export default ListsPage

```

---

## Arquivo: src\pages\Login.css
```css
/* 
  DEPRECATED: Styles have been moved to Tailwind classes in Login.jsx
  as part of the Obsidian Glass visual overhaul.
*/
```

---

## Arquivo: src\pages\Login.jsx
```jsx
import React, { useState } from 'react';
import { useAuth } from '../contexts/AuthContext';
import { useNavigate } from 'react-router-dom';
import { Loader2, Lock, ArrowRight, ShieldCheck, Mail } from 'lucide-react';

const Login = () => {
    const [email, setEmail] = useState('');
    const [password, setPassword] = useState('');
    const [loading, setLoading] = useState(false);
    const [error, setError] = useState('');
    const { signIn } = useAuth();
    const navigate = useNavigate();

    const handleLogin = async (e) => {
        e.preventDefault();
        setLoading(true);
        setError('');

        try {
            await signIn(email, password);
            navigate('/');
        } catch (err) {
            setError('Falha ao entrar. Verifique suas credenciais.');
            console.error(err);
        } finally {
            setLoading(false);
        }
    };

    return (
        <div className="min-h-screen bg-obsidian flex items-center justify-center p-4 relative overflow-hidden">

            {/* AMBIENT BACKGROUND */}
            <div className="fixed top-[-20%] left-[-10%] w-[600px] h-[600px] bg-primary/20 blur-[120px] rounded-full pointer-events-none z-0" />
            <div className="fixed bottom-[-20%] right-[-10%] w-[600px] h-[600px] bg-blue-600/10 blur-[120px] rounded-full pointer-events-none z-0" />

            <div className="bg-charcoal/80 backdrop-blur-xl border border-glass-border p-8 w-full max-w-md rounded-2xl relative z-10 shadow-2xl animate-fade-in-up">

                {/* HEADER */}
                <div className="flex flex-col items-center mb-8">
                    <div className="w-16 h-16 rounded-2xl bg-gradient-to-br from-gray-800 to-black border border-glass-border flex items-center justify-center mb-6 shadow-inner">
                        <img src="/logo-linklead.png" alt="Link&Lead" className="w-10 h-auto opacity-90" />
                    </div>
                    <h1 className="text-2xl font-bold text-white mb-2">Bem-vindo de volta</h1>
                    <p className="text-gray-400 text-sm text-center">Acesse o painel de aprova√ß√µes Link&Lead</p>
                </div>

                <form onSubmit={handleLogin} className="space-y-6">
                    <div className="space-y-2">
                        <label className="text-sm font-medium text-gray-400 ml-1">Email Corporativo</label>
                        <div className="relative group">
                            <div className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 group-focus-within:text-primary transition-colors">
                                <Mail size={18} />
                            </div>
                            <input
                                type="email"
                                value={email}
                                onChange={(e) => setEmail(e.target.value)}
                                placeholder="seu@email.com"
                                className="w-full bg-white/5 border border-glass-border rounded-xl pl-10 pr-4 py-3 text-white placeholder-gray-600 focus:outline-none focus:border-primary/50 focus:ring-1 focus:ring-primary/50 transition-all font-medium"
                                required
                            />
                        </div>
                    </div>

                    <div className="space-y-2">
                        <label className="text-sm font-medium text-gray-400 ml-1">Senha</label>
                        <div className="relative group">
                            <div className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 group-focus-within:text-primary transition-colors">
                                <Lock size={18} />
                            </div>
                            <input
                                type="password"
                                value={password}
                                onChange={(e) => setPassword(e.target.value)}
                                placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                                className="w-full bg-white/5 border border-glass-border rounded-xl pl-10 pr-4 py-3 text-white placeholder-gray-600 focus:outline-none focus:border-primary/50 focus:ring-1 focus:ring-primary/50 transition-all font-medium"
                                required
                            />
                        </div>
                    </div>

                    {error && (
                        <div className="p-3 bg-red-500/10 border border-red-500/20 rounded-lg text-red-400 text-sm text-center">
                            {error}
                        </div>
                    )}

                    <button
                        type="submit"
                        disabled={loading}
                        className="w-full btn-primary py-3.5 text-base shadow-lg shadow-primary/20 hover:shadow-primary/40"
                    >
                        {loading ? (
                            <Loader2 className="animate-spin" size={20} />
                        ) : (
                            <>Entrar na Plataforma <ArrowRight size={20} /></>
                        )}
                    </button>
                </form>

                <div className="mt-8 pt-6 border-t border-glass-border text-center">
                    <div className="flex items-center justify-center gap-2 text-xs text-gray-500 font-medium">
                        <ShieldCheck size={14} className="text-primary/60" />
                        Protegido por Link&Lead Security
                    </div>
                </div>
            </div>
        </div>
    );
};

export default Login;

```

---

## Arquivo: src\pages\MissionsPage.jsx
```jsx
import React, { useState, useEffect, useMemo } from 'react'
import { supabase } from '../services/supabaseClient'
import { useAuth } from '../contexts/AuthContext'
import { useClientSelection } from '../contexts/ClientSelectionContext'
import {
    Crosshair,
    Flame,
    Target,
    Trophy,
    PartyPopper,
    Loader2,
    RefreshCw
} from 'lucide-react'
import MissionCard from '../components/MissionCard'

const MissionsPage = () => {
    const { user } = useAuth()
    const { selectedClientId } = useClientSelection()

    const [pendingTasks, setPendingTasks] = useState([])
    const [doneCount, setDoneCount] = useState(0)
    const [loading, setLoading] = useState(true)
    const [refreshing, setRefreshing] = useState(false)

    const fetchTasks = async (isRefresh = false) => {
        if (!user?.id) return
        if (isRefresh) setRefreshing(true)
        else setLoading(true)

        try {
            let pendingQuery = supabase
                .from('tasks')
                .select('*, leads(nome, headline, avatar_url, last_cadence_level, icp_score)')
                .eq('status', 'PENDING')
                .order('priority', { ascending: true })
                .order('days_overdue', { ascending: false })

            if (selectedClientId) {
                pendingQuery = pendingQuery.eq('client_id', selectedClientId)
            }

            let doneQuery = supabase
                .from('tasks')
                .select('id', { count: 'exact', head: true })
                .eq('status', 'DONE')

            if (selectedClientId) {
                doneQuery = doneQuery.eq('client_id', selectedClientId)
            }

            const [pendingResult, doneResult] = await Promise.all([pendingQuery, doneQuery])

            if (pendingResult.error) throw pendingResult.error

            setPendingTasks(pendingResult.data || [])
            setDoneCount(doneResult.count || 0)
        } catch (err) {
            console.error('Error fetching missions:', err)
        } finally {
            setLoading(false)
            setRefreshing(false)
        }
    }

    useEffect(() => {
        fetchTasks()
    }, [user?.id, selectedClientId])

    const { highPriority, normal } = useMemo(() => {
        const high = []
        const norm = []

        pendingTasks.forEach(task => {
            if (
                task.priority === 'CRITICAL' ||
                task.priority === 'HIGH' ||
                (task.days_overdue && task.days_overdue > 2)
            ) {
                high.push(task)
            } else {
                norm.push(task)
            }
        })

        return { highPriority: high, normal: norm }
    }, [pendingTasks])

    const totalMissions = pendingTasks.length + doneCount
    const progressPercent = totalMissions > 0 ? Math.round((doneCount / totalMissions) * 100) : 0
    const allDone = pendingTasks.length === 0 && !loading

    const getGreeting = () => {
        const hour = new Date().getHours()
        if (hour < 12) return 'Bom dia'
        if (hour < 18) return 'Boa tarde'
        return 'Boa noite'
    }

    const highPriorityCount = highPriority.length

    if (loading) {
        return (
            <div className="min-h-screen bg-obsidian text-white flex items-center justify-center">
                <div className="flex flex-col items-center gap-4">
                    <Loader2 className="w-8 h-8 animate-spin text-primary" />
                    <span className="tracking-wide uppercase text-xs font-bold text-gray-400">Carregando miss√µes...</span>
                </div>
            </div>
        )
    }

    return (
        <div className="min-h-screen bg-obsidian text-white p-4 sm:p-6 lg:p-8 relative overflow-hidden">
            {/* Background accent glow (same pattern as AdminPanel) */}
            <div className="fixed top-20 right-20 w-96 h-96 bg-primary/10 blur-[100px] rounded-full pointer-events-none z-0" />

            <div className="relative z-10 max-w-4xl mx-auto">

                {/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */}
                {/* GAMIFIED HEADER                        */}
                {/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */}
                <div className="glass-panel rounded-2xl p-5 sm:p-6 mb-8 relative overflow-hidden">
                    {/* Top: Icon + Greeting */}
                    <div className="flex items-start justify-between gap-4 mb-5">
                        <div className="flex items-center gap-3">
                            <div className="w-10 h-10 rounded-xl bg-primary/10 border border-primary/20 flex items-center justify-center">
                                <Crosshair size={20} className="text-primary" />
                            </div>
                            <div>
                                <h1 className="text-2xl sm:text-3xl font-bold tracking-tight text-white mb-1">
                                    {getGreeting()}! üéØ
                                </h1>
                                <p className="text-sm text-gray-400">
                                    {highPriorityCount > 0
                                        ? <>Voc√™ tem <span className="text-red-400 font-semibold">{highPriorityCount} miss√£o(√µes) urgente(s)</span> hoje.</>
                                        : pendingTasks.length > 0
                                            ? <>{pendingTasks.length} miss√µes aguardando execu√ß√£o.</>
                                            : 'Nenhuma miss√£o pendente!'
                                    }
                                </p>
                            </div>
                        </div>

                        {/* Refresh */}
                        <button
                            onClick={() => fetchTasks(true)}
                            disabled={refreshing}
                            className="p-2 rounded-lg hover:bg-white/10 transition-colors text-gray-500 hover:text-white"
                            title="Atualizar miss√µes"
                        >
                            <RefreshCw size={16} className={refreshing ? 'animate-spin' : ''} />
                        </button>
                    </div>

                    {/* Progress Bar */}
                    <div className="space-y-2">
                        <div className="flex items-center justify-between">
                            <span className="text-xs font-medium text-gray-500 uppercase tracking-wider">Progresso do dia</span>
                            <span className="text-sm font-bold text-gray-300">
                                {doneCount}/{totalMissions} conclu√≠das
                            </span>
                        </div>
                        <div className="h-3 bg-white/[0.05] rounded-full overflow-hidden border border-white/[0.08]">
                            <div
                                className="h-full rounded-full transition-all duration-700 ease-out"
                                style={{
                                    width: `${progressPercent}%`,
                                    background: progressPercent === 100
                                        ? 'linear-gradient(90deg, #10b981, #34d399)'
                                        : 'linear-gradient(90deg, #ff4d00, #ff8800)',
                                    boxShadow: progressPercent === 100
                                        ? '0 0 16px rgba(16, 185, 129, 0.6)'
                                        : '0 0 16px rgba(255, 77, 0, 0.5)',
                                }}
                            />
                        </div>
                    </div>
                </div>

                {/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */}
                {/* EMPTY STATE                            */}
                {/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */}
                {allDone && (
                    <div className="glass-panel rounded-2xl p-10 sm:p-16 text-center">
                        <div className="flex justify-center mb-4">
                            <div className="w-16 h-16 rounded-2xl bg-emerald-900/30 border border-emerald-500/20 flex items-center justify-center">
                                {doneCount > 0
                                    ? <Trophy size={32} className="text-emerald-400" />
                                    : <PartyPopper size={32} className="text-emerald-400" />
                                }
                            </div>
                        </div>
                        <h2 className="text-xl font-bold text-white mb-2">
                            {doneCount > 0 ? 'Miss√µes Conclu√≠das! üèÜ' : 'Tudo em dia! üéâ'}
                        </h2>
                        <p className="text-sm text-gray-400 max-w-sm mx-auto">
                            {doneCount > 0
                                ? `Voc√™ completou ${doneCount} miss√µes hoje. Excelente trabalho!`
                                : 'Nenhuma miss√£o gerada no momento. Quando a IA identificar oportunidades, elas aparecer√£o aqui.'
                            }
                        </p>
                    </div>
                )}

                {/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */}
                {/* GROUP 1: HIGH PRIORITY                 */}
                {/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */}
                {highPriority.length > 0 && (
                    <section className="mb-8">
                        <div className="flex items-center gap-2 mb-3 px-1">
                            <Flame size={16} className="text-red-400" />
                            <h2 className="text-xs font-bold text-gray-400 tracking-widest uppercase">
                                Alta Prioridade
                            </h2>
                            <span className="text-[10px] font-bold px-2 py-0.5 rounded-full bg-red-900/40 text-red-400 border border-red-700/50">
                                {highPriority.length}
                            </span>
                        </div>
                        <div className="space-y-2">
                            {highPriority.map(task => (
                                <MissionCard key={task.id} task={task} isHighPriority />
                            ))}
                        </div>
                    </section>
                )}

                {/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */}
                {/* GROUP 2: DAILY TARGETS                 */}
                {/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */}
                {normal.length > 0 && (
                    <section className="mb-8">
                        <div className="flex items-center gap-2 mb-3 px-1">
                            <Target size={16} className="text-blue-400" />
                            <h2 className="text-xs font-bold text-gray-400 tracking-widest uppercase">
                                Miss√µes do Dia
                            </h2>
                            <span className="text-[10px] font-bold px-2 py-0.5 rounded-full bg-blue-900/40 text-blue-400 border border-blue-700/50">
                                {normal.length}
                            </span>
                        </div>
                        <div className="space-y-2">
                            {normal.map(task => (
                                <MissionCard key={task.id} task={task} />
                            ))}
                        </div>
                    </section>
                )}
            </div>
        </div>
    )
}

export default MissionsPage

```

---

## Arquivo: src\pages\PostFeedbackPage.css
```css
/* PostFeedbackPage.css */
@import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700&display=swap');

/* We will rely mostly on Tailwind in the JSX, but keeping some custom classes for specific components can be useful */
.spin {
    animation: spin 1s linear infinite;
}

@keyframes spin {
    from {
        transform: rotate(0deg);
    }

    to {
        transform: rotate(360deg);
    }
}
```

---

## Arquivo: src\pages\PostFeedbackPage.jsx
```jsx
import React, { useState, useEffect, useRef } from 'react'
import { useParams, useNavigate } from 'react-router-dom'
import { supabase } from '../services/supabaseClient'
import { useAuth } from '../contexts/AuthContext'
import { Send, Check, AlertTriangle, ArrowLeft, Loader2, Image as ImageIcon, MessageSquare, ThumbsUp, MessageCircle, MessageSquarePlus } from 'lucide-react'
import { pdfjs, Document, Page } from 'react-pdf'
import 'react-pdf/dist/Page/AnnotationLayer.css';
import 'react-pdf/dist/Page/TextLayer.css';

// Worker setup
pdfjs.GlobalWorkerOptions.workerSrc = `//unpkg.com/pdfjs-dist@${pdfjs.version}/build/pdf.worker.min.mjs`;

// Sub-component for PDF Carousel
const PdfCarousel = ({ url }) => {
  const [numPages, setNumPages] = useState(null);

  function onDocumentLoadSuccess({ numPages }) {
    setNumPages(numPages);
  }

  return (
    <Document file={url} onLoadSuccess={onDocumentLoadSuccess} className="flex gap-2">
      {Array.from(new Array(numPages), (el, index) => (
        <div key={`page_${index + 1}`} style={{ scrollSnapAlign: 'center', display: 'flex', justifyContent: 'center' }}>
          <Page
            pageNumber={index + 1}
            renderTextLayer={false}
            renderAnnotationLayer={false}
            height={600}
            canvasBackground="white"
          />
        </div>
      ))}
    </Document>
  );
}

// --- CUSTOM CSS STYLES (Vertical Feed + Compact Fixed Footer) ---
const pageStyles = `
  .feedback-page {
    min-height: 100vh;
    background-color: #f8fafc; /* Lighter background for better contrast */
    font-family: 'Montserrat', system-ui, sans-serif;
    color: #1f2937;
    /* Extra padding at bottom to prevent footer overlap */
    padding-bottom: 160px; 
  }
  
  .page-container {
    max-width: 700px;
    margin: 0 auto;
    padding: 1rem;
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  /* Navigation */
  .back-nav {
    margin-bottom: 0.5rem;
  }
  .btn-back {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: #64748b;
    font-size: 0.875rem;
    font-weight: 600;
    background: none;
    border: none;
    cursor: pointer;
    transition: color 0.2s;
  }
  .btn-back:hover { color: #0f172a; }

  /* SECTION 1: POST PREVIEW CARD */
  .post-preview-card {
    background: white;
    border-radius: 16px;
    box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05);
    overflow: hidden;
    border: 1px solid #e2e8f0;
  }

  .preview-header {
    padding: 1rem 1.25rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    border-bottom: 1px solid #f8fafc;
  }
  .preview-avatar {
    width: 44px;
    height: 44px;
    border-radius: 50%;
    background: #f1f5f9;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    color: #64748b;
    font-size: 1.1rem;
  }
  .preview-meta h3 {
    margin: 0;
    font-size: 1rem;
    font-weight: 700;
    color: #0f172a;
  }
  .preview-subtext {
    margin: 0;
    font-size: 0.75rem;
    color: #64748b;
  }

  /* Status Banner inside Post Card */
  .status-banner {
    padding: 0.4rem 0.8rem;
    font-size: 0.7rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    border-radius: 99px;
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .status-approved { background: #dcfce7; color: #166534; }
  .status-pending { background: #fef9c3; color: #854d0e; }
  .status-changes { background: #ffedd5; color: #9a3412; }

  .post-content-text {
    padding: 1.25rem;
    white-space: pre-wrap;
    font-size: 0.95rem;
    line-height: 1.6;
    color: #334155;
  }

  .post-media {
    width: 100%;
    background: #000;
  }
  .post-media img {
    width: 100%;
    height: auto;
    display: block;
    max-height: 600px;
    object-fit: contain; /* Contain ensures full image visible */
  }
  .media-placeholder {
    background: #f8fafc;
    padding: 4rem;
    text-align: center;
    color: #94a3b8;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  /* Mock Social Actions Footer */
  .social-footer {
    padding: 0.75rem 1.25rem;
    display: flex;
    gap: 1.5rem;
    border-top: 1px solid #e2e8f0;
    color: #64748b;
    background: #fff;
  }
  .mock-action {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 0.8rem;
    font-weight: 600;
    cursor: default;
  }

  /* SECTION 2: FEEDBACK UI (Vertical below post) */
  .feedback-section {
    /* No visual container styles needed as it's just the messages */
    display: flex;
    flex-direction: column;
    gap: 1rem;
    margin-top: 1rem;
  }
  
  .feedback-title {
    font-size: 0.9rem;
    font-weight: 700;
    color: #64748b;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-left: 0.5rem;
  }

  .chat-scroll {
    /* Remove max-height so it flows naturally with the page */
    display: flex;
    flex-direction: column;
    gap: 1rem;
    padding-bottom: 2rem; /* Extra buffer */
  }

  .message-row {
    display: flex;
    flex-direction: column;
    max-width: 85%;
  }
  .row-admin { align-self: flex-end; align-items: flex-end; }
  .row-client { align-self: flex-start; }

  .chat-bubble {
    padding: 0.75rem 1rem;
    border-radius: 16px;
    font-size: 0.95rem;
    line-height: 1.5;
    position: relative;
    box-shadow: 0 1px 2px rgba(0,0,0,0.05);
  }
  .bubble-admin {
    background: #3b82f6; 
    color: white;
    border-bottom-right-radius: 4px;
  }
  .bubble-client {
    background: white;
    border: 1px solid #e2e8f0;
    color: #1e293b;
    border-top-left-radius: 4px;
  }

  .chat-meta {
    font-size: 0.7rem;
    color: #94a3b8;
    margin-top: 4px;
    padding: 0 4px;
  }

  /* --- FIXED BOTTOM ACTION BAR --- */
  .fixed-footer {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-top: 1px solid #e2e8f0;
    box-shadow: 0 -4px 6px -1px rgba(0,0,0,0.05);
    z-index: 1000;
    padding: 0.75rem 1rem;
  }

  .footer-content {
    max-width: 700px;
    margin: 0 auto;
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }

  /* Input Row */
  .input-wrapper {
    display: flex;
    gap: 0.5rem;
    background: #f1f5f9;
    padding: 0.25rem 0.25rem 0.25rem 1rem;
    border-radius: 99px;
    align-items: center;
  }
  .chat-input {
    flex: 1;
    border: none;
    background: transparent;
    padding: 0.5rem 0;
    outline: none;
    font-size: 0.9rem;
    color: #334155;
  }
  .btn-send {
    background: #3b82f6;
    color: white;
    border: none;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: background 0.2s;
    flex-shrink: 0;
  }
  .btn-send:hover { background: #2563eb; }

  /* Buttons Row (Client Only) */
  .approval-actions {
    display: flex;
    gap: 0.75rem;
  }
  .btn-action {
    flex: 1;
    padding: 0.6rem;
    border-radius: 10px;
    font-weight: 600;
    font-size: 0.85rem;
    cursor: pointer;
    text-align: center;
    transition: transform 0.1s;
  }
  .btn-action:active { transform: scale(0.98); }

  .btn-approve {
    background: #16a34a;
    color: white;
    border: none;
    box-shadow: 0 2px 4px rgba(22, 163, 74, 0.2);
  }
  .btn-request {
    background: white;
    color: #475569;
    border: 1px solid #cbd5e1;
  }
  
  /* Upload Button Style */
  .upload-btn-overlay {
    position: absolute;
    bottom: 1rem;
    right: 1rem;
    background: rgba(0,0,0,0.7);
    color: white;
    padding: 0.5rem 1rem;
    border-radius: 99px;
    font-size: 0.75rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 6px;
    cursor: pointer;
    backdrop-filter: blur(4px);
  }
`

const PostFeedbackPage = () => {
  const { id } = useParams()
  const navigate = useNavigate()
  const { user, profile, loading: authLoading } = useAuth()
  const [post, setPost] = useState(null)
  const [comments, setComments] = useState([])
  const [loading, setLoading] = useState(true)
  const [messageText, setMessageText] = useState('')
  const [sending, setSending] = useState(false)
  const [uploading, setUploading] = useState(false)

  const commentsEndRef = useRef(null)
  const inputRef = useRef(null)

  const isAdmin = profile?.role === 'admin'
  // Magic Link Logic: If not admin, assume it's the client (Public Access)
  const isClient = !isAdmin

  useEffect(() => { commentsEndRef.current?.scrollIntoView({ behavior: 'smooth' }) }, [comments])

  useEffect(() => {
    if (!id) return
    const fetchData = async () => {
      try {
        const { data: postData } = await supabase.from('tabela_projetofred1').select('*').eq('id', id).single()
        setPost(postData)
        const { data: commentsData } = await supabase.from('post_comments').select('*').eq('post_id', id).order('created_at', { ascending: true })
        setComments(commentsData || [])
      } catch (err) { console.error(err) } finally { setLoading(false) }
    }
    fetchData()
    const channel = supabase.channel(`post_feed_${id}`).on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'post_comments', filter: `post_id=eq.${id}` }, (pl) => setComments(prev => [...prev, pl.new])).subscribe()
    return () => { supabase.removeChannel(channel) }
  }, [id])

  const handleQuoteParagraph = (text) => {
    const maxLen = 100
    const truncated = text.length > maxLen ? text.substring(0, maxLen) + '...' : text
    const quote = `> "${truncated}"\n\n`

    // Append or set message
    setMessageText(prev => (prev ? prev + '\n' + quote : quote))

    // Scroll and Focus
    commentsEndRef.current?.scrollIntoView({ behavior: 'smooth' })
    setTimeout(() => {
      inputRef.current?.focus()
    }, 300)
  }

  const handleSendMessage = async () => {
    if (!messageText.trim()) return
    setSending(true)
    try {
      const authorName = isAdmin ? 'Link&Lead' : (post?.nome_cliente || 'Cliente')

      const payload = {
        post_id: id,
        content: messageText,
        role: isAdmin ? 'admin' : 'client',
        author_name: authorName
        // user_id is NOT sent for guests/clients as it doesn't exist in the table schema or is optional
      }

      await supabase.from('post_comments').insert([payload])
      setMessageText('')
    } catch (err) { alert('Erro ao enviar.') } finally { setSending(false) }
  }

  const handleUpdateStatus = async (newStatus) => {
    if (!isClient) return

    let finalStatus = newStatus
    let successMessage = 'Post Aprovado! üöÄ'

    // Smart Approval Logic
    if (newStatus === 'APPROVED') {
      if (post.data_agendamento) {
        finalStatus = 'AGENDADO'
        const date = new Date(post.data_agendamento).toLocaleString('pt-BR')
        successMessage = `Post aprovado e agendado automaticamente para ${date}! üìÖ`
      } else {
        successMessage = 'Post aprovado! Aguardando defini√ß√£o de data pela ag√™ncia. ‚úÖ'
      }
    }

    try {
      await supabase.from('tabela_projetofred1').update({ status: finalStatus }).eq('id', id)
      setPost({ ...post, status: finalStatus })

      if (newStatus === 'APPROVED' || finalStatus === 'AGENDADO') {
        alert(successMessage)
      } else {
        inputRef.current?.focus()
      }
    } catch (err) { alert('Erro ao atualizar status.') }
  }

  const handleImageUpload = async (e) => {
    const file = e.target.files[0]
    if (!file) return
    setUploading(true)
    try {
      const fileName = `${id}_${Date.now()}_${file.name}`
      await supabase.storage.from('post-images').upload(fileName, file)
      const { data } = supabase.storage.from('post-images').getPublicUrl(fileName)

      // Save as array [url]
      const newImageArray = [data.publicUrl]

      await supabase.from('tabela_projetofred1').update({ sugestao_imagem: newImageArray }).eq('id', id)
      setPost({ ...post, sugestao_imagem: newImageArray })
    } catch (err) { alert('Erro no upload.') } finally { setUploading(false) }
  }

  if (authLoading || loading) return <div style={{ height: '100vh', display: 'flex', alignItems: 'center', justifyContent: 'center' }}><Loader2 className="animate-spin" /></div>
  if (!post) return <div>404 Post Not Found</div>

  const normalizedStatus = (post.status || '').toUpperCase()
  let statusObj = { cls: 'status-pending', txt: 'Pendente' }

  if (normalizedStatus === 'APPROVED' || normalizedStatus === 'APROVADO') {
    statusObj = { cls: 'status-approved', txt: 'Aprovado' }
  } else if (normalizedStatus === 'WAITING_APPROVAL' || normalizedStatus === 'PENDING') {
    statusObj = { cls: 'status-pending', txt: 'Aguardando Aprova√ß√£o' }
  } else if (normalizedStatus === 'CHANGES_REQUESTED' || normalizedStatus.includes('REVI')) {
    statusObj = { cls: 'status-changes', txt: 'Revis√£o Solicitada' }
  } else if (normalizedStatus === 'AGENDADO') {
    statusObj = { cls: 'status-approved', txt: 'Agendado' } // Reusing approved style for scheduled
  } else if (normalizedStatus === 'POSTADO') {
    statusObj = { cls: 'status-approved', txt: 'Publicado' }
  }

  // Helper to get array
  const images = Array.isArray(post.sugestao_imagem) ? post.sugestao_imagem : post.sugestao_imagem ? [post.sugestao_imagem] : []

  return (
    <div className="feedback-page">
      <style>{pageStyles}</style>

      <div className="page-container">
        <div className="back-nav">
          <button onClick={() => navigate(-1)} className="btn-back">
            <ArrowLeft size={16} /> Voltar
          </button>
        </div>

        {/* --- 1. POST PREVIEW (Top) --- */}
        <div className="post-preview-card">
          {/* Header */}
          <div className="preview-header">
            <div className="preview-avatar">
              {post.nome_cliente ? post.nome_cliente.charAt(0).toUpperCase() : 'C'}
            </div>
            <div className="preview-meta">
              <h3>{post.nome_cliente || 'Nome do Cliente'}</h3>
              <p className="preview-subtext">
                {post.data_agendamento
                  ? `Post Agendado para ${new Date(post.data_agendamento).toLocaleDateString('pt-BR')}`
                  : 'Post ainda n√£o agendado'
                }
              </p>
            </div>
            <div style={{ marginLeft: 'auto' }}>
              <div className={`status-banner ${statusObj.cls}`}>
                {statusObj.txt}
              </div>
            </div>
          </div>

          {/* Text Content */}
          <div className="post-content-text">
            {post.corpo_post && post.corpo_post.split(/\r?\n/).map((paragraph, idx) => {
              // If it's an empty line, render a small spacer to simulate a paragraph break
              if (!paragraph.trim()) return <div key={idx} style={{ height: '0.5rem' }} />

              return (
                <div key={idx} className="group relative p-1 -mx-1 hover:bg-gray-50 rounded transition-colors flex items-start">
                  <p className="flex-1 whitespace-pre-wrap leading-relaxed">{paragraph}</p>
                  <button
                    onClick={() => handleQuoteParagraph(paragraph)}
                    className="ml-2 opacity-0 group-hover:opacity-100 focus:opacity-100 transition-all text-blue-500 bg-white border border-blue-100 shadow-sm p-1 rounded-md hover:bg-blue-50 hover:text-blue-700 flex-shrink-0"
                    title="Citar este trecho"
                    style={{ marginTop: '0px' }}
                  >
                    <MessageSquarePlus size={14} />
                  </button>
                </div>
              )
            })}
          </div>

          {/* Media Content */}
          <div className="post-media" style={{ position: 'relative', background: '#000', minHeight: '300px', display: 'flex', alignItems: 'center', justifyContent: 'center', overflow: 'hidden' }}>
            {images.length > 0 ? (
              <div style={{ display: 'flex', overflowX: 'auto', width: '100%', scrollSnapType: 'x mandatory', gap: '4px' }}>
                {images.map((url, idx) => {
                  const isPdf = url.toLowerCase().includes('.pdf')
                  return (
                    <div
                      key={idx}
                      style={{
                        flex: '0 0 100%',
                        width: '100%',
                        height: '600px',
                        scrollSnapAlign: 'start',
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center',
                        background: '#f1f5f9'
                      }}
                    >
                      {isPdf ? (
                        <div style={{ width: '100%', height: '100%', overflowY: 'hidden', overflowX: 'auto', display: 'flex', scrollSnapType: 'x mandatory' }}>
                          <PdfCarousel url={url} />
                        </div>
                      ) : (
                        <img
                          src={url}
                          alt={`Slide ${idx}`}
                          style={{
                            width: '100%',
                            height: 'auto',
                            maxHeight: '600px',
                            objectFit: 'contain'
                          }}
                        />
                      )}
                    </div>
                  )
                })}
              </div>
            ) : (
              <div className="media-placeholder">
                <ImageIcon size={48} style={{ opacity: 0.3, marginBottom: 4 }} />
                <span>Sem imagem selecionada</span>
              </div>
            )}

            {isClient && (
              <label className="upload-btn-overlay">
                {uploading ? <Loader2 size={12} className="animate-spin" /> : <ImageIcon size={12} />}
                {uploading ? '...' : 'Alterar Imagem'}
                <input type="file" onChange={handleImageUpload} hidden disabled={uploading} />
              </label>
            )}
          </div>

          {/* Mock Footer */}
          <div className="social-footer">
            <div className="mock-action"><ThumbsUp size={16} /> Curtir</div>
            <div className="mock-action"><MessageCircle size={16} /> Comentar</div>
          </div>
        </div>

        {/* --- 2. FEEDBACK (Messages) --- */}
        <div className="feedback-section">
          <div className="feedback-title">Coment√°rios</div>
          <div className="chat-scroll">
            {comments.length === 0 && <div style={{ textAlign: 'center', color: '#cbd5e1', padding: '1rem', fontSize: '0.9rem' }}>Nenhum coment√°rio ainda.</div>}
            {comments.map((msg, i) => {
              const isAdminMsg = msg.role === 'admin'
              return (
                <div key={i} className={`message-row ${isAdminMsg ? 'row-admin' : 'row-client'}`}>
                  <div className={`chat-bubble ${isAdminMsg ? 'bubble-admin' : 'bubble-client'}`}>
                    {msg.content}
                  </div>
                  <div className="chat-meta">{msg.author_name} ‚Ä¢ {new Date(msg.created_at).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</div>
                </div>
              )
            })}
            <div ref={commentsEndRef}></div>
          </div>
        </div>
      </div>

      {/* --- 4. STICKY ACTION BAR (Client Only & Pending) --- */}
      {isClient && (normalizedStatus === 'WAITING_APPROVAL' || normalizedStatus === 'PENDING') && (
        <div className="fixed bottom-0 left-0 right-0 w-full bg-white border-t border-gray-200 z-50 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] mb-[70px]">
          <div className="max-w-[700px] mx-auto px-4 py-4 flex justify-between gap-4">
            <button
              className="flex-1 px-4 py-3 rounded-xl border border-gray-300 text-gray-600 font-bold text-sm hover:bg-gray-50 transition-colors"
              onClick={() => {
                commentsEndRef.current?.scrollIntoView({ behavior: 'smooth' })
                setTimeout(() => {
                  inputRef.current?.focus()
                  setMessageText("Solicito ajuste em: ")
                }, 300)
              }}
            >
              Solicitar Altera√ß√£o
            </button>

            <button
              className="flex-1 px-4 py-3 rounded-xl bg-green-600 text-white font-bold text-sm hover:bg-green-700 shadow-md transition-transform active:scale-95 flex items-center justify-center gap-2"
              onClick={() => handleUpdateStatus('APPROVED')}
            >
              Aprovar Post <Check size={18} />
            </button>
          </div>
        </div>
      )}

      {/* --- 5. ALWAYS VISIBLE CHAT FOOTER --- */}
      <div className="fixed-footer" style={{ zIndex: 40 }}>
        <div className="footer-content">
          <div className="input-wrapper">
            <input
              ref={inputRef}
              className="chat-input"
              placeholder="Digite sua mensagem..."
              value={messageText}
              onChange={e => setMessageText(e.target.value)}
              onKeyDown={e => e.key === 'Enter' && handleSendMessage()}
            />
            <button className="btn-send" onClick={handleSendMessage} disabled={sending || !messageText.trim()}>
              {sending ? <Loader2 size={16} className="animate-spin" /> : <Send size={16} />}
            </button>
          </div>
        </div>
      </div>

      {/* Helper Spacer to prevent content from being hidden behind footer */}
      <div style={{ height: '100px' }}></div>
    </div>
  )
}

export default PostFeedbackPage

```

---

## Arquivo: src\pages\PostsPage.css
```css
:root {
  --primary-color: #0f172a;
  --accent-color: #2563eb;
  --sidebar-w: 200px;
  --header-h: 60px;
  --bg-body: #f1f5f9;
  --border-color: #e2e8f0;
}

body {
  background-color: var(--bg-body);
}

.dashboard-layout {
  display: flex;
  min-height: 100vh;
}

/* SIDEBAR */
.sidebar {
  width: var(--sidebar-w);
  background: white;
  border-right: 1px solid var(--border-color);
  display: flex;
  flex-direction: column;
  position: fixed;
  height: 100vh;
  left: 0;
  top: 0;
  z-index: 100;
}

.logo-area {
  padding: 1rem;
  border-bottom: 1px solid var(--border-color);
}

.logo-area h2 {
  margin: 0;
  font-size: 1.25rem;
  color: #0f172a;
}

.logo-area span {
  font-size: 0.8rem;
  color: #64748b;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.nav-menu {
  padding: 1rem 0.75rem;
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 0.35rem;
  overflow-y: auto;
  min-height: 0;
}

/* Scrollbar Styling for Sidebar */
.nav-menu::-webkit-scrollbar {
  width: 6px;
}

.nav-menu::-webkit-scrollbar-track {
  background: #f1f5f9;
  /* Light Gray */
}

.nav-menu::-webkit-scrollbar-thumb {
  background-color: #f97316;
  /* Orange */
  border-radius: 4px;
}

.nav-menu::-webkit-scrollbar-thumb:hover {
  background-color: #ea580c;
  /* Darker Orange */
}

.nav-item {
  display: flex;
  align-items: center;
  gap: 0.6rem;
  padding: 0.6rem 0.75rem;
  color: #64748b;
  text-decoration: none;
  border-radius: 6px;
  font-weight: 500;
  font-size: 0.875rem;
  transition: all 0.2s;
}

.nav-item:hover,
.nav-item.active {
  background-color: #eff6ff;
  color: var(--accent-color);
}

.sidebar-footer {
  padding: 1rem;
  border-top: 1px solid var(--border-color);
}

.btn-new-post {
  width: 100%;
  background-color: var(--accent-color);
  color: white;
  border: none;
  padding: 0.5rem;
  border-radius: 8px;
  font-weight: 600;
  font-size: 0.8rem;
  cursor: pointer;
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 0.4rem;
}

.btn-new-post:hover {
  background-color: #1d4ed8;
}

/* MAIN CONTENT */
.main-content {
  margin-left: var(--sidebar-w);
  flex: 1;
  width: calc(100% - var(--sidebar-w));
  min-height: 100vh;
  padding: 1rem 1.5rem;
  overflow-x: hidden;
  box-sizing: border-box;
}

.top-bar {
  margin-bottom: 2rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.top-bar h1 {
  margin: 0;
  font-size: 1.8rem;
  color: #0f172a;
}

.filters-bar {
  margin-bottom: 1.5rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.tabs {
  display: flex;
  gap: 0.5rem;
  background: white;
  padding: 0.25rem;
  border-radius: 8px;
  border: 1px solid var(--border-color);
}

.tab-btn {
  background: transparent;
  border: none;
  padding: 0.5rem 1rem;
  border-radius: 6px;
  color: #64748b;
  font-weight: 500;
  cursor: pointer;
}

.tab-btn.active {
  background-color: #e0f2fe;
  color: var(--accent-color);
}

/* TABLE MODERNIZATION */
.table-container {
  background: white;
  border-radius: 16px;
  /* Smooth rounded corners */
  border: 1px solid var(--border-color);
  overflow: hidden;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
  /* Modern soft shadow */
}

.posts-table {
  width: 100%;
  border-collapse: separate;
  /* Allow spacing for rows if needed */
  border-spacing: 0;
}

.posts-table th {
  background-color: #f8fafc;
  padding: 1rem 1.5rem;
  /* More breathing room */
  text-align: left;
  font-weight: 600;
  color: #64748b;
  border-bottom: 1px solid var(--border-color);
  font-size: 0.75rem;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.posts-table td {
  padding: 1rem 1.5rem;
  border-bottom: 1px solid #f1f5f9;
  /* Lighter border for rows */
  color: #334155;
  font-size: 0.875rem;
  vertical-align: middle;
}

.posts-table tr:last-child td {
  border-bottom: none;
}

.posts-table tr:hover {
  background-color: #f8fafc;
  /* Subtle hover effect */
  transition: background-color 0.2s ease;
}

.fw-500 {
  font-weight: 600;
  color: #0f172a;
}

/* COMPACT & MODERN BADGES */
.badge {
  padding: 0.25rem 0.75rem;
  border-radius: 6px;
  /* Slightly squared pill for modern look */
  font-size: 0.7rem;
  /* Smaller font */
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.02em;
  display: inline-flex;
  align-items: center;
  gap: 0.35rem;
  white-space: nowrap;
  /* Prevent wrapping essentially */
  line-height: 1;
  border: 1px solid transparent;
  /* Prepare for border styles */
}

/* Status: APROVADO */
.badge-success {
  background: #ecfdf5;
  /* Crisp mint */
  color: #059669;
  border-color: #d1fae5;
}

.badge-success::before {
  content: "‚óè";
  font-size: 0.6rem;
  color: #10b981;
}

/* Status: REVIS√ÉO / ALTERA√á√ÉO */
.badge-warning {
  background: #fffbeb;
  /* Soft amber */
  color: #b45309;
  border-color: #fef3c7;
}

.badge-warning::before {
  content: "‚óè";
  font-size: 0.6rem;
  color: #f59e0b;
}

/* Status: AGUARDANDO / PENDENTE */
.badge-info {
  background: #eff6ff;
  /* Soft blue */
  color: #0369a1;
  border-color: #dbeafe;
}

.badge-info::before {
  content: "‚óè";
  font-size: 0.6rem;
  color: #3b82f6;
}

/* Status: POSTADO */
.badge-purple {
  background: #faf5ff;
  /* Soft purple */
  color: #7e22ce;
  border-color: #f3e8ff;
}

.badge-purple::before {
  content: "‚óè";
  font-size: 0.6rem;
  color: #9333ea;
}

/* ACTION BUTTONS */
.actions-group {
  display: flex;
  gap: 0.5rem;
  align-items: center;
}

.icon-btn {
  background: white;
  border: 1px solid #e2e8f0;
  padding: 0.4rem;
  border-radius: 6px;
  cursor: pointer;
  color: #64748b;
  display: flex;
  /* Center icon */
  align-items: center;
  justify-content: center;
  transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
}

.icon-btn:hover {
  background-color: #f8fafc;
  border-color: #cbd5e1;
  color: #0f172a;
  transform: translateY(-1px);
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
}

.icon-btn.text-danger:hover {
  color: #ef4444;
  border-color: #fecaca;
  background-color: #fef2f2;
}

/* MODAL */
.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000;
  animation: fadeIn 0.2s ease-out;
}

.modal-content {
  background: white;
  padding: 2rem;
  border-radius: 12px;
  width: 100%;
  max-width: 500px;
  box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
  animation: slideUp 0.3s ease-out;
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1.5rem;
}

.modal-header h2 {
  margin: 0;
  font-size: 1.25rem;
}

.close-btn {
  background: none;
  border: none;
  cursor: pointer;
  color: #94a3b8;
}

.close-btn:hover {
  color: #0f172a;
}

@keyframes fadeIn {
  from {
    opacity: 0;
  }

  to {
    opacity: 1;
  }
}

@keyframes slideUp {
  from {
    transform: translateY(20px);
    opacity: 0;
  }

  to {
    transform: translateY(0);
    opacity: 1;
  }
}

.mini-preview {
  background: #f8fafc;
  padding: 1rem;
  border-radius: 8px;
  margin: 1rem 0;
  font-size: 0.9rem;
  color: #475569;
}

.modal-actions {
  display: flex;
  gap: 1rem;
  margin-top: 1.5rem;
}

.modal-actions button,
.modal-actions a {
  flex: 1;
  text-align: center;
}

/* Tooltip for Feedback */
.tooltip-container {
  position: relative;
  display: inline-block;
  margin-left: 0.5rem;
  vertical-align: middle;
}

.tooltip-text {
  visibility: hidden;
  width: 200px;
  background-color: #333;
  color: #fff;
  text-align: center;
  border-radius: 6px;
  padding: 8px;
  position: absolute;
  z-index: 1;
  bottom: 125%;
  left: 50%;
  margin-left: -100px;
  opacity: 0;
  transition: opacity 0.3s;
  font-size: 0.8rem;
  font-weight: normal;
  text-transform: none;
}

.tooltip-container:hover .tooltip-text {
  visibility: visible;
  opacity: 1;
}

.text-warning {
  color: #f59e0b;
  cursor: help;
}
```

---

## Arquivo: src\pages\PostsPage.jsx
```jsx
import React, { useState, useEffect } from 'react'
import { supabase } from '../services/supabaseClient'
import { useAuth } from '../contexts/AuthContext'
import { useSearchParams, Link, useNavigate } from 'react-router-dom'
import {
    Loader2,
    ExternalLink,
    FileText,
    Trash2,
    Link as LinkIcon,
    AlertCircle,
    Filter,
    Pencil,
    MessageCircle,
    CalendarClock
} from 'lucide-react'
import EditPostModal from '../components/EditPostModal'
import SchedulePostModal from '../components/SchedulePostModal'
import './PostsPage.css'

const PostsPage = () => {
    // Dashboard States
    // Helper for Status Translation
    const getStatusLabel = (status) => {
        if (!status) return 'Desconhecido'

        const map = {
            'WAITING_APPROVAL': 'Aguardando Aprova√ß√£o',
            'CHANGES_REQUESTED': 'Altera√ß√£o Solicitada',
            'APPROVED': 'Aprovado',
            'waiting_approval': 'Aguardando Aprova√ß√£o',
            'changes_requested': 'Altera√ß√£o Solicitada',
            'approved': 'Aprovado',
            'postado': 'Postado',
            'POSTADO': 'Postado',
            'AGENDADO': 'Agendado'
        }

        return map[status] || map[status.toUpperCase()] || map[status.toLowerCase()] || status
    }

    const { profile, loading: authLoading } = useAuth()
    const navigate = useNavigate()
    const [posts, setPosts] = useState([])
    const [loadingPosts, setLoadingPosts] = useState(true)
    const [statusFilter, setStatusFilter] = useState('Todos')
    const [editingPost, setEditingPost] = useState(null)
    const [schedulingPost, setSchedulingPost] = useState(null)
    const [searchParams] = useSearchParams()
    const clientFilter = searchParams.get('client')

    // Notifications State
    const [unreadCounts, setUnreadCounts] = useState({})

    // Stable Fetch Functions
    // Safe Mount Check
    const isMounted = React.useRef(true)
    useEffect(() => {
        return () => { isMounted.current = false }
    }, [])

    const fetchPosts = React.useCallback(async () => {
        setLoadingPosts(true)
        try {
            let query = supabase
                .from('tabela_projetofred1')
                .select('*')
                .order('id', { ascending: false })
                .range(0, 49) // Limit to last 50 items

            // Role-based filtering
            // IMPORTANT: If Admin, show ALL. If Client, show ONLY THEIRS.
            if (profile?.role === 'client') {
                if (profile.nome_empresa) {
                    query = query.eq('nome_cliente', profile.nome_empresa)
                } else {
                    console.warn('Cliente sem nome_empresa definido.')
                    setPosts([])
                    return
                }
            }
            // Admin gets standard "All Posts" query (unless client param exists for specific filter)
            if (clientFilter && clientFilter.trim() !== '') {
                query = query.eq('nome_cliente', clientFilter)
            }

            const { data, error } = await query
            if (error) throw error

            // BLINDAGEM: Se houver processamento de dados (ex: map), proteja-o
            // Normalize status strictly to Uppercase String or UNKNOWN
            const postsTratados = (data || []).map(post => ({
                ...post,
                status: post.status ? String(post.status).toUpperCase() : 'UNKNOWN'
            }));

            // FORCE STATE UPDATE - NO MOUNT CHECK
            setPosts(postsTratados);

        } catch (err) {
            console.error("Erro CR√çTICO no fetch ou processamento:", err);
        } finally {
            setLoadingPosts(false); // FOR√áAR REMO√á√ÉO DO SPINNER
        }
    }, [profile?.role, profile?.nome_empresa, clientFilter])

    const fetchUnreadMessages = React.useCallback(async () => {
        try {
            const { data, error } = await supabase
                .from('post_comments')
                .select('post_id')
                .eq('read_by_admin', false)
                .eq('role', 'client')

            if (error) throw error

            const counts = {}
            data.forEach(msg => {
                counts[msg.post_id] = (counts[msg.post_id] || 0) + 1
            })
            setUnreadCounts(counts)
        } catch (err) {
            console.error("Erro ao buscar notifica√ß√µes:", err)
        }
    }, [])

    useEffect(() => {
        if (!authLoading && profile) {
            // Initial Load
            fetchPosts()
            fetchUnreadMessages()

            // Realtime subscription (Cleanup enforced)
            const channel = supabase
                .channel('realtime:posts_and_comments')
                .on('postgres_changes', { event: '*', schema: 'public', table: 'tabela_projetofred1' }, () => {
                    fetchPosts()
                })
                .on('postgres_changes', { event: '*', schema: 'public', table: 'post_comments' }, () => {
                    fetchUnreadMessages()
                })
                .subscribe()

            return () => {
                supabase.removeChannel(channel)
            }
        }
    }, [authLoading, profile?.id, fetchPosts, fetchUnreadMessages]) // Primitive dependency + memozied functions



    const handleDelete = async (id) => {
        if (!window.confirm('Tem certeza que deseja excluir este post?')) return

        try {
            const { error } = await supabase
                .from('tabela_projetofred1')
                .delete()
                .eq('id', id)

            if (error) throw error
            setPosts(posts.filter(post => post.id !== id))
        } catch (err) {
            alert('Erro ao excluir: ' + err.message)
        }
    }

    const copyLink = (id) => {
        const url = `${window.location.origin}/aprovacao?id=${id}`
        navigator.clipboard.writeText(url)
        alert('Link copiado!')
    }

    const getStatusColor = (status) => {
        const s = (status || 'WAITING_APPROVAL').toUpperCase()
        if (s === 'APPROVED' || s === 'APROVADO' || s.includes('APPROV')) return 'badge-success'
        if (s === 'CHANGES_REQUESTED' || s.includes('CHANGE') || s.includes('REVI')) return 'badge-warning'
        if (s.includes('POSTADO')) return 'badge-purple'
        if (s === 'AGENDADO') return 'badge-purple' // Or another distinctive color like badge-primary
        return 'badge-info'
    }

    // Filter Logic
    const filteredPosts = posts.filter(post => {
        // 1. Client Filter (URL)
        if (clientFilter && clientFilter.trim() !== '' && post.nome_cliente !== clientFilter) return false

        // 2. Tab Filter
        if (statusFilter === 'Todos') return true

        const s = (post.status || 'WAITING_APPROVAL').toUpperCase()
        if (statusFilter === 'Pendentes') return s === 'WAITING_APPROVAL' || s.includes('WAITING')
        if (statusFilter === 'Aprovados') return s === 'APPROVED' || s.includes('APPROV')
        if (statusFilter === 'Revis√£o') return s === 'CHANGES_REQUESTED' || s.includes('REVI')
        return true
    })

    return (
        <div style={{ padding: '0' }}>
            <header className="top-bar">
                <div>
                    <h1>Meus Posts</h1>
                    {clientFilter && (
                        <span style={{ color: '#64748b', display: 'flex', alignItems: 'center', gap: '0.5rem', marginTop: '0.5rem' }}>
                            <Filter size={16} /> Filtrando por cliente: <strong>{clientFilter}</strong>
                            <Link to="/posts" style={{ color: '#2563eb', fontSize: '0.875rem', marginLeft: '0.5rem' }}>Limpar</Link>
                        </span>
                    )}
                </div>
                <div className="user-profile">
                    <span>Admin Ag√™ncia</span>
                </div>
            </header>

            <div className="filters-bar">
                <div className="tabs">
                    {['Todos', 'Pendentes', 'Aprovados', 'Revis√£o'].map(filter => (
                        <button
                            key={filter}
                            className={`tab-btn ${statusFilter === filter ? 'active' : ''}`}
                            onClick={() => setStatusFilter(filter)}
                        >
                            {filter}
                        </button>
                    ))}
                </div>
            </div>

            <div className="table-container">
                {loadingPosts ? (
                    <div className="loading-state">
                        <Loader2 className="spinner" /> Carregando posts...
                    </div>
                ) : (
                    <table className="posts-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Cliente</th>
                                <th>Tema</th>
                                <th>P√∫blico Alvo</th>
                                <th>Status</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody>
                            {filteredPosts.length > 0 ? (
                                filteredPosts.map(post => {
                                    const unreadCount = unreadCounts[post.id] || 0
                                    return (
                                        <tr key={post.id}>
                                            <td>#{post.id}</td>
                                            <td className="fw-500">
                                                <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                                                    {post.nome_cliente || 'N/A'}
                                                    {unreadCount > 0 && (
                                                        <span title={`${unreadCount} novas mensagens`} style={{
                                                            background: '#ef4444',
                                                            color: 'white',
                                                            fontSize: '0.7rem',
                                                            fontWeight: 'bold',
                                                            padding: '0.1rem 0.5rem',
                                                            borderRadius: '99px',
                                                            display: 'flex',
                                                            alignItems: 'center',
                                                            gap: '4px'
                                                        }}>
                                                            <MessageCircle size={10} fill="white" /> {unreadCount}
                                                        </span>
                                                    )}
                                                </div>
                                            </td>
                                            <td>{post.tema || 'Sem Tema'}</td>
                                            <td>{post.publico || '-'}</td>
                                            <td>
                                                <span className={`badge ${getStatusColor(post.status)}`}>
                                                    {getStatusLabel(post.status)}
                                                </span>
                                            </td>
                                            <td>
                                                <div className="actions-group">
                                                    <button
                                                        className="icon-btn"
                                                        title="Abrir Sala de Guerra"
                                                        onClick={() => navigate(`/post-feedback/${post.id}`)}
                                                        style={{ position: 'relative' }}
                                                    >
                                                        <ExternalLink size={18} />
                                                        {unreadCount > 0 && <span style={{ position: 'absolute', top: -2, right: -2, width: 8, height: 8, background: '#ef4444', borderRadius: '50%' }}></span>}
                                                    </button>
                                                    <button
                                                        className="icon-btn"
                                                        title="Editar Post"
                                                        onClick={() => setEditingPost(post)}
                                                    >
                                                        <Pencil size={18} />
                                                    </button>
                                                    <button
                                                        className="icon-btn"
                                                        title="Copiar Link"
                                                        onClick={() => copyLink(post.id)}
                                                    >
                                                        <LinkIcon size={18} />
                                                    </button>
                                                    <button
                                                        className="icon-btn text-danger"
                                                        title="Excluir"
                                                        onClick={() => handleDelete(post.id)}
                                                    >
                                                        <Trash2 size={18} />
                                                    </button>
                                                    <button
                                                        className="icon-btn"
                                                        title="Agendar Postagem"
                                                        onClick={() => setSchedulingPost(post)}
                                                        style={{ color: '#8b5cf6' }}
                                                    >
                                                        <CalendarClock size={18} />
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    )
                                })
                            ) : (
                                <tr>
                                    <td colSpan="6" style={{ textAlign: 'center', padding: '2rem', color: '#64748b' }}>
                                        Nenhum post encontrado.
                                    </td>
                                </tr>
                            )}
                        </tbody>
                    </table>
                )}
            </div>

            {editingPost && (
                <EditPostModal
                    post={editingPost}
                    onClose={() => setEditingPost(null)}
                    onSuccess={() => {
                        fetchPosts()
                        setEditingPost(null)
                    }}
                />
            )}

            {schedulingPost && (
                <SchedulePostModal
                    post={schedulingPost}
                    onClose={() => setSchedulingPost(null)}
                    onSuccess={() => {
                        fetchPosts()
                        setSchedulingPost(null)
                    }}
                />
            )}
        </div>
    )
}

export default PostsPage

```

---

## Arquivo: src\pages\SalesHub.css
```css
/* 
  DEPRECATED: Styles have been moved to Tailwind classes in SalesHubPage.jsx.
  Reverted to Light Theme (White/Orange) per user request.
*/
```

---

## Arquivo: src\pages\SalesHubPage.jsx
```jsx
import React, { useState, useEffect, useRef } from 'react'
import { supabase } from '../services/supabaseClient'
import { useClientSelection } from '../contexts/ClientSelectionContext'
import {
    Search,
    Filter,
    MessageCircle,
    X,
    Copy,
    RefreshCw,
    Loader2,
    Sparkles,
    Briefcase,
    MapPin,
    Hash,
    ArrowRight,
    Users,
    Zap,
    Gem,
    Building2,
    Globe,
    Send,
    CheckCircle2,
    XCircle,
    Bot
} from 'lucide-react'

const SalesHubPage = () => {
    const { selectedClientId } = useClientSelection()
    const [leads, setLeads] = useState([])
    const [loading, setLoading] = useState(false)
    const [selectedLead, setSelectedLead] = useState(null)
    const [searchTerm, setSearchTerm] = useState('')
    const [debouncedSearch, setDebouncedSearch] = useState('')
    const [stats, setStats] = useState({ total: 0, hot: 0, interactions: 0 })

    // Pagination State
    const [page, setPage] = useState(0)
    const [hasMore, setHasMore] = useState(true)
    const [loadingMore, setLoadingMore] = useState(false)
    const ITEMS_per_PAGE = 50

    // Sync Logic State
    const [syncLoading, setSyncLoading] = useState(false)
    const [enrichmentLoading, setEnrichmentLoading] = useState(false)
    const [notification, setNotification] = useState(null)

    // Strategy Logic State
    const [sendingMessage, setSendingMessage] = useState(false)
    const [messageDraft, setMessageDraft] = useState('')

    // Debounce Search
    useEffect(() => {
        const timer = setTimeout(() => {
            setDebouncedSearch(searchTerm)
        }, 500)
        return () => clearTimeout(timer)
    }, [searchTerm])

    useEffect(() => {
        if (selectedLead) {
            setMessageDraft(selectedLead.suggested_message || '')
        }
    }, [selectedLead])

    const handleSync = async () => {
        if (!selectedClientId) return
        setSyncLoading(true)

        try {
            const response = await fetch('https://n8n-n8n-start.kfocge.easypanel.host/webhook/sync-connections', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ client_id: selectedClientId })
            })

            if (response.ok) {
                setNotification({ message: 'A minera√ß√£o come√ßou! Os leads aparecer√£o na tela automaticamente.', type: 'info' })
            } else {
                setNotification({ message: 'Erro ao iniciar sincroniza√ß√£o (Webhook).', type: 'error' })
                setSyncLoading(false)
            }
        } catch (error) {
            console.error(error)
            setNotification({ message: 'Erro de conex√£o.', type: 'error' })
            setSyncLoading(false)
        }

        setTimeout(() => setNotification(null), 5000)
    }

    const handleEnrichment = async (singleLead = null) => {
        if (!selectedClientId) return
        setEnrichmentLoading(true)

        let leadsToProcess = []

        if (singleLead) {
            leadsToProcess = [singleLead]
            setNotification({ message: `Enviando ${singleLead.nome} para an√°lise...`, type: 'info' })
        } else {
            // Filter leads in current view that are not qualified yet
            leadsToProcess = leads.filter(l => !l.qualification_status)
            if (leadsToProcess.length === 0) {
                setNotification({ message: 'Todos os leads desta lista j√° foram analisados.', type: 'info' })
                setEnrichmentLoading(false)
                setTimeout(() => setNotification(null), 3000)
                return
            }
            setNotification({ message: `Enviando ${leadsToProcess.length} leads para an√°lise...`, type: 'info' })
        }


        try {
            // Loop and send requests
            let processedCount = 0

            for (const lead of leadsToProcess) {
                try {
                    await fetch('https://n8n-n8n-start.kfocge.easypanel.host/webhook-test/qualificacao-cascata', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            id: lead.id,
                            name: lead.nome,
                            headline: lead.headline,
                            summary: lead.summary || '',
                            company_name: lead.company || lead.empresa || '',
                            client_id: selectedClientId
                        })
                    })
                    processedCount++
                } catch (err) {
                    console.error(`Erro ao enviar lead ${lead.id}`, err)
                }
            }

            setNotification({ message: `Processo iniciado! ${processedCount} leads enviados para enriquecimento.`, type: 'success' })

        } catch (error) {
            console.error(error)
            setNotification({ message: 'Erro ao conectar com servidor de enriquecimento.', type: 'error' })
        } finally {
            setEnrichmentLoading(false)
            setTimeout(() => setNotification(null), 5000)
        }
    }

    const fetchStats = async () => {
        if (!selectedClientId) return

        try {
            const { count: totalCount } = await supabase
                .from('leads')
                .select('*', { count: 'exact', head: true })
                .eq('client_id', selectedClientId)

            const { count: hotCount } = await supabase
                .from('leads')
                .select('*', { count: 'exact', head: true })
                .eq('client_id', selectedClientId)
                .eq('icp_score', 'A')

            const sevenDaysAgo = new Date()
            sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7)

            const { count: interactionsCount } = await supabase
                .from('interactions')
                .select('*, leads!inner(client_id)', { count: 'exact', head: true })
                .eq('leads.client_id', selectedClientId)
                .gte('interaction_date', sevenDaysAgo.toISOString())

            setStats({
                total: totalCount || 0,
                hot: hotCount || 0,
                interactions: interactionsCount || 0
            })

        } catch (error) {
            console.error('Erro ao buscar KPIs:', error)
        }
    }

    useEffect(() => {
        if (selectedClientId) {
            setLeads([])
            setPage(0)
            setHasMore(true)
            fetchLeads(0, true)
            fetchStats()
        } else {
            setLeads([])
            setStats({ total: 0, hot: 0, interactions: 0 })
        }
    }, [selectedClientId, debouncedSearch])

    useEffect(() => {
        if (!selectedClientId) return
        const channel = supabase.channel('leads-changes')
            .on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'leads', filter: `client_id=eq.${selectedClientId}` }, () => {
                setNotification({ message: 'Novos leads encontrados!', type: 'success' })
                fetchLeads(0, true)
                fetchStats()
            })
            // Listen for UPDATES too (Enrichment coming back)
            .on('postgres_changes', { event: 'UPDATE', schema: 'public', table: 'leads', filter: `client_id=eq.${selectedClientId}` }, () => {
                // Determine if we should show toast? Maybe too noisy. Just refresh.
                fetchLeads(0, true)
                fetchStats()
            })
            .subscribe()
        return () => { supabase.removeChannel(channel) }
    }, [selectedClientId])

    const fetchLeads = async (pageIndex = 0, isRefresh = false) => {
        if (!selectedClientId) return

        try {
            if (pageIndex === 0) setLoading(true)
            else setLoadingMore(true)

            const from = pageIndex * ITEMS_per_PAGE
            const to = from + ITEMS_per_PAGE - 1

            let query = supabase
                .from('leads')
                .select('*', { count: 'exact' })
                .eq('client_id', selectedClientId)
                .range(from, to)

            if (debouncedSearch) {
                query = query.or(`nome.ilike.%${debouncedSearch}%,company.ilike.%${debouncedSearch}%,empresa.ilike.%${debouncedSearch}%`)
            }

            const { data, count, error } = await query.order('created_at', { ascending: false })

            if (error) throw error

            if (data) {
                if (isRefresh || pageIndex === 0) {
                    setLeads(data)
                } else {
                    setLeads(prev => [...prev, ...data])
                }

                if (pageIndex === 0 && count !== null) {
                    setStats(prev => ({ ...prev, total: count }))
                }

                setHasMore(data.length === ITEMS_per_PAGE)
            }
        } catch (err) {
            console.error(err)
        } finally {
            setLoading(false)
            setLoadingMore(false)
        }
    }

    const loadMore = () => {
        if (!loadingMore && hasMore) {
            const nextPage = page + 1
            setPage(nextPage)
            fetchLeads(nextPage, false)
        }
    }

    const observerTarget = useRef(null);
    useEffect(() => {
        const observer = new IntersectionObserver(
            entries => {
                if (entries[0].isIntersecting && hasMore && !loading && !loadingMore) {
                    loadMore();
                }
            },
            { threshold: 1.0 }
        );
        if (observerTarget.current) observer.observe(observerTarget.current);
        return () => observer.disconnect();
    }, [hasMore, loading, loadingMore, leads]);

    const handleCopy = (text) => {
        navigator.clipboard.writeText(text)
        setNotification({ message: 'Copiado para a √°rea de transfer√™ncia', type: 'info' })
        setTimeout(() => setNotification(null), 2000)
    }

    const handleSendMessage = async () => {
        if (!selectedLead) return
        setSendingMessage(true)

        try {
            await new Promise(resolve => setTimeout(resolve, 1500))
            setNotification({ message: 'Conex√£o enviada com sucesso!', type: 'success' })
            setSelectedLead(null)
        } catch (e) {
            setNotification({ message: 'Erro ao enviar.', type: 'error' })
        } finally {
            setSendingMessage(false)
            setTimeout(() => setNotification(null), 3000)
        }
    }

    // --- HELPER COMPONENTS ---
    const QualificationBadge = ({ isHighTicket, isB2B, companySize }) => {
        return (
            <div className="flex flex-wrap gap-1.5 justify-start">
                {isHighTicket && (
                    <div className="w-6 h-6 rounded-md bg-purple-50 text-purple-600 border border-purple-100 flex items-center justify-center shadow-sm" title="High Ticket Potential">
                        <Gem size={14} />
                    </div>
                )}

                {isB2B && (
                    <span className="px-1.5 py-0.5 rounded-md bg-blue-50 text-blue-700 text-[10px] font-extrabold border border-blue-100 flex items-center shadow-sm">
                        B2B
                    </span>
                )}

                {companySize && (
                    <span className={`px-1.5 py-0.5 rounded-md text-[10px] font-bold border flex items-center shadow-sm ${companySize === 'Enterprise'
                        ? 'bg-purple-100 text-purple-700 border-purple-200'
                        : companySize === 'Mid-Market'
                            ? 'bg-indigo-50 text-indigo-600 border-indigo-100'
                            : 'bg-gray-100 text-gray-600 border-gray-200'
                        }`}>
                        {companySize}
                    </span>
                )}
            </div>
        )
    }

    return (
        <div className="min-h-screen bg-gray-50 p-6 md:p-8 font-sans text-slate-800">

            {/* NOTIFICATION TOAST */}
            {notification && (
                <div className={`fixed top-6 right-6 z-50 px-4 py-3 rounded-lg shadow-lg border flex items-center gap-3 animate-slide-in-right ${notification.type === 'error' ? 'bg-red-50 border-red-200 text-red-600' : 'bg-white border-gray-200 text-slate-700'
                    }`}>
                    {notification.type === 'error' ? <Zap size={18} /> : <RefreshCw size={18} className={syncLoading || enrichmentLoading ? "animate-spin text-orange-500" : "text-green-500"} />}
                    <span className="text-sm font-medium">{notification.message}</span>
                </div>
            )}

            {/* HEADER */}
            <div className="max-w-7xl mx-auto mb-10">
                <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-8">
                    <div>
                        <h1 className="text-3xl font-bold text-slate-900 tracking-tight mb-2">Minera√ß√£o de Base & Cad√™ncia</h1>
                        <p className="text-slate-500 text-lg">Identifique oportunidades ocultas e inicie conversas com contexto.</p>
                    </div>
                </div>

                {/* KPI CARDS */}
                <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div className="bg-white p-6 rounded-2xl border border-gray-200 shadow-sm hover:shadow-md transition-all">
                        <div className="flex items-center gap-3 mb-2 text-slate-500 text-sm font-semibold uppercase tracking-wider">
                            <Users size={16} /> Total na Base
                        </div>
                        <div className="text-4xl font-extrabold text-slate-900">{stats.total}</div>
                    </div>
                    <div className="bg-white p-6 rounded-2xl border border-orange-100 shadow-sm hover:shadow-md transition-all relative overflow-hidden group">
                        <div className="absolute top-0 right-0 w-20 h-20 bg-orange-500/5 rounded-bl-full -mr-4 -mt-4 transition-transform group-hover:scale-110"></div>
                        <div className="flex items-center gap-3 mb-2 text-orange-600 text-sm font-bold uppercase tracking-wider">
                            <Zap size={16} fill="currentColor" /> Oportunidades ICP A
                        </div>
                        <div className="text-4xl font-extrabold text-orange-600">{stats.hot}</div>
                    </div>
                    <div className="bg-white p-6 rounded-2xl border border-blue-100 shadow-sm hover:shadow-md transition-all">
                        <div className="flex items-center gap-3 mb-2 text-blue-600 text-sm font-bold uppercase tracking-wider">
                            <MessageCircle size={16} /> Intera√ß√µes (7d)
                        </div>
                        <div className="text-4xl font-extrabold text-blue-600">{stats.interactions}</div>
                    </div>
                </div>

                {/* CONTROLS */}
                <div className="bg-white p-4 rounded-xl border border-gray-200 shadow-sm mb-6 flex flex-col md:flex-row justify-between items-center gap-4">
                    <div className="relative w-full md:w-96">
                        <Search className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400" size={18} />
                        <input
                            type="text"
                            placeholder="Buscar por nome, cargo ou empresa..."
                            value={searchTerm}
                            onChange={e => setSearchTerm(e.target.value)}
                            className="w-full pl-10 pr-4 py-2.5 bg-gray-50 border border-gray-200 rounded-lg text-slate-700 focus:outline-none focus:border-orange-500 focus:ring-1 focus:ring-orange-500 transition-all font-medium placeholder:text-gray-400"
                        />
                    </div>
                    <div className="flex gap-3 w-full md:w-auto">
                        <button
                            onClick={handleSync}
                            disabled={syncLoading || enrichmentLoading}
                            className={`flex items-center gap-2 px-4 py-2.5 rounded-lg font-semibold text-sm transition-all ${syncLoading
                                ? 'bg-orange-50 text-orange-400 cursor-not-allowed'
                                : 'bg-orange-50 text-orange-600 hover:bg-orange-100 hover:text-orange-700 border border-orange-200'
                                }`}
                        >
                            <RefreshCw size={16} className={syncLoading ? "animate-spin" : ""} />
                            {syncLoading ? 'Sincronizando...' : 'Sincronizar Conex√µes'}
                        </button>

                        <button
                            onClick={() => handleEnrichment()}
                            disabled={enrichmentLoading || syncLoading}
                            className={`flex items-center gap-2 px-4 py-2.5 rounded-lg font-semibold text-sm transition-all ${enrichmentLoading
                                ? 'bg-purple-50 text-purple-400 cursor-not-allowed'
                                : 'bg-purple-50 text-purple-600 hover:bg-purple-100 hover:text-purple-700 border border-purple-200'
                                }`}
                        >
                            <Sparkles size={16} className={enrichmentLoading ? "animate-spin" : ""} />
                            {enrichmentLoading ? 'Analisando...' : '‚ú® Enriquecer Base'}
                        </button>

                        <button className="flex items-center gap-2 px-4 py-2.5 rounded-lg bg-gray-50 text-slate-600 border border-gray-200 hover:bg-gray-100 font-semibold text-sm transition-all">
                            <Filter size={16} /> Filtros
                        </button>
                    </div>
                </div>

                {/* TABLE */}
                <div className="bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden">
                    <div className="overflow-x-auto">
                        <table className="w-full text-left border-collapse">
                            <thead>
                                <tr className="bg-gray-50 border-b border-gray-200 text-xs font-bold text-gray-400 uppercase tracking-wider">
                                    <th className="py-4 px-6 border-r border-gray-100/50 w-[30%]">Lead & Motivo</th>
                                    <th className="py-4 px-6 border-r border-gray-100/50 w-[15%]">Empresa</th>
                                    <th className="py-4 px-6 border-r border-gray-100/50 w-[15%]">Qualifica√ß√£o</th>
                                    <th className="py-4 px-6 border-r border-gray-100/50 w-[15%]">Status</th>
                                    <th className="py-4 px-6 border-r border-gray-100/50 w-[10%]">Engajamento</th>
                                    <th className="py-4 px-6 w-[15%]">A√ß√£o</th>
                                </tr>
                            </thead>
                            <tbody className="divide-y divide-gray-100">
                                {loading && stats.total === 0 ? (
                                    <tr><td colSpan="5" className="py-12 text-center text-gray-400"><Loader2 className="animate-spin mx-auto mb-2" />Carregando...</td></tr>
                                ) : leads.map(lead => {

                                    // Row Visual Logic
                                    const isQualified = lead.qualification_status === 'QUALIFIED'
                                    const isDisqualified = lead.qualification_status === 'DISQUALIFIED'

                                    let rowClass = "hover:bg-gray-50/80 transition-all group border-l-[3px] border-l-transparent"
                                    if (isQualified) rowClass += " bg-green-50/30 border-l-green-500"
                                    if (isDisqualified) rowClass += " opacity-60 grayscale-[0.5]"

                                    return (
                                        <tr key={lead.id} className={rowClass}>
                                            <td className="py-4 px-6">
                                                <div className="flex items-start gap-4">
                                                    <div className="w-10 h-10 rounded-full bg-slate-200 flex items-center justify-center text-slate-500 font-bold border-2 border-white shadow-sm overflow-hidden shrink-0 mt-1">
                                                        {lead.avatar_url ? <img src={lead.avatar_url} className="w-full h-full object-cover" /> : (lead.nome?.charAt(0) || '?')}
                                                    </div>
                                                    <div className="flex-1 min-w-0">
                                                        <div className="flex items-center gap-2">
                                                            <div className="font-bold text-slate-800 text-sm truncate">{lead.nome || 'Sem Nome'}</div>
                                                        </div>
                                                        <div className="text-xs text-gray-400 truncate mb-1">{lead.headline}</div>

                                                        {/* ICP REASON (TRUNCATED) */}
                                                        {lead.icp_reason && (
                                                            <div className="text-[11px] text-slate-500 bg-slate-50 px-2 py-1 rounded border border-slate-100 inline-block max-w-full truncate hover:whitespace-normal hover:border-slate-300 transition-colors cursor-help" title={lead.icp_reason}>
                                                                <span className="font-semibold text-slate-400 mr-1">üîé</span>
                                                                {lead.icp_reason}
                                                            </div>
                                                        )}
                                                    </div>
                                                </div>
                                            </td>
                                            <td className="py-4 px-6 align-top pt-5">
                                                <span className="text-sm font-medium text-slate-700 truncate block max-w-[150px]" title={lead.empresa}>
                                                    {lead.empresa || '-'}
                                                </span>
                                            </td>
                                            <td className="py-4 px-6 align-top pt-5">
                                                <QualificationBadge
                                                    isHighTicket={lead.is_high_ticket}
                                                    isB2B={lead.is_b2b}
                                                    companySize={lead.company_size_type}
                                                />
                                            </td>
                                            <td className="py-4 px-6 align-top pt-5">
                                                <span className={`px-2.5 py-1 rounded-md text-[11px] font-bold uppercase tracking-wide border ${lead.status_pipeline === 'Conex√£o'
                                                    ? 'bg-blue-50 text-blue-600 border-blue-100'
                                                    : 'bg-gray-100 text-gray-500 border-gray-200'
                                                    }`}>
                                                    {lead.status_pipeline || 'Desconhecido'}
                                                </span>
                                            </td>
                                            <td className="py-4 px-6 align-top pt-5">
                                                {lead.engagement_score > 0 ? (
                                                    <div className="flex items-center gap-1.5 font-bold text-orange-600 text-sm">
                                                        <Zap size={14} fill="currentColor" /> {lead.engagement_score} pts
                                                    </div>
                                                ) : (
                                                    <span className="text-gray-300 text-xs font-medium">-</span>
                                                )}
                                            </td>
                                            <td className="py-4 px-6 align-top pt-4">
                                                <div className="flex gap-2">
                                                    <button
                                                        onClick={() => !isDisqualified && setSelectedLead(lead)}
                                                        disabled={isDisqualified}
                                                        className={`px-4 py-2 rounded-lg font-semibold text-xs transition-all shadow-sm flex-1 ${isDisqualified
                                                            ? 'bg-gray-100 text-gray-400 cursor-not-allowed border border-gray-200'
                                                            : 'bg-white hover:bg-orange-50 text-slate-600 hover:text-orange-600 border border-gray-200 hover:border-orange-200 shadow-sm hover:shadow'
                                                            }`}
                                                    >
                                                        {isDisqualified ? 'Desqualificado' : 'Abordar'}
                                                    </button>
                                                    <button
                                                        onClick={(e) => {
                                                            e.stopPropagation()
                                                            handleEnrichment(lead)
                                                        }}
                                                        disabled={enrichmentLoading}
                                                        title="Re-analisar com IA"
                                                        className="px-2 py-2 rounded-lg bg-gray-50 text-gray-400 hover:bg-purple-50 hover:text-purple-600 border border-gray-200 transition-all"
                                                    >
                                                        <Bot size={16} />
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    )
                                })}
                            </tbody>
                        </table>
                    </div>
                    {/* Load More Sentinel */}
                    <div ref={observerTarget} className="py-6 text-center">
                        {loadingMore && <div className="flex items-center justify-center gap-2 text-gray-500 text-sm"><Loader2 className="animate-spin" size={16} /> Carregando mais...</div>}
                        {!hasMore && leads.length > 0 && <span className="text-gray-400 text-xs">Voc√™ chegou ao fim da lista.</span>}
                    </div>
                </div>
            </div>

            {/* DRAWER (Slide-Over) */}
            {selectedLead && (
                <div className="fixed inset-0 z-50 flex justify-end">
                    <div className="absolute inset-0 bg-slate-900/20 backdrop-blur-sm transition-opacity" onClick={() => setSelectedLead(null)} />
                    <div className="relative w-full max-w-lg bg-white h-full shadow-2xl flex flex-col animate-slide-in-right overflow-hidden border-l border-gray-200">
                        {/* Drawer Header */}
                        <div className="p-6 border-b border-gray-100 flex justify-between items-center bg-white">
                            <div>
                                <h2 className="text-xl font-bold text-slate-800">Cad√™ncia de Venda</h2>
                                <p className="text-xs text-gray-500 mt-1">Gerencie a intera√ß√£o com este lead</p>
                            </div>
                            <button onClick={() => setSelectedLead(null)} className="p-2 rounded-full hover:bg-gray-100 text-gray-400 hover:text-slate-600 transition-colors">
                                <X size={20} />
                            </button>
                        </div>

                        {/* Drawer Body - Split into Context and Action */}
                        <div className="flex-1 overflow-y-auto p-6 space-y-8 custom-scrollbar bg-slate-50/50">

                            {/* BLOCK 1: CONTEXT (Why is this lead here?) */}
                            <div className="bg-white p-5 rounded-xl border border-orange-100 shadow-sm">
                                <div className="flex items-start gap-4 mb-4">
                                    <div className="w-14 h-14 rounded-full bg-slate-100 flex items-center justify-center text-lg font-bold text-slate-500 shrink-0 border border-gray-200">
                                        {selectedLead.avatar_url ? <img src={selectedLead.avatar_url} className="w-full h-full object-cover rounded-full" /> : (selectedLead.nome?.charAt(0) || '?')}
                                    </div>
                                    <div className="flex-1">
                                        <div className="flex justify-between items-start">
                                            <h3 className="text-lg font-bold text-slate-900 leading-tight">{selectedLead.nome}</h3>
                                            {selectedLead.company_website && (
                                                <a href={selectedLead.company_website} target="_blank" rel="noopener noreferrer" className="text-gray-400 hover:text-blue-600 transition-colors" title="Visitar Site">
                                                    <Globe size={18} />
                                                </a>
                                            )}
                                        </div>
                                        <p className="text-sm text-gray-500 mb-1">{selectedLead.headline}</p>
                                        <div className="flex flex-wrap gap-2 mt-2">
                                            {selectedLead.is_high_ticket && <span className="px-2 py-0.5 bg-indigo-50 text-indigo-700 text-[10px] font-bold rounded border border-indigo-100 flex items-center gap-1"><Gem size={10} /> High Ticket</span>}
                                            {selectedLead.company_size_type && <span className="px-2 py-0.5 bg-gray-100 text-gray-600 text-[10px] font-bold rounded border border-gray-200"><Building2 size={10} className="inline mr-1" />{selectedLead.company_size_type}</span>}
                                        </div>
                                    </div>
                                </div>

                                {/* ICP REASON */}
                                <div className="p-3 bg-orange-50 rounded-lg border border-orange-100/60">
                                    <h4 className="flex items-center gap-2 text-[10px] font-bold text-orange-600 uppercase tracking-wider mb-1">
                                        <Sparkles size={12} /> Motivo da Qualifica√ß√£o
                                    </h4>
                                    <p className="text-sm text-slate-700 leading-relaxed font-medium">
                                        {selectedLead.icp_reason || "Este perfil apresenta alta ader√™ncia com seu ICP ideal, ocupando cargo de decis√£o em setor estrat√©gico."}
                                    </p>
                                </div>
                            </div>

                            {/* Skills Tag Cloud (Collapsed/Secondary) */}
                            {selectedLead.skills && (
                                <div>
                                    <h4 className="text-xs font-bold text-gray-400 uppercase tracking-wider mb-3 px-2">Habilidades Detectadas</h4>
                                    <div className="flex flex-wrap gap-2 px-2">
                                        {(() => {
                                            try {
                                                const tags = typeof selectedLead.skills === 'string' ? JSON.parse(selectedLead.skills) : selectedLead.skills
                                                return tags.slice(0, 5).map((t, i) => (
                                                    <span key={i} className="px-2 py-1 rounded-md bg-white text-slate-500 text-xs font-medium border border-gray-200 shadow-sm">
                                                        {typeof t === 'string' ? t : t.name}
                                                    </span>
                                                ))
                                            } catch (e) { return null }
                                        })()}
                                    </div>
                                </div>
                            )}
                        </div>

                        {/* BLOCK 2: ACTION (Bottom Fixed) */}
                        <div className="p-6 border-t border-gray-200 bg-white">
                            <label className="block text-xs font-bold text-gray-500 uppercase tracking-wider mb-2">Mensagem de Conex√£o</label>

                            <div className="relative mb-4">
                                <textarea
                                    className="w-full h-32 p-3 bg-slate-50 border border-gray-300 rounded-lg text-sm text-slate-700 focus:outline-none focus:border-orange-500 focus:ring-1 focus:ring-orange-500 resize-none font-medium leading-relaxed"
                                    value={messageDraft}
                                    onChange={(e) => setMessageDraft(e.target.value)}
                                    placeholder="Escreva sua mensagem de conex√£o..."
                                />
                                <button
                                    onClick={() => handleCopy(messageDraft)}
                                    className="absolute top-2 right-2 p-1.5 rounded-md bg-white text-gray-400 hover:text-orange-600 border border-gray-200 shadow-sm transition-all"
                                    title="Copiar texto"
                                >
                                    <Copy size={14} />
                                </button>
                            </div>

                            <button
                                onClick={handleSendMessage}
                                disabled={sendingMessage}
                                className={`w-full py-3.5 rounded-xl text-white font-bold shadow-lg transition-all transform active:scale-95 flex items-center justify-center gap-2 ${sendingMessage
                                    ? 'bg-orange-300 cursor-not-allowed'
                                    : 'bg-orange-600 hover:bg-orange-700 shadow-orange-200 hover:shadow-orange-300'
                                    }`}
                            >
                                {sendingMessage ? <Loader2 className="animate-spin" size={20} /> : <Send size={18} />}
                                {sendingMessage ? 'Enviando...' : 'Enviar Conex√£o'}
                            </button>

                            <p className="text-center text-[10px] text-gray-400 mt-2">
                                Esta a√ß√£o enviar√° um convite de conex√£o via LinkedIn.
                            </p>
                        </div>
                    </div>
                </div>
            )}
        </div>
    )
}

export default SalesHubPage

```

---

## Arquivo: src\pages\SalesInbox.css
```css
/* 
  DEPRECATED: Styles have been moved to Tailwind classes in SalesInboxPage.jsx
  as part of the Obsidian Glass visual overhaul.
*/
```

---

## Arquivo: src\pages\SalesInboxPage.jsx
```jsx
import React, { useState, useEffect, useRef } from 'react'
import { supabase } from '../services/supabaseClient'
import { useClientSelection } from '../contexts/ClientSelectionContext'
import { Search, Send, MoreVertical, Phone, Mail, MapPin, Briefcase, Zap, Star, Sparkles, MessageSquare, Copy, Check, LayoutGrid, List, Loader2, X } from 'lucide-react'

const N8N_GENERATE_REPLY_URL = 'https://n8n-n8n-start.kfocge.easypanel.host/webhook/generate-reply'
import KanbanColumn from '../components/kanban/KanbanColumn'
import KanbanLeadCard from '../components/kanban/KanbanLeadCard'
import StrategicContextCard from '../components/StrategicContextCard'

const SalesInboxPage = () => {
    const { selectedClientId } = useClientSelection()
    const [leads, setLeads] = useState([])
    const [loadingLeads, setLoadingLeads] = useState(false)
    const [activeLead, setActiveLead] = useState(null)

    // View Mode
    const [viewMode, setViewMode] = useState('list') // 'list' | 'kanban'
    const [searchTerm, setSearchTerm] = useState('')

    // Chat State
    const [interactions, setInteractions] = useState([])
    const [loadingChat, setLoadingChat] = useState(false)
    const [newMessage, setNewMessage] = useState('')

    // AI Actions State
    const [draftMessage, setDraftMessage] = useState('')
    const [selectedSuggestionIdx, setSelectedSuggestionIdx] = useState(null)
    const [copiedIdx, setCopiedIdx] = useState(null)
    const [generatingReply, setGeneratingReply] = useState(false)
    const [sdrSeniorGenerated, setSdrSeniorGenerated] = useState(false)
    const [generatedReasoning, setGeneratedReasoning] = useState(null)

    // 1. Fetch Inbox Leads (Score > 0, Sorted Desc)
    useEffect(() => {
        if (!selectedClientId) return

        const fetchInboxLeads = async () => {
            setLoadingLeads(true)
            try {
                const { data, error } = await supabase
                    .from('leads')
                    .select('*')
                    .eq('client_id', selectedClientId)
                    .order('last_interaction_date', { ascending: false, nullsFirst: false })
                    .limit(50)

                if (error) throw error

                const leadIds = (data || []).map(l => l.id)

                // Fetch last interaction direction (is_sender) per lead
                let lastSenderMap = {}
                if (leadIds.length > 0) {
                    const { data: intData } = await supabase
                        .from('interactions')
                        .select('lead_id, is_sender, interaction_date')
                        .in('lead_id', leadIds)
                        .order('interaction_date', { ascending: false })

                    if (intData) {
                        intData.forEach(row => {
                            if (!(row.lead_id in lastSenderMap)) {
                                lastSenderMap[row.lead_id] = row.is_sender
                            }
                        })
                    }
                }

                const processedLeads = (data || []).map(lead => ({
                    ...lead,
                    total_interactions_count: lead.total_interactions_count || 0,
                    last_interaction_date: lead.last_interaction_date || null,
                    // is_sender=true ‚Üí I sent last msg | is_sender=false ‚Üí lead sent last msg
                    _lastMsgIsSender: lead.id in lastSenderMap ? lastSenderMap[lead.id] : null
                }))

                setLeads(processedLeads)
            } catch (err) {
                console.error('Erro ao buscar leads do inbox:', err)
            } finally {
                setLoadingLeads(false)
            }
        }

        fetchInboxLeads()
    }, [selectedClientId])

    // 2. Fetch Interactions when Active Lead Changes
    useEffect(() => {
        if (!activeLead) {
            setInteractions([])
            setDraftMessage('')
            setSelectedSuggestionIdx(null)
            setSdrSeniorGenerated(false)
            setGeneratedReasoning(null)
            return
        }

        // Load suggested_message from DB if it exists
        if (activeLead.suggested_message) {
            setDraftMessage(activeLead.suggested_message)
            setSdrSeniorGenerated(true)
        } else {
            setDraftMessage('')
            setSdrSeniorGenerated(false)
        }
        setSelectedSuggestionIdx(null)
        setGeneratedReasoning(null)

        const fetchInteractions = async () => {
            setLoadingChat(true)
            try {
                const { data, error } = await supabase
                    .from('interactions')
                    .select('*')
                    .eq('lead_id', activeLead.id)
                    .order('interaction_date', { ascending: false })

                if (error) throw error
                setInteractions(data || [])
            } catch (err) {
                console.error('Erro ao buscar chat:', err)
            } finally {
                setLoadingChat(false)
            }
        }

        fetchInteractions()
    }, [activeLead])

    // Kanban Categorization Logic
    // 1) Prioridade Alta: confian√ßa >= 75
    // 2) Para Responder: confian√ßa < 75, lead enviou a √∫ltima msg (eu preciso responder)
    // 3) Aguardando: confian√ßa < 75, eu enviei a √∫ltima msg (aguardando lead responder)
    // 4) Stand-by: confian√ßa < 75, mais de 7 dias desde a √∫ltima mensagem
    const categorizeLeads = (leadsArray) => {
        const now = new Date()
        const sevenDaysAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000)

        const highPriority = []
        const toRespond = []
        const waiting = []
        const standby = []

        leadsArray.forEach(lead => {
            const trustScore = lead?.trust_score || lead?.engagement_score || 0
            const lastDate = lead?.last_interaction_date ? new Date(lead.last_interaction_date) : null

            // Rule 1: Prioridade Alta ‚Äî confian√ßa >= 75
            if (trustScore >= 75) {
                highPriority.push(lead)
                return
            }

            // Rule 4: Stand-by ‚Äî mais de 7 dias sem intera√ß√£o
            if (lastDate && lastDate < sevenDaysAgo) {
                standby.push(lead)
                return
            }

            // Rule 2 & 3: baseado em quem enviou a √∫ltima mensagem
            // _lastMsgIsSender: true = eu enviei, false = lead enviou, null = sem dados
            if (lead._lastMsgIsSender === false) {
                // Lead enviou a √∫ltima msg ‚Üí eu preciso responder
                toRespond.push(lead)
            } else if (lead._lastMsgIsSender === true) {
                // Eu enviei a √∫ltima msg ‚Üí aguardando resposta do lead
                waiting.push(lead)
            } else {
                // Sem hist√≥rico de intera√ß√£o ‚Üí Para Responder (default)
                toRespond.push(lead)
            }
        })

        return { highPriority, toRespond, waiting, standby }
    }

    const filteredLeads = searchTerm.trim()
        ? leads.filter(lead => {
            const term = searchTerm.toLowerCase()
            return (
                (lead.nome || '').toLowerCase().includes(term) ||
                (lead.headline || '').toLowerCase().includes(term) ||
                (lead.company || '').toLowerCase().includes(term)
            )
        })
        : leads

    const kanbanData = categorizeLeads(filteredLeads)

    const handleSendMessage = async () => {
        if (!newMessage.trim() || !activeLead) return

        // Optimistic UI Update
        const tempMsg = {
            id: Date.now(),
            content: newMessage,
            direction: 'outbound',
            interaction_date: new Date().toISOString()
        }
        setInteractions([tempMsg, ...interactions])
        setNewMessage('')
    }

    const handleAiSend = () => {
        if (!draftMessage.trim() || !activeLead) return

        console.log('[LinkedIn Send] Simulating send:', draftMessage)

        // Optimistic Update
        const tempMsg = {
            id: Date.now(),
            content: draftMessage,
            direction: 'outbound',
            interaction_date: new Date().toISOString()
        }
        setInteractions([tempMsg, ...interactions])
        alert('‚úÖ Mensagem enviada via LinkedIn (Simula√ß√£o)')
        setDraftMessage('')
    }

    const copyToClipboard = (text, idx) => {
        navigator.clipboard.writeText(text)
        setCopiedIdx(idx)
        setTimeout(() => setCopiedIdx(null), 2000)
    }

    const generateAISuggestion = async () => {
        if (!activeLead || !selectedClientId) return

        setGeneratingReply(true)
        setSdrSeniorGenerated(false)
        setGeneratedReasoning(null)
        try {
            const conversationHistory = interactions
                .slice().reverse()
                .map(msg => `${msg.is_sender ? 'Eu' : 'Lead'}: ${msg.content}`)
                .join('\n')

            const payload = {
                user_id: selectedClientId,
                lead_id: activeLead.id,
                lead_name: activeLead.nome || '',
                lead_headline: activeLead.headline || '',
                lead_location: activeLead.location || '',
                lead_reasoning: activeLead.analysis_reasoning || '',
                lead_icp_reason: activeLead.icp_reason || '',
                conversation_history: conversationHistory,
                is_icebreaker: interactions.length === 0
            }

            const response = await fetch(N8N_GENERATE_REPLY_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            })

            if (!response.ok) throw new Error('Erro na requisi√ß√£o')

            const data = await response.json()
            if (data.reply) {
                setNewMessage(data.reply)
                setDraftMessage(data.reply)
                setSdrSeniorGenerated(true)
                if (data.reasoning) {
                    setGeneratedReasoning(data.reasoning)
                }
            }

            // After 5s, re-fetch the lead's strategic columns + suggested_message (populated by n8n workflow)
            const leadId = activeLead.id
            setTimeout(async () => {
                try {
                    const { data: updated, error } = await supabase
                        .from('leads')
                        .select('last_cadence_level, last_signal_detected, last_psychological_factor, last_forbidden_action, last_strategy_used, suggested_message')
                        .eq('id', leadId)
                        .single()

                    if (error || !updated) return

                    // Update activeLead & leads array
                    setActiveLead(prev => prev && prev.id === leadId ? { ...prev, ...updated } : prev)
                    setLeads(prev => prev.map(l => l.id === leadId ? { ...l, ...updated } : l))

                    // Update Pr√≥ximo Passo with DB suggested_message
                    if (updated.suggested_message) {
                        setDraftMessage(updated.suggested_message)
                        setSdrSeniorGenerated(true)
                    }
                } catch (err) {
                    console.error('[Raio-X] Error refreshing strategic data:', err)
                }
            }, 5000)
        } catch (error) {
            console.error('[AI] Error generating suggestion:', error)
            alert('‚ùå Erro ao gerar sugest√£o. Tente novamente.')
        } finally {
            setGeneratingReply(false)
        }
    }

    if (!selectedClientId) return (
        <div className="flex flex-col items-center justify-center h-[calc(100vh-100px)] text-gray-400 gap-4">
            <div className="w-16 h-16 rounded-full bg-primary/10 border border-primary/30 flex items-center justify-center">
                <Mail size={24} className="text-primary/70" />
            </div>
            <p className="text-gray-300">Selecione um cliente para acessar o Inbox.</p>
        </div>
    )

    return (
        <div className="flex flex-col h-[calc(100vh-120px)] p-2 gap-4 overflow-hidden">

            {/* HEADER & TOGGLE */}
            <div className="flex flex-wrap justify-between items-center px-4 gap-3 shrink-0">
                <h1 className="text-xl font-bold text-black flex items-center gap-2">
                    <LayoutGrid size={20} className="text-primary" /> Inbox Inteligente
                </h1>

                {/* Search Input */}
                <div className="relative flex-1 max-w-xs">
                    <Search size={14} className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500" />
                    <input
                        type="text"
                        placeholder="Pesquisar lead..."
                        value={searchTerm}
                        onChange={e => setSearchTerm(e.target.value)}
                        className="w-full bg-black/40 border border-white/10 rounded-xl pl-9 pr-8 py-2 text-sm text-white placeholder-gray-500 focus:outline-none focus:border-primary/50 focus:ring-1 focus:ring-primary/30 transition-all"
                    />
                    {searchTerm && (
                        <button
                            onClick={() => setSearchTerm('')}
                            className="absolute right-2.5 top-1/2 -translate-y-1/2 text-gray-500 hover:text-white transition-colors"
                        >
                            <X size={14} />
                        </button>
                    )}
                </div>

                <div className="bg-black/40 p-1 rounded-xl border border-white/10 flex gap-1 backdrop-blur-md">
                    <button
                        onClick={() => setViewMode('kanban')}
                        className={`px-3 py-1.5 rounded-lg text-xs font-bold uppercase tracking-wider transition-all flex items-center gap-2 ${viewMode === 'kanban' ? 'bg-primary text-white shadow-lg shadow-primary/20' : 'text-gray-400 hover:text-white hover:bg-white/5'}`}
                    >
                        <LayoutGrid size={14} /> Kanban
                    </button>
                    <button
                        onClick={() => setViewMode('list')}
                        className={`px-3 py-1.5 rounded-lg text-xs font-bold uppercase tracking-wider transition-all flex items-center gap-2 ${viewMode === 'list' ? 'bg-primary text-white shadow-lg shadow-primary/20' : 'text-gray-400 hover:text-white hover:bg-white/5'}`}
                    >
                        <List size={14} /> Lista
                    </button>
                </div>
            </div>

            {/* KANBAN VIEW */}
            {viewMode === 'kanban' && (
                <div className="flex-1 overflow-x-auto pb-4 custom-scrollbar">
                    <div className="flex gap-6 min-w-max h-full px-4">
                        {/* Column 1: High Priority */}
                        <KanbanColumn
                            title="Prioridade Alta"
                            icon="üî•"
                            count={kanbanData.highPriority.length}
                            colorClass="bg-red-500"
                        >
                            {kanbanData.highPriority.map(lead => (
                                <KanbanLeadCard
                                    key={lead.id}
                                    lead={lead}
                                    onClick={(l) => { setActiveLead(l); setViewMode('list') }}
                                />
                            ))}
                        </KanbanColumn>

                        {/* Column 2: To Respond */}
                        <KanbanColumn
                            title="Para Responder"
                            icon="üì©"
                            count={kanbanData.toRespond.length}
                            colorClass="bg-blue-500"
                        >
                            {kanbanData.toRespond.map(lead => (
                                <KanbanLeadCard
                                    key={lead.id}
                                    lead={lead}
                                    onClick={(l) => { setActiveLead(l); setViewMode('list') }}
                                />
                            ))}
                        </KanbanColumn>

                        {/* Column 3: Waiting */}
                        <KanbanColumn
                            title="Aguardando"
                            icon="‚è≥"
                            count={kanbanData.waiting.length}
                            colorClass="bg-amber-500"
                        >
                            {kanbanData.waiting.map(lead => (
                                <KanbanLeadCard
                                    key={lead.id}
                                    lead={lead}
                                    onClick={(l) => { setActiveLead(l); setViewMode('list') }}
                                />
                            ))}
                        </KanbanColumn>

                        {/* Column 4: Stand-by */}
                        <KanbanColumn
                            title="Stand-by / Frios"
                            icon="üí§"
                            count={kanbanData.standby.length}
                            colorClass="bg-slate-400"
                        >
                            {kanbanData.standby.map(lead => (
                                <KanbanLeadCard
                                    key={lead.id}
                                    lead={lead}
                                    onClick={(l) => { setActiveLead(l); setViewMode('list') }}
                                />
                            ))}
                        </KanbanColumn>
                    </div>
                </div>
            )}

            {/* LIST / DETAIL VIEW */}
            {viewMode === 'list' && (
                <div className="flex-1 flex gap-6 overflow-hidden">
                    {/* LEFT: Lead List */}
                    <div className="w-80 flex flex-col bg-[#0d0d0d] rounded-2xl border border-white/10 overflow-hidden shrink-0">
                        <div className="p-4 border-b border-white/10 bg-[#111111] flex justify-between items-center">
                            <span className="font-semibold text-white">Inbox Priorit√°rio</span>
                            <span className="text-xs bg-primary/20 text-primary px-2 py-1 rounded-full font-bold">
                                {filteredLeads.length}
                            </span>
                        </div>

                        <div className="flex-1 overflow-y-auto custom-scrollbar p-2 space-y-2">
                            {loadingLeads ? (
                                <div className="p-8 text-center text-gray-500 text-sm">Carregando...</div>
                            ) : filteredLeads.map(lead => (
                                <div
                                    key={lead.id}
                                    onClick={() => setActiveLead(lead)}
                                    className={`p-3 rounded-xl border cursor-pointer transition-all ${activeLead?.id === lead.id
                                        ? 'bg-primary/20 border-primary/50 shadow-lg shadow-primary/10'
                                        : 'border-transparent hover:bg-white/10 hover:border-white/10'
                                        }`}
                                >
                                    <div className="flex justify-between items-start mb-1">
                                        <span className={`font-semibold text-sm truncate max-w-[160px] ${activeLead?.id === lead.id ? 'text-white' : 'text-white'}`}>
                                            {lead.nome || 'Sem Nome'}
                                        </span>
                                        <span className="text-[10px] text-gray-400">
                                            {lead.last_interaction ? new Date(lead.last_interaction).toLocaleDateString(undefined, { month: 'short', day: 'numeric' }) : ''}
                                        </span>
                                    </div>
                                    <div className="text-xs text-gray-300 mb-2 truncate">
                                        {lead.headline || 'Lead qualificado'}
                                    </div>
                                    <div className="flex items-center gap-1 text-[10px] font-bold text-white bg-primary/30 self-start px-2 py-0.5 rounded-md inline-flex">
                                        <Star size={10} className="text-primary fill-primary" /> {lead.engagement_score} pts
                                    </div>
                                </div>
                            ))}
                            {!loadingLeads && filteredLeads.length === 0 && (
                                <div className="p-8 text-center text-gray-500 text-sm">
                                    {searchTerm ? 'Nenhum lead encontrado.' : 'Nenhum lead com engajamento.'}
                                </div>
                            )}
                        </div>
                    </div>

                    {/* MIDDLE: Chat Area */}
                    {activeLead ? (
                        <div className="flex-1 flex flex-col bg-[#0d0d0d] rounded-2xl border border-white/10 overflow-hidden relative">
                            {/* Header */}
                            <div className="p-4 border-b border-white/10 bg-[#111111] flex items-center justify-between z-10">
                                <div className="flex items-center gap-3 flex-1 min-w-0">
                                    <div className="w-10 h-10 shrink-0 rounded-full bg-gradient-to-br from-gray-700 to-black border border-glass-border flex items-center justify-center text-white font-bold shadow-inner overflow-hidden">
                                        {activeLead.avatar_url ? (
                                            <img src={activeLead.avatar_url} alt={activeLead.nome} className="w-full h-full object-cover" />
                                        ) : (
                                            activeLead.nome?.charAt(0)
                                        )}
                                    </div>
                                    <div className="flex-1 min-w-0">
                                        <div className="font-bold text-white text-sm truncate">{activeLead.nome}</div>
                                        <div className="text-xs text-gray-400 truncate">{activeLead.headline || activeLead.company}</div>
                                    </div>
                                </div>
                                <button className="p-2 rounded-lg hover:bg-white/5 text-gray-400 hover:text-white transition-colors shrink-0">
                                    <MoreVertical size={18} />
                                </button>
                            </div>

                            {/* Timeline */}
                            <div className="flex-1 overflow-y-auto p-6 flex flex-col-reverse gap-4 custom-scrollbar bg-black/20">
                                {loadingChat ? (
                                    <div className="text-center text-gray-500 text-sm py-10">Carregando hist√≥rico...</div>
                                ) : interactions.length === 0 ? (
                                    <div className="text-center text-gray-500 text-sm py-10 flex flex-col items-center gap-2">
                                        <MessageSquare size={24} className="opacity-20" />
                                        Nenhuma mensagem trocada ainda.
                                    </div>
                                ) : interactions.map(msg => (
                                    <div key={msg.id} className={`flex flex-col max-w-[80%] ${msg.is_sender === true ? 'self-end items-end' : 'self-start items-start'}`}>
                                        <div className={`px-4 py-3 rounded-2xl text-sm leading-relaxed ${msg.is_sender === true
                                            ? 'bg-primary/90 text-white rounded-br-sm shadow-lg shadow-primary/10'
                                            : 'bg-white/10 text-gray-200 rounded-bl-sm'
                                            }`}>
                                            {msg.content}
                                        </div>
                                        <span className="text-[10px] text-gray-500 mt-1 px-1">
                                            {new Date(msg.interaction_date).toLocaleString('pt-BR', { hour: '2-digit', minute: '2-digit' })}
                                        </span>
                                    </div>
                                ))}
                            </div>

                            {/* Input Area */}
                            <div className="p-4 border-t border-glass-border bg-white/[0.02]">
                                <div className="relative">
                                    <textarea
                                        className="w-full bg-black/40 border border-glass-border rounded-xl pl-4 pr-12 py-3 text-white placeholder-gray-500 focus:outline-none focus:border-primary/50 focus:ring-1 focus:ring-primary/50 transition-all resize-none text-sm"
                                        rows="1"
                                        placeholder="Digite sua resposta..."
                                        value={newMessage}
                                        onChange={e => setNewMessage(e.target.value)}
                                        onKeyDown={e => {
                                            if (e.key === 'Enter' && !e.shiftKey) {
                                                e.preventDefault()
                                                handleSendMessage()
                                            }
                                        }}
                                    />
                                    <button
                                        onClick={handleSendMessage}
                                        className="absolute right-2 top-1/2 -translate-y-1/2 p-2 rounded-lg bg-primary hover:bg-primary-dark text-white shadow-lg shadow-primary/20 transition-all"
                                    >
                                        <Send size={14} />
                                    </button>
                                </div>
                            </div>
                        </div>
                    ) : (
                        <div className="flex-1 flex flex-col items-center justify-center bg-[#0d0d0d] rounded-2xl border border-white/10 text-gray-300 gap-4">
                            <div className="w-20 h-20 rounded-full bg-primary/10 flex items-center justify-center">
                                <Zap size={32} className="text-primary/50" />
                            </div>
                            <p className="text-sm text-gray-400">Selecione um lead para iniciar o atendimento.</p>
                        </div>
                    )}

                    {/* RIGHT: Context & AI (ENHANCED) */}
                    <div className="w-80 flex flex-col gap-4 shrink-0 overflow-y-auto custom-scrollbar">
                        {activeLead ? (
                            <>
                                {/* Lead Info Card - 3 Main Indicators */}
                                <div className="bg-[#0d0d0d] rounded-2xl border border-white/10 p-5">
                                    <h4 className="text-xs font-bold text-primary uppercase tracking-wider mb-4">Dados do Lead</h4>
                                    <div className="flex items-center justify-between gap-3">
                                        {/* ICP Score */}
                                        <div className={`flex-1 text-center py-2 px-3 rounded-lg border ${activeLead.icp_score === 'A' ? 'bg-emerald-500/20 border-emerald-500/50 text-emerald-400' :
                                            activeLead.icp_score === 'B' ? 'bg-amber-500/20 border-amber-500/50 text-amber-400' :
                                                'bg-slate-500/20 border-slate-500/50 text-slate-400'
                                            }`}>
                                            <div className="text-[10px] uppercase tracking-wider opacity-70 mb-1">ICP</div>
                                            <div className="text-lg font-bold">{activeLead.icp_score || 'C'}</div>
                                        </div>

                                        {/* Interactions Count */}
                                        <div className="flex-1 text-center py-2 px-3 rounded-lg bg-blue-500/20 border border-blue-500/50 text-blue-400">
                                            <div className="text-[10px] uppercase tracking-wider opacity-70 mb-1">Intera√ß√µes</div>
                                            <div className="text-lg font-bold">{activeLead.total_interactions_count || activeLead.total_interactions || 0}</div>
                                        </div>

                                        {/* Cadence Stage */}
                                        {(() => {
                                            const stage = activeLead.cadence_stage || ''
                                            const match = stage?.toString().match(/(\d+)/)
                                            const level = match ? parseInt(match[1], 10) : 0
                                            const style = level >= 5 ? 'bg-emerald-500/20 border-emerald-500/50 text-emerald-400'
                                                : level >= 3 ? 'bg-amber-500/20 border-amber-500/50 text-amber-400'
                                                    : level >= 1 ? 'bg-blue-500/20 border-blue-500/50 text-blue-400'
                                                        : 'bg-slate-500/20 border-slate-500/50 text-slate-400'
                                            return (
                                                <div className={`flex-1 text-center py-2 px-3 rounded-lg border ${style}`}>
                                                    <div className="text-[10px] uppercase tracking-wider opacity-70 mb-1">Cad√™ncia</div>
                                                    <div className="text-lg font-bold">{stage || '‚Äî'}</div>
                                                </div>
                                            )
                                        })()}
                                    </div>
                                </div>

                                {/* Raio-X da Negocia√ß√£o */}
                                <StrategicContextCard lead={activeLead} />

                                {/* AI Suggestion Card - Always starts clean */}
                                <div className="relative p-[1px] rounded-2xl bg-gradient-to-br from-primary/50 to-purple-600/50 shadow-lg shadow-primary/10">
                                    <div className="bg-[#0d0d0d] rounded-2xl p-5 h-full flex flex-col gap-4">
                                        <div className="flex items-center gap-2 text-primary font-bold text-sm">
                                            <Sparkles size={16} /> Pr√≥ximo Passo
                                        </div>

                                        {(() => {
                                            const isIcebreaker = interactions.length === 0
                                            const hasGeneratedReply = !!draftMessage

                                            // Has a message (from DB or just generated) ‚Üí show it
                                            if (hasGeneratedReply) {
                                                return (
                                                    <>
                                                        {/* SDR Senior Badge */}
                                                        <div className="flex items-center gap-2 px-3 py-1.5 rounded-lg bg-gradient-to-r from-amber-500/20 to-orange-500/20 border border-amber-500/30 text-amber-400 text-[10px] font-bold uppercase tracking-wider">
                                                            <Sparkles size={12} />
                                                            Gerada pelo Agente SDR Senior
                                                        </div>

                                                        {/* Message - Prominent Display */}
                                                        <div className="p-4 rounded-xl bg-white/10 border border-primary/30">
                                                            <p className="text-white text-sm leading-relaxed whitespace-pre-wrap">
                                                                "{draftMessage}"
                                                            </p>
                                                        </div>

                                                        {/* Reasoning (only if available) */}
                                                        {generatedReasoning && (
                                                            <div className="flex gap-2 text-gray-400 text-xs">
                                                                <span className="text-primary/60 shrink-0">üí°</span>
                                                                <p className="leading-relaxed italic">
                                                                    {generatedReasoning}
                                                                </p>
                                                            </div>
                                                        )}

                                                        {/* Regenerate Button */}
                                                        <button
                                                            onClick={generateAISuggestion}
                                                            disabled={generatingReply}
                                                            className="w-full mt-2 py-2.5 rounded-lg bg-gradient-to-r from-amber-500/20 to-orange-500/20 hover:from-amber-500/30 hover:to-orange-500/30 border border-amber-500/30 text-xs font-semibold text-amber-300 hover:text-amber-200 transition-all flex justify-center items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed"
                                                        >
                                                            {generatingReply ? (
                                                                <>
                                                                    <Loader2 size={14} className="animate-spin" />
                                                                    {isIcebreaker ? 'Gerando Icebreaker...' : 'Gerando Resposta...'}
                                                                </>
                                                            ) : (
                                                                <>
                                                                    <Sparkles size={14} />
                                                                    {isIcebreaker ? 'Gerar Novo Icebreaker' : 'Gerar Nova Resposta'}
                                                                </>
                                                            )}
                                                        </button>

                                                        {/* Use in Chat Button */}
                                                        <button
                                                            onClick={() => {
                                                                setNewMessage(draftMessage)
                                                                setSelectedSuggestionIdx(0)
                                                            }}
                                                            className="w-full py-2.5 rounded-lg bg-primary hover:bg-primary/80 text-white text-xs font-bold shadow-lg shadow-primary/20 transition-all flex justify-center items-center gap-2"
                                                        >
                                                            <Check size={14} />
                                                            Usar no Chat
                                                        </button>
                                                    </>
                                                )
                                            }

                                            // Default: Empty state ‚Üí show generate button
                                            return (
                                                <div className="text-center py-6">
                                                    <p className="text-sm text-gray-400 mb-5">
                                                        {isIcebreaker
                                                            ? 'Nenhuma conversa iniciada com este lead.'
                                                            : 'Clique para gerar uma sugest√£o de resposta com IA.'}
                                                    </p>
                                                    <button
                                                        onClick={generateAISuggestion}
                                                        disabled={generatingReply}
                                                        className="w-full py-3 rounded-lg bg-gradient-to-r from-amber-500/20 to-orange-500/20 hover:from-amber-500/30 hover:to-orange-500/30 border border-amber-500/30 text-sm font-semibold text-amber-300 hover:text-amber-200 transition-all flex justify-center items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed"
                                                    >
                                                        {generatingReply ? (
                                                            <>
                                                                <Loader2 size={14} className="animate-spin" />
                                                                {isIcebreaker ? 'Gerando Icebreaker...' : 'Gerando Resposta...'}
                                                            </>
                                                        ) : (
                                                            <>
                                                                <Sparkles size={14} />
                                                                {isIcebreaker ? 'Gerar Icebreaker' : 'Gerar Resposta'}
                                                            </>
                                                        )}
                                                    </button>
                                                </div>
                                            )
                                        })()}
                                    </div>
                                </div>
                            </>
                        ) : (
                            <div className="bg-[#0d0d0d] rounded-2xl border border-white/10 p-8 text-center text-gray-400 text-sm h-40 flex items-center justify-center">
                                Contexto do lead aparecer√° aqui.
                            </div>
                        )}
                    </div>
                </div>
            )}
        </div>
    )
}

export default SalesInboxPage

```

---

## Arquivo: src\pages\SystemInfoPage.jsx
```jsx
import React from 'react'
import { RefreshCw, History, Info, Server, ShieldCheck, Activity } from 'lucide-react'

const SystemInfoPage = () => {
    return (
        <div className="p-8 max-w-5xl mx-auto space-y-8 animate-fade-in-up">

            {/* Header */}
            <div className="flex flex-col gap-2 mb-8">
                <h1 className="text-3xl font-bold text-slate-900 flex items-center gap-3">
                    <Info className="text-blue-600" size={32} />
                    Informa√ß√µes do Sistema
                </h1>
                <p className="text-slate-500 text-lg">
                    Entenda como o Link&Lead opera seus processos de sincroniza√ß√£o e seguran√ßa.
                </p>
            </div>

            {/* SYNC STATUS SECTION */}
            <div className="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
                <div className="px-8 py-6 border-b border-slate-100 bg-slate-50/50 flex items-center gap-3">
                    <Activity size={20} className="text-slate-500" />
                    <h2 className="text-xl font-bold text-slate-800">Status da Sincroniza√ß√£o</h2>
                </div>

                <div className="p-8 grid gap-8 md:grid-cols-2">

                    {/* Block 1: Real-time Sync */}
                    <div className="flex flex-col gap-4 p-6 rounded-xl bg-green-50/50 border border-green-100/50 hover:shadow-md transition-shadow">
                        <div className="w-12 h-12 rounded-full bg-green-100 text-green-600 flex items-center justify-center shadow-sm">
                            <RefreshCw size={24} className="animate-spin-slow" />
                        </div>
                        <div>
                            <h3 className="text-lg font-bold text-slate-900 mb-2 flex items-center gap-2">
                                üü¢ Sincroniza√ß√£o em Tempo Real (O "Rep√≥rter")
                            </h3>
                            <p className="text-slate-600 leading-relaxed">
                                "Para manter suas conversas fluindo, o sistema verifica novas mensagens automaticamente v√°rias vezes ao dia. Assim que seu lead responder no LinkedIn, a mensagem aparecer√° na plataforma e a IA analisar√° o contexto imediato para sugerir a pr√≥xima a√ß√£o. (Janela de leitura: √öltimas 50 mensagens)."
                            </p>
                        </div>
                    </div>

                    {/* Block 2: History Import */}
                    <div className="flex flex-col gap-4 p-6 rounded-xl bg-amber-50/50 border border-amber-100/50 hover:shadow-md transition-shadow">
                        <div className="w-12 h-12 rounded-full bg-amber-100 text-amber-600 flex items-center justify-center shadow-sm">
                            <History size={24} />
                        </div>
                        <div>
                            <h3 className="text-lg font-bold text-slate-900 mb-2 flex items-center gap-2">
                                üü° Importa√ß√£o de Hist√≥rico (O "Arque√≥logo")
                            </h3>
                            <p className="text-slate-600 leading-relaxed">
                                "Para garantir que a IA conhe√ßa seu cliente a fundo, ao cadastrar um novo lead, iniciamos uma varredura segura para recuperar o hist√≥rico de conversas antigas (at√© 1 ano). Isso permite que o sistema entenda dores passadas e negocia√ß√µes anteriores. (Execu√ß√£o √∫nica no cadastro)."
                            </p>
                        </div>
                    </div>

                </div>
            </div>

            {/* SERVER SECTION */}
            <div className="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
                <div className="px-8 py-6 border-b border-slate-100 bg-slate-50/50 flex items-center gap-3">
                    <Server size={20} className="text-slate-500" />
                    <h2 className="text-xl font-bold text-slate-800">Infraestrutura & Seguran√ßa</h2>
                </div>
                <div className="p-8">
                    <div className="flex gap-4 items-start">
                        <div className="mt-1">
                            <ShieldCheck size={24} className="text-indigo-600" />
                        </div>
                        <div>
                            <h3 className="text-lg font-bold text-slate-900 mb-2">Dados e Privacidade</h3>
                            <p className="text-slate-600 leading-relaxed max-w-2xl">
                                Todos os dados de leads e mensagens s√£o processados em servidores seguros. Utilizamos conex√µes criptografadas (SSL) para toda a comunica√ß√£o com o LinkedIn e gateways de pagamento. Seus dados nunca s√£o compartilhados com terceiros.
                            </p>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    )
}

export default SystemInfoPage

```

---

## Arquivo: src\services\api.js
```js

export const generateContent = async (cliente, tema, publico, clientData = null, imageUrl = null) => {
    try {
        // Construct rich payload with briefing data if available
        const payload = {
            cliente,
            tema,
            publico,
            imageUrl, // Pass the uploaded image URL
            // If clientData exists, inject its fields
            ...(clientData && {
                clientId: clientData.id, // Explicit ID for DB relation
                resumo_negocio: clientData.description,
                tom_de_voz: clientData.tone_of_voice,
                dores: clientData.pain_points
            })
        }

        const response = await fetch('https://n8n-n8n-start.kfocge.easypanel.host/webhook/create-post-workflow', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(payload),
        })

        if (!response.ok) {
            throw new Error('Erro ao gerar conte√∫do')
        }

        return await response.json()
    } catch (error) {
        console.error('Error generating content:', error)
        throw error
    }
}

```

---

## Arquivo: src\services\supabaseClient.js
```js

import { createClient } from '@supabase/supabase-js'

const supabaseUrl = import.meta.env.VITE_SUPABASE_URL
const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY

export const supabase = createClient(supabaseUrl, supabaseAnonKey)

```

---


```

## File: supabase_migration_add_columns.sql
```sql

-- Migration to add cadence_stage and message_count to leads table if missing

-- Add cadence_stage column
ALTER TABLE leads 
ADD COLUMN IF NOT EXISTS cadence_stage TEXT DEFAULT 'G1';

-- Add message_count column
ALTER TABLE leads 
ADD COLUMN IF NOT EXISTS message_count INTEGER DEFAULT 0;

-- Optional: Create an index for performance if needed
CREATE INDEX IF NOT EXISTS idx_leads_cadence_stage ON leads(cadence_stage);

```

## File: tailwind.config.js
```javascript
/** @type {import('tailwindcss').Config} */
export default {
    content: [
        "./index.html",
        "./src/**/*.{js,ts,jsx,tsx}",
    ],
    theme: {
        extend: {
            colors: {
                obsidian: '#030303',
                charcoal: '#0a0a0a',
                primary: '#ff4d00',
                glass: 'rgba(255, 255, 255, 0.03)',
                'glass-border': 'rgba(255, 255, 255, 0.08)',
                'surface': 'rgba(255, 255, 255, 0.05)',
                'surface-hover': 'rgba(255, 255, 255, 0.08)',
            },
            backdropBlur: {
                xs: '2px',
            },
            boxShadow: {
                glow: '0 0 20px rgba(255, 77, 0, 0.3)',
            }
        },
    },
    plugins: [],
}

```

## File: vercel.json
```json
{
    "rewrites": [
        {
            "source": "/(.*)",
            "destination": "/index.html"
        }
    ]
}
```

## File: vite.config.js
```javascript
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'
import path from 'path'

// https://vite.dev/config/
export default defineConfig({
  plugins: [react()],
  resolve: {
    alias: {
      "@": path.resolve(__dirname, "./src"),
    },
  },
})

```

## File: src\App.css
```css
/* App.css */
```

## File: src\App.jsx
```javascript
import React, { useState, useEffect } from 'react'
import { supabase } from './services/supabaseClient'
import { BrowserRouter as Router, Routes, Route, Navigate, useLocation } from 'react-router-dom'
import { AuthProvider, useAuth } from './contexts/AuthContext'
import './App.css'

// Pages & Components
import AdminPanel from './pages/AdminPanel'
import ClientPortal from './pages/ClientPortal' // External review
import ClientDashboard from './pages/ClientDashboard' // Old/Legacy portal if any
import PostsPage from './pages/PostsPage'
import PostFeedbackPage from './pages/PostFeedbackPage' // New Feedback Loop
import Login from './pages/Login'
import ClientsPage from './pages/ClientsPage'
import IdeasPage from './pages/IdeasPage'
import SalesHubPage from './pages/SalesHubPage'
import SalesInboxPage from './pages/SalesInboxPage'
import CampaignsPage from './pages/CampaignsPage'
import CampaignLeadsView from './pages/CampaignLeadsView'
import CampaignLeadsPage from './pages/CampaignLeadsPage'
import SystemInfoPage from './pages/SystemInfoPage'
import LinkedInEngagementPage from './pages/LinkedInEngagementPage'
import MissionsPage from './pages/MissionsPage'
import AdminLayout from './components/AdminLayout'

// Client Portal New (Ideas/Insights)
import ClientLoginPage from './pages/ClientLoginPage'
import ClientDashboardLayout from './components/ClientDashboardLayout'
import ClientInsightsPage from './pages/ClientInsightsPage'
import { ClientAuthProvider, useClientAuth } from './contexts/ClientAuthContext'
import { ClientSelectionProvider } from './contexts/ClientSelectionContext'
import { useParams, useNavigate } from 'react-router-dom'

// Magic Link Handler Component
const MagicLinkHandler = () => {
  console.log("ROTA ACIONADA: MagicLinkHandler montado") // DEBUG LIFE CHECK
  const { token } = useParams()
  console.log("Token from URL:", token)

  const { loginWithToken, loading: authLoading, clientUser } = useClientAuth()
  const navigate = useNavigate()
  const [authAttempted, setAuthAttempted] = useState(false)
  const [error, setError] = useState(null)

  useEffect(() => {
    const attemptLogin = async () => {
      if (token && !clientUser) {
        // Ignore "insights" if it accidentally matches (though Router should handle it)
        if (token === 'insights' || token === 'login') return;

        const success = await loginWithToken(token)
        if (!success) {
          setError('Link inv√°lido ou expirado.')
        }
      }
      setAuthAttempted(true)
    }
    attemptLogin()
  }, [token, clientUser, loginWithToken])

  if (authLoading || !authAttempted) {
    return (
      <div className="loading-screen" style={{ display: 'flex', flexDirection: 'column', gap: '1rem', alignItems: 'center', justifyContent: 'center', height: '100vh' }}>
        <div style={{ width: '40px', height: '40px', border: '3px solid #e2e8f0', borderTopColor: '#2563eb', borderRadius: '50%', animation: 'spin 1s linear infinite' }}></div>
        <span>Validando acesso...</span>
        <style>{`@keyframes spin { to { transform: rotate(360deg); } }`}</style>
      </div>
    )
  }

  if (error) {
    return (
      <div style={{ height: '100vh', display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', gap: '1rem', fontFamily: 'sans-serif' }}>
        <h2 style={{ fontSize: '1.5rem', fontWeight: 'bold', color: '#ef4444' }}>Acesso Negado</h2>
        <p style={{ color: '#64748b' }}>{error}</p>
        <button
          onClick={() => navigate('/portal/login')}
          style={{ padding: '0.75rem 1.5rem', background: '#2563eb', color: 'white', border: 'none', borderRadius: '8px', cursor: 'pointer' }}
        >
          Ir para Login
        </button>
      </div>
    )
  }

  if (!clientUser) {
    // Fallback safety
    return <Navigate to="/portal/login" replace />
  }

  // Success: Render the standard Dashboard Layout
  return (
    <ClientDashboardLayout>
      <ClientInsightsPage />
    </ClientDashboardLayout>
  )
}

// Validates authentication and role (Admin)
const ProtectedRoute = ({ children, allowedRoles }) => {
  const { user, profile, loading } = useAuth()
  const location = useLocation()

  // 1. Loading inicial de Auth (Sess√£o)
  if (loading) return <div className="loading-screen">Carregando...</div>

  // 2. Sem usu√°rio -> Login
  if (!user) {
    return <Navigate to="/login" state={{ from: location }} replace />
  }

  // 3. Usu√°rio existe, mas Perfil ainda carregando (Fetch em background)
  // Se a rota exige role, precisamos esperar o profile
  if (allowedRoles && !profile) {
    return <div className="loading-screen">Verificando permiss√µes...</div>
  }

  // 4. Checagem de Role
  if (allowedRoles && profile && !allowedRoles.includes(profile.role)) {
    // Redirect based on role
    if (profile.role === 'client') return <Navigate to="/portal/insights" replace />
    if (profile.role === 'admin') return <Navigate to="/" replace />
    return <Navigate to="/login" replace /> // Fallback
  }

  return children
}

function App() {
  // REMOVED BLOCKING SESSION CHECK here to allow instant render of public routes.
  // AuthProvider will handle its own loading state for protected routes.

  return (
    <Router>
      <Routes>
        {/* === CLIENT PORTAL ROUTES (Decoupled from Global AuthProvider) === */}

        {/* 1. Magic Link Route (Public - handled by ClientInsightsPage logic) */}
        <Route path="/portal/:token" element={
          <ClientAuthProvider>
            <ClientInsightsPage />
          </ClientAuthProvider>
        } />

        {/* 2. Login Page (Public) */}
        <Route path="/portal/login" element={<ClientLoginPage />} />

        {/* 3. Insights Page (Protected by Layout check logic) */}
        <Route path="/portal/insights" element={
          <ClientAuthProvider>
            <ClientDashboardLayout>
              <ClientInsightsPage />
            </ClientDashboardLayout>
          </ClientAuthProvider>
        } />

        {/* === MAIN APP ROUTES (Wrapped in AuthProvider) === */}
        <Route path="/*" element={
          <AuthProvider>
            <Routes>
              {/* Public App Routes */}
              <Route path="/login" element={<Login />} />
              <Route path="/aprovacao" element={<ClientPortal />} />
              <Route path="/post-feedback/:id" element={<PostFeedbackPage />} />

              {/* Admin Protected Routes */}
              <Route element={
                <ProtectedRoute allowedRoles={['admin']}>
                  <ClientSelectionProvider>
                    <AdminLayout />
                  </ClientSelectionProvider>
                </ProtectedRoute>
              }>
                <Route path="/" element={<AdminPanel />} />
                <Route path="/posts" element={<PostsPage />} />
                <Route path="/clients" element={<ClientsPage />} />
                <Route path="/ideas" element={<IdeasPage />} />
                <Route path="/sales" element={<SalesHubPage />} />
                <Route path="/campaigns" element={<CampaignsPage />} />
                <Route path="/campaigns" element={<CampaignsPage />} />
                <Route path="/campaigns/:id" element={<CampaignLeadsView />} />
                <Route path="/campaigns/:campaignId/leads" element={<CampaignLeadsPage />} />
                <Route path="/sales/inbox" element={<SalesInboxPage />} />
                <Route path="/system-info" element={<SystemInfoPage />} />
                <Route path="/engagement" element={<LinkedInEngagementPage />} />
                <Route path="/missions" element={<MissionsPage />} />
              </Route>

              {/* Fallback */}
              <Route path="*" element={<Navigate to="/" replace />} />
            </Routes>
          </AuthProvider>
        } />
      </Routes>
    </Router>
  )
}

export default App

```

## File: src\index.css
```css
/* Google Fonts - Plus Jakarta Sans */
@import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:ital,wght@0,200..800;1,200..800&display=swap');

@tailwind base;
@tailwind components;
@tailwind utilities;

:root {
  /* Brand Typography */
  --font-main: 'Plus Jakarta Sans', system-ui, -apple-system, sans-serif;

  /* Color Palette - OBSIDIAN GLASS THEME */
  --color-bg: #030303;
  /* Deep Void */
  --color-surface: rgba(255, 255, 255, 0.03);
  --color-surface-hover: rgba(255, 255, 255, 0.06);
  --color-glass-border: rgba(255, 255, 255, 0.08);
  --color-glass-shine: rgba(255, 255, 255, 0.15);

  /* Text Colors */
  --color-text-heading: #ffffff;
  /* White */
  --color-text-body: #94a3b8;
  /* Slate 400 */
  --color-text-muted: #64748b;
  /* Slate 500 */
  --color-text-highlight: #e2e8f0;
  /* Slate 200 */

  /* Brand Colors */
  --color-primary: #ff4d00;
  /* Signal Orange */
  --color-primary-glow: rgba(255, 77, 0, 0.4);
  --color-primary-dim: rgba(255, 77, 0, 0.1);

  /* Status Colors */
  --color-success: #10b981;
  --color-success-glow: rgba(16, 185, 129, 0.4);
  --color-danger: #ef4444;
  --color-danger-glow: rgba(239, 68, 68, 0.4);

  /* Spacing & Radii */
  --radius-sm: 4px;
  /* Sharp/Tech */
  --radius-md: 8px;
  /* Standard */
  --radius-lg: 16px;
  /* Floating panels */
  --radius-full: 9999px;

  /* Animation */
  --ease-spring: cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

/* Global Reset & Base */
body {
  margin: 0;
  min-width: 320px;
  min-height: 100vh;
  font-family: var(--font-main);
  background-color: var(--color-bg);
  /* Deep mesh gradient background */
  background-image:
    radial-gradient(circle at 15% 50%, rgba(255, 77, 0, 0.08), transparent 25%),
    radial-gradient(circle at 85% 30%, rgba(77, 77, 255, 0.05), transparent 25%);
  color: var(--color-text-body);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  line-height: 1.6;
  overflow-x: hidden;
}

/* Headings */
h1,
h2,
h3,
h4,
h5,
h6 {
  color: var(--color-text-heading);
  font-weight: 700;
  margin-top: 0;
  letter-spacing: -0.025em;
  /* Tighter for modern look */
}

/* GLASS UTILITIES - The Core of the Design */

.glass-panel {
  background: var(--color-surface);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  border: 1px solid var(--color-glass-border);
  box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
}

.glass-panel-hover:hover {
  background: var(--color-surface-hover);
  border-color: var(--color-glass-shine);
  box-shadow: 0 0 15px rgba(255, 255, 255, 0.05);
  transition: all 0.3s ease;
}

/* Primary Button - Neo-Glass */
.btn-primary {
  position: relative;
  background: var(--color-primary);
  color: white;
  border: none;
  padding: 0.75rem 1.5rem;
  border-radius: var(--radius-sm);
  font-weight: 600;
  font-size: 0.9rem;
  letter-spacing: 0.01em;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  overflow: hidden;
  transition: all 0.2s var(--ease-spring);
  box-shadow: 0 0 20px var(--color-primary-glow);
  z-index: 1;
}

/* Internal glass sheen for button */
.btn-primary::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg,
      transparent,
      rgba(255, 255, 255, 0.2),
      transparent);
  transition: 0.5s;
  z-index: -1;
}

.btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 0 30px var(--color-primary-glow);
}

.btn-primary:hover::before {
  left: 100%;
}

/* Inputs - Glass Style */
input,
select,
textarea {
  font-family: inherit;
  background-color: rgba(255, 255, 255, 0.03);
  /* Extremely transparent */
  border: 1px solid var(--color-glass-border);
  border-radius: var(--radius-sm);
  padding: 0.75rem 1rem;
  font-size: 0.95rem;
  color: var(--color-text-heading);
  transition: all 0.2s;
  outline: none;
  backdrop-filter: blur(4px);
}

input:focus,
select:focus,
textarea:focus {
  background-color: rgba(255, 255, 255, 0.05);
  border-color: var(--color-primary);
  box-shadow: 0 0 0 1px var(--color-primary), 0 0 15px var(--color-primary-dim);
}

input::placeholder {
  color: var(--color-text-muted);
}

/* Scrollbar - Dark & Slim */
::-webkit-scrollbar {
  width: 6px;
  height: 6px;
}

::-webkit-scrollbar-track {
  background: #000;
}

::-webkit-scrollbar-thumb {
  background: #333;
  border-radius: 3px;
}

::-webkit-scrollbar-thumb:hover {
  background: var(--color-primary);
}

/* Utility: Text Gradients */
.text-gradient {
  background: linear-gradient(135deg, #fff 0%, #94a3b8 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.text-gradient-primary {
  background: linear-gradient(135deg, #ff4d00 0%, #ff8800 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

/* Table overrides for Glass look */
/* We'll use these in the component updates, but defining base here helps */

/* Animations */
@keyframes float {
  0% {
    transform: translateY(0px);
  }

  50% {
    transform: translateY(-10px);
  }

  100% {
    transform: translateY(0px);
  }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
}
```

## File: src\main.jsx
```javascript
import { StrictMode } from 'react'
import { createRoot } from 'react-dom/client'
import './index.css'
import App from './App.jsx'

console.log('Main starting...')
window.mainLoaded = true

import ErrorBoundary from './components/ErrorBoundary'

import { LanguageProvider } from './contexts/LanguageContext'

createRoot(document.getElementById('root')).render(
  <StrictMode>
    <ErrorBoundary>
      <LanguageProvider>
        <App />
      </LanguageProvider>
    </ErrorBoundary>
  </StrictMode>,
)

```

## File: src\components\AddLeadsModal.jsx
```javascript
import React, { useState } from 'react'

import {
    X,
    Linkedin,
    Users,
    Search,
    ArrowLeft,
    Loader2,
    CheckCircle2,
    Link as LinkIcon
} from 'lucide-react'

const AddLeadsModal = ({ isOpen, onClose, campaignId, clientId, onImportConnections }) => {
    const [view, setView] = useState('selection') // 'selection' | 'post-form'
    const [postUrl, setPostUrl] = useState('')
    const [loading, setLoading] = useState(false)
    const [success, setSuccess] = useState(false)

    if (!isOpen) return null

    const handleBack = () => {
        setView('selection')
        setPostUrl('')
        setSuccess(false)
    }

    const handleImportFromPost = async (e) => {
        e.preventDefault()
        if (!postUrl) return

        setLoading(true)
        try {
            const response = await fetch('https://n8n-n8n-start.kfocge.easypanel.host/webhook/import-post-leads', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    post_url: postUrl,
                    campaign_id: campaignId,
                    client_id: clientId
                })
            })

            if (response.ok) {
                setSuccess(true)
                setTimeout(() => {
                    onClose()
                    // Reset after close
                    setTimeout(() => {
                        setSuccess(false)
                        setPostUrl('')
                        setView('selection')
                    }, 300)
                }, 2000)
            } else {
                console.error('Webhook error')
                // Handle error visual state if needed
            }
        } catch (err) {
            console.error(err)
        } finally {
            setLoading(false)
        }
    }

    // NEW: Trigger History Import (Backend Logic Requirement)
    const triggerHistoryScan = async (leadId, accountId) => {
        try {
            const response = await fetch('https://n8n-n8n-start.kfocge.easypanel.host/webhook/import-history', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    lead_id: leadId,
                    account_id: accountId
                })
            })
            if (!response.ok) {
                // Feedback only on error
                console.error('Falha no trigger de hist√≥rico')
                // If we had a toast system here: toast.error("Erro ao iniciar sincroniza√ß√£o de hist√≥rico")
                alert("Erro ao iniciar sincroniza√ß√£o de hist√≥rico")
            }
        } catch (e) {
            console.error(e)
            alert("Erro ao iniciar sincroniza√ß√£o de hist√≥rico")
        }
    }

    return (
        <div className="fixed inset-0 z-50 flex items-center justify-center bg-slate-900/50 backdrop-blur-sm p-4 animate-fade-in">
            <div className="bg-white w-full max-w-lg rounded-2xl shadow-2xl overflow-hidden animate-scale-in flex flex-col max-h-[90vh]">

                {/* HEADER */}
                <div className="p-6 border-b border-slate-100 flex justify-between items-center">
                    <div className="flex items-center gap-3">
                        {view === 'post-form' && (
                            <button onClick={handleBack} className="p-1 rounded-full hover:bg-gray-100 text-gray-500 transition-colors">
                                <ArrowLeft size={20} />
                            </button>
                        )}
                        <div>
                            <h2 className="text-xl font-bold text-slate-800">Adicionar Leads</h2>
                            <p className="text-sm text-gray-500 mt-0.5">
                                {view === 'selection' ? 'Escolha uma fonte de importa√ß√£o' : 'Importar engajamento de Post'}
                            </p>
                        </div>
                    </div>
                    <button onClick={onClose} className="p-2 rounded-full hover:bg-gray-100 text-gray-400 transition-colors">
                        <X size={20} />
                    </button>
                </div>

                {/* CONTENT */}
                <div className="p-6 overflow-y-auto">
                    {success ? (
                        <div className="flex flex-col items-center justify-center py-10 text-center animate-fade-in">
                            <div className="w-16 h-16 bg-green-100 text-green-600 rounded-full flex items-center justify-center mb-4">
                                <CheckCircle2 size={32} />
                            </div>
                            <h3 className="text-xl font-bold text-slate-800 mb-2">Importa√ß√£o Iniciada!</h3>
                            <p className="text-gray-500 max-w-xs mx-auto">
                                O rob√¥ est√° processando o post. Os leads aparecer√£o na campanha em breve.
                            </p>
                        </div>
                    ) : view === 'selection' ? (
                        <div className="grid gap-4">
                            {/* Option 1: LinkedIn Post */}
                            <button
                                onClick={() => setView('post-form')}
                                className="flex items-center gap-4 p-4 rounded-xl border border-slate-200 hover:border-blue-500 hover:bg-blue-50/30 transition-all text-left group"
                            >
                                <div className="w-12 h-12 rounded-lg bg-blue-100 text-blue-600 flex items-center justify-center shrink-0 group-hover:scale-110 transition-transform">
                                    <Linkedin size={24} />
                                </div>
                                <div>
                                    <h3 className="font-bold text-slate-800 group-hover:text-blue-700">Importar de Post do LinkedIn</h3>
                                    <p className="text-xs text-gray-500 mt-1">Extraia perfis que curtiram ou comentaram em um post viral.</p>
                                </div>
                            </button>

                            {/* Option 2: Connections (Active) */}
                            <button
                                onClick={() => {
                                    if (onImportConnections) onImportConnections()
                                    onClose()
                                }}
                                className="flex items-center gap-4 p-4 rounded-xl border border-slate-200 hover:border-blue-500 hover:bg-blue-50/30 transition-all text-left group w-full"
                            >
                                <div className="w-12 h-12 rounded-lg bg-blue-100 text-blue-600 flex items-center justify-center shrink-0 group-hover:scale-110 transition-transform">
                                    <Users size={24} />
                                </div>
                                <div className="flex-1">
                                    <div className="flex justify-between items-center">
                                        <h3 className="font-bold text-slate-800 group-hover:text-blue-700">Suas Conex√µes</h3>
                                        <span className="text-[10px] font-bold bg-green-100 text-green-600 px-2 py-0.5 rounded-full uppercase">Novo</span>
                                    </div>
                                    <p className="text-xs text-gray-500 mt-1">Importe suas conex√µes recentes para qualifica√ß√£o.</p>
                                </div>
                            </button>

                            {/* Option 3: Search (Disabled) */}
                            <div className="flex items-center gap-4 p-4 rounded-xl border border-slate-200 bg-slate-50/50 opacity-60 cursor-not-allowed">
                                <div className="w-12 h-12 rounded-lg bg-slate-200 text-slate-400 flex items-center justify-center shrink-0">
                                    <Search size={24} />
                                </div>
                                <div className="flex-1">
                                    <div className="flex justify-between items-center">
                                        <h3 className="font-bold text-slate-400">Sales Navigator Search</h3>
                                        <span className="text-[10px] font-bold bg-gray-200 text-gray-500 px-2 py-0.5 rounded-full uppercase">Em Breve</span>
                                    </div>
                                    <p className="text-xs text-gray-400 mt-1">Cole uma URL de pesquisa do Sales Nav.</p>
                                </div>
                            </div>
                        </div>
                    ) : (
                        // FORM VIEW
                        <form onSubmit={handleImportFromPost} className="animate-fade-in">
                            <div className="mb-6">
                                <label className="block text-sm font-bold text-slate-700 mb-2">URL do Post do LinkedIn</label>
                                <div className="relative">
                                    <div className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">
                                        <LinkIcon size={18} />
                                    </div>
                                    <input
                                        autoFocus
                                        type="url"
                                        required
                                        value={postUrl}
                                        onChange={e => setPostUrl(e.target.value)}
                                        placeholder="https://www.linkedin.com/posts/..."
                                        className="w-full pl-10 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-800 focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all font-medium"
                                    />
                                </div>
                                <p className="text-xs text-gray-400 mt-2">
                                    Certifique-se de que o post √© p√∫blico. O rob√¥ ir√° verificar likes e coment√°rios.
                                </p>
                            </div>

                            <button
                                type="submit"
                                disabled={loading || !postUrl}
                                className="w-full py-3.5 rounded-xl bg-blue-600 text-white font-bold hover:bg-blue-700 transition-all shadow-lg shadow-blue-200 disabled:opacity-70 disabled:cursor-not-allowed flex items-center justify-center gap-2"
                            >
                                {loading ? <Loader2 className="animate-spin" size={20} /> : <Linkedin size={20} />}
                                {loading ? 'Importando...' : 'Importar e Analisar'}
                            </button>
                        </form>
                    )}
                </div>
            </div>
        </div>
    )
}

export default AddLeadsModal

```

## File: src\components\AdminLayout.jsx
```javascript
import React, { useState } from 'react'
import { Outlet, Link, useLocation } from 'react-router-dom'
import { useAuth } from '../contexts/AuthContext'
import {
    LayoutDashboard,
    FileText,
    Users,
    LogOut,
    Plus,
    Lightbulb,
    Menu, // Added
    X, // Added
    Briefcase, // Added
    Database, // Added
    ChevronDown,
    ChevronRight,
    MessageCircle, // Added
    Target, // Added
    Flame, // Cockpit de Vendas
    Info,
    ThumbsUp
} from 'lucide-react'
import CreatePostModal from './CreatePostModal'
import ClientSelector from './ClientSelector'
// Reusing AdminPanel styles as requested/implied for consistency without full CSS refactor
import '../pages/AdminPanel.css'

import { useLanguage } from '../contexts/LanguageContext'

const AdminLayout = () => {
    const { signOut } = useAuth()
    const { t, language, setLanguage } = useLanguage()
    const [showModal, setShowModal] = useState(false)
    const [isSidebarOpen, setSidebarOpen] = useState(false) // Mobile State
    const location = useLocation()

    const isActive = (path) => {
        return location.pathname === path ? 'nav-item active' : 'nav-item'
    }

    const toggleSidebar = () => setSidebarOpen(!isSidebarOpen)

    const [expandedGroups, setExpandedGroups] = useState({
        creative: true,
        sales: true
    })

    const toggleGroup = (group) => {
        setExpandedGroups(prev => ({ ...prev, [group]: !prev[group] }))
    }



    return (
        <div className="dashboard-layout">
            {/* MOBILE HEADER (VISIBLE ONLY ON MOBILE) */}
            <div className="mobile-header">
                <button onClick={toggleSidebar} className="menu-btn">
                    <Menu size={24} />
                </button>
                <img src="/logo-linklead.png" alt="Link&Lead" style={{ height: '32px' }} />
            </div>

            {/* OVERLAY FOR MOBILE */}
            {isSidebarOpen && (
                <div
                    className="sidebar-overlay"
                    onClick={() => setSidebarOpen(false)}
                />
            )}

            {/* GLOBAL SIDEBAR */}
            <aside className={`sidebar ${isSidebarOpen ? 'open' : ''}`}>

                {/* Mobile Close Button */}
                {/* Sidebar Close Button Removed as requested */}


                <div className="logo-area">
                    <img src="/logo-linklead.png" alt="Link&Lead" style={{ maxWidth: '160px', height: 'auto' }} />
                </div>
                <nav className="nav-menu" style={{ gap: '0.5rem' }}>

                    {/* GROUP 1: Gest√£o Criativa */}
                    <div className="nav-group">
                        <button
                            onClick={() => toggleGroup('creative')}
                            style={{
                                width: '100%', display: 'flex', alignItems: 'center', justifyContent: 'space-between',
                                background: 'transparent', border: 'none', color: '#94a3b8',
                                padding: '0.5rem 1.5rem', cursor: 'pointer', fontSize: '0.75rem', fontWeight: '700', letterSpacing: '0.05em'
                            }}
                        >
                            GEST√ÉO CRIATIVA
                            {expandedGroups.creative ? <ChevronDown size={14} /> : <ChevronRight size={14} />}
                        </button>

                        {expandedGroups.creative && (
                            <div className="nav-group-items" style={{ animation: 'fadeIn 0.2s' }}>
                                <Link to="/" className={isActive('/')}>
                                    <LayoutDashboard size={20} /> {t('dashboard')}
                                </Link>
                                <Link to="/posts" className={isActive('/posts')}>
                                    <FileText size={20} /> {t('posts')}
                                </Link>
                                <Link to="/ideas" className={isActive('/ideas')}>
                                    <Lightbulb size={20} /> {t('ideas')}
                                </Link>
                            </div>
                        )}
                    </div>

                    {/* GROUP 2: M√°quina de Vendas */}
                    <div className="nav-group">
                        <button
                            onClick={() => toggleGroup('sales')}
                            style={{
                                width: '100%', display: 'flex', alignItems: 'center', justifyContent: 'space-between',
                                background: 'transparent', border: 'none', color: '#94a3b8',
                                padding: '0.5rem 1.5rem', marginTop: '1rem', cursor: 'pointer', fontSize: '0.75rem', fontWeight: '700', letterSpacing: '0.05em'
                            }}
                        >
                            M√ÅQUINA DE VENDAS
                            {expandedGroups.sales ? <ChevronDown size={14} /> : <ChevronRight size={14} />}
                        </button>

                        {expandedGroups.sales && (
                            <div className="nav-group-items" style={{ animation: 'fadeIn 0.2s' }}>
                                <Link to="/campaigns" className={isActive('/campaigns')}>
                                    <Target size={20} /> Campanhas & Prospec√ß√£o
                                </Link>
                                <Link to="/missions" className={isActive('/missions')}>
                                    <Flame size={20} /> Cockpit de Vendas
                                </Link>
                                <Link to="/sales/inbox" className={isActive('/sales/inbox')}>
                                    <div style={{ position: 'relative' }}>
                                        <MessageCircle size={20} />
                                    </div>
                                    Inbox Inteligente
                                </Link>
                                <Link to="/clients" className={isActive('/clients')}>
                                    <Users size={20} /> Gerenciar Clientes
                                </Link>
                                <Link to="/engagement" className={isActive('/engagement')}>
                                    <ThumbsUp size={20} /> Engajamento LinkedIn
                                </Link>
                                <Link to="/system-info" className={isActive('/system-info')}>
                                    <Info size={20} /> Informa√ß√µes do Sistema
                                </Link>
                            </div>
                        )}
                    </div>

                    <div style={{ marginTop: 'auto' }}></div>

                    <button
                        type="button"
                        onClick={(e) => {
                            e.preventDefault()
                            signOut()
                        }}
                        className="nav-item"
                        style={{
                            marginTop: '0',
                            background: 'transparent',
                            border: 'none',
                            cursor: 'pointer',
                            color: '#ef4444',
                            width: '100%',
                            justifyContent: 'flex-start',
                            position: 'relative',
                            zIndex: 50
                        }}
                    >
                        <LogOut size={20} /> {t('logout')}
                    </button>
                </nav>
                <div className="sidebar-footer">
                    <button className="btn-new-post" onClick={() => setShowModal(true)}>
                        <Plus size={18} /> {t('newPost')}
                    </button>
                </div>
            </aside>

            {/* MAIN CONTENT AREA */}
            <main className="main-content">
                {/* Sales Context Header */}
                {(location.pathname.startsWith('/sales') || location.pathname.startsWith('/leads') || location.pathname.startsWith('/campaigns') || location.pathname.startsWith('/engagement') || location.pathname.startsWith('/missions')) && (
                    <div className="context-header" style={{
                        padding: '0.75rem 1.5rem',
                        background: 'rgba(255, 255, 255, 0.03)',
                        borderBottom: '1px solid rgba(255, 255, 255, 0.08)',
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'space-between'
                    }}>
                        <div style={{ display: 'flex', alignItems: 'center', gap: '1rem' }}>
                            <span style={{ fontSize: '0.9rem', color: '#5F5F5F' }}>Contexto:</span>
                            <ClientSelector />
                        </div>
                    </div>
                )}
                <Outlet />
            </main>

            {/* GLOBAL CREATE MODAL */}
            {
                showModal && (
                    <CreatePostModal
                        onClose={() => setShowModal(false)}
                        onSuccess={() => {
                            // Ideally we trigger a refresh here. 
                            // Since we are in Layout, we might need a context or simple page reload for now.
                            // Or we pass a context method. 
                            // For simplicity in this request (focus on Layout), I'll just close it.
                            // The user can refresh individual pages or we rely on React Query (not installed) or Realtime (installed).
                            // I'll force a soft reload of the current view if possible, or just close.
                            setShowModal(false)
                            window.location.reload() // Bruteforce refresh to ensure lists update on all pages
                        }}
                    />
                )
            }
        </div >
    )
}

export default AdminLayout

```

## File: src\components\ClientDashboardLayout.jsx
```javascript
import React from 'react'
import { Outlet, Navigate, useLocation } from 'react-router-dom'
import { useClientAuth } from '../contexts/ClientAuthContext'
import { LogOut, LayoutDashboard, HelpCircle } from 'lucide-react'
import SystemStatusHelpModal from './SystemStatusHelpModal'

const ClientDashboardLayout = () => {
    const { clientUser, clientId, loading, signOut, isTokenAuth } = useClientAuth()
    const location = useLocation()
    const [isHelpOpen, setIsHelpOpen] = React.useState(false)

    if (loading) return (
        <div className="min-h-screen flex items-center justify-center bg-obsidian text-white">
            <div className="animate-pulse flex flex-col items-center gap-4">
                <div className="w-12 h-12 rounded-full border-2 border-primary border-t-transparent animate-spin" />
                <span className="text-gray-400 text-sm tracking-wider uppercase">Carregando Portal...</span>
            </div>
        </div>
    )

    if (!clientUser || !clientId) {
        return <Navigate to="/portal/login" state={{ from: location }} replace />
    }

    return (
        <div className="min-h-screen bg-obsidian text-white selection:bg-primary selection:text-white pb-12 relative overflow-x-hidden">

            {/* AMBIENT BACKGROUND GLOWS - FIXED POSITIONS */}
            <div className="fixed top-0 left-0 w-[500px] h-[500px] bg-primary/20 blur-[120px] rounded-full pointer-events-none -translate-x-1/2 -translate-y-1/2 z-0" />
            <div className="fixed bottom-0 right-0 w-[500px] h-[500px] bg-blue-600/10 blur-[120px] rounded-full pointer-events-none translate-x-1/2 translate-y-1/2 z-0" />

            {/* FLOATING HUD HEADER */}
            <header className="sticky top-6 mx-auto max-w-7xl px-6 z-50 mb-12">
                <div className="glass-panel rounded-2xl md:rounded-full px-6 py-4 flex justify-between items-center shadow-glow border border-glass-border/50">
                    <div className="flex items-center gap-4">
                        <div className="w-10 h-10 rounded-full bg-gradient-to-br from-gray-800 to-black flex items-center justify-center border border-glass-border shadow-inner">
                            <img src="/logo-linklead.png" alt="Link&Lead" className="h-6 w-auto opacity-90" />
                        </div>
                        <div className="h-6 w-px bg-glass-border"></div>
                        <span className="text-gray-300 font-medium tracking-wide text-sm uppercase">Portal do Cliente</span>

                    </div>

                    <div className="flex items-center gap-3">
                        <button
                            onClick={() => setIsHelpOpen(true)}
                            className="p-2 rounded-full text-gray-400 hover:text-white hover:bg-white/10 transition-all"
                            title="Ajuda e Status do Sistema"
                        >
                            <HelpCircle size={20} />
                        </button>

                        {!isTokenAuth && (
                            <button
                                onClick={signOut}
                                className="group flex items-center gap-2 text-gray-400 hover:text-red-400 transition-colors text-sm font-medium px-4 py-2 rounded-full hover:bg-white/5 active:scale-95"
                            >
                                <span className="group-hover:translate-x-1 transition-transform">Sair</span>
                                <LogOut size={16} />
                            </button>
                        )}
                    </div>
                </div>
            </header>

            {/* MAIN CONTENT */}
            <main className="relative z-10 mx-auto max-w-7xl px-6 w-full animate-fade-in-up">
                <Outlet />
            </main>
            <SystemStatusHelpModal isOpen={isHelpOpen} onClose={() => setIsHelpOpen(false)} />
        </div>
    )
}

export default ClientDashboardLayout

```

## File: src\components\ClientSelector.jsx
```javascript
import React, { useEffect, useState } from 'react'
import { supabase } from '../services/supabaseClient'
import { useClientSelection } from '../contexts/ClientSelectionContext'
import { Users, ChevronDown } from 'lucide-react'

const ClientSelector = () => {
    const [clients, setClients] = useState([])
    const { selectedClientId, setSelectedClientId } = useClientSelection()
    const [loading, setLoading] = useState(true)

    useEffect(() => {
        const fetchClients = async () => {
            try {
                const { data, error } = await supabase
                    .from('clients')
                    .select('id, name')
                    .order('name', { ascending: true })

                if (error) throw error
                setClients(data || [])
            } catch (err) {
                console.error('Error fetching clients for selector:', err)
            } finally {
                setLoading(false)
            }
        }
        fetchClients()
    }, [])

    const handleChange = (e) => {
        const val = e.target.value
        setSelectedClientId(val ? parseInt(val) : null)
    }

    const getClientName = (c) => c.name || 'Cliente sem nome'

    return (
        <div className="relative flex items-center group">
            <div className="absolute left-3 pointer-events-none text-primary/80 group-hover:text-primary transition-colors">
                <Users size={16} />
            </div>
            <select
                value={selectedClientId || ''}
                onChange={handleChange}
                disabled={loading}
                className="appearance-none bg-white/5 border border-glass-border hover:border-primary/50 text-sm font-medium rounded-lg pl-10 pr-10 py-2.5 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all cursor-pointer min-w-[200px] backdrop-blur-md"
                style={{ color: '#5F5F5F' }}
            >
                <option value="" className="bg-charcoal text-gray-400">Selecione um Cliente...</option>
                {clients.map(client => (
                    <option key={client.id} value={client.id} className="bg-charcoal text-white">
                        {getClientName(client)}
                    </option>
                ))}
            </select>
            <div className="absolute right-3 pointer-events-none text-gray-500 group-hover:text-white transition-colors">
                <ChevronDown size={14} />
            </div>
        </div>
    )
}

export default ClientSelector

```

## File: src\components\ContentCalendar.jsx
```javascript
import React, { useState } from 'react'
import { format } from 'date-fns'
import { ptBR } from 'date-fns/locale'
import { DayPicker } from 'react-day-picker'
import 'react-day-picker/dist/style.css'
import { Clock, CheckCircle2, ArrowRight, X } from 'lucide-react'

const ContentCalendar = ({ posts }) => {
    const [selectedDayPosts, setSelectedDayPosts] = useState(null)

    // Filter posts that have a schedule date
    const scheduledPosts = posts.filter(p => p.data_agendamento)

    // Modifiers Logic
    const hasPostModifier = (date) => {
        return scheduledPosts.some(post => {
            const postDate = new Date(post.data_agendamento)
            return postDate.toDateString() === date.toDateString()
        })
    }

    const modifiers = {
        hasPost: hasPostModifier
    }

    const modifiersStyles = {
        hasPost: {
            fontWeight: 'bold',
            color: '#6366f1'
        }
    }

    // Custom Day Content to show Dots
    const DayContent = (props) => {
        const { date, displayMonth, activeModifiers } = props
        const dayPosts = scheduledPosts.filter(post =>
            new Date(post.data_agendamento).toDateString() === date.toDateString()
        )

        const isPast = date < new Date().setHours(0, 0, 0, 0)

        // Only render content for days in the current month view (standard behavior)
        if (date.getMonth() !== displayMonth.getMonth()) {
            return <span style={{ color: '#cbd5e1' }}>{date.getDate()}</span>
        }

        return (
            <div style={{ position: 'relative', display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', height: '100%', width: '100%' }}>
                <span>{date.getDate()}</span>
                {dayPosts.length > 0 && (
                    <div style={{ display: 'flex', gap: '2px', position: 'absolute', bottom: '4px' }}>
                        {dayPosts.slice(0, 3).map((post, i) => {
                            const postIsPast = new Date(post.data_agendamento) < new Date()
                            return (
                                <div key={i} style={{
                                    width: '4px', height: '4px', borderRadius: '50%',
                                    backgroundColor: postIsPast ? '#22c55e' : '#3b82f6'
                                }} />
                            )
                        })}
                    </div>
                )}
            </div>
        )
    }

    const handleDayClick = (day) => {
        if (!day) return
        const dayPosts = scheduledPosts.filter(post =>
            new Date(post.data_agendamento).toDateString() === day.toDateString()
        )

        if (dayPosts.length > 0) {
            setSelectedDayPosts({ date: day, posts: dayPosts })
        } else {
            setSelectedDayPosts(null)
        }
    }

    const scrollToPost = (postId) => {
        const element = document.getElementById(`post-${postId}`)
        if (element) {
            element.scrollIntoView({ behavior: 'smooth', block: 'center' })
            element.style.transition = 'background 0.5s'
            const originalBg = element.style.background
            element.style.background = '#fef3c7'
            setTimeout(() => {
                element.style.background = originalBg
            }, 1000)
        }
        setSelectedDayPosts(null)
    }

    return (
        <div className="content-calendar-wrapper" style={{
            background: 'white',
            borderRadius: '16px',
            boxShadow: '0 4px 20px rgba(0,0,0,0.05)',
            padding: '1.5rem',
            marginBottom: '2rem',
            border: '1px solid #f1f5f9',
            fontFamily: "'Inter', sans-serif",
            display: 'flex',
            flexDirection: 'column',
            alignItems: 'center'
        }}>

            <style>{`
                .rdp {
                    margin: 0;
                    --rdp-cell-size: 45px;
                    --rdp-accent-color: #6366f1;
                    --rdp-background-color: #e0e7ff; 
                }
                .rdp-day_selected { 
                    background-color: var(--rdp-accent-color); 
                }
                .rdp-day_today { 
                    font-weight: bold; 
                    color: #6366f1;
                }
                .rdp-caption_label {
                    font-size: 1rem;
                    color: #1e293b;
                    font-weight: 700;
                    text-transform: capitalize;
                }
                .rdp-head_cell {
                    color: #94a3b8;
                    font-weight: 600;
                    font-size: 0.85rem;
                }
                @media (max-width: 640px) {
                    .rdp { --rdp-cell-size: 36px; }
                }
            `}</style>

            <h3 style={{ width: '100%', fontSize: '1.1rem', fontWeight: 700, color: '#1e293b', display: 'flex', alignItems: 'center', gap: '8px', marginBottom: '1rem' }}>
                <Clock size={20} color="#6366f1" />
                Calend√°rio de Conte√∫do
            </h3>

            <DayPicker
                mode="single"
                locale={ptBR}
                onDayClick={handleDayClick}
                modifiers={modifiers}
                modifiersStyles={modifiersStyles}
                components={{
                    DayContent: DayContent
                }}
            />

            {/* Popover / Overlay */}
            {selectedDayPosts && (
                <>
                    <div
                        style={{ position: 'fixed', inset: 0, zIndex: 9999, background: 'rgba(0,0,0,0.2)' }}
                        onClick={() => setSelectedDayPosts(null)}
                    ></div>
                    <div className="calendar-popover" style={{
                        position: 'fixed',
                        top: '50%', left: '50%', transform: 'translate(-50%, -50%)',
                        zIndex: 10000,
                        background: 'white',
                        padding: '1.5rem',
                        borderRadius: '16px',
                        boxShadow: '0 20px 50px rgba(0,0,0,0.2)',
                        width: '320px',
                        maxWidth: '90%',
                        border: '1px solid #e2e8f0',
                        animation: 'fadeIn 0.2s ease-out'
                    }}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1rem' }}>
                            <div>
                                <h4 style={{ margin: 0, fontWeight: 700, color: '#1e293b', fontSize: '1.1rem' }}>
                                    {format(selectedDayPosts.date, "EEEE, d 'de' MMMM", { locale: ptBR })}
                                </h4>
                                <span style={{ fontSize: '0.85rem', color: '#64748b' }}>
                                    {selectedDayPosts.posts.length} {selectedDayPosts.posts.length === 1 ? 'postagem' : 'postagens'}
                                </span>
                            </div>
                            <button onClick={() => setSelectedDayPosts(null)} style={{ background: 'none', border: 'none', cursor: 'pointer', color: '#94a3b8' }}>
                                <X size={20} />
                            </button>
                        </div>

                        <div style={{ display: 'flex', flexDirection: 'column', gap: '1rem', maxHeight: '300px', overflowY: 'auto' }}>
                            {selectedDayPosts.posts.map(post => {
                                const isPast = new Date(post.data_agendamento) < new Date()
                                return (
                                    <div key={post.id} style={{ padding: '1rem', background: '#f8fafc', borderRadius: '12px', border: '1px solid #f1f5f9' }}>
                                        <div style={{ fontSize: '0.9rem', fontWeight: 700, color: '#334155', marginBottom: '4px' }}>
                                            {post.tema || post.corpo_post?.substring(0, 30) + "..." || "Post sem t√≠tulo"}
                                        </div>
                                        <div style={{ display: 'flex', alignItems: 'center', gap: '6px', fontSize: '0.75rem', marginBottom: '12px' }}>
                                            {isPast ? (
                                                <span style={{ color: '#16a34a', display: 'flex', alignItems: 'center', gap: '4px', background: '#dcfce7', padding: '2px 8px', borderRadius: '12px', fontWeight: 600 }}>
                                                    <CheckCircle2 size={12} /> Publicado as {format(new Date(post.data_agendamento), 'HH:mm')}
                                                </span>
                                            ) : (
                                                <span style={{ color: '#3b82f6', display: 'flex', alignItems: 'center', gap: '4px', background: '#dbeafe', padding: '2px 8px', borderRadius: '12px', fontWeight: 600 }}>
                                                    <Clock size={12} /> Agendado para {format(new Date(post.data_agendamento), 'HH:mm')}
                                                </span>
                                            )}
                                        </div>
                                        <button
                                            onClick={() => scrollToPost(post.id)}
                                            style={{
                                                width: '100%',
                                                padding: '8px',
                                                border: '1px solid #cbd5e1',
                                                borderRadius: '8px',
                                                background: 'white',
                                                color: '#0f172a',
                                                fontSize: '0.85rem',
                                                cursor: 'pointer',
                                                display: 'flex',
                                                alignItems: 'center',
                                                justifyContent: 'center',
                                                gap: '6px',
                                                fontWeight: 600,
                                                transition: 'all 0.2s'
                                            }}
                                            onMouseOver={(e) => e.currentTarget.style.background = '#f1f5f9'}
                                            onMouseOut={(e) => e.currentTarget.style.background = 'white'}
                                        >
                                            Visualizar <ArrowRight size={14} />
                                        </button>
                                    </div>
                                )
                            })}
                        </div>
                    </div>
                </>
            )}
        </div>
    )
}

export default ContentCalendar

```

## File: src\components\CreatePostModal.css
```css
/* 
  DEPRECATED: Styles have been moved to Tailwind classes in CreatePostModal.jsx
  as part of the Obsidian Glass visual overhaul.
*/
```

## File: src\components\CreatePostModal.jsx
```javascript
import React, { useState, useEffect } from 'react'
import { generateContent } from '../services/api'
import { supabase } from '../services/supabaseClient'
import { X, Loader2, Building2, Briefcase, Sparkles, User, AlertCircle, Image as ImageIcon, UploadCloud, FileText, CheckCircle2 } from 'lucide-react'

const CreatePostModal = ({ onClose, onSuccess }) => {
    // Clients List
    const [clients, setClients] = useState([])
    const [loadingClients, setLoadingClients] = useState(true)

    // Wizard State
    const [step, setStep] = useState(1) // 1: Briefing, 2: Review, 3: Finalize

    // Form State
    const [selectedClientId, setSelectedClientId] = useState('') // This holds the UUID
    const [clienteName, setClienteName] = useState('')
    const [selectedClientData, setSelectedClientData] = useState(null)

    const [tema, setTema] = useState('')
    const [publico, setPublico] = useState('')

    // Content State
    const [generatedText, setGeneratedText] = useState('')
    const [currentPostId, setCurrentPostId] = useState(null)
    const [selectedFiles, setSelectedFiles] = useState([])

    // Process State
    const [loading, setLoading] = useState(false)
    const [errorMsg, setErrorMsg] = useState(null)

    // New Tab State
    const [activeTab, setActiveTab] = useState('ai') // 'ai' | 'manual'

    // Fetch clients on mount
    useEffect(() => {
        const fetchClients = async () => {
            try {
                const { data, error } = await supabase
                    .from('clients')
                    .select('*')
                    .order('name')

                if (error) throw error
                const validClients = (data || []).filter(c => c.name)
                setClients(validClients)
            } catch (err) {
                console.error('Erro ao buscar clientes:', err)
            } finally {
                setLoadingClients(false)
            }
        }
        fetchClients()
    }, [])

    const handleClientChange = (e) => {
        const uuid = e.target.value
        setSelectedClientId(uuid)

        const clientData = clients.find(c => String(c.id) === uuid)
        if (clientData) {
            setClienteName(clientData.name)
            setSelectedClientData(clientData)
        } else {
            setClienteName('')
            setSelectedClientData(null)
        }
    }

    // --- STEP 1: GENERATE DRAFT ---
    const handleGenerateDraft = async (e) => {
        e.preventDefault()
        if (!selectedClientId) return alert("Por favor, selecione um cliente.")
        if (!tema || !publico) return

        setLoading(true)
        setErrorMsg(null)

        try {
            const data = await generateContent(clienteName, tema, publico, selectedClientData, null)

            let text = ""
            if (typeof data === 'string') text = data
            else if (data.text) text = data.text
            else if (data.content) text = data.content
            else if (data.response) text = data.response
            else if (data.transcription) text = data.transcription
            else if (data.corpo_post) text = data.corpo_post
            else text = JSON.stringify(data, null, 2)

            setGeneratedText(text.replace(/^"|"$/g, '').replace(/\\n/g, '\n'))

            if (data.id) setCurrentPostId(data.id)
            else if (data.record_id) setCurrentPostId(data.record_id)

            setStep(2)
        } catch (err) {
            console.error(err)
            setErrorMsg('Falha ao gerar rascunho. Tente novamente.')
        } finally {
            setLoading(false)
        }
    }

    // --- FINAL SAVE (Shared Logic) ---
    const performSave = async (isManual = false) => {
        if (!selectedClientId) {
            alert("Erro: ID do cliente n√£o identificado")
            return
        }

        setLoading(true)
        setErrorMsg(null)

        try {
            // Validate client name for manual flow
            let finalClientName = clienteName
            if (isManual && !finalClientName) {
                const { data: clientData } = await supabase
                    .from('clients')
                    .select('name')
                    .eq('id', selectedClientId)
                    .single()
                finalClientName = clientData?.name
            }

            if (!finalClientName) throw new Error("Nome do cliente n√£o encontrado")

            // Upload Images
            let finalImageUrls = []
            if (selectedFiles.length > 0) {
                const uploadPromises = selectedFiles.map(async (file) => {
                    const fileExt = file.name.split('.').pop()
                    const sanitizedName = file.name.replace(/[^a-zA-Z0-9]/g, '_')
                    const fileName = `${Date.now()}_${Math.random().toString(36).substring(7)}_${sanitizedName}.${fileExt}`

                    const { error: uploadError } = await supabase.storage
                        .from('post-images')
                        .upload(fileName, file)

                    if (uploadError) throw uploadError

                    const { data: publicUrlData } = supabase.storage
                        .from('post-images')
                        .getPublicUrl(fileName)

                    return publicUrlData.publicUrl
                })
                finalImageUrls = await Promise.all(uploadPromises)
            }

            // Payload
            const payload = {
                id_client: selectedClientId,
                nome_cliente: finalClientName,
                tema: tema || 'Post Manual',
                publico: publico || 'Geral',
                corpo_post: generatedText,
                sugestao_imagem: finalImageUrls,
                status: 'waiting_approval'
            }

            // Insert or Update
            if (currentPostId && !isManual) {
                const { error } = await supabase.from('tabela_projetofred1').update(payload).eq('id', currentPostId)
                if (error) throw error
            } else {
                const { error, data } = await supabase.from('tabela_projetofred1').insert([payload]).select()
                if (error) throw error
                // Basic check
                if (data && data[0] && !data[0].nome_cliente) {
                    alert("Aviso: Banco de dados pode ter ignorado o nome do cliente.")
                }
            }

            alert("Post salvo com sucesso!")
            if (onSuccess) onSuccess()
            else onClose()

        } catch (err) {
            console.error("Save Error:", err)
            setErrorMsg("Erro ao salvar post: " + err.message)
        } finally {
            setLoading(false)
        }
    }

    const handleFileChange = (e) => {
        if (e.target.files && e.target.files.length > 0) {
            const newFiles = Array.from(e.target.files)
            const validFiles = newFiles.filter(file => {
                if (file.size > 50 * 1024 * 1024) {
                    alert(`Arquivo ${file.name} excede 50MB.`)
                    return false
                }
                return true
            })
            if (validFiles.length > 0) setSelectedFiles(prev => [...prev, ...validFiles])
        }
    }

    // --- UI COMPONENTS ---
    const ProgressBar = () => (
        <div className="flex items-center gap-2 mb-8">
            {[1, 2, 3].map(s => (
                <div key={s} className="flex-1 h-1 rounded-full overflow-hidden bg-white/10">
                    <div
                        className={`h-full transition-all duration-300 ${s <= step ? 'bg-primary' : 'bg-transparent'}`}
                        style={{ width: s <= step ? '100%' : '0%' }}
                    />
                </div>
            ))}
            <span className="text-xs font-semibold text-gray-500 uppercase tracking-wider ml-2">Passo {step}/3</span>
        </div>
    )

    const ModernInput = ({ label, icon: Icon, ...props }) => (
        <div className="mb-6">
            <label className="block text-sm font-medium text-gray-400 mb-2 ml-1">{label}</label>
            <div className="relative group">
                <div className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 group-focus-within:text-primary transition-colors pointer-events-none">
                    {Icon && <Icon size={18} />}
                </div>
                {props.type === 'textarea' ? (
                    <textarea
                        {...props}
                        className="w-full bg-white/5 border border-glass-border rounded-xl pl-10 pr-4 py-3 text-white placeholder-gray-600 focus:outline-none focus:border-primary/50 focus:ring-1 focus:ring-primary/50 transition-all min-h-[100px] resize-y"
                    />
                ) : (
                    <input
                        {...props}
                        className="w-full bg-white/5 border border-glass-border rounded-xl pl-10 pr-4 py-3 text-white placeholder-gray-600 focus:outline-none focus:border-primary/50 focus:ring-1 focus:ring-primary/50 transition-all"
                    />
                )}
            </div>
        </div>
    )

    // --- RENDER ---
    return (
        <div className="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4 pt-16" onClick={(e) => e.target === e.currentTarget && onClose()}>
            <div className="bg-[#0f0f0f] border border-glass-border w-full max-w-2xl max-h-[85vh] rounded-2xl shadow-2xl flex flex-col overflow-hidden animate-fade-in-up">

                {/* HEADER */}
                <div className="p-6 border-b border-glass-border flex justify-between items-center bg-white/[0.02]">
                    <div>
                        <h2 className="text-xl font-bold text-white mb-0.5">Novo Conte√∫do B2B</h2>
                        <p className="text-xs font-medium text-transparent bg-clip-text bg-gradient-to-r from-primary to-orange-400 uppercase tracking-wider">Criar Novo Post</p>
                    </div>
                    <button onClick={onClose} className="p-2 rounded-full hover:bg-white/10 text-gray-400 hover:text-white transition-colors">
                        <X size={20} />
                    </button>
                </div>

                {/* TABS */}
                <div className="flex border-b border-glass-border bg-black/20">
                    <button
                        onClick={() => setActiveTab('ai')}
                        className={`flex-1 py-4 text-sm font-medium flex items-center justify-center gap-2 transition-colors relative ${activeTab === 'ai' ? 'text-white' : 'text-gray-500 hover:text-gray-300'}`}
                    >
                        <Sparkles size={16} className={activeTab === 'ai' ? 'text-primary' : ''} />
                        Criar com IA
                        {activeTab === 'ai' && <div className="absolute bottom-0 left-0 right-0 h-0.5 bg-primary shadow-[0_0_10px_rgba(255,77,0,0.5)]" />}
                    </button>
                    <button
                        onClick={() => setActiveTab('manual')}
                        className={`flex-1 py-4 text-sm font-medium flex items-center justify-center gap-2 transition-colors relative ${activeTab === 'manual' ? 'text-white' : 'text-gray-500 hover:text-gray-300'}`}
                    >
                        <FileText size={16} className={activeTab === 'manual' ? 'text-primary' : ''} />
                        Manual
                        {activeTab === 'manual' && <div className="absolute bottom-0 left-0 right-0 h-0.5 bg-primary shadow-[0_0_10px_rgba(255,77,0,0.5)]" />}
                    </button>
                </div>

                {/* BODY */}
                <div className="flex-1 overflow-y-auto p-6 custom-scrollbar">

                    {/* --- AI MODE --- */}
                    {activeTab === 'ai' && (
                        <>
                            <ProgressBar />

                            {/* STEP 1 */}
                            {step === 1 && (
                                <form onSubmit={handleGenerateDraft}>
                                    <div className="mb-6">
                                        <label className="block text-sm font-medium text-gray-400 mb-2 ml-1">Selecione o Cliente</label>
                                        <div className="relative">
                                            <div className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 pointer-events-none"><Building2 size={18} /></div>
                                            <select
                                                value={selectedClientId}
                                                onChange={handleClientChange}
                                                className="w-full bg-white/5 border border-glass-border rounded-xl pl-10 pr-4 py-3 text-white appearance-none focus:outline-none focus:border-primary/50 focus:ring-1 focus:ring-primary/50 transition-all"
                                                required
                                            >
                                                <option value="" className="bg-charcoal text-gray-500">Selecione...</option>
                                                {clients.map(c => <option key={c.id} value={c.id} className="bg-charcoal text-white">{c.name}</option>)}
                                            </select>
                                        </div>
                                    </div>

                                    <ModernInput
                                        label="Tema Central"
                                        icon={Briefcase}
                                        type="textarea"
                                        placeholder="Sobre o que vamos falar hoje?"
                                        value={tema} onChange={e => setTema(e.target.value)} required
                                    />

                                    <ModernInput
                                        label="P√∫blico-Alvo"
                                        icon={User}
                                        placeholder="CEO, Marketing Managers..."
                                        value={publico} onChange={e => setPublico(e.target.value)} required
                                    />

                                    {errorMsg && <div className="mb-4 p-3 bg-red-500/10 border border-red-500/20 rounded-lg text-red-400 text-sm flex items-center gap-2"><AlertCircle size={16} /> {errorMsg}</div>}

                                    <div className="flex gap-4 pt-4">
                                        <button type="button" onClick={onClose} className="flex-1 px-4 py-3 rounded-xl border border-glass-border text-gray-400 hover:bg-white/5 hover:text-white transition-all font-medium">Cancelar</button>
                                        <button type="submit" disabled={loading} className="flex-[2] btn-primary">
                                            {loading ? <Loader2 className="animate-spin" /> : <><Sparkles size={18} /> Gerar Rascunho</>}
                                        </button>
                                    </div>
                                </form>
                            )}

                            {/* STEP 2 */}
                            {step === 2 && (
                                <div className="animate-fade-in-up">
                                    <label className="block text-sm font-medium text-gray-400 mb-2 ml-1">Rascunho Gerado (Edite √† vontade):</label>
                                    <textarea
                                        value={generatedText}
                                        onChange={e => setGeneratedText(e.target.value)}
                                        className="w-full bg-white/5 border border-glass-border rounded-xl p-4 text-gray-200 focus:outline-none focus:border-primary/50 focus:ring-1 focus:ring-primary/50 transition-all min-h-[300px] leading-relaxed resize-y mb-6 font-mono text-sm"
                                    />

                                    <div className="flex gap-4">
                                        <button onClick={() => setStep(1)} className="flex-1 px-4 py-3 rounded-xl border border-glass-border text-gray-400 hover:bg-white/5 hover:text-white transition-all font-medium">Voltar e Ajustar</button>
                                        <button onClick={() => setStep(3)} className="flex-[2] btn-primary">
                                            Aprovar Texto <CheckCircle2 size={18} />
                                        </button>
                                    </div>
                                </div>
                            )}

                            {/* STEP 3 */}
                            {step === 3 && (
                                <div className="animate-fade-in-up">
                                    <FormMediaUpload selectedFiles={selectedFiles} setSelectedFiles={setSelectedFiles} handleFileChange={handleFileChange} />

                                    <div className="bg-white/5 border border-glass-border rounded-xl p-4 mb-6">
                                        <h4 className="text-sm font-bold text-gray-300 mb-2 uppercase tracking-wider">Resumo</h4>
                                        <div className="text-sm text-gray-400 space-y-1">
                                            <p><span className="text-gray-500">Cliente:</span> {clienteName}</p>
                                            <p><span className="text-gray-500">Tema:</span> {tema}</p>
                                        </div>
                                    </div>

                                    {errorMsg && <div className="mb-4 p-3 bg-red-500/10 border border-red-500/20 rounded-lg text-red-400 text-sm flex items-center gap-2"><AlertCircle size={16} /> {errorMsg}</div>}

                                    <div className="flex gap-4">
                                        <button onClick={() => setStep(2)} className="flex-1 px-4 py-3 rounded-xl border border-glass-border text-gray-400 hover:bg-white/5 hover:text-white transition-all font-medium">Voltar</button>
                                        <button onClick={() => performSave(false)} disabled={loading} className="flex-[2] btn-primary">
                                            {loading ? <Loader2 className="animate-spin" /> : "üíæ Salvar Post Final"}
                                        </button>
                                    </div>
                                </div>
                            )}
                        </>
                    )}

                    {/* --- MANUAL MODE --- */}
                    {activeTab === 'manual' && (
                        <form onSubmit={(e) => { e.preventDefault(); performSave(true); }} className="animate-fade-in-up">
                            <div className="mb-6">
                                <label className="block text-sm font-medium text-gray-400 mb-2 ml-1">Selecione o Cliente</label>
                                <div className="relative">
                                    <div className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 pointer-events-none"><Building2 size={18} /></div>
                                    <select
                                        value={selectedClientId}
                                        onChange={handleClientChange}
                                        className="w-full bg-white/5 border border-glass-border rounded-xl pl-10 pr-4 py-3 text-white appearance-none focus:outline-none focus:border-primary/50 focus:ring-1 focus:ring-primary/50 transition-all"
                                        required
                                    >
                                        <option value="" className="bg-charcoal text-gray-500">Selecione...</option>
                                        {clients.map(c => <option key={c.id} value={c.id} className="bg-charcoal text-white">{c.name}</option>)}
                                    </select>
                                </div>
                            </div>

                            <ModernInput
                                label="T√≠tulo / Tema"
                                icon={Briefcase}
                                placeholder="Ex: Campanha de Ver√£o"
                                value={tema} onChange={e => setTema(e.target.value)}
                            />

                            <ModernInput
                                label="Texto do Post"
                                icon={FileText}
                                type="textarea"
                                placeholder="Escreva o conte√∫do aqui..."
                                value={generatedText} onChange={e => setGeneratedText(e.target.value)} required
                            />

                            <FormMediaUpload selectedFiles={selectedFiles} setSelectedFiles={setSelectedFiles} handleFileChange={handleFileChange} />

                            {errorMsg && <div className="mb-4 p-3 bg-red-500/10 border border-red-500/20 rounded-lg text-red-400 text-sm flex items-center gap-2"><AlertCircle size={16} /> {errorMsg}</div>}

                            <div className="flex gap-4 pt-4">
                                <button type="button" onClick={onClose} className="flex-1 px-4 py-3 rounded-xl border border-glass-border text-gray-400 hover:bg-white/5 hover:text-white transition-all font-medium">Cancelar</button>
                                <button type="submit" disabled={loading} className="flex-[2] btn-primary">
                                    {loading ? <Loader2 className="animate-spin" /> : "üíæ Salvar Manualmente"}
                                </button>
                            </div>
                        </form>
                    )}

                </div>
            </div>
        </div>
    )
}

// Sub-component for Media Upload to keep logic clean
const FormMediaUpload = ({ selectedFiles, setSelectedFiles, handleFileChange }) => (
    <div className="mb-8">
        <label className="block text-sm font-medium text-gray-400 mb-2 ml-1">M√≠dia (Imagens/V√≠deo)</label>
        <div className={`border-2 border-dashed rounded-xl p-4 transition-all ${selectedFiles.length > 0 ? 'border-primary/50 bg-primary/5' : 'border-glass-border hover:border-gray-500 hover:bg-white/5'}`}>
            <input type="file" multiple accept="image/*,video/*,application/pdf" onChange={handleFileChange} className="hidden" id="file-upload" />

            {selectedFiles.length === 0 ? (
                <label htmlFor="file-upload" className="flex flex-col items-center justify-center h-24 cursor-pointer gap-2">
                    <UploadCloud className="text-gray-500" size={24} />
                    <span className="text-sm font-medium text-gray-400">Clique para selecionar arquivos</span>
                </label>
            ) : (
                <div>
                    <div className="flex justify-between items-center mb-3 px-1">
                        <span className="text-xs font-semibold text-gray-400 uppercase">{selectedFiles.length} arquivos</span>
                        <button type="button" onClick={() => setSelectedFiles([])} className="text-xs text-red-400 hover:text-red-300 font-medium">Limpar Tudo</button>
                    </div>
                    <div className="grid grid-cols-4 gap-2">
                        {selectedFiles.map((file, i) => (
                            <div key={i} className="aspect-square rounded-lg bg-black/40 border border-glass-border overflow-hidden relative flex items-center justify-center group">
                                {file.type.includes('pdf') ? <FileText className="text-red-500" /> :
                                    <img src={URL.createObjectURL(file)} className="w-full h-full object-cover opacity-80 group-hover:opacity-100 transition-opacity" />
                                }
                            </div>
                        ))}
                        <label htmlFor="file-upload" className="aspect-square rounded-lg border border-glass-border flex items-center justify-center cursor-pointer hover:bg-white/5 text-gray-500 hover:text-white transition-colors">
                            <span className="text-2xl">+</span>
                        </label>
                    </div>
                </div>
            )}
        </div>
    </div>
)

export default CreatePostModal

```

## File: src\components\EditPostModal.jsx
```javascript
import React, { useState } from 'react'
import { supabase } from '../services/supabaseClient'
import { X, Loader2, Save, Image as ImageIcon, UploadCloud, Calendar as CalendarIcon } from 'lucide-react'
import DatePicker, { registerLocale } from 'react-datepicker'
import "react-datepicker/dist/react-datepicker.css"
import ptBR from 'date-fns/locale/pt-BR'

registerLocale('pt-BR', ptBR)

const EditPostModal = ({ post, onClose, onSuccess }) => {
    const [theme, setTheme] = useState(post.tema || '')

    // Helper to format DB timestamp (UTC) to datetime-local (Local)
    // This helper is no longer needed if scheduleDate is stored as a Date object
    // const formatDateForInput = (isoString) => {
    //     if (!isoString) return ''
    //     const date = new Date(isoString)
    //     const offset = date.getTimezoneOffset() * 60000
    //     const localDate = new Date(date.getTime() - offset)
    //     return localDate.toISOString().slice(0, 16)
    // }

    // Initialize directly with Date object or null
    const [scheduleDate, setScheduleDate] = useState(post.data_agendamento ? new Date(post.data_agendamento) : null)
    const [text, setText] = useState(post.corpo_post || '')
    // Initialize as array (handle legacy string or null)
    const initialImages = Array.isArray(post.sugestao_imagem)
        ? post.sugestao_imagem
        : post.sugestao_imagem
            ? [post.sugestao_imagem]
            : []

    const [currentImageUrls, setCurrentImageUrls] = useState(initialImages)
    const [newImageFiles, setNewImageFiles] = useState([])

    const [loading, setLoading] = useState(false)
    const [errorMsg, setErrorMsg] = useState(null)

    const handleFileChange = (e) => {
        if (e.target.files && e.target.files.length > 0) {
            const files = Array.from(e.target.files)

            // Validate basic constraints
            const validFiles = files.filter(file => {
                if (!file.type.startsWith('image/')) {
                    alert(`Arquivo ${file.name} n√£o √© uma imagem.`)
                    return false
                }
                if (file.size > 50 * 1024 * 1024) {
                    alert(`Arquivo ${file.name} excede o limite de 50MB.`)
                    return false
                }
                return true
            })

            setNewImageFiles(validFiles)
        }
    }

    const handleSave = async (e) => {
        e.preventDefault()
        setLoading(true)
        setErrorMsg(null)

        try {
            let finalImageUrls = currentImageUrls

            // 1. Upload new images if selected (Replacing old)
            if (newImageFiles.length > 0) {
                const uploadPromises = newImageFiles.map(async (file) => {
                    const fileExt = file.name.split('.').pop()
                    const sanitizedName = file.name.replace(/[^a-zA-Z0-9]/g, '_')
                    const fileName = `${Date.now()}_${Math.random().toString(36).substring(7)}_${sanitizedName}.${fileExt}`

                    const { error: uploadError } = await supabase.storage
                        .from('post-images')
                        .upload(fileName, file)

                    if (uploadError) throw uploadError

                    const { data: publicUrlData } = supabase.storage
                        .from('post-images')
                        .getPublicUrl(fileName)

                    return publicUrlData.publicUrl
                })

                finalImageUrls = await Promise.all(uploadPromises)
            }

            // 2. Update DB
            const updates = {
                tema: theme,
                corpo_post: text,
                sugestao_imagem: finalImageUrls, // Save as Array
                data_agendamento: scheduleDate ? scheduleDate.toISOString() : null // Date Object to ISO
            }

            // REVIS√ÉO LOGIC: If editing a post with feedback, reset status to waiting_approval
            if ((post.status === 'revis√£o' || post.status === 'changes_requested') && post.feedback_cliente) {
                updates.status = 'waiting_approval'
            }

            const { error: dbError } = await supabase
                .from('tabela_projetofred1')
                .update(updates)
                .eq('id', post.id)

            if (dbError) throw dbError

            alert("Post atualizado com sucesso!")
            onSuccess() // Should trigger refresh
            onClose()

        } catch (err) {
            console.error(err)
            setErrorMsg("Erro ao atualizar: " + err.message)
        } finally {
            setLoading(false)
        }
    }

    return (
        <div style={{
            position: 'fixed', top: 0, left: 0, right: 0, bottom: 0,
            background: 'rgba(0,0,0,0.5)', display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 1100
        }} onClick={(e) => {
            if (e.target === e.currentTarget) onClose()
        }}>
            <div className="modern-modal" style={{ maxWidth: '700px', width: '90%', maxHeight: '90vh', overflowY: 'auto' }}>
                <div className="modal-header">
                    <div className="header-title">
                        <h2>Editar Post #{post.id}</h2>
                        <span className="subtitle">{post.tema}</span>
                    </div>
                    <button className="close-btn" onClick={onClose} aria-label="Fechar">
                        <X size={24} />
                    </button>
                </div>

                <div className="modal-body" style={{ padding: '2rem' }}>

                    {/* FEEDBACK ALERT */}
                    {(post.status === 'revis√£o' || post.status === 'changes_requested') && post.feedback_cliente && (
                        <div style={{
                            background: '#fef2f2',
                            border: '1px solid #fee2e2',
                            borderRadius: '8px',
                            padding: '1rem',
                            marginBottom: '1.5rem',
                            display: 'flex',
                            gap: '0.75rem',
                            alignItems: 'start'
                        }}>
                            <AlertCircle color="#ef4444" size={20} style={{ marginTop: '2px', flexShrink: 0 }} />
                            <div>
                                <h4 style={{ color: '#991b1b', fontWeight: 700, fontSize: '0.95rem', marginBottom: '4px' }}>
                                    üì¢ Aten√ß√£o: Cliente solicitou altera√ß√µes
                                </h4>
                                <p style={{ color: '#7f1d1d', fontSize: '0.9rem', lineHeight: '1.5' }}>
                                    "{post.feedback_cliente}"
                                </p>
                            </div>
                        </div>
                    )}

                    <form onSubmit={handleSave}>
                        {/* THEME EDITOR */}
                        <div className="modern-form-group">
                            <label className="input-label">Tema / T√≠tulo Interno</label>
                            <input
                                type="text"
                                value={theme}
                                onChange={e => setTheme(e.target.value)}
                                className="modern-input"
                                placeholder="T√≠tulo do post..."
                            />
                        </div>

                        {/* SCHEDULE DATE (PREMIUM UI) */}
                        <div className="modern-form-group">
                            <label className="input-label" style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                                <CalendarIcon size={16} /> Data de Publica√ß√£o / Agendamento
                            </label>
                            <div className="custom-datepicker-wrapper">
                                <DatePicker
                                    selected={scheduleDate}
                                    onChange={(date) => setScheduleDate(date)}
                                    showTimeSelect
                                    timeFormat="HH:mm"
                                    timeIntervals={15}
                                    dateFormat="dd/MM/yyyy HH:mm"
                                    locale="pt-BR"
                                    placeholderText="Selecione data e hora..."
                                    className="modern-input"
                                    wrapperClassName="w-full"
                                    showPopperArrow={false}
                                />
                            </div>
                        </div>

                        {/* TEXT EDITOR */}
                        <div className="modern-form-group">
                            <label className="input-label">Texto do Post</label>
                            <textarea
                                value={text}
                                onChange={e => setText(e.target.value)}
                                className="modern-textarea"
                                style={{ minHeight: '200px', fontSize: '1rem', lineHeight: '1.6' }}
                            />
                        </div>

                        {/* IMAGE EDITOR (CAROUSEL SUPPORT) */}
                        <div className="modern-form-group">
                            <label className="input-label">M√≠dia (Imagens)</label>

                            {/* Current/New Preview Grid */}
                            <div style={{ marginBottom: '1rem', background: '#f8fafc', padding: '1rem', borderRadius: '8px' }}>
                                {newImageFiles.length > 0 ? (
                                    <div>
                                        <div style={{ color: '#16a34a', fontWeight: 600, marginBottom: '0.5rem', textAlign: 'center' }}>
                                            {newImageFiles.length} Novas imagens selecionadas:
                                        </div>
                                        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fill, minmax(80px, 1fr))', gap: '8px' }}>
                                            {newImageFiles.map((file, idx) => (
                                                <div key={idx} style={{ aspectRatio: '1/1', borderRadius: '6px', overflow: 'hidden', border: '1px solid #ddd' }}>
                                                    <img src={URL.createObjectURL(file)} alt="Preview" style={{ width: '100%', height: '100%', objectFit: 'cover' }} />
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                ) : currentImageUrls.length > 0 ? (
                                    <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fill, minmax(80px, 1fr))', gap: '8px' }}>
                                        {currentImageUrls.map((url, idx) => (
                                            <div key={idx} style={{ aspectRatio: '1/1', borderRadius: '6px', overflow: 'hidden', border: '1px solid #ddd' }}>
                                                <img src={url} alt={`Current ${idx}`} style={{ width: '100%', height: '100%', objectFit: 'cover' }} />
                                            </div>
                                        ))}
                                    </div>
                                ) : (
                                    <div style={{ color: '#94a3b8', textAlign: 'center' }}>Sem imagem atualmente</div>
                                )}
                            </div>

                            {/* Upload Input */}
                            <div className={`upload-wrapper ${newImageFiles.length > 0 ? 'has-file' : ''}`}>
                                <input
                                    type="file"
                                    accept="image/*"
                                    multiple
                                    onChange={handleFileChange}
                                    className="file-input-hidden"
                                />
                                <div className="upload-content-empty">
                                    <UploadCloud size={20} className="upload-icon-empty" />
                                    <span className="upload-text">Clique para trocar imagens (Substituir tudo)</span>
                                </div>
                            </div>
                        </div>

                        {errorMsg && <p className="error-text">{errorMsg}</p>}

                        <div className="modal-footer">
                            <button type="button" className="btn-cancel" onClick={onClose} disabled={loading}>
                                Cancelar
                            </button>
                            <button type="submit" className="btn-generate-primary" disabled={loading}>
                                {loading ? <><Loader2 className="spinner" /> Salvando...</> : <><Save size={18} /> Salvar Altera√ß√µes</>}
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            {/* Premium DatePicker Styles Override */}
            <style>{`
                    .custom-datepicker-wrapper .react-datepicker-wrapper {
                        width: 100%;
                    }
                    .react-datepicker {
                        font-family: 'Inter', sans-serif;
                        border: 1px solid #e2e8f0;
                        border-radius: 12px;
                        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
                        overflow: hidden;
                    }
                    .react-datepicker__header {
                        background-color: white;
                        border-bottom: 1px solid #e2e8f0;
                        padding-top: 1rem;
                    }
                    .react-datepicker__current-month {
                        font-weight: 700;
                        color: #1e293b;
                        margin-bottom: 0.5rem;
                        text-transform: capitalize;
                    }
                    .react-datepicker__day-name {
                        color: #64748b;
                        font-weight: 500;
                        width: 2.5rem;
                    }
                    .react-datepicker__day {
                        width: 2.5rem;
                        line-height: 2.5rem;
                        margin: 0.1rem;
                        border-radius: 8px;
                        color: #334155;
                        font-weight: 500;
                    }
                    .react-datepicker__day:hover {
                        background-color: #f1f5f9;
                        border-radius: 8px;
                    }
                    .react-datepicker__day--selected, 
                    .react-datepicker__day--keyboard-selected {
                        background-color: #3b82f6 !important;
                        color: white !important;
                        font-weight: 700;
                    }
                    .react-datepicker__day--today {
                        color: #3b82f6;
                        font-weight: 700;
                        background: none;
                    }
                    .react-datepicker__time-container {
                        border-left: 1px solid #e2e8f0;
                    }
                    .react-datepicker__time-container .react-datepicker__time .react-datepicker__time-box ul.react-datepicker__time-list li.react-datepicker__time-list-item--selected {
                        background-color: #3b82f6 !important;
                    }
                    .react-datepicker__navigation-icon::before {
                        border-color: #64748b;
                        border-width: 2px 2px 0 0;
                    }
                `}</style>
        </div>
    )
}

export default EditPostModal

```

## File: src\components\ErrorBoundary.jsx
```javascript

import React from 'react';
import { AlertTriangle, RefreshCw } from 'lucide-react';

class ErrorBoundary extends React.Component {
    constructor(props) {
        super(props);
        this.state = { hasError: false, error: null, errorInfo: null };
    }

    static getDerivedStateFromError(error) {
        // Update state so the next render will show the fallback UI.
        return { hasError: true };
    }

    componentDidCatch(error, errorInfo) {
        // You can also log the error to an error reporting service
        console.error("Uncaught error:", error, errorInfo);
        this.setState({ error, errorInfo });
    }

    render() {
        if (this.state.hasError) {
            // You can render any custom fallback UI
            return (
                <div style={{
                    height: '100vh',
                    display: 'flex',
                    flexDirection: 'column',
                    alignItems: 'center',
                    justifyContent: 'center',
                    backgroundColor: '#f8fafc',
                    color: '#1e293b',
                    textAlign: 'center',
                    fontFamily: "'Montserrat', sans-serif"
                }}>
                    <div style={{
                        background: '#fff',
                        padding: '2rem 3rem',
                        borderRadius: '16px',
                        boxShadow: '0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1)',
                        maxWidth: '500px',
                        width: '90%'
                    }}>
                        <div style={{
                            background: '#fee2e2',
                            padding: '1rem',
                            borderRadius: '50%',
                            display: 'inline-flex',
                            marginBottom: '1.5rem'
                        }}>
                            <AlertTriangle size={48} color="#ef4444" />
                        </div>

                        <h1 style={{ fontSize: '1.5rem', fontWeight: '700', marginBottom: '0.5rem', color: '#0f172a' }}>
                            Ops! Algo deu errado.
                        </h1>

                        <p style={{ color: '#64748b', marginBottom: '2rem', lineHeight: '1.5' }}>
                            Ocorreu um erro inesperado e o sistema precisou parar.
                            <br />
                            N√£o se preocupe, seus dados est√£o seguros.
                        </p>

                        <button
                            onClick={() => window.location.reload()}
                            style={{
                                display: 'inline-flex',
                                alignItems: 'center',
                                gap: '0.5rem',
                                padding: '0.75rem 1.5rem',
                                background: '#0f172a',
                                color: '#fff',
                                border: 'none',
                                borderRadius: '8px',
                                fontWeight: '600',
                                fontSize: '0.95rem',
                                cursor: 'pointer',
                                transition: 'opacity 0.2s',
                            }}
                            onMouseOver={(e) => e.target.style.opacity = '0.9'}
                            onMouseOut={(e) => e.target.style.opacity = '1'}
                        >
                            <RefreshCw size={18} /> Recarregar P√°gina
                        </button>

                        {/* Optional: details for debugging (hidden by default or small) */}
                        {this.state.error && process.env.NODE_ENV === 'development' && (
                            <details style={{ marginTop: '2rem', textAlign: 'left', color: '#94a3b8', fontSize: '0.75rem', overflow: 'auto', maxHeight: '100px' }}>
                                <summary>Detalhes do Erro</summary>
                                <pre>{this.state.error.toString()}</pre>
                                <pre>{this.state.errorInfo.componentStack}</pre>
                            </details>
                        )}
                    </div>
                </div>
            );
        }

        return this.props.children;
    }
}

export default ErrorBoundary;

```

## File: src\components\ImportContactsModal.jsx
```javascript
import React, { useState, useEffect } from 'react'
import { supabase } from '../services/supabaseClient'
import { X, Linkedin, Download, Loader2, AlertCircle } from 'lucide-react'

const ImportContactsModal = ({ isOpen, onClose, listId, clientId, accountId, onSuccess }) => {
    const [searchUrl, setSearchUrl] = useState('')
    const [loading, setLoading] = useState(false)
    const [error, setError] = useState(null)

    const handleSubmit = async (e) => {
        e.preventDefault()
        if (!searchUrl.trim() || !clientId || !listId) return

        // Validate Account ID
        if (!accountId) {
            setError('Esta lista n√£o est√° vinculada a uma conta do LinkedIn. (Account ID ausente).')
            return
        }

        setLoading(true)
        setError(null)

        try {
            // Call n8n Webhook
            const response = await fetch('https://n8n-n8n-start.kfocge.easypanel.host/webhook/import-linkedin-search', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    search_url: searchUrl,
                    list_id: listId,
                    client_id: clientId,
                    account_id: accountId
                })
            })

            if (!response.ok) throw new Error('Falha na comunica√ß√£o com o servidor de importa√ß√£o.')

            // Update List Status to PROCESSING
            await supabase
                .from('contact_lists')
                .update({
                    status: 'PROCESSING',
                })
                .eq('id', listId)

            onSuccess()
            onClose()
            setSearchUrl('')

        } catch (err) {
            console.error(err)
            setError(err.message || 'Erro desconhecido ao iniciar importa√ß√£o.')
        } finally {
            setLoading(false)
        }
    }

    if (!isOpen) return null

    return (
        <div className="fixed inset-0 z-50 flex items-center justify-center bg-slate-900/50 backdrop-blur-sm p-4 animate-fade-in">
            <div className="bg-white w-full max-w-md rounded-2xl shadow-2xl overflow-hidden animate-scale-in">
                <div className="p-6 border-b border-gray-100 flex justify-between items-center bg-slate-50">
                    <div>
                        <h2 className="text-xl font-bold text-slate-800">Importar Contatos</h2>
                        <p className="text-xs text-gray-500 mt-1">Adicione leads a esta lista automaticamente.</p>
                    </div>
                    <button onClick={onClose} className="p-2 rounded-full hover:bg-gray-200 text-gray-400 hover:text-gray-600 transition-colors">
                        <X size={20} />
                    </button>
                </div>

                <div className="p-6">
                    {/* Source Selection - For now just LinkedIn Search */}
                    <div className="mb-6">
                        <label className="block text-xs font-bold text-gray-400 uppercase tracking-wider mb-2">Fonte de Dados</label>
                        <div className="border-2 border-indigo-100 bg-indigo-50/50 rounded-xl p-4 flex items-center gap-4 cursor-pointer hover:border-indigo-300 transition-all">
                            <div className="w-10 h-10 rounded-lg bg-blue-600 text-white flex items-center justify-center">
                                <Linkedin size={24} />
                            </div>
                            <div>
                                <h3 className="font-bold text-slate-800">LinkedIn Search</h3>
                                <p className="text-xs text-slate-500">Extrair leads de uma busca salva.</p>
                            </div>
                            <div className="ml-auto">
                                <input type="radio" checked readOnly className="w-4 h-4 text-indigo-600" />
                            </div>
                        </div>
                    </div>

                    <form onSubmit={handleSubmit}>
                        <div className="mb-6">
                            <label className="block text-sm font-bold text-slate-700 mb-2">LinkedIn Search URL</label>
                            <input
                                autoFocus
                                type="url"
                                required
                                value={searchUrl}
                                onChange={e => setSearchUrl(e.target.value)}
                                placeholder="https://www.linkedin.com/search/results/people/..."
                                className="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl text-slate-800 focus:outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 transition-all font-medium text-sm"
                            />
                            <p className="text-xs text-slate-400 mt-2">Cole a URL completa da p√°gina de resultados de busca do LinkedIn.</p>
                        </div>

                        {error && (
                            <div className="mb-4 p-3 bg-red-50 text-red-600 text-sm rounded-lg flex items-start gap-2">
                                <AlertCircle size={16} className="mt-0.5 shrink-0" />
                                <span>{error}</span>
                            </div>
                        )}

                        <div className="flex gap-3 justify-end pt-2">
                            <button
                                type="button"
                                onClick={onClose}
                                className="px-5 py-2.5 rounded-xl text-slate-600 font-bold hover:bg-gray-100 transition-colors"
                            >
                                Cancelar
                            </button>
                            <button
                                type="submit"
                                disabled={loading || !searchUrl.trim()}
                                className="px-5 py-2.5 rounded-xl bg-indigo-600 text-white font-bold hover:bg-indigo-700 transition-all shadow-lg shadow-indigo-200 disabled:opacity-70 disabled:cursor-not-allowed flex items-center gap-2"
                            >
                                {loading ? <Loader2 className="animate-spin" size={18} /> : <Download size={18} />}
                                {loading ? 'Iniciando...' : 'Extrair e Importar'}
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    )
}

export default ImportContactsModal

```

## File: src\components\KanbanColumn.jsx
```javascript
import React from 'react'

/**
 * Reusable Kanban Column component
 * @param {string} title - Column title
 * @param {string} icon - Emoji icon for the column
 * @param {number} count - Number of items in the column
 * @param {string} color - Tailwind color class for the header accent
 * @param {React.ReactNode} children - Lead cards to render inside
 */
const KanbanColumn = ({ title, icon, count = 0, color = 'bg-slate-500', children }) => {
    return (
        <div className="flex flex-col bg-slate-50 rounded-2xl border border-slate-200 min-w-[300px] max-w-[320px] h-full">
            {/* Column Header */}
            <div className={`flex items-center justify-between px-4 py-3 border-b border-slate-200 ${color} bg-opacity-10 rounded-t-2xl`}>
                <div className="flex items-center gap-2">
                    <span className="text-lg">{icon}</span>
                    <h3 className="font-semibold text-slate-700 text-sm">{title}</h3>
                </div>
                <span className={`px-2.5 py-0.5 rounded-full text-xs font-bold ${color} text-white`}>
                    {count}
                </span>
            </div>

            {/* Scrollable Card List */}
            <div className="flex-1 overflow-y-auto p-3 space-y-2 max-h-[calc(100vh-280px)]">
                {children}
                {count === 0 && (
                    <div className="text-center py-8 text-slate-400 text-sm">
                        Nenhum lead aqui
                    </div>
                )}
            </div>
        </div>
    )
}

export default KanbanColumn

```

## File: src\components\KanbanLeadCard.jsx
```javascript
import React from 'react'
import { Clock, MessageCircle, ExternalLink, Zap } from 'lucide-react'

/**
 * Compact Lead Card for Kanban view
 * @param {object} lead - Lead data object
 * @param {function} onClick - Handler when card is clicked
 */
const KanbanLeadCard = ({ lead, onClick }) => {
    // Calculate time since last interaction
    const getTimeSince = (date) => {
        if (!date) return 'Sem intera√ß√£o'
        const now = new Date()
        const lastDate = new Date(date)
        const diffDays = Math.floor((now - lastDate) / (1000 * 60 * 60 * 24))

        if (diffDays === 0) return 'Hoje'
        if (diffDays === 1) return 'Ontem'
        if (diffDays < 7) return `${diffDays} dias`
        if (diffDays < 30) return `${Math.floor(diffDays / 7)} sem`
        return `${Math.floor(diffDays / 30)} m√™s`
    }

    // Get score color
    const getScoreColor = (score) => {
        if (score >= 70) return 'bg-emerald-500'
        if (score >= 40) return 'bg-amber-500'
        return 'bg-red-500'
    }

    // Get ICP badge style
    const getIcpStyle = (icp) => {
        if (icp === 'A') return 'bg-emerald-100 text-emerald-700 border-emerald-300'
        if (icp === 'B') return 'bg-amber-100 text-amber-700 border-amber-300'
        return 'bg-slate-100 text-slate-600 border-slate-300'
    }

    const trustScore = lead?.trust_score || 0
    const icpScore = lead?.icp_score || 'C'
    const totalInteractions = lead?.total_interactions_count || lead?.total_interactions || 0
    const lastInteractionDate = lead?.last_interaction_date
    const hasAiSuggestions = (lead?.ai_suggested_replies?.length || 0) > 0

    return (
        <div
            className="bg-white rounded-xl border border-slate-200 p-3 cursor-pointer hover:shadow-md hover:border-slate-300 transition-all group"
            onClick={() => onClick(lead)}
        >
            {/* Top Row: Avatar + Name + Score */}
            <div className="flex items-start gap-3">
                {/* Avatar */}
                <div className="w-10 h-10 rounded-full bg-gradient-to-br from-slate-200 to-slate-300 flex items-center justify-center overflow-hidden shrink-0">
                    {lead?.avatar_url ? (
                        <img src={lead.avatar_url} alt={lead.nome} className="w-full h-full object-cover" />
                    ) : (
                        <span className="text-sm font-bold text-slate-500">{lead?.nome?.charAt(0) || '?'}</span>
                    )}
                </div>

                {/* Name + Headline */}
                <div className="flex-1 min-w-0">
                    <h4 className="font-semibold text-slate-800 text-sm truncate">{lead?.nome || 'Lead'}</h4>
                    <p className="text-xs text-slate-500 truncate">{lead?.headline || lead?.empresa || '‚Äî'}</p>
                </div>

                {/* Trust Score Badge */}
                <div className={`${getScoreColor(trustScore)} text-white text-xs font-bold px-2 py-1 rounded-lg shrink-0`}>
                    {trustScore}
                </div>
            </div>

            {/* Bottom Row: Meta Info */}
            <div className="flex items-center justify-between mt-3 pt-2 border-t border-slate-100">
                {/* ICP Badge */}
                <span className={`text-[10px] font-bold px-2 py-0.5 rounded border ${getIcpStyle(icpScore)}`}>
                    ICP {icpScore}
                </span>

                {/* Interaction Count */}
                <div className="flex items-center gap-1 text-slate-400 text-xs">
                    <MessageCircle size={12} />
                    <span>{totalInteractions}</span>
                </div>

                {/* Time Since */}
                <div className="flex items-center gap-1 text-slate-400 text-xs">
                    <Clock size={12} />
                    <span>{getTimeSince(lastInteractionDate)}</span>
                </div>

                {/* AI Ready Indicator */}
                {hasAiSuggestions && (
                    <div className="text-amber-500" title="Sugest√µes de IA prontas">
                        <Zap size={14} />
                    </div>
                )}
            </div>
        </div>
    )
}

export default KanbanLeadCard

```

## File: src\components\LeadDetailModal.jsx
```javascript
import React, { useState, useEffect } from 'react'
import { supabase } from '../services/supabaseClient'
import {
    X,
    Briefcase,
    MapPin,
    ExternalLink,
    Copy,
    Check,
    Sparkles,
    MessageCircle,
    ArrowRight,
    ArrowLeft,
    Info,
    Brain,
    Send
} from 'lucide-react'

const LeadDetailModal = ({ lead, campaignLead, onClose }) => {
    const [interactions, setInteractions] = useState([])
    const [loadingInteractions, setLoadingInteractions] = useState(false)
    const [copiedIdx, setCopiedIdx] = useState(null)
    const [enrichedData, setEnrichedData] = useState(null) // Local state for fresh DB data
    const [draftMessage, setDraftMessage] = useState('') // Human-in-the-loop message editing
    const [selectedSuggestionIdx, setSelectedSuggestionIdx] = useState(null)

    useEffect(() => {
        if (lead?.id) fetchInteractions()
    }, [lead?.id])

    const fetchInteractions = async () => {
        setLoadingInteractions(true)
        try {
            // 1. Fetch Interactions
            const { data: interactionsData, error: interactionsError } = await supabase
                .from('interactions')
                .select('*')
                .eq('lead_id', lead.id)
                .order('interaction_date', { ascending: false })
                .limit(5)

            if (interactionsError) throw interactionsError
            setInteractions(interactionsData || [])

            // 2. FETCH MISSING DATA (Trust Score, Sentiment, AI Replies, Summary)
            // Since the main view can't join, we fetch fresh data here
            const { data: leadData, error: leadError } = await supabase
                .from('leads')
                .select('cadence_stage, sentiment, sentiment_reasoning, ai_suggested_replies, conversation_summary, icp_reason')
                .eq('id', lead.id)
                .single()

            if (leadData) {
                console.log('[LeadDetailModal] Fetched fresh enriched data:', leadData)
                // Merge fresh data into the local lead object mechanism
                // We'll update a local state or ref, but since 'lead' is a prop, 
                // we might need a local state for the enriched fields.
                setEnrichedData(leadData)
            }

        } catch (err) {
            console.error('Error fetching details:', err)
        } finally {
            setLoadingInteractions(false)
        }
    }

    const copyToClipboard = (text, idx) => {
        navigator.clipboard.writeText(text)
        setCopiedIdx(idx)
        setTimeout(() => setCopiedIdx(null), 2000)
    }

    // ============ DATA TRIAD LOGIC ============

    // 1. QUALITY (A/B/C tier)
    const getQualityData = () => {
        const tier = lead?.icp_score?.toUpperCase() || 'C'
        const configs = {
            'A': { label: 'A', percent: 100, color: '#10b981', bg: 'bg-emerald-500', text: 'text-emerald-400' },
            'B': { label: 'B', percent: 66, color: '#f59e0b', bg: 'bg-amber-500', text: 'text-amber-400' },
            'C': { label: 'C', percent: 33, color: '#ef4444', bg: 'bg-red-500', text: 'text-red-400' }
        }
        return configs[tier] || configs['C']
    }

    // 2. INTERACTION (message volume)
    const getInteractionData = () => {
        const count = lead?.total_interactions || 0
        if (count >= 10) return { percent: 100, color: '#10b981', label: count, text: 'text-emerald-400' }
        if (count >= 5) return { percent: 66, color: '#f59e0b', label: count, text: 'text-amber-400' }
        return { percent: Math.max(10, count * 10), color: '#ef4444', label: count, text: 'text-red-400' }
    }

    // 3. CADENCE STAGE ‚Üí Trust/Proximity Level
    // In outbound prospecting, cadence stages reflect growing trust:
    // G1 (first contact) ‚Üí G7+ (high trust / ready to close)
    const getCadenceData = () => {
        const stage = enrichedData?.cadence_stage
            ?? lead?.cadence_stage
            ?? lead?.leads?.cadence_stage
            ?? ''

        // Extract numeric level from stage (e.g. "G5" ‚Üí 5, "G1" ‚Üí 1)
        const match = stage?.toString().match(/(\d+)/)
        const level = match ? parseInt(match[1], 10) : 0

        // Map level to trust progression (outbound context)
        const trustLevels = [
            { max: 0, label: 'Sem Cad√™ncia', desc: 'Este lead ainda n√£o iniciou a cad√™ncia de prospec√ß√£o.', percent: 5, color: '#94a3b8', text: 'text-slate-400' },
            { max: 1, label: 'Primeiro Contato', desc: 'Lead recebeu o primeiro toque. N√≠vel de confian√ßa inicial.', percent: 15, color: '#3b82f6', text: 'text-blue-400' },
            { max: 2, label: 'Reconhecimento', desc: 'Lead come√ßa a reconhecer voc√™. Confian√ßa em constru√ß√£o.', percent: 30, color: '#06b6d4', text: 'text-cyan-400' },
            { max: 3, label: 'Considera√ß√£o', desc: 'Lead demonstra abertura para conversar. Confian√ßa em crescimento.', percent: 45, color: '#f59e0b', text: 'text-amber-400' },
            { max: 4, label: 'Interesse Ativo', desc: 'Lead engajado e interessado. Boa confian√ßa estabelecida.', percent: 60, color: '#f97316', text: 'text-orange-400' },
            { max: 5, label: 'Relacionamento', desc: 'Lead confia em voc√™ como refer√™ncia. Rela√ß√£o s√≥lida.', percent: 75, color: '#10b981', text: 'text-emerald-400' },
            { max: 6, label: 'Alta Confian√ßa', desc: 'Lead altamente engajado. Pronto para proposta.', percent: 90, color: '#22c55e', text: 'text-green-400' },
            { max: Infinity, label: 'Pronto p/ Fechar', desc: 'M√°xima confian√ßa atingida. Momento ideal para convers√£o.', percent: 100, color: '#eab308', text: 'text-yellow-400' }
        ]

        const config = trustLevels.find(t => level <= t.max) || trustLevels[0]

        return { ...config, stage, level }
    }

    const quality = getQualityData()
    const interaction = getInteractionData()
    const cadence = getCadenceData()
    // Prioritize fresh AI replies
    const aiReplies = enrichedData?.ai_suggested_replies || lead?.ai_suggested_replies || []

    if (!lead) return null

    // Circular Progress Ring Component
    const CircularGauge = ({ percent, color, size = 80, strokeWidth = 6, children }) => {
        const radius = (size - strokeWidth) / 2
        const circumference = radius * 2 * Math.PI
        const offset = circumference - (percent / 100) * circumference

        return (
            <div className="relative" style={{ width: size, height: size }}>
                <svg className="transform -rotate-90" width={size} height={size}>
                    <circle
                        cx={size / 2}
                        cy={size / 2}
                        r={radius}
                        stroke="rgba(255,255,255,0.1)"
                        strokeWidth={strokeWidth}
                        fill="none"
                    />
                    <circle
                        cx={size / 2}
                        cy={size / 2}
                        r={radius}
                        stroke={color}
                        strokeWidth={strokeWidth}
                        fill="none"
                        strokeLinecap="round"
                        strokeDasharray={circumference}
                        strokeDashoffset={offset}
                        style={{ transition: 'stroke-dashoffset 0.5s ease' }}
                    />
                </svg>
                <div className="absolute inset-0 flex items-center justify-center">
                    {children}
                </div>
            </div>
        )
    }

    return (
        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-md p-4" onClick={onClose}>
            <div
                className="bg-white rounded-3xl shadow-2xl w-full max-w-2xl max-h-[92vh] overflow-hidden border border-slate-200"
                onClick={e => e.stopPropagation()}
            >
                {/* ========== HEADER: Identity (Keep Dark) ========== */}
                <div className="relative px-6 pt-6 pb-4 bg-gradient-to-b from-slate-900 to-slate-800 rounded-t-3xl">
                    <button
                        onClick={onClose}
                        className="absolute top-4 right-4 p-2 rounded-full hover:bg-white/10 transition text-slate-400 hover:text-white"
                    >
                        <X size={20} />
                    </button>

                    <div className="flex items-center gap-4">
                        {/* Avatar */}
                        <div className="w-16 h-16 rounded-full bg-gradient-to-br from-sky-500 to-indigo-600 p-0.5 shrink-0">
                            <div className="w-full h-full rounded-full bg-slate-800 flex items-center justify-center overflow-hidden">
                                {lead.avatar_url ? (
                                    <img src={lead.avatar_url} alt={lead.nome} className="w-full h-full object-cover" />
                                ) : (
                                    <span className="text-2xl font-bold text-white">{lead.nome?.charAt(0) || '?'}</span>
                                )}
                            </div>
                        </div>

                        {/* Name + Headline */}
                        <div className="flex-1 min-w-0">
                            <h2 className="text-xl font-bold text-white truncate">{lead.nome || 'Lead'}</h2>
                            <p className="text-slate-400 text-sm flex items-center gap-1.5 mt-0.5 truncate">
                                <Briefcase size={14} className="shrink-0" />
                                {lead.headline || 'Sem cargo informado'}
                            </p>
                            {lead.location && (
                                <p className="text-slate-500 text-xs flex items-center gap-1 mt-1">
                                    <MapPin size={12} /> {lead.location}
                                </p>
                            )}
                        </div>

                        {lead.linkedin_url && (
                            <a
                                href={lead.linkedin_url}
                                target="_blank"
                                rel="noopener noreferrer"
                                className="shrink-0 p-2.5 rounded-xl bg-slate-800 hover:bg-slate-700 text-slate-400 hover:text-white transition"
                            >
                                <ExternalLink size={18} />
                            </a>
                        )}
                    </div>
                </div>

                {/* ========== TRUST TRIAD: 3 Gauges (Light Theme) ========== */}
                <div className="px-6 py-5 border-b border-slate-200 bg-slate-50">
                    <div className="grid grid-cols-3 gap-4">
                        {/* Gauge 1: Qualifica√ß√£o ICP */}
                        <div className="flex flex-col items-center">
                            <CircularGauge percent={quality.percent} color={quality.color}>
                                <span className={`text-xl font-bold ${quality.text}`}>{quality.label}</span>
                            </CircularGauge>
                            <span className="text-[11px] text-slate-600 font-semibold uppercase tracking-wider mt-2">Qualifica√ß√£o ICP</span>
                        </div>

                        {/* Gauge 2: Intera√ß√µes */}
                        <div className="flex flex-col items-center">
                            <CircularGauge percent={interaction.percent} color={interaction.color}>
                                <span className={`text-xl font-bold ${interaction.text}`}>{interaction.label}</span>
                            </CircularGauge>
                            <span className="text-[11px] text-slate-600 font-semibold uppercase tracking-wider mt-2">Intera√ß√µes</span>
                        </div>

                        {/* Gauge 3: N√≠vel de Cad√™ncia (Trust Proxy) */}
                        <div className="flex flex-col items-center">
                            <CircularGauge percent={cadence.percent} color={cadence.color}>
                                <div className="flex flex-col items-center">
                                    <span className={`text-lg font-bold ${cadence.text}`}>{cadence.stage || '‚Äî'}</span>
                                </div>
                            </CircularGauge>
                            <span className="text-[11px] text-slate-600 font-semibold uppercase tracking-wider mt-2">Cad√™ncia</span>
                            <span className={`text-[9px] font-medium mt-0.5 ${cadence.text}`}>{cadence.label}</span>
                        </div>
                    </div>

                    {/* ICP Reasoning */}
                    <div className="mt-4 p-3 bg-white rounded-xl border border-slate-200 shadow-sm">
                        <p className="text-xs text-slate-600">
                            <span className="font-bold text-slate-800 mr-1">Por que ICP {quality.label}?</span>
                            {enrichedData?.icp_reason || lead?.icp_reason || "Sem justificativa dispon√≠vel."}
                        </p>
                    </div>

                    {/* Cadence Stage Explanation */}
                    <div className="mt-3 p-3 bg-white rounded-xl border border-slate-200 shadow-sm">
                        <p className="text-xs text-slate-600">
                            <span className="font-bold text-slate-800 mr-1">N√≠vel de Cad√™ncia ({cadence.stage || '‚Äî'}):</span>
                            {cadence.desc}
                        </p>
                    </div>
                </div>

                {/* ========== SCROLLABLE CONTENT (Light Theme) ========== */}
                <div className="px-6 pb-6 pt-4 overflow-y-auto max-h-[calc(92vh-340px)] space-y-5 bg-white">

                    {/* ========== AI BRIEFING (Context) ========== */}
                    {(enrichedData?.conversation_summary || lead?.conversation_summary) && (
                        <div className="bg-blue-50 rounded-xl p-4 border border-blue-200">
                            <div className="flex items-center gap-2 mb-2">
                                <Brain size={16} className="text-blue-600" />
                                <span className="text-xs font-bold text-blue-700 uppercase tracking-wider">Resumo da Conversa</span>
                            </div>
                            <p className="text-sm text-slate-700 leading-relaxed">
                                {enrichedData?.conversation_summary || lead?.conversation_summary}
                            </p>
                        </div>
                    )}

                    {/* ========== ACTION ENGINE: AI Suggestions (Enhanced) ========== */}
                    <div>
                        <div className="flex items-center gap-2 mb-3">
                            <Sparkles size={16} className="text-amber-500" />
                            <span className="text-xs font-bold text-slate-600 uppercase tracking-wider">Motor de A√ß√£o</span>
                        </div>

                        {aiReplies.length > 0 ? (
                            <div className="space-y-3">
                                {aiReplies.map((reply, idx) => {
                                    // Support both old string format and new object format
                                    const text = typeof reply === 'object' ? reply.text : reply
                                    const strategy = typeof reply === 'object' ? reply.strategy : null
                                    const isSelected = selectedSuggestionIdx === idx

                                    return (
                                        <div
                                            key={idx}
                                            className={`group relative p-4 rounded-2xl border transition-all cursor-pointer ${isSelected
                                                ? 'ring-2 ring-violet-500 border-violet-400 bg-violet-50'
                                                : idx === 0
                                                    ? 'bg-gradient-to-r from-violet-100 to-indigo-100 border-violet-300 hover:border-violet-400'
                                                    : 'bg-slate-50 border-slate-200 hover:border-slate-300'
                                                }`}
                                            onClick={() => {
                                                setDraftMessage(text)
                                                setSelectedSuggestionIdx(idx)
                                            }}
                                        >
                                            {idx === 0 && (
                                                <span className="absolute -top-2 left-3 px-2 py-0.5 bg-violet-600 text-white text-[10px] font-bold uppercase rounded-full">
                                                    Recomendada
                                                </span>
                                            )}
                                            <p className="text-sm text-slate-700 leading-relaxed pr-10">
                                                "{text}"
                                            </p>
                                            {/* Strategy Explanation */}
                                            {strategy && (
                                                <p className="text-xs text-slate-500 italic mt-2 border-t border-slate-200 pt-2">
                                                    üí° <span className="font-medium">Estrat√©gia:</span> {strategy}
                                                </p>
                                            )}
                                            <button
                                                className="absolute top-4 right-4 p-2 rounded-lg bg-slate-100 hover:bg-slate-200 text-slate-500 hover:text-slate-700 transition opacity-0 group-hover:opacity-100"
                                                onClick={(e) => { e.stopPropagation(); copyToClipboard(text, idx) }}
                                            >
                                                {copiedIdx === idx ? <Check size={16} className="text-emerald-500" /> : <Copy size={16} />}
                                            </button>
                                        </div>
                                    )
                                })}

                                {/* ========== HUMAN-IN-THE-LOOP EDITOR ========== */}
                                {draftMessage && (
                                    <div className="mt-4 p-4 bg-white rounded-xl border-2 border-dashed border-blue-300 space-y-3">
                                        <div className="flex items-center gap-2 text-xs text-blue-600 font-bold uppercase tracking-wider">
                                            <MessageCircle size={14} />
                                            Editar Mensagem Antes de Enviar
                                        </div>
                                        <textarea
                                            className="w-full h-28 p-3 bg-slate-50 border border-slate-200 rounded-lg text-sm text-slate-700 focus:outline-none focus:border-blue-400 focus:ring-2 focus:ring-blue-100 resize-none"
                                            value={draftMessage}
                                            onChange={(e) => setDraftMessage(e.target.value)}
                                            placeholder="Edite a mensagem aqui..."
                                        />
                                        <div className="flex gap-2">
                                            <button
                                                onClick={() => copyToClipboard(draftMessage, -1)}
                                                className="flex-1 py-2.5 rounded-lg bg-slate-100 text-slate-600 font-semibold text-sm hover:bg-slate-200 transition flex items-center justify-center gap-2"
                                            >
                                                <Copy size={14} />
                                                Copiar
                                            </button>
                                            <button
                                                onClick={() => {
                                                    console.log('[LinkedIn Send] Simulating send:', draftMessage)
                                                    alert('‚úÖ Mensagem pronta para envio! (Simula√ß√£o)')
                                                    setDraftMessage('')
                                                    setSelectedSuggestionIdx(null)
                                                }}
                                                className="flex-1 py-2.5 rounded-lg bg-blue-600 text-white font-semibold text-sm hover:bg-blue-700 transition flex items-center justify-center gap-2 shadow-lg shadow-blue-200"
                                            >
                                                <Send size={14} />
                                                Enviar via LinkedIn
                                            </button>
                                        </div>
                                    </div>
                                )}
                            </div>
                        ) : (
                            <div className="p-5 rounded-2xl bg-slate-50 border border-dashed border-slate-300 text-center">
                                <Sparkles size={24} className="mx-auto text-slate-400 mb-2" />
                                <p className="text-sm text-slate-500">
                                    Nenhuma sugest√£o dispon√≠vel ainda.<br />
                                    <span className="text-slate-400">Sincronize as mensagens para gerar.</span>
                                </p>
                            </div>
                        )}
                    </div>

                    {/* ========== RECENT MESSAGES ========== */}
                    {interactions.length > 0 && (
                        <div>
                            <div className="flex items-center gap-2 mb-3">
                                <MessageCircle size={16} className="text-slate-500" />
                                <span className="text-xs font-bold text-slate-600 uppercase tracking-wider">√öltimas Mensagens</span>
                            </div>
                            <div className="space-y-2">
                                {interactions.slice(0, 3).map((msg, idx) => (
                                    <div key={idx} className="p-3 rounded-xl bg-slate-50 border border-slate-200">
                                        <div className="flex items-center justify-between mb-1.5">
                                            <div className="flex items-center gap-2">
                                                <span className={`w-5 h-5 rounded-full flex items-center justify-center ${msg.direction === 'outbound' ? 'bg-blue-100 text-blue-600' : 'bg-emerald-100 text-emerald-600'
                                                    }`}>
                                                    {msg.direction === 'outbound' ? <ArrowRight size={10} /> : <ArrowLeft size={10} />}
                                                </span>
                                                <span className={`text-xs font-semibold ${msg.direction === 'outbound' ? 'text-blue-600' : 'text-emerald-600'
                                                    }`}>
                                                    {msg.direction === 'outbound' ? 'Enviada' : 'Recebida'}
                                                </span>
                                            </div>
                                            <span className="text-[10px] text-slate-400">
                                                {new Date(msg.interaction_date).toLocaleDateString('pt-BR')}
                                            </span>
                                        </div>
                                        <p className="text-sm text-slate-700 line-clamp-2">{msg.content || '‚Äî'}</p>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}

                    {!loadingInteractions && interactions.length === 0 && (
                        <div className="text-center py-6 text-slate-600 text-sm">
                            <MessageCircle size={24} className="mx-auto mb-2 opacity-50" />
                            Nenhuma mensagem registrada
                        </div>
                    )}
                </div>
            </div>
        </div>
    )
}

export default LeadDetailModal

```

## File: src\components\MissionCard.jsx
```javascript
import React from 'react'
import { useNavigate } from 'react-router-dom'
import {
    MessageSquare,
    AlertTriangle,
    UserPlus,
    Sprout,
    Crosshair,
    Clock,
    ChevronRight
} from 'lucide-react'

const TYPE_CONFIG = {
    GHOSTING: { icon: AlertTriangle, label: 'Ghosting', color: 'text-red-400' },
    NEW_CONNECTION: { icon: UserPlus, label: 'Nova Conex√£o', color: 'text-cyan-400' },
    NURTURING: { icon: Sprout, label: 'Nutri√ß√£o', color: 'text-emerald-400' },
    CLOSING: { icon: Crosshair, label: 'Fechamento', color: 'text-amber-400' },
}

const getCadenceStyle = (level) => {
    if (!level) return 'bg-gray-800 text-gray-400 border-gray-700'
    const num = parseInt(level?.toString().replace(/\D/g, ''), 10) || 0
    if (num >= 5) return 'bg-emerald-900/60 text-emerald-300 border-emerald-700'
    if (num >= 3) return 'bg-amber-900/60 text-amber-300 border-amber-700'
    return 'bg-cyan-900/60 text-cyan-300 border-cyan-700'
}

const getIcpStyle = (tier) => {
    switch (tier) {
        case 'A': return 'bg-emerald-900/60 text-emerald-300 border-emerald-700'
        case 'B': return 'bg-blue-900/60 text-blue-300 border-blue-700'
        default: return 'bg-gray-800 text-gray-400 border-gray-700'
    }
}

const MissionCard = ({ task, isHighPriority = false }) => {
    const navigate = useNavigate()
    const lead = task.leads || {}
    const typeConfig = TYPE_CONFIG[task.type] || TYPE_CONFIG.NURTURING
    const TypeIcon = typeConfig.icon

    const handleOpenChat = (e) => {
        e.stopPropagation()
        if (task.lead_id) {
            navigate(`/sales/inbox?lead=${task.lead_id}`)
        }
    }

    return (
        <div
            className={`
                rounded-xl p-4 group cursor-pointer
                transition-all duration-200
                bg-white/[0.03] border border-white/[0.08]
                hover:bg-white/[0.06] hover:border-white/[0.15]
                ${isHighPriority
                    ? 'border-l-[3px] border-l-red-500/70'
                    : ''
                }
            `}
            onClick={handleOpenChat}
            style={{ backdropFilter: 'blur(8px)' }}
        >
            <div className="flex items-start gap-3 sm:gap-4">
                {/* Lead Avatar */}
                <div className="w-10 h-10 sm:w-11 sm:h-11 rounded-full overflow-hidden shrink-0 bg-gradient-to-br from-gray-800 to-black border border-white/[0.1] flex items-center justify-center">
                    {lead.avatar_url ? (
                        <img src={lead.avatar_url} alt={lead.nome} className="w-full h-full object-cover" />
                    ) : (
                        <span className="text-sm font-bold text-gray-300">
                            {lead.nome?.charAt(0)?.toUpperCase() || '?'}
                        </span>
                    )}
                </div>

                {/* Content */}
                <div className="flex-1 min-w-0">
                    {/* Row 1: Name + Badges */}
                    <div className="flex items-center gap-2 flex-wrap">
                        <h4 className="text-sm font-semibold text-white truncate max-w-[160px] sm:max-w-[240px]">
                            {lead.nome || 'Lead'}
                        </h4>

                        {lead.last_cadence_level && (
                            <span className={`text-[10px] font-bold px-1.5 py-0.5 rounded border ${getCadenceStyle(lead.last_cadence_level)}`}>
                                {lead.last_cadence_level}
                            </span>
                        )}
                        {lead.icp_score && (
                            <span className={`text-[10px] font-bold px-1.5 py-0.5 rounded border ${getIcpStyle(lead.icp_score)}`}>
                                ICP {lead.icp_score}
                            </span>
                        )}

                        {task.days_overdue > 0 && (
                            <span className="text-[10px] font-medium px-1.5 py-0.5 rounded bg-red-900/50 text-red-300 border border-red-700 flex items-center gap-0.5">
                                <Clock size={10} />
                                {task.days_overdue}d
                            </span>
                        )}
                    </div>

                    {/* Row 2: Headline */}
                    {lead.headline && (
                        <p className="text-xs text-gray-500 truncate mt-0.5">{lead.headline}</p>
                    )}

                    {/* Row 3: Reasoning */}
                    <div className="flex items-start gap-1.5 mt-2">
                        <TypeIcon size={14} className={`${typeConfig.color} shrink-0 mt-0.5`} />
                        <p className="text-xs text-gray-400 leading-relaxed line-clamp-2">
                            {task.reasoning || `Miss√£o de ${typeConfig.label}`}
                        </p>
                    </div>
                </div>

                {/* Action Button */}
                <button
                    onClick={handleOpenChat}
                    className="
                        shrink-0 flex items-center gap-1.5 px-3 py-2 rounded-lg text-xs font-semibold
                        bg-primary text-white
                        hover:shadow-glow hover:-translate-y-0.5
                        transition-all duration-200
                        opacity-70 group-hover:opacity-100
                    "
                >
                    <MessageSquare size={14} />
                    <span className="hidden sm:inline">Abrir Chat</span>
                    <ChevronRight size={14} className="sm:hidden" />
                </button>
            </div>
        </div>
    )
}

export default MissionCard

```

## File: src\components\SalesCockpit.jsx
```javascript
import React, { useState, useEffect, useMemo, useCallback } from 'react'
import { supabase } from '../services/supabaseClient'
import { useClientSelection } from '../contexts/ClientSelectionContext'
import {
    Flame,
    Send,
    MessageSquare,
    FileText,
    ExternalLink,
    CheckCircle2,
    Trophy,
    PartyPopper,
    Loader2,
    RefreshCw,
    AlertTriangle,
    Rocket,
    Zap,
    Target,
    Hammer,
    Linkedin,
    Sparkles,
    TrendingUp,
    HandMetal,
    MessageCircle,
    Users,
    DollarSign
} from 'lucide-react'

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CONSTANTS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const HOT_STAGES = ['G4', 'G5']

const CADENCE_LABELS = {
    G1: 'Primeiro Contato',
    G2: 'Networking',
    G3: 'Nutri√ß√£o',
    G4: 'Aquecido',
    G5: 'Pronto p/ Fechar',
}

const CADENCE_STYLES = {
    G1: 'bg-slate-800 text-slate-300 border-slate-600',
    G2: 'bg-blue-900/50 text-blue-300 border-blue-700',
    G3: 'bg-cyan-900/50 text-cyan-300 border-cyan-700',
    G4: 'bg-orange-900/50 text-orange-300 border-orange-700',
    G5: 'bg-red-900/50 text-red-300 border-red-700',
}

const COLUMN_THEMES = {
    hot: {
        borderTop: 'linear-gradient(90deg, #ef4444, #f97316)',
        headerBg: 'bg-red-500/[0.06]',
        headerBorder: 'border-red-500/15',
        countBg: 'bg-red-900/40',
        countText: 'text-red-400',
        countBorder: 'border-red-700/50',
        iconColor: 'text-red-400',
        cardBorder: 'border-l-orange-500/60',
        columnBg: 'rgba(239, 68, 68, 0.015)',
        emptyBg: 'bg-red-500/5',
        emptyBorder: 'border-red-500/10',
    },
    cold: {
        borderTop: 'linear-gradient(90deg, #3b82f6, #64748b)',
        headerBg: 'bg-blue-500/[0.06]',
        headerBorder: 'border-blue-500/15',
        countBg: 'bg-blue-900/40',
        countText: 'text-blue-400',
        countBorder: 'border-blue-700/50',
        iconColor: 'text-blue-400',
        cardBorder: 'border-l-blue-500/30',
        columnBg: 'rgba(59, 130, 246, 0.015)',
        emptyBg: 'bg-blue-500/5',
        emptyBorder: 'border-blue-500/10',
    }
}

const VISIBLE_COLD_CARDS = 8

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MAIN COMPONENT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const SalesCockpit = () => {
    const { selectedClientId } = useClientSelection()
    const [tasks, setTasks] = useState([])
    const [doneCount, setDoneCount] = useState(0)
    const [loading, setLoading] = useState(true)
    const [error, setError] = useState(null)
    const [refreshing, setRefreshing] = useState(false)
    const [completingIds, setCompletingIds] = useState(new Set())
    const [showAllCold, setShowAllCold] = useState(false)

    const fetchTasks = useCallback(async (isRefresh = false) => {
        if (!selectedClientId) {
            setTasks([])
            setDoneCount(0)
            setLoading(false)
            return
        }

        if (isRefresh) setRefreshing(true)
        else setLoading(true)

        setError(null)

        try {
            const [pendingResult, doneResult] = await Promise.all([
                supabase
                    .from('tasks')
                    .select('*, leads!inner(client_id, nome, empresa, headline, linkedin_profile_url, cadence_stage, total_interactions_count)')
                    .eq('leads.client_id', selectedClientId)
                    .eq('status', 'PENDING')
                    .order('created_at', { ascending: true }),
                supabase
                    .from('tasks')
                    .select('id, leads!inner(client_id)', { count: 'exact' })
                    .eq('leads.client_id', selectedClientId)
                    .eq('status', 'DONE')
                    .limit(1)
            ])

            if (pendingResult.error) throw pendingResult.error

            setTasks(pendingResult.data || [])
            setDoneCount(doneResult.count || 0)
        } catch (err) {
            console.error('Error fetching cockpit tasks:', err)
            setError('Falha ao carregar tarefas. Tente novamente.')
        } finally {
            setLoading(false)
            setRefreshing(false)
        }
    }, [selectedClientId])

    useEffect(() => {
        fetchTasks()
    }, [fetchTasks])

    const handleComplete = async (taskId) => {
        setCompletingIds(prev => new Set(prev).add(taskId))
        setTasks(prev => prev.filter(t => t.id !== taskId))
        setDoneCount(prev => prev + 1)

        try {
            const { error: updateError } = await supabase
                .from('tasks')
                .update({ status: 'DONE' })
                .eq('id', taskId)

            if (updateError) throw updateError
        } catch (err) {
            console.error('Error completing task:', err)
            fetchTasks(true)
        } finally {
            setCompletingIds(prev => {
                const next = new Set(prev)
                next.delete(taskId)
                return next
            })
        }
    }

    const handleExecute = (linkedinUrl) => {
        if (linkedinUrl) {
            window.open(linkedinUrl, '_blank', 'noopener,noreferrer')
        }
    }

    // Split by cadence_stage: G4/G5 ‚Üí hot, rest ‚Üí cold
    const { hotTasks, coldTasks } = useMemo(() => {
        const hot = []
        const cold = []

        tasks.forEach(task => {
            const stage = task.leads?.cadence_stage
            if (HOT_STAGES.includes(stage)) {
                hot.push(task)
            } else {
                cold.push(task)
            }
        })

        return { hotTasks: hot, coldTasks: cold }
    }, [tasks])

    const totalMissions = tasks.length + doneCount
    const progressPercent = totalMissions > 0 ? Math.round((doneCount / totalMissions) * 100) : 0
    const allDone = tasks.length === 0 && !loading

    // Cold column: show first N or all
    const visibleColdTasks = showAllCold ? coldTasks : coldTasks.slice(0, VISIBLE_COLD_CARDS)
    const hiddenColdCount = coldTasks.length - VISIBLE_COLD_CARDS

    // --- LOADING STATE ---
    if (loading) {
        return (
            <div className="glass-panel rounded-2xl p-8 mb-8 animate-fade-in-up">
                <div className="flex flex-col items-center justify-center py-12 gap-4">
                    <Loader2 className="w-8 h-8 animate-spin text-primary" />
                    <span className="tracking-wide uppercase text-xs font-bold text-gray-400">
                        Carregando cockpit...
                    </span>
                </div>
            </div>
        )
    }

    // --- ERROR STATE ---
    if (error) {
        return (
            <div className="glass-panel rounded-2xl p-8 mb-8 border-red-500/20 animate-fade-in-up">
                <div className="flex flex-col items-center justify-center py-12 gap-4 text-center">
                    <div className="w-14 h-14 rounded-2xl bg-red-500/10 border border-red-500/20 flex items-center justify-center">
                        <AlertTriangle size={28} className="text-red-400" />
                    </div>
                    <p className="text-sm text-gray-400">{error}</p>
                    <button
                        onClick={() => fetchTasks()}
                        className="px-4 py-2 rounded-lg bg-white/5 hover:bg-white/10 text-gray-300 text-sm font-medium border border-glass-border transition-all"
                    >
                        Tentar novamente
                    </button>
                </div>
            </div>
        )
    }

    // --- NO CLIENT ---
    if (!selectedClientId) {
        return (
            <div className="glass-panel rounded-2xl p-8 mb-8 animate-fade-in-up">
                <div className="flex flex-col items-center justify-center py-8 gap-3 text-center">
                    <Target size={32} className="text-gray-600" />
                    <p className="text-sm text-gray-400">Selecione um cliente para ver o Cockpit.</p>
                </div>
            </div>
        )
    }

    return (
        <div className="mb-8 animate-fade-in-up">
            {/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */}
            {/* HEADER + PROGRESS                      */}
            {/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */}
            <div className="glass-panel rounded-2xl p-5 sm:p-6 mb-5">
                <div className="flex items-start justify-between gap-4 mb-5">
                    <div className="flex items-center gap-3">
                        <div className="w-10 h-10 rounded-xl bg-primary/10 border border-primary/20 flex items-center justify-center">
                            <Rocket size={20} className="text-primary" />
                        </div>
                        <div>
                            <h2 className="text-xl sm:text-2xl font-bold tracking-tight text-white mb-0.5">
                                Sales Cockpit üöÄ
                            </h2>
                            <p className="text-sm text-gray-400">
                                {hotTasks.length > 0
                                    ? <><span className="text-orange-400 font-semibold">{hotTasks.length} quente(s)</span> ¬∑ {coldTasks.length} em prospec√ß√£o</>
                                    : tasks.length > 0
                                        ? <>{tasks.length} tarefa(s) pendente(s)</>
                                        : 'Nenhuma tarefa pendente!'
                                }
                            </p>
                        </div>
                    </div>
                    <button
                        onClick={() => fetchTasks(true)}
                        disabled={refreshing}
                        className="p-2 rounded-lg hover:bg-white/10 transition-colors text-gray-500 hover:text-white"
                        title="Atualizar"
                    >
                        <RefreshCw size={16} className={refreshing ? 'animate-spin' : ''} />
                    </button>
                </div>

                {/* Progress */}
                <div className="space-y-2">
                    <div className="flex items-center justify-between">
                        <span className="text-xs font-medium text-gray-500 uppercase tracking-wider">Progresso do dia</span>
                        <span className="text-sm font-bold text-gray-300">{doneCount}/{totalMissions} conclu√≠das</span>
                    </div>
                    <div className="h-3 bg-white/[0.05] rounded-full overflow-hidden border border-white/[0.08]">
                        <div
                            className="h-full rounded-full transition-all duration-700 ease-out"
                            style={{
                                width: `${progressPercent}%`,
                                background: progressPercent === 100
                                    ? 'linear-gradient(90deg, #10b981, #34d399)'
                                    : 'linear-gradient(90deg, #ff4d00, #ff8800)',
                                boxShadow: progressPercent === 100
                                    ? '0 0 16px rgba(16, 185, 129, 0.6)'
                                    : '0 0 16px rgba(255, 77, 0, 0.5)',
                            }}
                        />
                    </div>
                </div>
            </div>

            {/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */}
            {/* ZERO INBOX                             */}
            {/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */}
            {allDone && (
                <div className="glass-panel rounded-2xl p-10 sm:p-16 text-center">
                    <div className="flex justify-center mb-4">
                        <div className="w-16 h-16 rounded-2xl bg-emerald-900/30 border border-emerald-500/20 flex items-center justify-center">
                            {doneCount > 0
                                ? <Trophy size={32} className="text-emerald-400" />
                                : <PartyPopper size={32} className="text-emerald-400" />
                            }
                        </div>
                    </div>
                    <h2 className="text-xl font-bold text-white mb-2">
                        {doneCount > 0 ? 'Todas conclu√≠das! üèÜ' : 'Zero Inbox! üéâ'}
                    </h2>
                    <p className="text-sm text-gray-400 max-w-sm mx-auto">
                        {doneCount > 0
                            ? `Voc√™ completou ${doneCount} tarefas hoje. Excelente trabalho!`
                            : 'Nenhuma tarefa gerada. Quando a IA identificar oportunidades, elas aparecer√£o aqui.'
                        }
                    </p>
                </div>
            )}

            {/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */}
            {/* KANBAN BOARD                            */}
            {/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */}
            {!allDone && (
                <div className="grid grid-cols-1 lg:grid-cols-2 gap-4">

                    {/* LEFT: üî• FECHAMENTO / QUENTE (G4, G5) */}
                    <KanbanColumn
                        title="Fechamento / Quente"
                        emoji="üî•"
                        icon={<DollarSign size={15} />}
                        count={hotTasks.length}
                        themeKey="hot"
                        emptyIcon={<Sparkles size={28} className="text-orange-400/40" />}
                        emptyTitle="Pipeline limpo"
                        emptyText="Nenhum lead em G4/G5. Foque na prospec√ß√£o ‚Üí"
                    >
                        {hotTasks.map(task => (
                            <TaskCard
                                key={task.id}
                                task={task}
                                themeKey="hot"
                                completing={completingIds.has(task.id)}
                                onComplete={handleComplete}
                                onExecute={handleExecute}
                            />
                        ))}
                    </KanbanColumn>

                    {/* RIGHT: üî® PROSPEC√á√ÉO & NUTRI√á√ÉO (Rest) */}
                    <KanbanColumn
                        title="Prospec√ß√£o & Nutri√ß√£o"
                        emoji="üî®"
                        icon={<Users size={15} />}
                        count={coldTasks.length}
                        themeKey="cold"
                        emptyIcon={<TrendingUp size={28} className="text-blue-400/40" />}
                        emptyTitle="Tudo em dia"
                        emptyText="Nenhuma prospec√ß√£o pendente no momento."
                        footer={
                            hiddenColdCount > 0 && !showAllCold ? (
                                <button
                                    onClick={() => setShowAllCold(true)}
                                    className="w-full py-3 text-center text-xs font-semibold text-blue-400 hover:text-blue-300 bg-blue-500/[0.04] hover:bg-blue-500/[0.08] border-t border-blue-500/10 transition-colors"
                                >
                                    Mostrar mais {hiddenColdCount} tarefas
                                </button>
                            ) : showAllCold && coldTasks.length > VISIBLE_COLD_CARDS ? (
                                <button
                                    onClick={() => setShowAllCold(false)}
                                    className="w-full py-3 text-center text-xs font-semibold text-gray-500 hover:text-gray-300 bg-white/[0.02] hover:bg-white/[0.04] border-t border-white/[0.06] transition-colors"
                                >
                                    Mostrar menos
                                </button>
                            ) : null
                        }
                    >
                        {visibleColdTasks.map(task => (
                            <TaskCard
                                key={task.id}
                                task={task}
                                themeKey="cold"
                                completing={completingIds.has(task.id)}
                                onComplete={handleComplete}
                                onExecute={handleExecute}
                            />
                        ))}
                    </KanbanColumn>
                </div>
            )}
        </div>
    )
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// KANBAN COLUMN
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const KanbanColumn = ({
    title,
    emoji,
    icon,
    count,
    themeKey,
    children,
    emptyIcon,
    emptyTitle,
    emptyText,
    footer
}) => {
    const theme = COLUMN_THEMES[themeKey]
    const isEmpty = React.Children.count(children) === 0

    return (
        <div
            className="rounded-2xl overflow-hidden border border-white/[0.06] flex flex-col"
            style={{ background: theme.columnBg, backdropFilter: 'blur(12px)' }}
        >
            {/* Gradient accent bar */}
            <div className="h-[3px] w-full shrink-0" style={{ background: theme.borderTop }} />

            {/* Header */}
            <div className={`flex items-center justify-between px-4 py-3 ${theme.headerBg} border-b ${theme.headerBorder}`}>
                <div className="flex items-center gap-2">
                    <span className={theme.iconColor}>{icon}</span>
                    <h3 className="text-xs font-bold text-gray-300 tracking-wider uppercase">
                        {emoji} {title}
                    </h3>
                </div>
                <span className={`text-[11px] font-bold px-2.5 py-1 rounded-full ${theme.countBg} ${theme.countText} border ${theme.countBorder}`}>
                    {count}
                </span>
            </div>

            {/* Cards area */}
            <div
                className="flex-1 p-3 space-y-2.5 overflow-y-auto"
                style={{ maxHeight: '560px', minHeight: '140px' }}
            >
                {isEmpty ? (
                    <div className={`flex flex-col items-center justify-center py-10 gap-2 rounded-xl ${theme.emptyBg} border ${theme.emptyBorder}`}>
                        {emptyIcon}
                        <p className="text-sm font-semibold text-gray-400">{emptyTitle}</p>
                        <p className="text-[11px] text-gray-500 text-center px-6">{emptyText}</p>
                    </div>
                ) : (
                    children
                )}
            </div>

            {/* Optional footer (e.g. "Show more") */}
            {footer}
        </div>
    )
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TASK CARD ‚Äî Smart Action Button
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const TaskCard = ({ task, themeKey, completing, onComplete, onExecute }) => {
    const lead = task.leads || {}
    const theme = COLUMN_THEMES[themeKey]
    const initial = lead.nome?.charAt(0)?.toUpperCase() || '?'

    const stage = lead.cadence_stage || ''
    const stageLabel = CADENCE_LABELS[stage] || stage
    const stageStyle = CADENCE_STYLES[stage] || 'bg-gray-800 text-gray-400 border-gray-700'

    const messageCount = lead.total_interactions_count || 0
    const isFirstContact = messageCount === 0

    return (
        <div
            className={`
                rounded-xl p-3.5 group
                transition-all duration-300 ease-out
                bg-white/[0.025] border border-white/[0.06]
                hover:bg-white/[0.055] hover:border-white/[0.13]
                hover:shadow-lg hover:shadow-black/20
                border-l-[3px] ${theme.cardBorder}
                ${completing
                    ? 'opacity-0 scale-95 translate-x-4 pointer-events-none'
                    : 'opacity-100 scale-100 translate-x-0'
                }
            `}
            style={{ backdropFilter: 'blur(8px)' }}
        >
            {/* Row 1: Avatar + Lead Info + Stage Badge */}
            <div className="flex items-start gap-3 mb-2">
                <div className="w-9 h-9 rounded-lg shrink-0 bg-gradient-to-br from-gray-800 to-gray-900 border border-white/[0.08] flex items-center justify-center">
                    <span className="text-xs font-bold text-gray-300">{initial}</span>
                </div>
                <div className="flex-1 min-w-0">
                    <div className="flex items-center gap-2 mb-0.5">
                        <h4 className="text-sm font-semibold text-white truncate">{lead.nome || 'Lead'}</h4>
                        {stage && (
                            <span className={`shrink-0 text-[9px] font-bold px-1.5 py-0.5 rounded border ${stageStyle}`}>
                                {stage}
                            </span>
                        )}
                    </div>
                    <p className="text-[11px] text-gray-500 truncate leading-tight">
                        {lead.headline || ''}
                        {lead.empresa && lead.headline ? ` ¬∑ ${lead.empresa}` : lead.empresa || ''}
                    </p>
                </div>
            </div>

            {/* Row 2: AI Instruction */}
            {task.instruction && (
                <div className="mb-3">
                    <p className="text-[11px] text-gray-400 leading-relaxed line-clamp-2 bg-white/[0.02] rounded-lg px-3 py-2 border border-white/[0.04]">
                        <span className="mr-1">üí°</span>{task.instruction}
                    </p>
                </div>
            )}

            {/* Row 3: Smart Action Buttons */}
            <div className="flex items-center gap-2">
                {/* PRIMARY: Smart LinkedIn Action */}
                {lead.linkedin_profile_url && (
                    <button
                        onClick={() => onExecute(lead.linkedin_profile_url)}
                        className={`
                            flex-1 flex items-center justify-center gap-1.5 px-3 py-2 rounded-lg text-[11px] font-semibold
                            transition-all duration-200
                            ${isFirstContact
                                ? 'bg-indigo-500/15 text-indigo-300 border border-indigo-500/25 hover:bg-indigo-500/25 hover:border-indigo-500/40'
                                : 'bg-emerald-500/10 text-emerald-400 border border-emerald-500/20 hover:bg-emerald-500/20 hover:border-emerald-500/35'
                            }
                        `}
                        title={isFirstContact ? 'Enviar primeiro contato' : 'Continuar conversa'}
                    >
                        {isFirstContact ? (
                            <>
                                <HandMetal size={13} />
                                <span>Enviar Icebreaker</span>
                            </>
                        ) : (
                            <>
                                <MessageCircle size={13} />
                                <span>Continuar Conversa</span>
                            </>
                        )}
                    </button>
                )}

                {/* SECONDARY: Concluir */}
                <button
                    onClick={() => onComplete(task.id)}
                    disabled={completing}
                    className="
                        shrink-0 flex items-center justify-center gap-1 px-3 py-2 rounded-lg text-[11px] font-semibold
                        bg-white/[0.04] text-gray-400 border border-white/[0.08]
                        hover:bg-emerald-500/15 hover:text-emerald-400 hover:border-emerald-500/25
                        transition-all duration-200
                        disabled:opacity-50 disabled:cursor-not-allowed
                    "
                    title="Marcar como conclu√≠da"
                >
                    {completing ? (
                        <Loader2 size={13} className="animate-spin" />
                    ) : (
                        <CheckCircle2 size={13} />
                    )}
                </button>
            </div>
        </div>
    )
}

export default SalesCockpit

```

## File: src\components\SchedulePostModal.jsx
```javascript
import React, { useState } from 'react'
import { CalendarClock, X, Loader2, CheckCircle2 } from 'lucide-react'
import { supabase } from '../services/supabaseClient'
import './CreatePostModal.css' // Reusing modal styles

const SchedulePostModal = ({ post, onClose, onSuccess }) => {
    const [scheduleDate, setScheduleDate] = useState('')
    const [loading, setLoading] = useState(false)

    const handleSchedule = async (e) => {
        e.preventDefault()
        if (!scheduleDate) return

        setLoading(true)
        try {
            const { error } = await supabase
                .from('tabela_projetofred1')
                .update({
                    data_agendamento: scheduleDate,
                    status: 'AGENDADO'
                })
                .eq('id', post.id)

            if (error) throw error

            // Show success logic if needed (handled by parent usually, but we can do a local one)
            onSuccess()
            onClose()
            // Optional: You could use a toast library here if available in the project context
            alert(`Post agendado para ${new Date(scheduleDate).toLocaleString()}!`)

        } catch (error) {
            console.error('Erro ao agendar:', error)
            alert('Erro ao agendar post: ' + error.message)
        } finally {
            setLoading(false)
        }
    }

    return (
        <div className="modal-overlay">
            <div className="modal-content" style={{ maxWidth: '500px' }}>
                <div className="modal-header">
                    <h2 style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                        <CalendarClock size={24} className="text-primary" />
                        Agendar Publica√ß√£o
                    </h2>
                    <button className="close-btn" onClick={onClose}>
                        <X size={24} />
                    </button>
                </div>

                <div className="modal-body">
                    <div className="form-group">
                        <label style={{ fontSize: '0.9rem', color: '#64748b', marginBottom: '4px', display: 'block' }}>Tema do Post</label>
                        <div style={{
                            padding: '12px',
                            background: '#f8fafc',
                            borderRadius: '8px',
                            border: '1px solid #e2e8f0',
                            fontWeight: 500,
                            color: '#1e293b'
                        }}>
                            {post.tema || 'Sem T√≠tulo'}
                        </div>
                    </div>

                    <form onSubmit={handleSchedule} style={{ marginTop: '20px' }}>
                        <div className="form-group">
                            <label htmlFor="scheduleDate">Data e Hora da Publica√ß√£o</label>
                            <input
                                type="datetime-local"
                                id="scheduleDate"
                                className="form-input"
                                value={scheduleDate}
                                onChange={(e) => setScheduleDate(e.target.value)}
                                required
                                style={{ width: '100%' }}
                            />
                        </div>

                        <div className="modal-actions" style={{ marginTop: '24px', display: 'flex', justifyContent: 'flex-end', gap: '12px' }}>
                            <button type="button" className="btn-secondary" onClick={onClose} disabled={loading}>
                                Cancelar
                            </button>
                            <button
                                type="submit"
                                className="btn-primary"
                                disabled={loading || !scheduleDate}
                                style={{ display: 'flex', alignItems: 'center', gap: '8px' }}
                            >
                                {loading ? <Loader2 className="spinner" size={18} /> : <CheckCircle2 size={18} />}
                                Confirmar Agendamento
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    )
}

export default SchedulePostModal

```

## File: src\components\StrategicContextCard.jsx
```javascript
import React, { useState } from 'react'
import { ShieldAlert, Brain, Radio, Target, TrendingUp, Loader2 } from 'lucide-react'

// Cadence level configurations
const CADENCE_LEVELS = {
    G1: { label: 'Frio', desc: 'Lead acabou de ser abordado. Sem conex√£o emocional ainda.', color: 'from-slate-400 to-slate-500', bg: 'bg-slate-500/15', border: 'border-slate-500/40', text: 'text-slate-300', percent: 20 },
    G2: { label: 'Receptivo', desc: 'Lead reconhece voc√™ e est√° aberto a ouvir.', color: 'from-blue-400 to-blue-500', bg: 'bg-blue-500/15', border: 'border-blue-500/40', text: 'text-blue-300', percent: 40 },
    G3: { label: 'Contextualizado', desc: 'Lead entende sua proposta e est√° avaliando.', color: 'from-amber-400 to-amber-500', bg: 'bg-amber-500/15', border: 'border-amber-500/40', text: 'text-amber-300', percent: 60 },
    G4: { label: 'Interessado', desc: 'Lead demonstra interesse ativo. Engajamento crescente.', color: 'from-orange-400 to-orange-500', bg: 'bg-orange-500/15', border: 'border-orange-500/40', text: 'text-orange-300', percent: 80 },
    G5: { label: 'Quente', desc: 'Lead confia em voc√™. Pronto para a√ß√£o de convers√£o.', color: 'from-emerald-400 to-emerald-500', bg: 'bg-emerald-500/15', border: 'border-emerald-500/40', text: 'text-emerald-300', percent: 100 },
}

const getCadenceConfig = (level) => {
    if (!level) return null
    const key = level.toString().toUpperCase().trim()
    return CADENCE_LEVELS[key] || CADENCE_LEVELS['G1']
}

const StrategicContextCard = ({ lead }) => {
    const [showTooltip, setShowTooltip] = useState(false)

    if (!lead) return null

    const cadenceLevel = lead.last_cadence_level
    const signal = lead.last_signal_detected
    const psychological = lead.last_psychological_factor
    const forbidden = lead.last_forbidden_action
    const strategy = lead.last_strategy_used

    // If ALL fields are null ‚Üí show "awaiting analysis" state
    const hasAnyData = cadenceLevel || signal || psychological || forbidden || strategy

    if (!hasAnyData) {
        return (
            <div className="bg-[#0d0d0d] rounded-2xl border border-white/10 p-5">
                <div className="flex items-center gap-2 mb-4">
                    <div className="w-6 h-6 rounded-lg bg-primary/20 flex items-center justify-center">
                        <TrendingUp size={14} className="text-primary" />
                    </div>
                    <h4 className="text-xs font-bold text-primary uppercase tracking-wider">Raio-X da Negocia√ß√£o</h4>
                </div>
                <div className="flex flex-col items-center justify-center py-6 gap-3">
                    <Loader2 size={24} className="text-gray-500 animate-spin" />
                    <p className="text-xs text-gray-500 text-center leading-relaxed">
                        Aguardando An√°lise da IA...<br />
                        <span className="text-gray-600">Dispon√≠vel ap√≥s o pr√≥ximo processamento.</span>
                    </p>
                </div>
            </div>
        )
    }

    const config = getCadenceConfig(cadenceLevel)

    return (
        <div className="bg-[#0d0d0d] rounded-2xl border border-white/10 p-5 space-y-4">
            {/* Header */}
            <div className="flex items-center justify-between">
                <div className="flex items-center gap-2">
                    <div className="w-6 h-6 rounded-lg bg-primary/20 flex items-center justify-center">
                        <TrendingUp size={14} className="text-primary" />
                    </div>
                    <h4 className="text-xs font-bold text-primary uppercase tracking-wider">Raio-X da Negocia√ß√£o</h4>
                </div>
            </div>

            {/* A. Cadence Level Badge */}
            {config && (
                <div className="relative">
                    <div
                        className={`relative overflow-hidden rounded-xl ${config.bg} border ${config.border} p-3 cursor-default`}
                        onMouseEnter={() => setShowTooltip(true)}
                        onMouseLeave={() => setShowTooltip(false)}
                    >
                        {/* Progress bar behind */}
                        <div
                            className={`absolute inset-y-0 left-0 bg-gradient-to-r ${config.color} opacity-10`}
                            style={{ width: `${config.percent}%`, transition: 'width 0.6s ease' }}
                        />

                        <div className="relative flex items-center justify-between">
                            <div className="flex items-center gap-2.5">
                                <span className={`text-lg font-black ${config.text}`}>
                                    {cadenceLevel}
                                </span>
                                <div>
                                    <span className={`text-[10px] font-bold uppercase tracking-widest ${config.text} opacity-80`}>
                                        {config.label}
                                    </span>
                                    <div className="flex items-center gap-1 mt-0.5">
                                        {[1, 2, 3, 4, 5].map(i => {
                                            const levelNum = parseInt(cadenceLevel?.replace(/\D/g, '') || '0')
                                            return (
                                                <div
                                                    key={i}
                                                    className={`h-1 w-4 rounded-full transition-colors ${i <= levelNum
                                                        ? `bg-gradient-to-r ${config.color}`
                                                        : 'bg-white/10'
                                                        }`}
                                                />
                                            )
                                        })}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Tooltip */}
                    {showTooltip && (
                        <div className="absolute z-50 -top-2 left-1/2 -translate-x-1/2 -translate-y-full bg-gray-900 border border-white/20 rounded-lg px-3 py-2 shadow-xl max-w-[220px]">
                            <p className="text-[11px] text-gray-200 leading-relaxed">{config.desc}</p>
                            <div className="absolute bottom-0 left-1/2 -translate-x-1/2 translate-y-1/2 rotate-45 w-2 h-2 bg-gray-900 border-r border-b border-white/20" />
                        </div>
                    )}
                </div>
            )}

            {/* B. Forbidden Action - DANGER ZONE */}
            {forbidden && (
                <div className="rounded-xl bg-red-500/10 border border-red-500/30 p-3 space-y-1.5">
                    <div className="flex items-center gap-2">
                        <ShieldAlert size={14} className="text-red-400 shrink-0" />
                        <span className="text-[10px] font-bold uppercase tracking-widest text-red-400">Zona de Perigo</span>
                    </div>
                    <p className="text-xs text-red-300/90 leading-relaxed font-medium pl-[22px]">
                        {forbidden}
                    </p>
                </div>
            )}

            {/* C. Lead Analysis (Signal + Psychological) */}
            {(signal || psychological) && (
                <div className="rounded-xl bg-white/[0.03] border border-white/10 p-3 space-y-2.5">
                    <span className="text-[10px] font-bold uppercase tracking-widest text-gray-400">An√°lise do Lead</span>

                    {signal && (
                        <div className="flex items-start gap-2">
                            <Radio size={13} className="text-cyan-400 mt-0.5 shrink-0" />
                            <div>
                                <span className="text-[9px] uppercase tracking-widest text-cyan-400/70 font-bold">Sinal Detectado</span>
                                <p className="text-xs text-gray-300 leading-relaxed">{signal}</p>
                            </div>
                        </div>
                    )}

                    {psychological && (
                        <div className="flex items-start gap-2">
                            <Brain size={13} className="text-purple-400 mt-0.5 shrink-0" />
                            <div>
                                <span className="text-[9px] uppercase tracking-widest text-purple-400/70 font-bold">Fator Psicol√≥gico</span>
                                <p className="text-xs text-gray-300 leading-relaxed">{psychological}</p>
                            </div>
                        </div>
                    )}
                </div>
            )}

            {/* D. Recommended Tactic */}
            {strategy && (
                <div className="rounded-xl bg-primary/10 border border-primary/30 p-3 space-y-1.5">
                    <div className="flex items-center gap-2">
                        <Target size={14} className="text-primary shrink-0" />
                        <span className="text-[10px] font-bold uppercase tracking-widest text-primary/80">T√°tica Recomendada</span>
                    </div>
                    <p className="text-xs text-gray-200 leading-relaxed pl-[22px]">
                        {strategy}
                    </p>
                </div>
            )}
        </div>
    )
}

export default StrategicContextCard

```

## File: src\components\SystemStatusHelpModal.jsx
```javascript
import React from 'react'
import { X, RefreshCw, History, Info } from 'lucide-react'

const SystemStatusHelpModal = ({ isOpen, onClose }) => {
    if (!isOpen) return null

    return (
        <div className="fixed inset-0 z-[100] flex items-center justify-center bg-slate-900/60 backdrop-blur-sm p-4 animate-fade-in">
            <div className="bg-white w-full max-w-lg rounded-2xl shadow-2xl overflow-hidden animate-scale-in">
                {/* Header */}
                <div className="p-5 border-b border-gray-100 flex justify-between items-center bg-slate-50/50">
                    <div className="flex items-center gap-2.5">
                        <div className="w-8 h-8 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center">
                            <Info size={18} />
                        </div>
                        <div>
                            <h2 className="text-lg font-bold text-slate-800">Ajuda e Status do Sistema</h2>
                            <p className="text-xs text-gray-500 font-medium">Entenda como mantemos seus dados atualizados</p>
                        </div>
                    </div>
                    <button onClick={onClose} className="p-2 rounded-full hover:bg-white hover:shadow-sm text-gray-400 hover:text-slate-600 transition-all">
                        <X size={20} />
                    </button>
                </div>

                {/* Body */}
                <div className="p-6 space-y-6">

                    {/* Block 1: Real-time Sync */}
                    <div className="flex gap-4">
                        <div className="shrink-0 mt-1">
                            <div className="w-10 h-10 rounded-full bg-green-50 text-green-600 border border-green-100 flex items-center justify-center shadow-sm">
                                <RefreshCw size={20} className="animate-spin-slow" />
                            </div>
                        </div>
                        <div>
                            <h3 className="text-sm font-bold text-slate-900 mb-1 flex items-center gap-2">
                                üü¢ Sincroniza√ß√£o em Tempo Real (O "Rep√≥rter")
                            </h3>
                            <p className="text-sm text-slate-600 leading-relaxed">
                                "Para manter suas conversas fluindo, o sistema verifica novas mensagens automaticamente v√°rias vezes ao dia. Assim que seu lead responder no LinkedIn, a mensagem aparecer√° na plataforma e a IA analisar√° o contexto imediato para sugerir a pr√≥xima a√ß√£o. (Janela de leitura: √öltimas 50 mensagens)."
                            </p>
                        </div>
                    </div>

                    <div className="h-px bg-gray-100 w-full" />

                    {/* Block 2: History Import */}
                    <div className="flex gap-4">
                        <div className="shrink-0 mt-1">
                            <div className="w-10 h-10 rounded-full bg-amber-50 text-amber-600 border border-amber-100 flex items-center justify-center shadow-sm">
                                <History size={20} />
                            </div>
                        </div>
                        <div>
                            <h3 className="text-sm font-bold text-slate-900 mb-1 flex items-center gap-2">
                                üü° Importa√ß√£o de Hist√≥rico (O "Arque√≥logo")
                            </h3>
                            <p className="text-sm text-slate-600 leading-relaxed">
                                "Para garantir que a IA conhe√ßa seu cliente a fundo, ao cadastrar um novo lead, iniciamos uma varredura segura para recuperar o hist√≥rico de conversas antigas (at√© 1 ano). Isso permite que o sistema entenda dores passadas e negocia√ß√µes anteriores. (Execu√ß√£o √∫nica no cadastro)."
                            </p>
                        </div>
                    </div>

                </div>

                {/* Footer */}
                <div className="p-4 bg-slate-50 border-t border-gray-100 text-center">
                    <p className="text-xs text-gray-400">
                        O sistema opera em segundo plano. Voc√™ pode continuar navegando normalmente.
                    </p>
                </div>
            </div>
        </div>
    )
}

export default SystemStatusHelpModal

```

## File: src\components\kanban\KanbanColumn.jsx
```javascript
import React from 'react'

/**
 * KanbanColumn - A reusable column component for the Kanban board
 * @param {string} title - Column title
 * @param {string} icon - Emoji icon for the column
 * @param {number} count - Number of items in the column
 * @param {string} colorClass - Tailwind color class for the header accent
 * @param {React.ReactNode} children - Lead cards to render
 */
const KanbanColumn = ({ title, icon, count = 0, colorClass = 'bg-slate-500', children }) => {
    return (
        <div className="flex flex-col bg-white/5 backdrop-blur-lg rounded-2xl border border-white/10 shadow-lg min-w-[300px] max-w-[320px] h-full">
            {/* Column Header */}
            <div className={`flex items-center justify-between px-4 py-3 border-b border-gray-200 rounded-t-2xl`}>
                <div className="flex items-center gap-2">
                    <span className="text-lg">{icon}</span>
                    <h3 className="font-bold text-gray-800 text-sm">{title}</h3>
                </div>
                <span className={`px-2.5 py-0.5 rounded-full text-xs font-bold text-white ${colorClass}`}>
                    {count}
                </span>
            </div>

            {/* Scrollable Card List */}
            <div className="flex-1 overflow-y-auto p-3 space-y-2 max-h-[calc(100vh-320px)] custom-scrollbar">
                {children}
                {count === 0 && (
                    <div className="text-center py-8 text-gray-500 text-sm italic">
                        Nenhum lead aqui
                    </div>
                )}
            </div>
        </div>
    )
}

export default KanbanColumn

```

## File: src\components\kanban\KanbanLeadCard.jsx
```javascript
import React from 'react'
import { MessageCircle, Clock, Zap } from 'lucide-react'

/**
 * KanbanLeadCard - A compact lead card for the Kanban board
 * @param {Object} lead - Lead data object
 * @param {Function} onClick - Click handler
 */
const KanbanLeadCard = ({ lead, onClick }) => {
    // Helper: Time since last interaction
    const getTimeSince = (dateString) => {
        if (!dateString) return '‚Äî'
        const now = new Date()
        const date = new Date(dateString)
        const diffMs = now - date
        const diffHours = Math.floor(diffMs / (1000 * 60 * 60))
        const diffDays = Math.floor(diffHours / 24)

        if (diffDays > 0) return `${diffDays}d`
        if (diffHours > 0) return `${diffHours}h`
        return 'agora'
    }

    // Helper: Cadence stage styling (trust-gradient based on level)
    const getCadenceStyle = (stage) => {
        const match = stage?.toString().match(/(\d+)/)
        const level = match ? parseInt(match[1], 10) : 0

        if (level >= 7) return 'bg-yellow-100 text-yellow-700 border border-yellow-300'
        if (level >= 6) return 'bg-green-100 text-green-700 border border-green-300'
        if (level >= 5) return 'bg-emerald-100 text-emerald-700 border border-emerald-300'
        if (level >= 4) return 'bg-orange-100 text-orange-700 border border-orange-300'
        if (level >= 3) return 'bg-amber-100 text-amber-700 border border-amber-300'
        if (level >= 2) return 'bg-cyan-100 text-cyan-700 border border-cyan-300'
        if (level >= 1) return 'bg-blue-100 text-blue-700 border border-blue-300'
        return 'bg-gray-100 text-gray-600 border border-gray-300'
    }

    // Helper: ICP tier styling
    const getIcpStyle = (tier) => {
        switch (tier) {
            case 'A': return 'bg-emerald-100 text-emerald-700 border-emerald-300'
            case 'B': return 'bg-blue-100 text-blue-700 border-blue-300'
            case 'C': return 'bg-gray-100 text-gray-600 border-gray-300'
            default: return 'bg-gray-100 text-gray-600 border-gray-300'
        }
    }

    // Extract lead data (handle both direct and nested structures)
    const leadData = lead?.leads || lead
    const cadenceStage = leadData?.cadence_stage || ''
    const icpTier = leadData?.qualification_tier || leadData?.icp_score || 'C'
    const totalInteractions = leadData?.total_interactions_count || leadData?.total_interactions || 0
    const lastInteractionDate = leadData?.last_interaction_date
    const hasAiSuggestions = (leadData?.ai_suggested_replies?.length || 0) > 0
    const nome = leadData?.nome || 'Lead'
    const headline = leadData?.headline || leadData?.empresa || ''
    const avatarUrl = leadData?.avatar_url

    return (
        <div
            className="bg-white rounded-xl border border-gray-200 p-3 cursor-pointer hover:bg-gray-50 hover:border-gray-300 hover:shadow-md transition-all group"
            onClick={() => onClick(lead)}
        >
            {/* Top Row: Avatar + Name + Score */}
            <div className="flex items-start gap-3">
                {/* Avatar */}
                <div className="w-10 h-10 rounded-full bg-gradient-to-br from-gray-200 to-gray-300 flex items-center justify-center overflow-hidden shrink-0 border border-gray-200">
                    {avatarUrl ? (
                        <img src={avatarUrl} alt={nome} className="w-full h-full object-cover" />
                    ) : (
                        <span className="text-sm font-bold text-gray-500">{nome?.charAt(0) || '?'}</span>
                    )}
                </div>

                {/* Name + Headline */}
                <div className="flex-1 min-w-0">
                    <h4 className="font-semibold text-gray-800 text-sm truncate">{nome}</h4>
                    <p className="text-xs text-gray-500 truncate">{headline || '‚Äî'}</p>
                </div>

                {/* Cadence Stage Badge */}
                {cadenceStage && (
                    <div className={`${getCadenceStyle(cadenceStage)} text-[10px] font-bold px-2 py-0.5 rounded-lg shrink-0`}>
                        {cadenceStage}
                    </div>
                )}
            </div>

            {/* Bottom Row: Meta Info */}
            <div className="flex items-center justify-between mt-3 pt-2 border-t border-gray-100">
                {/* ICP Badge */}
                <span className={`text-[10px] font-bold px-2 py-0.5 rounded border ${getIcpStyle(icpTier)}`}>
                    ICP {icpTier}
                </span>

                {/* Interaction Count */}
                <div className="flex items-center gap-1 text-gray-500 text-xs">
                    <MessageCircle size={12} />
                    <span>{totalInteractions}</span>
                </div>

                {/* Time Since */}
                <div className="flex items-center gap-1 text-gray-500 text-xs">
                    <Clock size={12} />
                    <span>{getTimeSince(lastInteractionDate)}</span>
                </div>

                {/* AI Ready Indicator */}
                {hasAiSuggestions && (
                    <div className="text-amber-500" title="Sugest√µes de IA prontas">
                        <Zap size={14} />
                    </div>
                )}
            </div>
        </div>
    )
}

export default KanbanLeadCard

```

## File: src\contexts\AuthContext.jsx
```javascript

import React, { createContext, useContext, useState, useEffect } from 'react';
import { supabase } from '../services/supabaseClient';

const AuthContext = createContext({});

export const useAuth = () => useContext(AuthContext);

export const AuthProvider = ({ children }) => {
    const [user, setUser] = useState(null);
    const [profile, setProfile] = useState(null);
    const [loading, setLoading] = useState(true);

    useEffect(() => {
        let mounted = true;

        // 1. Initial Session Check (Critical for F5/Refresh)
        const checkSession = async () => {
            try {
                const { data: { session } } = await supabase.auth.getSession();
                if (mounted && session?.user) {
                    setUser(session.user);
                    setLoading(false); // RELEASE LOADING IMMEDIATELY
                    fetchProfile(session.user.id, session.user.email); // Background fetch
                } else if (mounted) {
                    setLoading(false); // No session, stop loading
                }
            } catch (err) {
                console.error('Session check failed:', err);
                if (mounted) setLoading(false);
            }
        };

        checkSession();

        // 2. Auth State Listener
        const { data: { subscription } } = supabase.auth.onAuthStateChange(async (event, session) => {
            if (!mounted) return;
            console.log('Auth State Change:', event);

            if (session?.user) {
                // If user changes or login happens, update state
                if (session.user.id !== user?.id) {
                    setUser(session.user);
                    setLoading(false); // RELEASE LOADING IMMEDIATELY
                    fetchProfile(session.user.id, session.user.email); // Background fetch
                }
            } else if (event === 'SIGNED_OUT') {
                setUser(null);
                setProfile(null);
                setLoading(false);
            }
        });

        // 3. Safety Timeout
        const safetyTimeout = setTimeout(() => {
            if (mounted && loading) {
                console.warn('Auth check timed out. Forcing stop loading.');
                setLoading(false);
            }
        }, 5000);

        return () => {
            mounted = false;
            clearTimeout(safetyTimeout);
            subscription.unsubscribe();
        };
    }, []); // Empty dependency array ok, relying on internal logic

    const fetchProfile = async (userId, userEmail) => {
        try {
            const { data, error } = await supabase
                .from('profiles')
                .select('*')
                .eq('id', userId)
                .single();

            if (error) {
                // Self-healing attempt for missing profile
                if (error.code === 'PGRST116' && userEmail) {
                    console.log('Profile missing (PGRST116). Attempting to create default profile...');
                    const defaultProfile = {
                        id: userId,
                        email: userEmail,
                        role: 'admin',
                        nome_empresa: 'Minha Ag√™ncia'
                    };

                    const { error: insertError } = await supabase
                        .from('profiles')
                        .insert([defaultProfile]);

                    if (!insertError) {
                        setProfile(defaultProfile);
                        setLoading(false); // Success path
                        return;
                    }
                    console.error('Failed to create fallback profile:', insertError);
                }

                // 3. TRATAMENTO DE ERRO NO PERFIL (Strict Error Handling)
                // If we are here, we failed to get OR create a profile.
                console.error('Critical Profile Error provided. Signing out to prevent broken state.');
                await handleCriticalAuthError();
            } else {
                setProfile(data);
                setLoading(false); // Success path
            }
        } catch (error) {
            console.error('Profile fetch exception:', error);
            await handleCriticalAuthError();
        }
    };

    const handleCriticalAuthError = async () => {
        // Force sign out and clear state
        await supabase.auth.signOut();
        setProfile(null);
        setUser(null);
        setLoading(false); // GUARANTEED: Loading must stop
    };

    const signIn = async (email, password) => {
        const { data, error } = await supabase.auth.signInWithPassword({
            email,
            password,
        });
        if (error) throw error;
        return data;
    };

    const signOut = async () => {
        try {
            await supabase.auth.signOut();
        } catch (error) {
            console.error('Error signing out:', error);
        } finally {
            // Force clear state to ensure UI updates immediately
            setUser(null);
            setProfile(null);
            setLoading(false);
        }
    };

    return (
        <AuthContext.Provider value={{ user, profile, loading, signIn, signOut }}>
            {!loading ? children : (
                <div style={{
                    display: 'flex',
                    justifyContent: 'center',
                    alignItems: 'center',
                    height: '100vh',
                    flexDirection: 'column',
                    gap: '1rem',
                    background: '#f8fafc'
                }}>
                    <div style={{
                        width: '40px',
                        height: '40px',
                        border: '3px solid #e2e8f0',
                        borderTopColor: '#2563eb',
                        borderRadius: '50%',
                        animation: 'spin 1s linear infinite'
                    }}></div>
                    <span style={{ color: '#64748b', fontSize: '0.875rem' }}>Carregando Link&Lead...</span>
                </div>
            )}
            <style>{`@keyframes spin { to { transform: rotate(360deg); } }`}</style>
        </AuthContext.Provider>
    );
};

```

## File: src\contexts\ClientAuthContext.jsx
```javascript
import React, { createContext, useContext, useState, useEffect } from 'react'
import { supabase } from '../services/supabaseClient'

const ClientAuthContext = createContext({})

export const useClientAuth = () => useContext(ClientAuthContext)

export const ClientAuthProvider = ({ children }) => {
    const [clientUser, setClientUser] = useState(null)
    const [clientId, setClientId] = useState(null) // UUID
    const [clientLegacyId, setClientLegacyId] = useState(null) // Integer ID (Legacy)
    const [clientName, setClientName] = useState('')
    const [isTokenAuth, setIsTokenAuth] = useState(false)
    const [loading, setLoading] = useState(true)

    useEffect(() => {
        let mounted = true

        const fetchClientData = async (user) => {
            try {
                // 1. LOGIN (UUID) -> PERFIL
                const { data: profile, error } = await supabase
                    .from('profiles')
                    .select('id, client_id, role, nome_empresa') // Added nome_empresa and id
                    .eq('id', user.id)
                    .single()

                if (error) throw error

                if (profile.role !== 'client') {
                    console.warn('User found but role is not client:', profile.role)
                    setClientUser(null)
                    setClientId(null)
                    setClientLegacyId(null)
                    setClientName('')
                } else {
                    console.log(`Client Auth Success: User ${user.id} (UUID)`)
                    setClientUser(user)
                    setClientId(profile.id) // UUID PRIMARY
                    setClientLegacyId(profile.client_id) // Integer Legacy
                    setClientName(profile.nome_empresa || '')
                }
            } catch (err) {
                console.error('Error fetching client profile:', err)
                setClientUser(null)
                setClientId(null)
                setClientLegacyId(null)
                setClientName('')
            } finally {
                if (mounted) setLoading(false)
            }
        }

        const { data: { subscription } } = supabase.auth.onAuthStateChange((event, session) => {
            if (isTokenAuth) return // Don't override if manually logged in via token

            if (session?.user) {
                fetchClientData(session.user)
            } else {
                setClientUser(null)
                setClientId(null)
                setClientLegacyId(null)
                setClientName('')
                setLoading(false)
            }
        })

        return () => {
            mounted = false
            subscription.unsubscribe()
        }
    }, [isTokenAuth]) // Re-run if token auth state changes (though mainly to re-bind listener logic)

    const loginWithToken = async (token) => {
        setLoading(true)
        try {
            // Check 'clients' table for access_token
            const { data: client, error } = await supabase
                .from('clients')
                .select('*')
                .eq('access_token', token)
                .single()

            if (error || !client) {
                throw new Error('Token inv√°lido ou expirado.')
            }

            // Set global state "as if" logged in
            // Mocking a clientUser object to satisfy existence checks
            setClientUser({ id: 'token_user', email: 'token_access', role: 'client' })

            // Use client.id directly. 
            // Note: If 'tabela_projetofred1' uses UUID from profiles, this might miss-match unless client.id IS the UUID.
            // Assuming client.id is the correct identifier for posts in this context.
            setClientId(client.id)
            setClientLegacyId(client.id) // Assuming same ID or fallback
            // FIX: User confirmed 'clients' table uses 'name' column.
            setClientName(client.name || client.nome_empresa)
            setIsTokenAuth(true)

            return true
        } catch (err) {
            console.error(err)
            return false
        } finally {
            setLoading(false)
        }
    }

    const signOut = async () => {
        if (isTokenAuth) {
            setIsTokenAuth(false)
            setClientUser(null)
            setClientId(null)
            setClientLegacyId(null)
            setClientName('')
        } else {
            await supabase.auth.signOut()
            setClientUser(null)
            setClientId(null)
            setClientLegacyId(null)
            setClientName('')
        }
    }

    return (
        <ClientAuthContext.Provider value={{ clientUser, clientId, clientLegacyId, clientName, loading, signOut, isTokenAuth, loginWithToken }}>
            {children}
        </ClientAuthContext.Provider>
    )
}

```

## File: src\contexts\ClientSelectionContext.jsx
```javascript
import React, { createContext, useContext, useState, useEffect } from 'react'

const ClientSelectionContext = createContext()

export const useClientSelection = () => {
    return useContext(ClientSelectionContext)
}

export const ClientSelectionProvider = ({ children }) => {
    const [selectedClientId, setSelectedClientId] = useState(() => {
        // Persist selection
        const saved = localStorage.getItem('selectedClientId')
        return saved ? JSON.parse(saved) : null
    })

    const setClient = (clientId) => {
        setSelectedClientId(clientId)
        if (clientId) {
            localStorage.setItem('selectedClientId', JSON.stringify(clientId))
        } else {
            localStorage.removeItem('selectedClientId')
        }
    }

    const value = {
        selectedClientId,
        setSelectedClientId: setClient
    }

    return (
        <ClientSelectionContext.Provider value={value}>
            {children}
        </ClientSelectionContext.Provider>
    )
}

```

## File: src\contexts\LanguageContext.jsx
```javascript
import React, { createContext, useState, useContext } from 'react'

const LanguageContext = createContext()

const translations = {
    pt: {
        dashboard: "Vis√£o Geral",
        posts: "Meus Posts",
        clients: "Gerenciar Clientes",
        newPost: "Novo Conte√∫do",
        logout: "Sair",
        agencyProgress: "Progresso da Ag√™ncia",
        pipelineOverview: "Vis√£o geral do pipeline por cliente",
        drafts: "Ideias (Draft)",
        waiting: "Aguardando Aprova√ß√£o",
        review: "Em Revis√£o",
        approved: "Aprovados / Prontos",
        actions: "A√ß√µes",
        client: "Cliente",
        openPosts: "Abrir Posts",
        copyLink: "Copiar Link",
        loading: "Carregando...",
        noClients: "Nenhum cliente cadastrado no pipeline.",
        ideas: "Banco de Ideias",
        newQuestion: "Nova Pergunta",
        pendingQuestions: "Perguntas Pendentes",
        answeredQuestions: "Respondidas / Insights",
        save: "Salvar",
        cancel: "Cancelar",
        delete: "Excluir",
        answer: "Responder",
        questionPlaceholder: "Digite a pergunta estrat√©gica para o cliente...",
        answerPlaceholder: "Digite a resposta do cliente..."
    },
    de: {
        dashboard: "√úbersicht",
        posts: "Meine Beitr√§ge",
        clients: "Kunden verwalten",
        newPost: "Neuer Inhalt",
        logout: "Abmelden",
        agencyProgress: "Agenturfortschritt",
        pipelineOverview: "Pipeline-√úbersicht pro Kunde",
        drafts: "Ideen (Entwurf)",
        waiting: "Wartet auf Genehmigung",
        review: "In √úberarbeitung",
        approved: "Genehmigt / Fertig",
        actions: "Aktionen",
        client: "Kunde",
        openPosts: "Beitr√§ge √∂ffnen",
        copyLink: "Link kopieren",
        loading: "Laden...",
        noClients: "Keine Kunden in der Pipeline registriert.",
        ideas: "Ideenbank",
        newQuestion: "Neue Frage",
        pendingQuestions: "Offene Fragen",
        answeredQuestions: "Beantwortet / Insights",
        save: "Speichern",
        cancel: "Abbrechen",
        delete: "L√∂schen",
        answer: "Antworten",
        questionPlaceholder: "Geben Sie die strategische Frage f√ºr den Kunden ein...",
        answerPlaceholder: "Geben Sie die Antwort des Kunden ein..."
    }
}

export const LanguageProvider = ({ children }) => {
    const [language, setLanguage] = useState('pt')

    const t = (key) => {
        return translations[language][key] || key
    }

    return (
        <LanguageContext.Provider value={{ language, setLanguage, t }}>
            {children}
        </LanguageContext.Provider>
    )
}

export const useLanguage = () => useContext(LanguageContext)

```

## File: src\lib\utils.js
```javascript
import { clsx } from "clsx"
import { twMerge } from "tailwind-merge"

export function cn(...inputs) {
    return twMerge(clsx(inputs))
}

```

## File: src\pages\AdminPanel.css
```css
/* 
  DEPRECATED: Styles have been moved to Tailwind classes in AdminPanel.jsx and index.css
  as part of the Obsidian Glass visual overhaul.
*/
```

## File: src\pages\AdminPanel.jsx
```javascript
import React, { useState, useEffect } from 'react'
import { supabase } from '../services/supabaseClient'
import { useAuth } from '../contexts/AuthContext'
import { Link } from 'react-router-dom'
import {
    Loader2,
    Briefcase,
    ExternalLink,
    Link as LinkIcon,
    Users,
    ArrowUpRight
} from 'lucide-react'
import SalesCockpit from '../components/SalesCockpit'

const AdminPanel = () => {
    const { profile, loading: authLoading } = useAuth()
    const [clients, setClients] = useState([])
    const [posts, setPosts] = useState([])
    const [loading, setLoading] = useState(true)
    const [unreadCounts, setUnreadCounts] = useState({})

    useEffect(() => {
        if (authLoading) return

        if (profile) {
            fetchDashboardData()
        } else {
            setLoading(false)
        }
    }, [authLoading, profile])

    const fetchDashboardData = async () => {
        try {
            setLoading(true)

            // 1. Fetch Clients
            const { data: clientsData, error: clientsError } = await supabase
                .from('clients')
                .select('*')
                .order('name')

            if (clientsError) throw clientsError

            // 2. Fetch All Posts
            let postsQuery = supabase
                .from('tabela_projetofred1')
                .select('id, nome_cliente, status')

            if (profile.role === 'client') {
                if (profile.nome_empresa) {
                    postsQuery = postsQuery.eq('nome_cliente', profile.nome_empresa)
                }
            }

            const { data: postsData, error: postsError } = await postsQuery
            if (postsError) throw postsError

            // NEW: Fetch Unread Comments for Badge
            const { data: unreadData, error: unreadError } = await supabase
                .from('post_comments')
                .select('post_id')
                .eq('role', 'client')
                .eq('read_by_admin', false)

            if (unreadError) throw unreadError

            // Map unread comments to clients
            const counts = {}
            if (unreadData && postsData) {
                unreadData.forEach(comment => {
                    // Find which client owns this post
                    const post = postsData.find(p => p.id === comment.post_id)
                    if (post && post.nome_cliente) {
                        counts[post.nome_cliente] = (counts[post.nome_cliente] || 0) + 1
                    }
                })
            }
            setUnreadCounts(counts)
            setClients(clientsData || [])
            setPosts(postsData || [])

        } catch (err) {
            console.error('Erro ao carregar dashboard:', err)
        } finally {
            setLoading(false)
        }
    }

    // Process Stats Per Client
    const getClientStats = (clientName) => {
        const clientPosts = posts.filter(p => p.nome_cliente === clientName)
        const normalize = (status) => status ? status.toLowerCase() : ''

        const drafts = clientPosts.filter(p => {
            const s = normalize(p.status)
            return !s || ['rascunho', 'ideia', 'draft', 'idea'].includes(s)
        }).length

        const waiting = clientPosts.filter(p => {
            const s = normalize(p.status)
            return ['aguardando aprova√ß√£o', 'pending', 'waiting_approval'].includes(s)
        }).length

        const review = clientPosts.filter(p => {
            const s = normalize(p.status)
            return ['revis√£o', 'review', 'changes_requested', 'revision'].includes(s)
        }).length

        const approved = clientPosts.filter(p => {
            const s = normalize(p.status)
            return ['aprovado', 'postado', 'approved', 'ready', 'published'].includes(s)
        }).length

        return { drafts, waiting, review, approved }
    }

    const renderCount = (count, type) => {
        if (count === 0) return <span className="text-gray-600 font-light">-</span>

        let colorClass = 'text-white'
        switch (type) {
            case 'draft': colorClass = 'text-gray-300'; break;
            case 'waiting': colorClass = 'text-amber-400 font-bold'; break;
            case 'review': colorClass = 'text-red-400 font-bold'; break;
            case 'approved': colorClass = 'text-emerald-400 font-bold'; break;
        }

        return <span className={`text-lg ${colorClass}`}>{count}</span>
    }

    const copyLink = (clientName) => {
        const url = `${window.location.origin}/login`
        navigator.clipboard.writeText(url)
        alert('Link do Portal copiado!')
    }

    return (
        <div className="min-h-screen bg-obsidian text-white p-8 relative overflow-hidden">
            {/* BACKGROUND ACCENTS */}
            <div className="fixed top-20 right-20 w-96 h-96 bg-primary/10 blur-[100px] rounded-full pointer-events-none z-0" />

            {/* FLOATING HUD HEADER */}
            <header className="relative z-10 flex flex-col md:flex-row justify-between items-start md:items-center mb-10 gap-4">
                <div>
                    <h1 className="text-3xl font-bold tracking-tight text-white mb-1">Progresso da Ag√™ncia</h1>
                    <p className="text-gray-400">Vis√£o geral do pipeline por cliente</p>
                </div>
                <div className="flex items-center gap-4">
                    <Link to="/clients" className="glass-panel px-4 py-2 rounded-full text-sm font-medium text-gray-300 hover:text-white hover:border-primary/50 transition-all flex items-center gap-2">
                        <Users size={16} />
                        Gerenciar Clientes
                    </Link>
                    <div className="px-4 py-2 rounded-full border border-glass-border bg-white/5 text-sm font-medium text-gray-400">
                        Admin Ag√™ncia
                    </div>
                </div>
            </header>

            {/* SALES COCKPIT - Primary Element */}
            <div className="relative z-10 mb-8">
                <SalesCockpit />
            </div>

            {/* GLASS TABLE CONTAINER */}
            <div className="relative z-10 glass-panel rounded-2xl overflow-hidden border-glass-border/30 shadow-2xl animate-fade-in-up">
                {loading ? (
                    <div className="p-12 text-center text-gray-400 flex flex-col items-center gap-4">
                        <Loader2 className="w-8 h-8 animate-spin text-primary" />
                        <span className="tracking-wide uppercase text-xs font-bold">Carregando pipeline...</span>
                    </div>
                ) : (
                    <div className="overflow-x-auto">
                        <table className="w-full text-left border-collapse">
                            <thead>
                                <tr className="border-b border-glass-border">
                                    <th className="p-5 text-gray-500 font-medium text-xs uppercase tracking-wider pl-8">Cliente</th>
                                    <th className="p-5 text-center text-gray-500 font-medium text-xs uppercase tracking-wider">Ideias</th>
                                    <th className="p-5 text-center text-amber-500/80 font-medium text-xs uppercase tracking-wider">Aguardando</th>
                                    <th className="p-5 text-center text-red-500/80 font-medium text-xs uppercase tracking-wider">Revis√£o</th>
                                    <th className="p-5 text-center text-emerald-500/80 font-medium text-xs uppercase tracking-wider">Aprovados</th>
                                    <th className="p-5 text-right text-gray-500 font-medium text-xs uppercase tracking-wider pr-8">A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody className="divide-y divide-glass-border/50">
                                {clients.length > 0 ? (
                                    clients.map(client => {
                                        const stats = getClientStats(client.name)
                                        const initial = client.name.charAt(0).toUpperCase()

                                        return (
                                            <tr key={client.id} className="group hover:bg-white/5 transition-colors duration-200">
                                                <td className="p-5 pl-8">
                                                    <div className="flex items-center gap-4">
                                                        <div className="w-10 h-10 rounded-full bg-gradient-to-br from-gray-800 to-black border border-glass-border flex items-center justify-center text-sm font-bold text-gray-300 shadow-inner group-hover:border-primary/50 transition-colors">
                                                            {initial}
                                                        </div>
                                                        <div className="flex flex-col">
                                                            <span className="font-semibold text-gray-200 group-hover:text-white transition-colors">{client.name}</span>
                                                            {unreadCounts[client.name] > 0 && (
                                                                <span className="text-xs text-red-400 animate-pulse font-bold flex items-center gap-1 mt-1">
                                                                    <span className="w-1.5 h-1.5 rounded-full bg-red-500" />
                                                                    {unreadCounts[client.name]} nova(s) msg
                                                                </span>
                                                            )}
                                                        </div>
                                                    </div>
                                                </td>

                                                <td className="p-5 text-center">
                                                    {renderCount(stats.drafts, 'draft')}
                                                </td>

                                                <td className="p-5 text-center">
                                                    {renderCount(stats.waiting, 'waiting')}
                                                </td>

                                                <td className="p-5 text-center">
                                                    {stats.review > 0 ? (
                                                        <span className="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-500/10 text-red-400 border border-red-500/20">
                                                            {stats.review}
                                                        </span>
                                                    ) : (
                                                        <span className="text-gray-600">-</span>
                                                    )}
                                                </td>

                                                <td className="p-5 text-center relative overflow-hidden">
                                                    {renderCount(stats.approved, 'approved')}
                                                    {stats.approved > 0 && <div className="absolute inset-x-0 bottom-0 h-0.5 bg-emerald-500/20 group-hover:bg-emerald-500/50 transition-colors" />}
                                                </td>

                                                <td className="p-5 pr-8 text-right">
                                                    <div className="flex items-center justify-end gap-2 opacity-60 group-hover:opacity-100 transition-opacity">
                                                        <Link
                                                            to={`/posts?client=${encodeURIComponent(client.name)}`}
                                                            className="p-2 rounded-lg hover:bg-white/10 text-gray-400 hover:text-white transition-colors"
                                                            title="Abrir Posts"
                                                        >
                                                            <ArrowUpRight size={18} />
                                                        </Link>
                                                        <button
                                                            className="p-2 rounded-lg hover:bg-white/10 text-gray-400 hover:text-primary transition-colors"
                                                            title="Copiar Link do Portal"
                                                            onClick={() => copyLink(client.name)}
                                                        >
                                                            <LinkIcon size={18} />
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                        )
                                    })
                                ) : (
                                    <tr>
                                        <td colSpan="6" className="p-12 text-center text-gray-500">
                                            Nenhum cliente cadastrado no pipeline.
                                        </td>
                                    </tr>
                                )}
                            </tbody>
                        </table>
                    </div>
                )}
            </div>
        </div>
    )
}

export default AdminPanel

```

## File: src\pages\CampaignLeadsPage.jsx
```javascript
import React, { useState, useEffect } from 'react'
import { useParams, useNavigate } from 'react-router-dom'
import { supabase } from '../services/supabaseClient'
import { useClientSelection } from '../contexts/ClientSelectionContext'
import {
    ArrowLeft,
    Search,
    Loader2,
    Building,
    MapPin,
    CheckSquare,
    Square,
    Bot,
    MoreHorizontal,
    Zap,
    RefreshCw,
    X,
    ExternalLink,
    Save,
    Gem
} from 'lucide-react'

const CampaignLeadsPage = () => {
    const { campaignId } = useParams() // Note: Route defined as :campaignId
    const navigate = useNavigate()
    const { selectedClientId } = useClientSelection()

    const [campaign, setCampaign] = useState(null)
    const [leads, setLeads] = useState([])
    const [loading, setLoading] = useState(false)
    const [searchTerm, setSearchTerm] = useState('')

    // Selection State
    const [selectedLeads, setSelectedLeads] = useState([]) // Array of IDs

    // Bulk Action State
    const [isProcessingBulk, setIsProcessingBulk] = useState(false)
    const [bulkProgressText, setBulkProgressText] = useState('')
    const [notification, setNotification] = useState(null)

    // Drawer / Curation State
    const [selectedLead, setSelectedLead] = useState(null)
    const [icebreakerText, setIcebreakerText] = useState('')
    const [isSaving, setIsSaving] = useState(false)

    useEffect(() => {
        if (selectedClientId && campaignId) {
            fetchCampaign()
            fetchLeads()
        }
    }, [selectedClientId, campaignId])

    const fetchCampaign = async () => {
        try {
            const { data, error } = await supabase
                .from('campaigns')
                .select('*')
                .eq('id', campaignId)
                .single()

            if (error) throw error
            setCampaign(data)
        } catch (error) {
            console.error('Error fetching campaign:', error)
        }
    }

    const fetchLeads = async () => {
        setLoading(true)
        try {
            // Join campaign_leads with leads table
            const { data, error } = await supabase
                .from('campaign_leads')
                .select(`
                    *,
                    leads:lead_id (*)
                `)
                .eq('campaign_id', campaignId)
                .order('created_at', { ascending: false })

            if (error) throw error
            setLeads(data || [])
        } catch (error) {
            console.error('Error fetching leads:', error)
        } finally {
            setLoading(false)
        }
    }

    // Selection Logic
    const toggleSelectAll = () => {
        if (selectedLeads.length === leads.length) {
            setSelectedLeads([])
        } else {
            setSelectedLeads(leads.map(l => l.id))
        }
    }

    const toggleSelectOne = (id) => {
        if (selectedLeads.includes(id)) {
            setSelectedLeads(selectedLeads.filter(l => l !== id))
        } else {
            setSelectedLeads([...selectedLeads, id])
        }
    }

    const handleBulkIcebreaker = async () => {
        if (!selectedLeads.length || !selectedClientId) return

        // 1. Calculate Estimated Time (3.5s per lead)
        const totalSeconds = selectedLeads.length * 3.5
        let timeString = `${Math.ceil(totalSeconds)} segundos`
        if (totalSeconds > 60) {
            timeString = `${Math.ceil(totalSeconds / 60)} minutos`
        }

        // 2. Set State
        setIsProcessingBulk(true)
        setBulkProgressText(`Gerando ${selectedLeads.length} mensagens. Tempo estimado: ${timeString}...`)

        try {
            // 3. Call Webhook
            const response = await fetch('https://n8n-n8n-start.kfocge.easypanel.host/webhook/generate-bulk-icebreakers', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    lead_ids: selectedLeads,
                    client_id: selectedClientId
                })
            })

            if (response.ok) {
                // 4. Success
                setNotification({
                    message: `${selectedLeads.length} Icebreakers gerados com sucesso!`,
                    type: 'success'
                })
                setSelectedLeads([]) // Clear selection
                fetchLeads() // Refresh data
            } else {
                throw new Error('Falha na API')
            }

        } catch (error) {
            console.error('Error generating icebreakers:', error)
            setNotification({
                message: 'Erro ao gerar Icebreakers. Tente novamente.',
                type: 'error'
            })
        } finally {
            setIsProcessingBulk(false)
            setBulkProgressText('')
            setTimeout(() => setNotification(null), 5000)
        }
    }

    const filteredLeads = leads.filter(item => {
        const lead = item.leads || {}
        const name = lead.nome || ''
        return name.toLowerCase().includes(searchTerm.toLowerCase())
    })

    // Filtered selection logic support
    // (If searching, 'Select All' could ideally only select visible, but simple global for now is fine or constrained to filtered)
    // Let's stick to simple ID matching for now.

    const getICPBadge = (reason) => {
        // Simple visual logic based on existence of ICP reason or score field if it existed
        // User asked for A, B, C. We don't have that field explicitly yet in the previous schemas viewed,
        // but let's mock the UI for it or use a heuristic.
        // For now, I'll render a generic 'A' badge if qualified, or 'C' if not.
        // Actually, let's use a random mock or derived prop for the visual request.
        return (
            <span className="inline-flex items-center justify-center w-6 h-6 rounded-full bg-green-100 text-green-700 font-bold text-xs border border-green-200">
                A
            </span>
        )
    }

    const getStatusBadge = (status) => {
        switch (status) {
            case 'PENDING_ENRICHMENT':
                return <span className="px-2 py-1 bg-yellow-50 text-yellow-700 rounded-md text-xs font-bold border border-yellow-200">Na Fila</span>
            case 'QUALIFIED_NO_ICEBREAKER':
                return <span className="px-2 py-1 bg-blue-50 text-blue-700 rounded-md text-xs font-bold border border-blue-200">Importado</span>
            case 'APPROACH_READY':
                return <span className="px-2 py-1 bg-green-50 text-green-700 rounded-md text-xs font-bold border border-green-200">Pronto</span>
            default:
                return <span className="px-2 py-1 bg-gray-50 text-gray-600 rounded-md text-xs font-bold border border-gray-200">{status || 'Desconhecido'}</span>
        }
    }

    // Agency Lock
    if (!selectedClientId) {
        return (
            <div className="min-h-screen bg-slate-50 flex items-center justify-center p-6">
                <div className="text-center max-w-md">
                    <div className="bg-white p-6 rounded-full inline-flex mb-6 shadow-sm border border-slate-100">
                        <Building size={48} className="text-slate-300" />
                    </div>
                    <h2 className="text-2xl font-bold text-slate-800 mb-3">Selecione um Cliente</h2>
                    <p className="text-slate-500">
                        Voc√™ precisa selecionar um cliente para visualizar os leads desta campanha.
                    </p>
                </div>
            </div>
        )
    }

    return (
        <div className="min-h-screen bg-slate-50 p-6 md:p-8 font-sans text-slate-800">

            {/* NOTIFICATION TOAST */}
            {notification && (
                <div className={`fixed top-6 right-6 z-50 px-4 py-3 rounded-lg shadow-lg border flex items-center gap-3 animate-slide-in-right ${notification.type === 'error' ? 'bg-red-50 border-red-200 text-red-600' : 'bg-white border-gray-200 text-slate-700'
                    }`}>
                    {notification.type === 'error' ? <Zap size={18} /> : <RefreshCw size={18} className="text-green-500" />}
                    <span className="text-sm font-medium">{notification.message}</span>
                </div>
            )}
            {/* Header */}
            <div className="max-w-7xl mx-auto mb-8">
                <button
                    onClick={() => navigate('/lists')}
                    className="flex items-center gap-2 text-slate-500 hover:text-indigo-600 transition-colors mb-6 text-sm font-bold"
                >
                    <ArrowLeft size={16} /> Voltar para Listas
                </button>

                <div className="flex flex-col md:flex-row justify-between items-end gap-4">
                    <div>
                        <h1 className="text-3xl font-bold text-slate-900 tracking-tight mb-2">
                            {campaign ? campaign.name : 'Carregando...'}
                        </h1>
                        <p className="text-slate-500 font-medium">
                            Gerencie e qualifique os leads da sua campanha.
                        </p>
                    </div>
                    <div className="flex items-center gap-3">
                        {/* Global Actions could go here */}
                    </div>
                </div>
            </div>

            {/* Toolbar & Bulk Actions */}
            <div className="max-w-7xl mx-auto bg-white p-4 rounded-xl border border-slate-200 shadow-sm mb-6 sticky top-4 z-10 transition-all">
                <div className="flex flex-col md:flex-row justify-between items-center gap-4">

                    {selectedLeads.length > 0 ? (
                        <div className="flex items-center gap-4 w-full md:w-auto animate-fade-in">
                            <div className="px-4 py-2 bg-indigo-50 text-indigo-700 rounded-lg font-bold text-sm border border-indigo-100">
                                {selectedLeads.length} leads selecionados
                            </div>
                            <div className="h-8 w-px bg-slate-200 hidden md:block"></div>
                            <button
                                onClick={handleBulkIcebreaker}
                                disabled={isProcessingBulk}
                                className={`flex items-center gap-2 px-4 py-2 rounded-lg font-bold transition-all shadow-md ${isProcessingBulk
                                    ? 'bg-indigo-400 text-white cursor-not-allowed'
                                    : 'bg-indigo-600 text-white hover:bg-indigo-700 shadow-indigo-200'
                                    }`}
                            >
                                {isProcessingBulk ? <Loader2 size={18} className="animate-spin" /> : <Bot size={18} />}
                                {isProcessingBulk ? bulkProgressText : 'Gerar Icebreakers'}
                            </button>
                        </div>
                    ) : (
                        <div className="flex items-center gap-2 text-slate-400 text-sm font-medium">
                            <CheckSquare size={18} /> Selecione leads para a√ß√µes em massa
                        </div>
                    )}

                    <div className="relative w-full md:w-80">
                        <Search className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400" size={18} />
                        <input
                            type="text"
                            placeholder="Buscar por nome ou cargo..."
                            value={searchTerm}
                            onChange={e => setSearchTerm(e.target.value)}
                            className="w-full pl-10 pr-4 py-2 bg-slate-50 border border-slate-200 rounded-lg text-slate-800 focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 transition-all font-medium"
                        />
                    </div>
                </div>
            </div>

            {/* Table */}
            <div className="max-w-7xl mx-auto bg-white border border-slate-200 rounded-xl shadow-sm overflow-hidden">
                <table className="w-full text-left border-collapse">
                    <thead>
                        <tr className="bg-slate-50 border-b border-slate-200 text-xs font-bold text-slate-500 uppercase tracking-wider">
                            <th className="p-4 w-12 text-center">
                                <button
                                    onClick={toggleSelectAll}
                                    className="text-slate-400 hover:text-indigo-600 transition-colors"
                                >
                                    {selectedLeads.length === leads.length && leads.length > 0 ? (
                                        <CheckSquare size={20} className="text-indigo-600" />
                                    ) : (
                                        <Square size={20} />
                                    )}
                                </button>
                            </th>
                            <th className="py-4 px-4">Lead</th>
                            <th className="py-4 px-4">Cargo / Headline</th>
                            <th className="py-4 px-4">Empresa</th>
                            <th className="py-4 px-4">Localiza√ß√£o</th>
                            <th className="py-4 px-4 text-center">ICP</th>
                            <th className="py-4 px-4 text-center">Status</th>
                            <th className="py-4 px-4 text-right"></th>
                        </tr>
                    </thead>
                    <tbody className="divide-y divide-gray-100">
                        {loading ? (
                            <tr>
                                <td colSpan="8" className="py-20 text-center text-gray-400">
                                    <Loader2 className="animate-spin mx-auto mb-2" size={32} />
                                    Carregando leads...
                                </td>
                            </tr>
                        ) : filteredLeads.length === 0 ? (
                            <tr>
                                <td colSpan="8" className="py-20 text-center text-gray-400">
                                    Nenhum lead encontrado.
                                </td>
                            </tr>
                        ) : (
                            filteredLeads.map(item => {
                                const lead = item.leads || {}
                                const isSelected = selectedLeads.includes(item.id)

                                return (
                                    <tr
                                        key={item.id}
                                        onClick={() => openDrawer(item)}
                                        className={`hover:bg-slate-50 transition-colors cursor-pointer group ${isSelected ? 'bg-indigo-50/30' : ''}`}
                                    >
                                        <td className="p-4 text-center" onClick={(e) => e.stopPropagation()}>
                                            <button
                                                onClick={() => toggleSelectOne(item.id)}
                                                className="text-slate-300 hover:text-indigo-600 transition-colors"
                                            >
                                                {isSelected ? (
                                                    <CheckSquare size={20} className="text-indigo-600" />
                                                ) : (
                                                    <Square size={20} />
                                                )}
                                            </button>
                                        </td>
                                        <td className="p-4">
                                            <div className="flex items-center gap-3">
                                                <div className="w-9 h-9 rounded-full bg-slate-200 border border-white shadow-sm flex items-center justify-center text-xs font-bold text-slate-500 overflow-hidden shrink-0">
                                                    {lead.avatar_url ? (
                                                        <img src={lead.avatar_url} alt="" className="w-full h-full object-cover" />
                                                    ) : (
                                                        lead.nome?.charAt(0).toUpperCase() || '?'
                                                    )}
                                                </div>
                                                <div className="font-bold text-slate-800 text-sm truncate max-w-[150px]" title={lead.nome}>
                                                    {lead.nome || 'Sem Nome'}
                                                </div>
                                            </div>
                                        </td>
                                        <td className="p-4">
                                            <div className="text-xs text-slate-500 font-medium truncate max-w-[200px]" title={lead.headline}>
                                                {lead.headline || '-'}
                                            </div>
                                        </td>
                                        <td className="p-4">
                                            <div className="flex items-center gap-1.5 text-xs font-semibold text-slate-700">
                                                <Building size={12} className="text-slate-400" />
                                                <span className="truncate max-w-[140px]">{lead.company_name || '-'}</span>
                                            </div>
                                        </td>
                                        <td className="p-4">
                                            <div className="flex items-center gap-1.5 text-xs text-slate-500">
                                                <MapPin size={12} className="text-slate-400" />
                                                <span className="truncate max-w-[120px]">{lead.location || '-'}</span>
                                            </div>
                                        </td>
                                        <td className="p-4 text-center">
                                            {getICPBadge(lead.icp_reason)}
                                        </td>
                                        <td className="p-4 text-center">
                                            {getStatusBadge(item.status_pipeline)}
                                        </td>
                                        <td className="p-4 text-right">
                                            <button className="p-1.5 rounded-md hover:bg-gray-100 text-gray-400 hover:text-slate-600">
                                                <MoreHorizontal size={18} />
                                            </button>
                                        </td>
                                    </tr>
                                )
                            })
                        )}
                    </tbody>
                </table>
            </div>

            {/* LEADS CURATION DRAWER */}
            {
                selectedLead && selectedLead.leads && (
                    <div className="fixed inset-0 z-50 flex justify-end">
                        <div
                            className="absolute inset-0 bg-slate-900/20 backdrop-blur-sm transition-opacity"
                            onClick={() => setSelectedLead(null)}
                        />
                        <div className="relative w-full max-w-lg bg-white h-full shadow-2xl flex flex-col animate-slide-in-right overflow-hidden border-l border-gray-200">

                            {/* HEADER */}
                            <div className="p-6 border-b border-gray-100 flex justify-between items-start bg-slate-50/50">
                                <div className="flex gap-4">
                                    <div className="w-14 h-14 rounded-full bg-white border border-gray-200 shadow-sm flex items-center justify-center text-xl font-bold text-slate-500 overflow-hidden shrink-0">
                                        {selectedLead.leads.avatar_url ? (
                                            <img src={selectedLead.leads.avatar_url} className="w-full h-full object-cover" />
                                        ) : (selectedLead.leads.nome?.charAt(0).toUpperCase())}
                                    </div>
                                    <div>
                                        <h2 className="text-xl font-bold text-slate-900 leading-tight">
                                            {selectedLead.leads.nome || 'Lead sem nome'}
                                        </h2>
                                        <p className="text-sm text-slate-500 font-medium mb-1">
                                            {selectedLead.leads.headline || 'Sem cargo'}
                                        </p>
                                        {selectedLead.leads.linkedin_profile && (
                                            <a
                                                href={selectedLead.leads.linkedin_profile}
                                                target="_blank"
                                                rel="noopener noreferrer"
                                                className="inline-flex items-center gap-1 text-xs font-bold text-blue-600 hover:text-blue-700 hover:underline"
                                            >
                                                <ExternalLink size={12} /> Ver LinkedIn
                                            </a>
                                        )}
                                    </div>
                                </div>
                                <button onClick={() => setSelectedLead(null)} className="p-2 rounded-full hover:bg-white text-gray-400 hover:text-slate-600 transition-all border border-transparent hover:border-gray-200 hover:shadow-sm">
                                    <X size={20} />
                                </button>
                            </div>

                            {/* BODY */}
                            <div className="flex-1 overflow-y-auto p-6 space-y-6 custom-scrollbar">

                                {/* SECTION 1: CONTEXT */}
                                <div className="space-y-3">
                                    <div className="flex items-center gap-2">
                                        {selectedLead.leads.is_high_ticket && (
                                            <span className="px-2.5 py-1 bg-purple-50 text-purple-700 text-xs font-bold rounded-lg border border-purple-100 flex items-center gap-1.5">
                                                <Gem size={12} /> High Ticket
                                            </span>
                                        )}
                                        <span className="px-2.5 py-1 bg-green-50 text-green-700 text-xs font-bold rounded-lg border border-green-100">
                                            ICP Score: A
                                        </span>
                                    </div>

                                    <div className="p-4 bg-slate-50 rounded-xl border border-slate-200">
                                        <h4 className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2">
                                            An√°lise da IA
                                        </h4>
                                        <p className="text-sm text-slate-600 leading-relaxed">
                                            {selectedLead.leads.analysis_reasoning || selectedLead.leads.icp_reason || "Sem an√°lise dispon√≠vel para este lead."}
                                        </p>
                                    </div>
                                </div>

                                {/* SECTION 2: ICEBREAKER */}
                                <div>
                                    <label className="flex justify-between items-center mb-2">
                                        <span className="text-sm font-bold text-slate-800">Icebreaker (Mensagem de Conex√£o)</span>
                                        <span className={`text-xs font-bold ${icebreakerText.length > 300 ? 'text-red-500' : 'text-slate-400'}`}>
                                            {icebreakerText.length}/300
                                        </span>
                                    </label>
                                    <textarea
                                        className="w-full h-48 p-4 bg-white border border-gray-200 rounded-xl text-slate-700 focus:outline-none focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/10 transition-all font-medium leading-relaxed resize-none text-sm shadow-sm"
                                        placeholder="Escreva ou edite o icebreaker aqui..."
                                        value={icebreakerText}
                                        onChange={(e) => setIcebreakerText(e.target.value)}
                                    />
                                    <p className="text-xs text-gray-400 mt-2">
                                        Dica: Personalize a mensagem com base na an√°lise da IA acima.
                                    </p>
                                </div>

                            </div>

                            {/* FOOTER */}
                            <div className="p-6 border-t border-gray-100 bg-white shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)]">
                                <button
                                    onClick={handleSaveIcebreaker}
                                    disabled={isSaving}
                                    className="w-full py-3 rounded-xl bg-indigo-600 text-white font-bold text-sm shadow-lg shadow-indigo-200 hover:bg-indigo-700 hover:shadow-indigo-300 transition-all active:scale-[0.98] flex items-center justify-center gap-2"
                                >
                                    {isSaving ? <Loader2 size={18} className="animate-spin" /> : <Save size={18} />}
                                    {isSaving ? 'Salvando...' : 'Salvar Altera√ß√µes'}
                                </button>
                            </div>
                        </div>
                    </div>
                )
            }
        </div>
    )
}

export default CampaignLeadsPage

```

## File: src\pages\CampaignLeadsView.jsx
```javascript
import React, { useState, useEffect, useRef } from 'react'
import { supabase } from '../services/supabaseClient'
import { useClientSelection } from '../contexts/ClientSelectionContext'
import { useParams, useNavigate } from 'react-router-dom'
import {
    Search,
    Loader2,
    Sparkles,
    Briefcase,
    Gem,
    Building2,
    Globe,
    Send,
    Bot,
    Plus,
    Check,
    Zap,
    RefreshCw,
    X,
    Trash2,
    MapPin,
    Copy,
    ExternalLink,
    ArrowUpDown,
    Filter,
    ChevronsUpDown,
    ArrowLeft,
    Users,
    MessageSquare,
    History,
    Clock,
    ChevronLeft,
    ChevronRight,
    MessageCircle,
    Trophy,
    Medal,
    Brain
} from 'lucide-react'
import AddLeadsModal from '../components/AddLeadsModal'
import LeadDetailModal from '../components/LeadDetailModal'

const CampaignLeadsView = () => {
    const { id: campaignId } = useParams()
    const navigate = useNavigate()
    const { selectedClientId } = useClientSelection()

    const [campaign, setCampaign] = useState(null)
    const [leads, setLeads] = useState([]) // Stores the JOINED object: { ...campaign_lead, leads: { ...lead_data } }
    const [loading, setLoading] = useState(false)
    const [selectedLead, setSelectedLead] = useState(null) // This will store the full enriched object for the drawer
    const [searchTerm, setSearchTerm] = useState('')
    const [debouncedSearch, setDebouncedSearch] = useState('')
    const [stats, setStats] = useState({ total: 0, hot: 0, interactions: 0 })
    const [totalMessages, setTotalMessages] = useState(0)
    const [topLeads, setTopLeads] = useState([])

    // Chat/Interactions State
    const [interactions, setInteractions] = useState([])
    const [loadingChat, setLoadingChat] = useState(false)

    // Data Table State
    const [selectedLeads, setSelectedLeads] = useState(new Set())
    const [sortConfig, setSortConfig] = useState({ key: 'added_at', direction: 'desc' })
    const [filters, setFilters] = useState({
        status: [],
        qualification: [],
        company: '',
        role: '',
        hasMessages: '' // 'yes', 'no', or ''
    })
    const [isFilterOpen, setIsFilterOpen] = useState(false)

    // Pagination State
    const [page, setPage] = useState(0)
    const [hasMore, setHasMore] = useState(true)
    const [loadingMore, setLoadingMore] = useState(false)
    const ITEMS_per_PAGE = 100

    // Logic State
    const [enrichmentLoading, setEnrichmentLoading] = useState(false)
    const [notification, setNotification] = useState(null)
    const [sendingMessage, setSendingMessage] = useState(false)
    const [icebreakerLoading, setIcebreakerLoading] = useState(null) // ID of lead being processed
    const [messageDraft, setMessageDraft] = useState('')
    const [isAddLeadsModalOpen, setIsAddLeadsModalOpen] = useState(false)
    const [syncLoading, setSyncLoading] = useState(false)
    const [clientSyncTimestamp, setClientSyncTimestamp] = useState(null) // from clients.last_sync_timestamp

    // NEW: Bulk History Import State
    const [importQueue, setImportQueue] = useState({
        active: false,
        current: 0,
        total: 0,
        failures: 0,
        currentLeadName: ''
    })
    const [showImportConfirm, setShowImportConfirm] = useState(false)



    // Helper function for delay (Safe Queue Pattern)
    const sleep = (ms) => new Promise(resolve => setTimeout(resolve, ms))



    // Debounce Search
    useEffect(() => {
        const timer = setTimeout(() => {
            setDebouncedSearch(searchTerm)
        }, 500)
        return () => clearTimeout(timer)
    }, [searchTerm])

    useEffect(() => {
        if (selectedLead && selectedLead.leads) {
            setMessageDraft(selectedLead.leads.suggested_message || '')
        }

        // Fetch Interactions (Chat History)
        if (!selectedLead?.leads?.id) {
            setInteractions([])
            return // Don't fetch if no lead
        }

        const fetchInteractions = async () => {
            setLoadingChat(true)
            try {
                const { data, error } = await supabase
                    .from('interactions')
                    .select('*')
                    .eq('lead_id', selectedLead.leads.id)
                    .order('interaction_date', { ascending: false })

                if (error) throw error
                setInteractions(data || [])
            } catch (err) {
                console.error('Erro ao buscar intera√ß√µes:', err)
            } finally {
                setLoadingChat(false)
            }
        }

        fetchInteractions()
    }, [selectedLead])



    // Realtime Subscription
    useEffect(() => {
        if (!campaignId) return

        const channel = supabase
            .channel(`campaign_leads_changes_${campaignId}`)
            .on(
                'postgres_changes',
                {
                    event: '*',
                    schema: 'public',
                    table: 'campaign_leads',
                    filter: `campaign_id=eq.${campaignId}`
                },
                (payload) => {
                    // Refresh data on any change for now to be safe
                    // Optimization: handle INSERT/UPDATE locally
                    console.log('Realtime update:', payload)
                    fetchLeads(0, true) // Specific refresh might be better but this ensures consistency
                    fetchStats()
                }
            )
            .subscribe()

        return () => {
            supabase.removeChannel(channel)
        }
    }, [campaignId])


    const fetchCampaignDetails = async () => {
        const { data } = await supabase
            .from('campaigns')
            .select('*')
            .eq('id', campaignId)
            .single()
        setCampaign(data)
    }

    const fetchClientSyncTimestamp = async () => {
        if (!selectedClientId) return
        try {
            const { data } = await supabase
                .from('clients')
                .select('last_sync_timestamp')
                .eq('id', selectedClientId)
                .single()

            if (data?.last_sync_timestamp) {
                setClientSyncTimestamp(data.last_sync_timestamp)
            }
        } catch (err) {
            console.error('Error fetching client sync timestamp:', err)
        }
    }

    const fetchStats = async () => {
        if (!selectedClientId || !campaignId) return

        try {
            const { count: totalCount } = await supabase
                .from('campaign_leads')
                .select('*', { count: 'exact', head: true })
                .eq('campaign_id', campaignId)

            setStats(prev => ({ ...prev, total: totalCount || 0 }))

        } catch (error) {
            console.error('Erro ao buscar KPIs:', error)
        }
    }

    // Fetch Total Messages (Global Counter)
    const fetchTotalMessages = async () => {
        try {
            const { count, error } = await supabase
                .from('interactions')
                .select('*', { count: 'exact', head: true })

            if (error) throw error
            setTotalMessages(count || 0)
        } catch (err) {
            console.error('Erro ao buscar total de mensagens:', err)
        }
    }

    // Fetch Top Leads (Engagement Ranking)
    const fetchTopLeads = async () => {
        try {
            const { data, error } = await supabase
                .from('leads_with_stats')
                .select('id, nome, avatar_url, total_interactions, empresa')
                .gt('total_interactions', 0)
                .order('total_interactions', { ascending: false })
                .limit(5)

            if (error) throw error
            setTopLeads(data || [])
        } catch (err) {
            console.error('Erro ao buscar top leads:', err)
        }
    }

    // SIMPLIFIED FETCH: Query campaign_leads view directly (flat structure)
    const fetchLeads = async (pageIndex = 0, isRefresh = false) => {
        if (!selectedClientId || !campaignId) return

        try {
            if (pageIndex === 0) setLoading(true)
            else setLoadingMore(true)

            const from = pageIndex * ITEMS_per_PAGE
            const to = from + ITEMS_per_PAGE - 1

            // FIXED: Reverted to simple select to fix PGRST200 error (view relationship missing)
            let query = supabase
                .from('campaign_leads')
                .select('*', { count: 'exact' })
                .eq('campaign_id', campaignId)
                .range(from, to)

            // FIXED: Direct sorting (no foreignTable needed)
            if (sortConfig.key) {
                query = query.order(sortConfig.key, { ascending: sortConfig.direction === 'asc' })
            } else {
                query = query.order('added_at', { ascending: false })
            }

            // FIXED: Direct search on view columns
            if (debouncedSearch) {
                query = query.or(`nome.ilike.%${debouncedSearch}%,empresa.ilike.%${debouncedSearch}%,headline.ilike.%${debouncedSearch}%`)
            }

            // FIXED: Direct filters on view columns
            if (filters.status.length > 0) {
                console.log('[Filter] Applying status filter:', filters.status)
                query = query.in('status_pipeline', filters.status)
            }

            if (filters.qualification.length > 0) {
                console.log('[Filter] Applying qualification filter:', filters.qualification)
                query = query.in('icp_score', filters.qualification)
            }

            if (filters.hasMessages === 'yes') {
                console.log('[Filter] Applying hasMessages filter: with messages')
                query = query.gt('total_interactions', 0)
            } else if (filters.hasMessages === 'no') {
                console.log('[Filter] Applying hasMessages filter: no messages')
                query = query.eq('total_interactions', 0)
            }

            const { data, error, count } = await query

            console.log('[Fetch Results] Data:', data)
            console.log('[Fetch Results] Count:', count)
            console.log('[Fetch Results] Error:', error)

            if (error) throw error

            if (data) {
                console.log(`[Fetch Success] Retrieved ${data.length} leads`)
                setLeads(data) // Pagination: always replace
                setHasMore(data.length === ITEMS_per_PAGE)
            }
        } catch (err) {
            console.error('Erro ao buscar leads:', err)
        } finally {
            setLoading(false)
            setLoadingMore(false)
        }
    }

    useEffect(() => {
        if (campaignId && selectedClientId) {
            // Only fetch details once or if campaignId changes
            if (page === 0) {
                fetchCampaignDetails()
                fetchClientSyncTimestamp()
            }
        }
    }, [campaignId, selectedClientId])

    useEffect(() => {
        if (campaignId && selectedClientId) {
            setLeads([])
            setPage(0)
            setHasMore(true)
            fetchLeads(0, true)
            fetchStats()
        }
    }, [campaignId, selectedClientId, debouncedSearch, sortConfig, filters])

    // Fetch total messages and top leads once on mount
    useEffect(() => {
        fetchTotalMessages()
        fetchTopLeads()
    }, [])

    // --- HANDLERS ---
    const handleSort = (key) => {
        setSortConfig(current => ({
            key,
            direction: current.key === key && current.direction === 'asc' ? 'desc' : 'asc'
        }))
    }

    const toggleSelectAll = () => {
        if (selectedLeads.size === leads.length && leads.length > 0) {
            setSelectedLeads(new Set())
        } else {
            setSelectedLeads(new Set(leads.map(l => l.id)))
        }
    }

    const toggleSelectRow = (id, e) => {
        e.stopPropagation()
        const newSet = new Set(selectedLeads)
        if (newSet.has(id)) newSet.delete(id)
        else newSet.add(id)
        setSelectedLeads(newSet)
    }

    const toggleFilterStatus = (statusValue) => {
        setFilters(prev => {
            const current = prev.status
            const newStatus = current.includes(statusValue)
                ? current.filter(s => s !== statusValue)
                : [...current, statusValue]
            return { ...prev, status: newStatus }
        })
    }



    const handleCopy = (text) => {
        navigator.clipboard.writeText(text)
        setNotification({ message: 'Copiado para a √°rea de transfer√™ncia', type: 'info' })
        setTimeout(() => setNotification(null), 2000)
    }

    const handleSendMessage = async () => {
        if (!selectedLead) return
        setSendingMessage(true)

        try {
            await new Promise(resolve => setTimeout(resolve, 1500))
            setNotification({ message: 'Conex√£o enviada com sucesso!', type: 'success' })
            setSelectedLead(null)
        } catch (e) {
            setNotification({ message: 'Erro ao enviar.', type: 'error' })
        } finally {
            setSendingMessage(false)
            setTimeout(() => setNotification(null), 3000)
        }
    }

    // UPDATED: Start Connections Sync (Queue Workflow A)
    const handleEnrichmentQueue = async () => {
        if (!selectedClientId) return
        setEnrichmentLoading(true)
        setNotification({ message: 'Iniciando coleta em segundo plano...', type: 'info' })

        try {
            const response = await fetch('https://n8n-n8n-start.kfocge.easypanel.host/webhook/start-connections-sync', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    client_id: selectedClientId,
                    campaign_id: campaignId
                })
            })

            if (response.ok) {
                setNotification({ message: 'Coleta iniciada! Os leads ser√£o processados em breve.', type: 'success' })
            } else {
                throw new Error('Falha no webhook')
            }

        } catch (error) {
            console.error(error)
            setNotification({ message: 'Erro ao iniciar fila de enriquecimento.', type: 'error' })
        } finally {
            setEnrichmentLoading(false)
            setTimeout(() => setNotification(null), 5000)
        }
    }

    const handleSyncConnections = async () => {
        if (!selectedClientId || !campaignId) return

        try {
            // 1. Fetch Client Unipile ID
            const { data: client, error } = await supabase
                .from('clients')
                .select('unipile_account_id')
                .eq('id', selectedClientId)
                .single()

            if (error || !client?.unipile_account_id) {
                setNotification({ message: 'Erro: Cliente sem conta Unipile conectada.', type: 'error' })
                return
            }

            // 2. Call Webhook
            const response = await fetch('https://n8n-n8n-start.kfocge.easypanel.host/webhook-test/sync-connections', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    client_id: selectedClientId,
                    unipile_account_id: client.unipile_account_id,
                    campaign_id: campaignId
                })
            })

            if (response.ok) {
                setNotification({ message: 'Iniciando captura e qualifica√ß√£o de leads...', type: 'info' })
            } else {
                throw new Error('Falha na API')
            }
        } catch (e) {
            console.error(e)
            setNotification({ message: 'Erro ao iniciar sincroniza√ß√£o.', type: 'error' })
        }
        setTimeout(() => setNotification(null), 5000)
    }

    // NEW: Sync Messages Manual Trigger
    const handleSyncMessages = async () => {
        if (!selectedClientId) return

        setSyncLoading(true)
        setNotification({ message: 'Iniciando sincroniza√ß√£o de mensagens...', type: 'info' })

        try {
            // 1. Fetch Client Unipile ID & Current User
            const { data: { user } } = await supabase.auth.getUser()

            const { data: client, error } = await supabase
                .from('clients')
                .select('unipile_account_id')
                .eq('id', selectedClientId)
                .single()

            if (error || !client?.unipile_account_id) {
                setNotification({ message: 'Erro: Cliente sem conta Unipile conectada.', type: 'error' })
                setSyncLoading(false)
                setTimeout(() => setNotification(null), 5000)
                return
            }

            // 2. Call Webhook with Enriched Payload
            const response = await fetch('https://n8n-n8n-start.kfocge.easypanel.host/webhook-test/sync-messages', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    account_id: client.unipile_account_id,
                    user_id: user?.id || 'system_user',
                    client_id: selectedClientId
                })
            })

            if (response.ok) {
                // Parse JSON response
                const result = await response.json()

                if (result.success) {
                    const messageCount = result.data?.messages_synced || 0
                    const timestamp = result.data?.last_sync_timestamp || new Date().toISOString()

                    // Update local timestamp (backend saves to DB)
                    setClientSyncTimestamp(timestamp)

                    // Show success with message count
                    setNotification({
                        message: `Sincroniza√ß√£o conclu√≠da! ${messageCount} mensagens processadas.`,
                        type: 'success'
                    })

                    // Refresh data
                    fetchLeads(0, true)
                    fetchTotalMessages()
                } else {
                    throw new Error(result.message || 'Falha na sincroniza√ß√£o')
                }
            } else {
                throw new Error('Erro ao sincronizar. Tente novamente.')
            }
        } catch (error) {
            console.error(error)
            setNotification({
                message: error.message || 'Erro ao sincronizar. Tente novamente.',
                type: 'error'
            })
        } finally {
            setSyncLoading(false)
            setTimeout(() => setNotification(null), 5000)
        }
    }

    // NEW: Generate Icebreaker (Workflow D)
    const handleGenerateIcebreaker = async (leadId, e) => {
        e.stopPropagation() // Prevent row click
        if (!selectedClientId || !leadId) return

        setIcebreakerLoading(leadId)
        setNotification({ message: 'Gerando Icebreaker personalizado...', type: 'info' })

        try {
            const response = await fetch('https://n8n-n8n-start.kfocge.easypanel.host/webhook/generate-icebreaker', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    lead_id: leadId,
                    client_id: selectedClientId
                })
            })

            if (response.ok) {
                setNotification({ message: 'Icebreaker gerado com sucesso!', type: 'success' })
                // Realtime should update the UI
            } else {
                setNotification({ message: 'Erro ao gerar Icebreaker.', type: 'error' })
            }

        } catch (error) {
            console.error(error)
            setNotification({ message: 'Erro de conex√£o.', type: 'error' })
        } finally {
            setIcebreakerLoading(null)
            setTimeout(() => setNotification(null), 3000)
        }

    }

    const handleDeleteLead = async (id, e) => {
        e.stopPropagation()
        if (!confirm('Tem certeza que deseja remover este lead da campanha?')) return

        try {
            const { error } = await supabase
                .from('campaign_leads')
                .delete()
                .eq('id', id)

            if (error) throw error

            setLeads(prev => prev.filter(l => l.id !== id))
            setStats(prev => ({ ...prev, total: prev.total - 1 }))
            setNotification({ message: 'Lead removido com sucesso.', type: 'success' })
        } catch (error) {
            console.error('Error deleting lead:', error)
            setNotification({ message: 'Erro ao remover lead.', type: 'error' })
        }
    }

    // NEW: Force History Import (Workflow B - Manual Trigger)
    const handleForceHistoryImport = async (lead) => {
        if (!selectedClientId || !lead) return

        // Check if we have the client object to get unipile_account_id
        // Ideally we should have it from context or fetch it effectively.
        // We will fetch it again to be safe or assuming we have it.

        setNotification({ message: 'Solicitando importa√ß√£o de hist√≥rico...', type: 'info' })

        try {
            // 1. Fetch Client Unipile ID
            const { data: client, error } = await supabase
                .from('clients')
                .select('unipile_account_id')
                .eq('id', selectedClientId)
                .single()

            if (error || !client?.unipile_account_id) {
                setNotification({ message: 'Erro: Cliente sem conta Unipile conectada.', type: 'error' })
                return
            }

            // 2. Trigger Webhook
            const response = await fetch('https://n8n-n8n-start.kfocge.easypanel.host/webhook/import-history', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    lead_id: lead.id,
                    account_id: client.unipile_account_id
                })
            })

            if (response.ok) {
                setNotification({ message: 'Hist√≥rico sendo importado! Pode levar alguns minutos.', type: 'success' })
            } else {
                setNotification({ message: 'Erro ao acionar importa√ß√£o de hist√≥rico.', type: 'error' })
            }
        } catch (e) {
            console.error('Error importing history:', e)
            setNotification({ message: 'Erro de conex√£o.', type: 'error' })
        }
    }

    // NEW: Manual Sync Recent (Workflow A - Manual Trigger)
    const handleSyncRecent = async (lead, e) => {
        e.stopPropagation()
        if (!selectedClientId || !lead) return

        setNotification({ message: 'Verificando novas mensagens...', type: 'info' })

        try {
            const response = await fetch('https://n8n-n8n-start.kfocge.easypanel.host/webhook/sync-recent-manual', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    lead_id: lead.id,
                    action: 'quick_sync'
                })
            })

            if (response.ok) {
                setNotification({ message: 'Sincroniza√ß√£o r√°pida iniciada!', type: 'success' })
            } else {
                setNotification({ message: 'Erro ao sincronizar.', type: 'error' })
            }
        } catch (e) {
            console.error('Error syncing recent:', e)
            setNotification({ message: 'Erro de conex√£o.', type: 'error' })
        }
    }

    // NEW: Manual Sync History (Workflow B - Manual Trigger from Table)
    const handleSyncHistory = async (lead, e) => {
        e.stopPropagation()
        if (!selectedClientId || !lead) return

        if (!confirm('Aten√ß√£o: Essa a√ß√£o far√° uma varredura profunda no hist√≥rico de conversas do √∫ltimo ano.\\n\\nIsso pode levar alguns minutos. Deseja continuar?')) return

        setNotification({ message: 'Iniciando importa√ß√£o completa de hist√≥rico...', type: 'info' })

        try {
            // 1. Fetch Client Unipile Account ID (REQUIRED by webhook)
            const { data: client, error } = await supabase
                .from('clients')
                .select('unipile_account_id')
                .eq('id', selectedClientId)
                .single()

            if (error || !client?.unipile_account_id) {
                setNotification({
                    message: 'Conecte uma conta do LinkedIn nas configura√ß√µes deste cliente.',
                    type: 'error'
                })
                return
            }

            console.log(`[Sync History] Sending request for lead_id: ${lead.id}, account_id: ${client.unipile_account_id}`)

            // 2. Call Webhook with REQUIRED account_id
            const response = await fetch('https://n8n-n8n-start.kfocge.easypanel.host/webhook/import-history', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    lead_id: lead.id,               // ID REAL do lead (da view leads_with_stats)
                    account_id: client.unipile_account_id
                })
            })

            if (response.ok) {
                setNotification({ message: 'Importa√ß√£o iniciada! O processo rodar√° em segundo plano.', type: 'success' })
            } else {
                const errorText = await response.text()
                console.error(`Webhook Error: ${response.status}`, errorText)
                setNotification({ message: `Erro ao iniciar importa√ß√£o: ${response.status}`, type: 'error' })
            }
        } catch (e) {
            console.error('Error importing history:', e)
            setNotification({ message: 'Erro de conex√£o.', type: 'error' })
        }
    }

    // NEW: Bulk History Import Logic (Workflow B - Mass Action)
    const handleBulkHistorySync = () => {
        setShowImportConfirm(true)
    }

    const cancelImport = () => {
        setShowImportConfirm(false)
    }

    const executeHistoryImport = async () => {
        setShowImportConfirm(false)
        if (!selectedClientId || !campaignId) return

        // 1. PREPARA√á√ÉO DO CLIENTE: Fetch Unipile Account ID (OBRIGAT√ìRIO antes de qualquer loop)
        let clientAccountId
        try {
            const { data: client, error } = await supabase
                .from('clients')
                .select('unipile_account_id')
                .eq('id', selectedClientId)
                .single()

            if (error || !client?.unipile_account_id) {
                setNotification({
                    message: 'Conecte uma conta do LinkedIn nas configura√ß√µes deste cliente.',
                    type: 'error'
                })
                return
            }
            clientAccountId = client.unipile_account_id
        } catch (err) {
            console.error("Error fetching client account ID", err)
            setNotification({ message: 'Erro ao buscar conta Unipile do cliente.', type: 'error' })
            return
        }

        // 2. PREPARA√á√ÉO DOS LEADS: Buscar IDs REAIS diretamente do banco
        let realLeadIds = []
        setNotification({ message: 'Buscando IDs reais dos leads no banco...', type: 'info' })

        try {
            if (selectedLeads.size > 0) {
                // Se h√° sele√ß√£o, buscar apenas os leads selecionados
                // Precisamos mapear os IDs selecionados (que s√£o de campaign_leads) para os IDs reais dos leads
                const selectedCampaignLeadIds = Array.from(selectedLeads)

                const { data, error } = await supabase
                    .from('campaign_leads')
                    .select('lead_id, leads!inner(id, nome)')
                    .in('id', selectedCampaignLeadIds)
                    .eq('campaign_id', campaignId)

                if (error) throw error

                // Extrair os IDs REAIS da tabela leads
                realLeadIds = data.map(item => ({
                    id: item.leads.id,  // ID REAL do lead na tabela leads
                    nome: item.leads.nome
                }))
            } else {
                // Buscar TODOS os leads da campanha diretamente da tabela leads
                const { data, error } = await supabase
                    .from('campaign_leads')
                    .select('lead_id, leads!inner(id, nome)')
                    .eq('campaign_id', campaignId)

                if (error) throw error

                // Extrair os IDs REAIS
                realLeadIds = data.map(item => ({
                    id: item.leads.id,  // ID REAL do lead
                    nome: item.leads.nome
                }))
            }
        } catch (err) {
            console.error("Error fetching real lead IDs", err)
            setNotification({ message: 'Erro ao buscar IDs reais dos leads.', type: 'error' })
            return
        }

        if (realLeadIds.length === 0) {
            setNotification({ message: 'Nenhum lead encontrado para processar.', type: 'error' })
            return
        }

        console.log(`[Bulk Sync] Starting import for ${realLeadIds.length} leads with account ${clientAccountId}`)
        console.log(`[Bulk Sync] Lead IDs:`, realLeadIds.map(l => l.id))

        // 3. Initialize Queue
        setImportQueue({
            active: true,
            current: 0,
            total: realLeadIds.length,
            failures: 0,
            currentLeadName: ''
        })

        // 4. O LOOP DE ENVIO: Process Queue (Sequential Loop with Delay)
        let failures = 0

        for (let i = 0; i < realLeadIds.length; i++) {
            const lead = realLeadIds[i]
            const leadName = lead.nome || 'Lead #' + lead.id

            setImportQueue(prev => ({ ...prev, current: i + 1, currentLeadName: leadName }))

            try {
                console.log(`[Bulk Sync] Sending request for lead_id: ${lead.id}`)

                const response = await fetch('https://n8n-n8n-start.kfocge.easypanel.host/webhook/import-history', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        lead_id: lead.id,           // ID REAL do lead (ex: 480)
                        account_id: clientAccountId  // ID da conta Unipile do Cliente
                    })
                })

                if (!response.ok) {
                    throw new Error(`Webhook failed with status ${response.status}`)
                }
            } catch (error) {
                console.error(`Failed to import history for ${leadName} (ID: ${lead.id})`, error)
                failures++
                setImportQueue(prev => ({ ...prev, failures: prev.failures + 1 }))
            }

            // 4. PAUSA DE SEGURAN√áA (3 segundos para evitar Rate Limit 429)
            if (i < realLeadIds.length - 1) {
                console.log(`[Bulk Sync] Waiting 3 seconds before next request...`)
                await sleep(3000)
            }
        }

        // 5. Finish
        setImportQueue(prev => ({ ...prev, active: false }))
        setNotification({
            message: `Processamento conclu√≠do! ${realLeadIds.length - failures} sucessos, ${failures} falhas.`,
            type: failures > 0 ? 'info' : 'success'
        })
        setTimeout(() => setNotification(null), 5000)
    }

    // --- HELPER COMPONENTS ---
    const QualificationBadge = ({ isHighTicket, isB2B, companySize }) => {
        return (
            <div className="flex flex-wrap gap-1.5 justify-start">
                {isHighTicket && (
                    <div className="w-6 h-6 rounded-md bg-purple-50 text-purple-600 border border-purple-100 flex items-center justify-center shadow-sm" title="High Ticket Potential">
                        <Gem size={14} />
                    </div>
                )}
                {isB2B && (
                    <span className="px-1.5 py-0.5 rounded-md bg-blue-50 text-blue-700 text-[10px] font-extrabold border border-blue-100 flex items-center shadow-sm">
                        B2B
                    </span>
                )}
                {companySize && (
                    <span className={`px-1.5 py-0.5 rounded-md text-[10px] font-bold border flex items-center shadow-sm ${companySize === 'Enterprise'
                        ? 'bg-purple-100 text-purple-700 border-purple-200'
                        : companySize === 'Mid-Market'
                            ? 'bg-indigo-50 text-indigo-600 border-indigo-100'
                            : 'bg-gray-100 text-gray-600 border-gray-200'
                        }`}>
                        {companySize}
                    </span>
                )}
            </div>
        )
    }

    return (
        <div className="min-h-screen bg-slate-50 p-6 md:p-8 font-sans text-slate-800">

            {/* NOTIFICATION TOAST */}
            {notification && (
                <div className={`fixed top-6 right-6 z-50 px-5 py-4 rounded-xl shadow-2xl border-2 flex items-center gap-3 animate-slide-in-right min-w-[300px] ${notification.type === 'error'
                    ? 'bg-red-50 border-red-300 text-red-700'
                    : notification.type === 'success'
                        ? 'bg-emerald-50 border-emerald-300 text-emerald-700'
                        : 'bg-blue-50 border-blue-300 text-blue-700'
                    }`}>
                    {notification.type === 'error' ? (
                        <X size={20} className="shrink-0" />
                    ) : notification.type === 'success' ? (
                        <Check size={20} className="shrink-0" />
                    ) : (
                        <RefreshCw size={20} className="animate-spin shrink-0" />
                    )}
                    <span className="text-sm font-semibold flex-1">{notification.message}</span>
                </div>
            )}

            {/* LEAD DETAIL MODAL */}
            {selectedLead && (
                <LeadDetailModal
                    lead={selectedLead.leads_with_stats}
                    campaignLead={selectedLead}
                    onClose={() => setSelectedLead(null)}
                />
            )}

            {/* HEADER */}

            {/* BULK IMPORT PROGRESS BANNER */}
            {importQueue.active && (
                <div className="fixed bottom-6 left-1/2 -translate-x-1/2 z-50 bg-slate-900 text-white px-6 py-4 rounded-xl shadow-2xl flex items-center gap-6 animate-slide-up w-[90%] max-w-2xl border border-slate-700">
                    <Loader2 className="animate-spin text-orange-500 shrink-0" size={24} />
                    <div className="flex-1">
                        <div className="flex justify-between items-center mb-1">
                            <h3 className="font-bold text-sm">Importando Hist√≥rico...</h3>
                            <span className="text-xs text-slate-400">{importQueue.current} de {importQueue.total}</span>
                        </div>
                        <div className="w-full bg-slate-700 rounded-full h-2 overflow-hidden">
                            <div
                                className="bg-orange-500 h-full transition-all duration-300 ease-out"
                                style={{ width: `${(importQueue.current / importQueue.total) * 100}%` }}
                            />
                        </div>
                        <p className="text-xs text-slate-400 mt-1 truncate">Processando: <span className="text-white">{importQueue.currentLeadName}</span></p>
                    </div>
                </div>
            )}

            {/* CONFIRMATION MODAL */}
            {showImportConfirm && (
                <div className="fixed inset-0 z-[60] flex items-center justify-center bg-slate-900/50 backdrop-blur-sm px-4">
                    <div className="bg-white rounded-2xl shadow-2xl p-6 max-w-md w-full animate-scale-in">
                        <div className="flex justify-center mb-4">
                            <div className="p-3 bg-amber-50 text-amber-600 rounded-full">
                                <History size={32} />
                            </div>
                        </div>
                        <h3 className="text-xl font-bold text-center text-slate-900 mb-2">Importar Hist√≥rico em Massa</h3>
                        <p className="text-slate-600 text-center mb-6 text-sm">
                            {selectedLeads.size > 0
                                ? `Voc√™ selecionou ${selectedLeads.size} leads para atualiza√ß√£o.`
                                : `Voc√™ n√£o selecionou nenhum lead. Isso iniciar√° a importa√ß√£o para TODOS os ${stats.total} leads desta campanha.`}
                            <br /><br />
                            <span className="font-bold text-slate-800">Aten√ß√£o:</span> O processo ser√° feito sequencialmente (um por um) para evitar bloqueios, levando cerca de <span className="text-orange-600 font-bold">3 segundos por lead</span>.
                        </p>
                        <div className="flex gap-3">
                            <button
                                onClick={cancelImport}
                                className="flex-1 py-3 rounded-lg border border-slate-200 font-bold text-slate-600 hover:bg-slate-50 transition-colors"
                            >
                                Cancelar
                            </button>
                            <button
                                onClick={executeHistoryImport}
                                className="flex-1 py-3 rounded-lg bg-orange-600 font-bold text-white hover:bg-orange-700 transition-colors shadow-lg shadow-orange-200"
                            >
                                Confirmar e Iniciar
                            </button>
                        </div>
                    </div>
                </div>
            )}

            <div className="px-4 mb-6">
                <button
                    onClick={() => navigate('/campaigns')}
                    className="flex items-center gap-2 text-slate-500 hover:text-orange-600 transition-colors text-sm font-semibold mb-4"
                >
                    <ArrowLeft size={16} /> Voltar para Campanhas
                </button>

                <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-2 mb-5">
                    <div>
                        <h1 className="text-2xl font-bold text-slate-900 tracking-tight mb-1">
                            {campaign ? campaign.name : 'Carregando campanha...'}
                        </h1>
                        <p className="text-slate-600 text-base font-medium">Gerencie os leads e cad√™ncia desta campanha.</p>
                    </div>
                </div>

                {/* KPI CARDS */}
                <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-5">
                    <div className="bg-white p-4 rounded-xl border border-slate-200 shadow-sm">
                        <div className="flex items-center gap-3 mb-2 text-slate-600 text-sm font-bold uppercase tracking-wider">
                            <Users size={16} /> Leads na Campanha
                        </div>
                        <div className="text-3xl font-extrabold text-slate-900">{stats.total}</div>
                    </div>

                    <div className="bg-white p-4 rounded-xl border border-slate-200 shadow-sm">
                        <div className="flex items-center gap-3 mb-2 text-slate-600 text-sm font-bold uppercase tracking-wider">
                            <MessageCircle size={16} /> Total de Mensagens na Base
                        </div>
                        <div className="text-3xl font-extrabold text-blue-600">{totalMessages.toLocaleString()}</div>
                        <div className="text-xs text-slate-500 mt-1">Intera√ß√µes registradas no sistema</div>
                    </div>

                    {/* TOP LEADS RANKING */}
                    <div className="bg-white p-4 rounded-xl border border-slate-200 shadow-sm">
                        <div className="flex items-center gap-3 mb-4 text-slate-600 text-sm font-bold uppercase tracking-wider">
                            <Trophy size={16} className="text-amber-500" /> Top Leads (Engajamento)
                        </div>
                        {topLeads.length > 0 ? (
                            <div className="space-y-2">
                                {topLeads.map((lead, idx) => (
                                    <div key={lead.id} className="flex items-center gap-3 py-1.5 px-2 rounded-lg hover:bg-slate-50 transition-colors">
                                        <div className={`w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold shrink-0 ${idx === 0 ? 'bg-amber-100 text-amber-700' :
                                            idx === 1 ? 'bg-slate-100 text-slate-600' :
                                                idx === 2 ? 'bg-orange-100 text-orange-700' :
                                                    'bg-slate-50 text-slate-500'
                                            }`}>
                                            {idx === 0 ? 'ü•á' : idx === 1 ? 'ü•à' : idx === 2 ? 'ü•â' : idx + 1}
                                        </div>
                                        <div className="w-7 h-7 rounded-full bg-slate-200 flex items-center justify-center text-xs font-semibold overflow-hidden shrink-0">
                                            {lead.avatar_url ? (
                                                <img src={lead.avatar_url} className="w-full h-full object-cover" alt="" />
                                            ) : (
                                                lead.nome?.charAt(0) || '?'
                                            )}
                                        </div>
                                        <div className="flex-1 min-w-0">
                                            <div className="text-sm font-medium text-slate-800 truncate">{lead.nome}</div>
                                        </div>
                                        <div className="text-xs font-bold text-blue-600 bg-blue-50 px-2 py-0.5 rounded-full">
                                            {lead.total_interactions} msg
                                        </div>
                                    </div>
                                ))}
                            </div>
                        ) : (
                            <p className="text-sm text-slate-400 text-center py-4">Nenhum lead com intera√ß√µes</p>
                        )}
                    </div>
                </div>

                {/* CONTROLS */}
                {/* HEADER CONTROLS */}
                <div className="bg-white border-b border-gray-200 p-3 md:p-4 mb-4 rounded-xl shadow-sm">
                    <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                        {/* SEARCH & FILTER */}
                        <div className="flex items-center gap-3 w-full md:w-auto">
                            <div className="relative flex-1 md:w-80">
                                <div className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">
                                    <Search size={18} />
                                </div>
                                <input
                                    type="text"
                                    placeholder="Buscar lead, cargo ou empresa..."
                                    className="w-full pl-10 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-800 focus:outline-none focus:border-orange-500 focus:ring-2 focus:ring-orange-200 transition-colors"
                                    value={searchTerm}
                                    onChange={(e) => setSearchTerm(e.target.value)}
                                />
                            </div>
                            <button
                                onClick={() => setIsFilterOpen(!isFilterOpen)}
                                className={`p-3 rounded-xl border transition-colors ${isFilterOpen ? 'bg-orange-50 border-orange-200 text-orange-600' : 'bg-white border-slate-200 text-slate-500 hover:border-orange-200 hover:text-orange-500'}`}>
                                <Filter size={20} />
                            </button>
                        </div>

                        {/* ACTION BUTTONS */}
                        <div className="flex items-center gap-3 w-full md:w-auto justify-end">
                            {selectedLeads.size > 0 && (
                                <span className="text-xs font-bold text-orange-600 animate-fade-in mr-2">
                                    {selectedLeads.size} selecionados
                                </span>
                            )}


                            <div className="flex flex-col items-end gap-1">
                                {clientSyncTimestamp && !syncLoading && (
                                    <div className="text-[10px] text-slate-500 flex items-center gap-1 mb-1">
                                        <Clock size={10} />
                                        <span>
                                            √öltima sync: {new Date(clientSyncTimestamp).toLocaleString('pt-BR', {
                                                day: '2-digit',
                                                month: '2-digit',
                                                hour: '2-digit',
                                                minute: '2-digit'
                                            })}
                                        </span>
                                    </div>
                                )}
                                <button
                                    onClick={handleSyncMessages}
                                    disabled={syncLoading}
                                    className={`flex items-center gap-2 px-4 py-2.5 rounded-lg font-semibold text-sm transition-all ${syncLoading
                                        ? 'bg-blue-50 text-blue-400 cursor-not-allowed'
                                        : 'bg-blue-50 text-blue-600 hover:bg-blue-100 hover:text-blue-700 border border-blue-200'
                                        }`}
                                >
                                    <RefreshCw size={16} className={syncLoading ? "animate-spin" : ""} />
                                    {syncLoading ? 'Sincronizando...' : 'Sync Mensagens'}
                                </button>
                            </div>


                            <button
                                onClick={handleBulkHistorySync}
                                disabled={importQueue.active}
                                className={`flex items-center gap-2 px-4 py-2.5 rounded-lg font-semibold text-sm transition-all ${importQueue.active
                                    ? 'bg-amber-50 text-amber-400 cursor-not-allowed'
                                    : 'bg-amber-50 text-amber-600 hover:bg-amber-100 hover:text-amber-700 border border-amber-200'
                                    }`}
                            >
                                <History size={16} className={importQueue.active ? "animate-spin" : ""} />
                                {importQueue.active ? 'Processando...' : 'Sync Hist√≥rico'}
                            </button>

                            <button
                                onClick={() => setIsAddLeadsModalOpen(true)}
                                className="flex items-center gap-2 px-4 py-2.5 rounded-lg bg-orange-600 text-white border border-orange-600 hover:bg-orange-700 font-bold text-sm transition-all shadow-md shadow-orange-100">
                                <Plus size={16} /> Adicionar Leads
                            </button>
                        </div>
                    </div>

                    {/* FILTER PANEL */}
                    {isFilterOpen && (
                        <div className="mt-4 p-4 bg-slate-50 rounded-xl border border-slate-200 animate-fade-in">
                            <div className="flex flex-wrap items-end gap-4">
                                {/* STATUS FILTER */}
                                <div className="flex-1 min-w-[200px]">
                                    <label className="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2">
                                        Status
                                    </label>
                                    <select
                                        value={filters.status[0] || ''}
                                        onChange={(e) => setFilters(prev => ({
                                            ...prev,
                                            status: e.target.value ? [e.target.value] : []
                                        }))}
                                        className="w-full px-4 py-2.5 bg-white border border-slate-200 rounded-lg text-slate-800 focus:outline-none focus:border-orange-500 focus:ring-2 focus:ring-orange-200 transition-colors text-sm"
                                    >
                                        <option value="">Todos os Status</option>
                                        <option value="NOT_CONTACTED">Not Contacted</option>
                                        <option value="PENDING_ENRICHMENT">In Queue</option>
                                        <option value="PROCESSING">Processing</option>
                                        <option value="QUALIFIED_NO_ICEBREAKER">Qualified</option>
                                        <option value="QUALIFIED_WITH_ICEBREAKER">Icebreaker Ready</option>
                                        <option value="CONTACTED">Contacted</option>
                                        <option value="REPLIED">Replied</option>
                                        <option value="MEETING_SCHEDULED">Meeting</option>
                                        <option value="WON">Won</option>
                                        <option value="LOST">Lost</option>
                                    </select>
                                </div>

                                {/* QUALIFICATION FILTER */}
                                <div className="flex-1 min-w-[200px]">
                                    <label className="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2">
                                        Qualifica√ß√£o
                                    </label>
                                    <select
                                        value={filters.qualification[0] || ''}
                                        onChange={(e) => setFilters(prev => ({
                                            ...prev,
                                            qualification: e.target.value ? [e.target.value] : []
                                        }))}
                                        className="w-full px-4 py-2.5 bg-white border border-slate-200 rounded-lg text-slate-800 focus:outline-none focus:border-orange-500 focus:ring-2 focus:ring-orange-200 transition-colors text-sm"
                                    >
                                        <option value="">Todas as Qualifica√ß√µes</option>
                                        <option value="A">A-Tier (High Ticket)</option>
                                        <option value="B">B-Tier (Enterprise)</option>
                                        <option value="C">C-Tier (Standard)</option>
                                    </select>
                                </div>

                                {/* HAS MESSAGES FILTER */}
                                <div className="flex-1 min-w-[180px]">
                                    <label className="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2">
                                        Mensagens
                                    </label>
                                    <select
                                        value={filters.hasMessages || ''}
                                        onChange={(e) => setFilters(prev => ({
                                            ...prev,
                                            hasMessages: e.target.value
                                        }))}
                                        className="w-full px-4 py-2.5 bg-white border border-slate-200 rounded-lg text-slate-800 focus:outline-none focus:border-orange-500 focus:ring-2 focus:ring-orange-200 transition-colors text-sm"
                                    >
                                        <option value="">Todos</option>
                                        <option value="yes">Com mensagens</option>
                                        <option value="no">Sem mensagens</option>
                                    </select>
                                </div>

                                {/* CLEAR FILTERS */}
                                <button
                                    onClick={() => setFilters({ status: [], qualification: [], company: '', role: '', hasMessages: '' })}
                                    className="px-4 py-2.5 bg-white border border-slate-200 rounded-lg text-slate-600 hover:bg-slate-100 hover:border-slate-300 font-medium text-sm transition-colors"
                                >
                                    Limpar Filtros
                                </button>
                            </div>

                            {/* Active Filters Tags */}
                            {(filters.status.length > 0 || filters.qualification.length > 0 || filters.hasMessages) && (
                                <div className="mt-3 flex flex-wrap gap-2">
                                    {filters.status.map(s => (
                                        <span key={s} className="inline-flex items-center gap-1 px-2 py-1 bg-orange-100 text-orange-700 rounded-full text-xs font-medium">
                                            Status: {s}
                                            <button onClick={() => setFilters(prev => ({ ...prev, status: prev.status.filter(x => x !== s) }))} className="hover:text-orange-900">
                                                <X size={12} />
                                            </button>
                                        </span>
                                    ))}
                                    {filters.qualification.map(q => (
                                        <span key={q} className="inline-flex items-center gap-1 px-2 py-1 bg-purple-100 text-purple-700 rounded-full text-xs font-medium">
                                            Tier: {q}
                                            <button onClick={() => setFilters(prev => ({ ...prev, qualification: prev.qualification.filter(x => x !== q) }))} className="hover:text-purple-900">
                                                <X size={12} />
                                            </button>
                                        </span>
                                    ))}
                                    {filters.hasMessages && (
                                        <span className="inline-flex items-center gap-1 px-2 py-1 bg-blue-100 text-blue-700 rounded-full text-xs font-medium">
                                            {filters.hasMessages === 'yes' ? 'Com mensagens' : 'Sem mensagens'}
                                            <button onClick={() => setFilters(prev => ({ ...prev, hasMessages: '' }))} className="hover:text-blue-900">
                                                <X size={12} />
                                            </button>
                                        </span>
                                    )}
                                </div>
                            )}
                        </div>
                    )}
                </div>

                <AddLeadsModal
                    isOpen={isAddLeadsModalOpen}
                    onClose={() => setIsAddLeadsModalOpen(false)}
                    campaignId={campaignId}
                    clientId={selectedClientId}
                    onImportConnections={handleSyncConnections}
                />





                {/* ========== TABLE/LIST VIEW ========== */}
                {
                    <div className="bg-white border border-slate-200 rounded-xl shadow-sm overflow-hidden flex flex-col">
                        <div className="overflow-x-auto min-h-[400px]">
                            <table className="w-full text-left border-collapse">
                                <thead className="bg-slate-50 sticky top-0 z-10 shadow-sm">
                                    <tr className="border-b border-slate-200 text-xs font-bold text-slate-500 uppercase tracking-wider">
                                        <th className="py-4 px-4 w-[40px] text-center">
                                            <div
                                                onClick={toggleSelectAll}
                                                className={`w-4 h-4 rounded border flex items-center justify-center cursor-pointer transition-colors mx-auto ${selectedLeads.size > 0 && selectedLeads.size === leads.length ? 'bg-orange-500 border-orange-500' : 'bg-white border-slate-300'
                                                    }`}>
                                                {selectedLeads.size > 0 && selectedLeads.size === leads.length && <Check size={10} className="text-white" />}
                                                {selectedLeads.size > 0 && selectedLeads.size < leads.length && <div className="w-2 h-0.5 bg-orange-500 rounded-full" />}
                                            </div>
                                        </th>

                                        <th
                                            className="py-4 px-4 w-[30%] cursor-pointer hover:bg-slate-100 transition-colors group"
                                            onClick={() => handleSort('nome')}
                                        >
                                            <div className="flex items-center gap-1">
                                                Lead
                                                <ArrowUpDown size={12} className={`text-slate-400 ${sortConfig.key === 'nome' ? 'opacity-100 text-orange-500' : 'opacity-0 group-hover:opacity-100'}`} />
                                            </div>
                                        </th>

                                        <th
                                            className="py-4 px-4 w-[15%] cursor-pointer hover:bg-slate-100 transition-colors group"
                                            onClick={() => handleSort('empresa')}
                                        >
                                            <div className="flex items-center gap-1">
                                                Empresa
                                                <ArrowUpDown size={12} className={`text-slate-400 ${sortConfig.key === 'empresa' ? 'opacity-100 text-orange-500' : 'opacity-0 group-hover:opacity-100'}`} />
                                            </div>
                                        </th>

                                        <th className="py-4 px-4 w-[10%]">Qualifica√ß√£o</th>

                                        <th
                                            className="py-4 px-4 w-[15%] cursor-pointer hover:bg-slate-100 transition-colors group"
                                            onClick={() => handleSort('location')}
                                        >
                                            <div className="flex items-center gap-1">
                                                Local
                                                <ArrowUpDown size={12} className={`text-slate-400 ${sortConfig.key === 'location' ? 'opacity-100 text-orange-500' : 'opacity-0 group-hover:opacity-100'}`} />
                                            </div>
                                        </th>

                                        <th
                                            className="py-4 px-4 w-[10%] text-center cursor-pointer hover:bg-slate-100 transition-colors group"
                                            onClick={() => handleSort('status_pipeline')}
                                        >
                                            <div className="flex items-center justify-center gap-1">
                                                Status
                                                <ArrowUpDown size={12} className={`text-slate-400 ${sortConfig.key === 'status_pipeline' ? 'opacity-100 text-orange-500' : 'opacity-0 group-hover:opacity-100'}`} />
                                            </div>
                                        </th>

                                        <th
                                            className="py-4 px-4 w-[10%] text-center cursor-pointer hover:bg-slate-100 transition-colors group"
                                            onClick={() => handleSort('total_interactions')}
                                        >
                                            <div className="flex items-center justify-center gap-1">
                                                Engagement
                                                <ArrowUpDown size={12} className={`text-slate-400 ${sortConfig.key === 'total_interactions' ? 'opacity-100 text-orange-500' : 'opacity-0 group-hover:opacity-100'}`} />
                                            </div>
                                        </th>

                                        <th
                                            className="py-4 px-4 w-[8%] text-center cursor-pointer hover:bg-slate-100 transition-colors group"
                                            onClick={() => handleSort('sentiment')}
                                        >
                                            <div className="flex items-center justify-center gap-1">
                                                <Brain size={14} className="text-violet-500" />
                                                IA
                                                <ArrowUpDown size={12} className={`text-slate-400 ${sortConfig.key === 'sentiment' ? 'opacity-100 text-orange-500' : 'opacity-0 group-hover:opacity-100'}`} />
                                            </div>
                                        </th>

                                        <th className="py-4 px-4 w-[8%] text-right">A√ß√µes</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {loading && leads.length === 0 ? (
                                        <tr><td colSpan="7" className="py-20 text-center text-gray-400"><Loader2 className="animate-spin mx-auto mb-2" />Carregando Leads...</td></tr>
                                    ) : leads.map((item, index) => {
                                        console.log(`[Render ${index + 1}/${leads.length}] Full item:`, item)

                                        // FIXED: campaign_leads view is flat - all data is directly on item
                                        const lead = item
                                        console.log(`[Render ${index + 1}] Using lead data:`, lead)

                                        const campaignStatus = item.status_pipeline
                                        const totalInteractions = lead.total_interactions || 0

                                        // Dynamic Status based on interactions
                                        let statusLabel = 'A Contatar'
                                        let statusColor = 'text-slate-500 bg-slate-100'

                                        if (totalInteractions > 0) {
                                            statusLabel = 'Em Conversa'
                                            statusColor = 'text-blue-600 bg-blue-50'
                                        }

                                        // Override with pipeline status if disqualified
                                        if (campaignStatus === 'DISQUALIFIED') {
                                            statusLabel = 'Desqualificado'
                                            statusColor = 'text-red-600 bg-red-50'
                                        }

                                        const isDisqualified = campaignStatus === 'DISQUALIFIED'
                                        const needsIcebreaker = campaignStatus === 'QUALIFIED_NO_ICEBREAKER'
                                        const isSelected = selectedLeads.has(item.id)

                                        // Professional Zebra Striping
                                        let rowClass = "group cursor-pointer border-b border-slate-100 hover:brightness-95"
                                        if (index % 2 === 0) rowClass += " bg-white"
                                        else rowClass += " bg-slate-50/50"
                                        if (isSelected) rowClass += " !bg-blue-50"

                                        return (
                                            <tr key={item.id} onClick={() => !isDisqualified && setSelectedLead(item)} className={rowClass}>
                                                <td className="py-3 px-4 text-center" onClick={(e) => e.stopPropagation()}>
                                                    <div onClick={(e) => toggleSelectRow(item.id, e)} className={`w-4 h-4 rounded border flex items-center justify-center cursor-pointer transition-colors mx-auto ${isSelected ? 'bg-blue-600 border-blue-600' : 'bg-white border-slate-300 hover:border-blue-400'}`}>
                                                        {isSelected && <Check size={10} className="text-white" />}
                                                    </div>
                                                </td>

                                                <td className="py-3 px-4">
                                                    <div className="flex items-center gap-3">
                                                        <div className="w-9 h-9 rounded-full bg-slate-200 flex items-center justify-center text-slate-600 font-semibold text-sm border border-slate-300 overflow-hidden shrink-0">
                                                            {lead.avatar_url ? <img src={lead.avatar_url} className="w-full h-full object-cover" alt="" /> : (lead.nome?.charAt(0) || '?')}
                                                        </div>
                                                        <div className="min-w-0">
                                                            <div className="font-semibold text-slate-900 text-sm truncate max-w-[220px]" title={lead.nome}>{lead.nome || 'Lead #' + item.id}</div>
                                                            <div className="text-xs text-slate-500 truncate max-w-[220px]" title={lead.headline}>{lead.headline || 'No headline'}</div>
                                                        </div>
                                                    </div>
                                                </td>

                                                <td className="py-3 px-4">
                                                    <div className="text-sm text-slate-700 truncate max-w-[180px]" title={lead.empresa}>
                                                        {lead.empresa || 'None'}
                                                    </div>
                                                </td>

                                                <td className="py-3 px-4">
                                                    <div className="text-sm text-slate-600">
                                                        {lead.icp_score ? `${lead.icp_score}-Tier` : 'N/A'}
                                                    </div>
                                                </td>

                                                <td className="py-3 px-4">
                                                    <div className="text-sm text-slate-600 truncate max-w-[140px]" title={lead.location}>
                                                        {lead.location || 'N/A'}
                                                    </div>
                                                </td>

                                                {/* ENGAGEMENT HEAT INDICATOR */}
                                                <td className="py-3 px-4">
                                                    {(() => {
                                                        const count = lead.total_interactions || 0
                                                        const sentiment = lead.last_sentiment

                                                        // Determine heat level based on sentiment
                                                        let heatConfig = {
                                                            bars: 1,
                                                            color: 'bg-slate-300',
                                                            textColor: 'text-slate-500',
                                                            label: 'Cold'
                                                        }

                                                        if (count === 0) {
                                                            heatConfig = { bars: 0, color: 'bg-slate-200', textColor: 'text-slate-400', label: 'No Activity' }
                                                        } else if (sentiment === 'POSITIVE') {
                                                            heatConfig = { bars: 3, color: 'bg-emerald-500', textColor: 'text-emerald-600', label: 'Hot' }
                                                        } else if (sentiment === 'NEGATIVE') {
                                                            heatConfig = { bars: 1, color: 'bg-rose-400', textColor: 'text-rose-500', label: 'Cold' }
                                                        } else if (sentiment === 'NEUTRAL') {
                                                            heatConfig = { bars: 2, color: 'bg-amber-400', textColor: 'text-amber-600', label: 'Warm' }
                                                        } else if (count > 0) {
                                                            heatConfig = { bars: 2, color: 'bg-slate-400', textColor: 'text-slate-600', label: 'Active' }
                                                        }

                                                        return (
                                                            <div className="flex items-center justify-center gap-2">
                                                                {/* Signal Strength Bars */}
                                                                <div className="flex items-end gap-0.5 h-4" title={`Sentiment: ${sentiment || 'Unknown'}`}>
                                                                    <div className={`w-1 rounded-sm transition-all ${heatConfig.bars >= 1 ? heatConfig.color : 'bg-slate-200'}`} style={{ height: '6px' }} />
                                                                    <div className={`w-1 rounded-sm transition-all ${heatConfig.bars >= 2 ? heatConfig.color : 'bg-slate-200'}`} style={{ height: '10px' }} />
                                                                    <div className={`w-1 rounded-sm transition-all ${heatConfig.bars >= 3 ? heatConfig.color : 'bg-slate-200'}`} style={{ height: '14px' }} />
                                                                </div>

                                                                {/* Count Badge */}
                                                                <span className={`text-sm font-semibold ${heatConfig.textColor}`}>
                                                                    {count}
                                                                </span>
                                                            </div>
                                                        )
                                                    })()}
                                                </td>

                                                <td className="py-3 px-4 text-center">
                                                    <span className={`text-xs font-semibold px-2.5 py-1 rounded-full ${statusColor}`}>
                                                        {statusLabel}
                                                    </span>
                                                </td>

                                                {/* AI STATUS BADGE */}
                                                <td className="py-3 px-4 text-center">
                                                    {(() => {
                                                        // Loading state
                                                        if (lead.ready_for_analysis) {
                                                            return (
                                                                <div className="flex items-center justify-center" title="IA analisando...">
                                                                    <div className="px-2 py-1 rounded-full bg-violet-50 border border-violet-200 flex items-center gap-1">
                                                                        <Sparkles size={12} className="text-violet-500 animate-pulse" />
                                                                        <span className="text-xs text-violet-600 font-medium">Analisando</span>
                                                                    </div>
                                                                </div>
                                                            )
                                                        }

                                                        const sentiment = lead.sentiment
                                                        const reasoning = lead.sentiment_reasoning

                                                        if (!sentiment) {
                                                            return (
                                                                <span className="text-xs text-slate-400">‚Äî</span>
                                                            )
                                                        }

                                                        let badgeConfig = {
                                                            bg: 'bg-slate-100',
                                                            border: 'border-slate-200',
                                                            text: 'text-slate-600',
                                                            label: '‚Äî',
                                                            icon: null
                                                        }

                                                        if (sentiment === 'POSITIVE') {
                                                            badgeConfig = {
                                                                bg: 'bg-emerald-50',
                                                                border: 'border-emerald-200',
                                                                text: 'text-emerald-700',
                                                                label: 'üî• Quente',
                                                                icon: null
                                                            }
                                                        } else if (sentiment === 'NEGATIVE') {
                                                            badgeConfig = {
                                                                bg: 'bg-rose-50',
                                                                border: 'border-rose-200',
                                                                text: 'text-rose-700',
                                                                label: '‚ùÑÔ∏è Frio',
                                                                icon: null
                                                            }
                                                        } else if (sentiment === 'NEUTRAL') {
                                                            badgeConfig = {
                                                                bg: 'bg-amber-50',
                                                                border: 'border-amber-200',
                                                                text: 'text-amber-700',
                                                                label: 'üå°Ô∏è Morno',
                                                                icon: null
                                                            }
                                                        }

                                                        return (
                                                            <div className="relative group/tooltip inline-block">
                                                                <div className={`px-2 py-1 rounded-full ${badgeConfig.bg} border ${badgeConfig.border} cursor-help`}>
                                                                    <span className={`text-xs font-semibold ${badgeConfig.text}`}>
                                                                        {badgeConfig.label}
                                                                    </span>
                                                                </div>
                                                                {/* Tooltip */}
                                                                {reasoning && (
                                                                    <div className="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-3 py-2 bg-slate-800 text-white text-xs rounded-lg opacity-0 invisible group-hover/tooltip:opacity-100 group-hover/tooltip:visible transition-all z-50 w-48 text-center shadow-lg">
                                                                        {reasoning}
                                                                        <div className="absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-slate-800" />
                                                                    </div>
                                                                )}
                                                            </div>
                                                        )
                                                    })()}
                                                </td>

                                                <td className="py-3 px-4 text-right">
                                                    <div className="flex justify-end items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity" onClick={e => e.stopPropagation()}>
                                                        <button onClick={(e) => handleSyncRecent(lead, e)} className="p-1.5 rounded text-slate-400 hover:text-blue-600 hover:bg-blue-50" title="Sync Recente"><RefreshCw size={14} /></button>
                                                        <button onClick={(e) => handleSyncHistory(lead, e)} className="p-1.5 rounded text-slate-400 hover:text-amber-600 hover:bg-amber-50" title="Importar Hist√≥rico"><History size={14} /></button>

                                                        <div className="w-px h-3 bg-slate-200 mx-1"></div>

                                                        {needsIcebreaker && (
                                                            <button onClick={(e) => handleGenerateIcebreaker(lead.id, e)} className="p-1.5 rounded bg-indigo-50 text-indigo-600 hover:bg-indigo-100" title="Gerar Icebreaker">
                                                                {icebreakerLoading === lead.id ? <Loader2 className="animate-spin" size={14} /> : <Bot size={14} />}
                                                            </button>
                                                        )}
                                                        <button onClick={(e) => handleDeleteLead(item.id, e)} className="p-1.5 rounded text-slate-400 hover:text-red-600 hover:bg-red-50" title="Remover"><Trash2 size={14} /></button>
                                                    </div>
                                                </td>
                                            </tr>
                                        )
                                    })}
                                </tbody>
                            </table>
                        </div>

                        {/* PAGINATION */}
                        <div className="border-t border-slate-200 bg-slate-50 p-4 flex justify-between items-center sticky bottom-0 z-10 w-full">
                            <span className="text-sm text-slate-600">
                                Showing {page * ITEMS_per_PAGE + 1} - {Math.min((page + 1) * ITEMS_per_PAGE, stats.total)} out of {stats.total} results
                            </span>

                            <div className="flex items-center gap-2">
                                <button
                                    onClick={() => {
                                        const newPage = Math.max(0, page - 1);
                                        setPage(newPage);
                                        fetchLeads(newPage, false);
                                    }}
                                    disabled={page === 0 || loading}
                                    className="p-2 rounded-lg border bg-white text-slate-600 hover:bg-slate-50 disabled:opacity-50 disabled:cursor-not-allowed shadow-sm transition-all"
                                >
                                    <ChevronLeft size={16} />
                                </button>
                                <span className="text-sm font-bold text-slate-700 min-w-[20px] text-center">{page + 1}</span>
                                <button
                                    onClick={() => {
                                        const newPage = page + 1;
                                        setPage(newPage);
                                        fetchLeads(newPage, false);
                                    }}
                                    disabled={!hasMore || loading}
                                    className="p-2 rounded-lg border bg-white text-slate-600 hover:bg-slate-50 disabled:opacity-50 disabled:cursor-not-allowed shadow-sm transition-all"
                                >
                                    <ChevronRight size={16} />
                                </button>
                            </div>
                        </div>
                    </div>
                }

            </div>

            {/* DRAWER (Slide-Over) */}
            {selectedLead && selectedLead.leads && (
                <div className="fixed inset-0 z-50 flex justify-end">
                    <div className="absolute inset-0 bg-slate-900/20 backdrop-blur-sm transition-opacity" onClick={() => setSelectedLead(null)} />
                    <div className="relative w-full max-w-lg bg-white h-full shadow-2xl flex flex-col animate-slide-in-right overflow-hidden border-l border-gray-200">
                        {/* Drawer Header */}
                        <div className="p-6 border-b border-gray-100 flex justify-between items-center bg-white">
                            <div>
                                <h2 className="text-xl font-bold text-slate-800">Cad√™ncia de Venda</h2>
                                <p className="text-xs text-gray-500 mt-1">Gerencie a intera√ß√£o com este lead</p>
                            </div>
                            <button onClick={() => setSelectedLead(null)} className="p-2 rounded-full hover:bg-gray-100 text-gray-400 hover:text-slate-600 transition-colors">
                                <X size={20} />
                            </button>
                        </div>

                        {/* Drawer Body - Split into Context and Action */}
                        <div className="flex-1 overflow-y-auto p-6 space-y-8 custom-scrollbar bg-slate-50/50">

                            {/* BLOCK 1: CONTEXT (Why is this lead here?) */}
                            <div className="bg-white p-5 rounded-xl border border-orange-100 shadow-sm">
                                <div className="flex items-start gap-4 mb-4">
                                    <div className="w-14 h-14 rounded-full bg-slate-100 flex items-center justify-center text-lg font-bold text-slate-500 shrink-0 border border-gray-200">
                                        {selectedLead.leads.avatar_url ? <img src={selectedLead.leads.avatar_url} className="w-full h-full object-cover rounded-full" /> : (selectedLead.leads.nome?.charAt(0) || '?')}
                                    </div>
                                    <div className="flex-1">
                                        <div className="flex justify-between items-start">
                                            <h3 className="text-lg font-bold text-slate-900 leading-tight">{selectedLead.leads.nome}</h3>
                                            {selectedLead.leads.company_website && (
                                                <a href={selectedLead.leads.company_website} target="_blank" rel="noopener noreferrer" className="text-gray-400 hover:text-blue-600 transition-colors" title="Visitar Site">
                                                    <Globe size={18} />
                                                </a>
                                            )}
                                        </div>
                                        <p className="text-sm text-gray-500 mb-1">{selectedLead.leads.headline}</p>
                                        <div className="flex flex-wrap gap-2 mt-2">
                                            {selectedLead.leads.is_high_ticket && <span className="px-2 py-0.5 bg-indigo-50 text-indigo-700 text-[10px] font-bold rounded border border-indigo-100 flex items-center gap-1"><Gem size={10} /> High Ticket</span>}
                                            {selectedLead.leads.company_size_type && <span className="px-2 py-0.5 bg-gray-100 text-gray-600 text-[10px] font-bold rounded border border-gray-200"><Building2 size={10} className="inline mr-1" />{selectedLead.leads.company_size_type}</span>}
                                        </div>
                                    </div>
                                </div>

                                {/* ICP REASON */}
                                <div className="p-3 bg-orange-50 rounded-lg border border-orange-100/60">
                                    <h4 className="flex items-center gap-2 text-[10px] font-bold text-orange-600 uppercase tracking-wider mb-1">
                                        <Sparkles size={12} /> Motivo da Qualifica√ß√£o
                                    </h4>
                                    <p className="text-sm text-slate-700 leading-relaxed font-medium">
                                        {selectedLead.leads.icp_reason || "Este perfil apresenta alta ader√™ncia com seu ICP ideal, ocupando cargo de decis√£o em setor estrat√©gico."}
                                    </p>
                                </div>
                            </div>

                            {/* Skills Tag Cloud (Collapsed/Secondary) */}
                            {selectedLead.leads.skills && (
                                <div>
                                    <h4 className="text-xs font-bold text-gray-400 uppercase tracking-wider mb-3 px-2">Habilidades Detectadas</h4>
                                    <div className="flex flex-wrap gap-2 px-2">
                                        {(() => {
                                            try {
                                                const tags = typeof selectedLead.leads.skills === 'string' ? JSON.parse(selectedLead.leads.skills) : selectedLead.leads.skills
                                                return tags.slice(0, 5).map((t, i) => (
                                                    <span key={i} className="px-2 py-1 rounded-md bg-white text-slate-500 text-xs font-medium border border-gray-200 shadow-sm">
                                                        {typeof t === 'string' ? t : t.name}
                                                    </span>
                                                ))
                                            } catch (e) { return null }
                                        })()}
                                    </div>
                                </div>
                            )}



                            {/* TIMELINE / INTERACTIONS */}
                            <div className="pt-4 border-t border-gray-100">
                                <h4 className="text-xs font-bold text-gray-400 uppercase tracking-wider mb-3 px-2 flex items-center gap-2">
                                    <MessageSquare size={12} /> Hist√≥rico de Intera√ß√µes
                                </h4>
                                <div className="space-y-3 px-2">
                                    {loadingChat ? (
                                        <div className="text-center text-xs text-gray-400 py-4">
                                            <Loader2 className="animate-spin inline mr-1" size={12} /> Carregando...
                                        </div>
                                    ) : interactions.length === 0 ? (
                                        <div className="text-center text-xs text-gray-400 py-4 italic bg-slate-50 rounded-lg border border-slate-100">
                                            Nenhuma intera√ß√£o registrada.
                                        </div>
                                    ) : (
                                        interactions.map(msg => (
                                            <div key={msg.id} className={`flex flex-col max-w-[90%] ${msg.direction === 'inbound' ? 'self-start' : 'self-end ml-auto'}`}>
                                                <div className={`p-3 rounded-xl text-xs leading-relaxed shadow-sm ${msg.direction === 'inbound'
                                                    ? 'bg-white border border-gray-200 text-slate-700 rounded-bl-none'
                                                    : 'bg-indigo-50 border border-indigo-100 text-indigo-900 rounded-br-none'
                                                    }`}>
                                                    {msg.content}
                                                </div>
                                                <span className="text-[10px] text-gray-400 mt-1 px-1 text-right">
                                                    {new Date(msg.interaction_date).toLocaleDateString()} {new Date(msg.interaction_date).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}
                                                </span>
                                            </div>
                                        ))
                                    )}
                                </div>
                            </div>
                        </div>

                        {/* BLOCK 2: ACTION (Bottom Fixed) */}
                        <div className="p-6 border-t border-gray-200 bg-white">
                            <label className="block text-xs font-bold text-gray-500 uppercase tracking-wider mb-2">Mensagem de Conex√£o</label>

                            <div className="relative mb-4">
                                <textarea
                                    className="w-full h-32 p-3 bg-slate-50 border border-gray-300 rounded-lg text-sm text-slate-700 focus:outline-none focus:border-orange-500 focus:ring-1 focus:ring-orange-500 resize-none font-medium leading-relaxed"
                                    value={messageDraft}
                                    onChange={(e) => setMessageDraft(e.target.value)}
                                    placeholder="Escreva sua mensagem de conex√£o..."
                                />
                                <button
                                    onClick={() => handleCopy(messageDraft)}
                                    className="absolute top-2 right-2 p-1.5 rounded-md bg-white text-gray-400 hover:text-orange-600 border border-gray-200 shadow-sm transition-all"
                                    title="Copiar texto"
                                >
                                    <Copy size={14} />
                                </button>
                            </div>

                            <button
                                onClick={handleSendMessage}
                                disabled={sendingMessage}
                                className={`w-full py-3.5 rounded-xl text-white font-bold shadow-lg transition-all transform active:scale-95 flex items-center justify-center gap-2 ${sendingMessage
                                    ? 'bg-orange-300 cursor-not-allowed'
                                    : 'bg-orange-600 hover:bg-orange-700 shadow-orange-200 hover:shadow-orange-300'
                                    }`}
                            >
                                {sendingMessage ? <Loader2 className="animate-spin" size={20} /> : <Send size={18} />}
                                {sendingMessage ? 'Enviando...' : 'Enviar Conex√£o'}
                            </button>

                            <p className="text-center text-[10px] text-gray-400 mt-2">
                                Esta a√ß√£o enviar√° um convite de conex√£o via LinkedIn.
                            </p>
                        </div>
                    </div>
                </div>
            )}

            {/* LEAD DETAIL MODAL - AI INSIGHTS */}
            {selectedLead && (
                <LeadDetailModal
                    lead={selectedLead}
                    onClose={() => setSelectedLead(null)}
                />
            )}
        </div>
    )
}

export default CampaignLeadsView


```

## File: src\pages\CampaignsPage.jsx
```javascript
import React, { useState, useEffect } from 'react'
import { supabase } from '../services/supabaseClient'
import { useClientSelection } from '../contexts/ClientSelectionContext'
import { useNavigate } from 'react-router-dom'
import {
    Plus,
    Search,
    Filter,
    MoreHorizontal,
    Calendar,
    ArrowRight,
    Loader2,
    Target,
    Users,
    MessageSquare,
    BarChart3
} from 'lucide-react'

const CampaignsPage = () => {
    const { selectedClientId } = useClientSelection()
    const navigate = useNavigate()
    const [campaigns, setCampaigns] = useState([])
    const [loading, setLoading] = useState(false)
    const [searchTerm, setSearchTerm] = useState('')
    const [isCreateModalOpen, setIsCreateModalOpen] = useState(false)
    const [newCampaignName, setNewCampaignName] = useState('')
    const [createLoading, setCreateLoading] = useState(false)

    useEffect(() => {
        if (selectedClientId) {
            fetchCampaigns()
        }
    }, [selectedClientId])

    const fetchCampaigns = async () => {
        setLoading(true)
        try {
            const { data, error } = await supabase
                .from('campaigns')
                .select('*')
                .eq('client_id', selectedClientId)
                .order('created_at', { ascending: false })

            if (error) throw error
            setCampaigns(data || [])
        } catch (error) {
            console.error('Error fetching campaigns:', error)
        } finally {
            setLoading(false)
        }
    }

    const handleCreateCampaign = async (e) => {
        e.preventDefault()
        if (!newCampaignName.trim() || !selectedClientId) return

        setCreateLoading(true)
        try {
            const { data, error } = await supabase
                .from('campaigns')
                .insert([
                    {
                        name: newCampaignName,
                        client_id: selectedClientId,
                        status: 'active'
                    }
                ])
                .select()

            if (error) throw error

            if (data) {
                setCampaigns([data[0], ...campaigns])
                setIsCreateModalOpen(false)
                setNewCampaignName('')
            }
        } catch (error) {
            console.error('Error creating campaign:', error)
        } finally {
            setCreateLoading(false)
        }
    }

    // Filter campaigns
    const filteredCampaigns = campaigns.filter(c =>
        c.name.toLowerCase().includes(searchTerm.toLowerCase())
    )

    return (
        <div className="min-h-screen bg-slate-50 p-6 md:p-8 font-sans text-slate-800">
            {/* HEADER */}
            <div className="max-w-7xl mx-auto mb-10">
                <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-8">
                    <div>
                        <h1 className="text-3xl font-bold text-slate-900 tracking-tight mb-2">Campanhas de Vendas</h1>
                        <p className="text-slate-500 text-lg">Gerencie suas estrat√©gias de prospec√ß√£o e acompanhe resultados.</p>
                    </div>
                    <button
                        onClick={() => setIsCreateModalOpen(true)}
                        className="flex items-center gap-2 px-5 py-2.5 rounded-xl bg-orange-600 text-white font-bold hover:bg-orange-700 transition-all shadow-lg shadow-orange-100"
                    >
                        <Plus size={20} /> Nova Campanha
                    </button>
                </div>

                {/* CONTROLS */}
                <div className="bg-white p-4 rounded-xl border border-slate-200 shadow-sm mb-6 flex flex-col md:flex-row justify-between items-center gap-4">
                    <div className="relative w-full md:w-96">
                        <Search className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400" size={18} />
                        <input
                            type="text"
                            placeholder="Buscar campanhas..."
                            value={searchTerm}
                            onChange={e => setSearchTerm(e.target.value)}
                            className="w-full pl-10 pr-4 py-2.5 bg-slate-50 border border-slate-200 rounded-lg text-slate-800 focus:outline-none focus:border-orange-500 focus:ring-1 focus:ring-orange-500 transition-all font-medium placeholder:text-slate-400"
                        />
                    </div>
                </div>

                {/* CAMPAIGN LIST */}
                {loading ? (
                    <div className="py-20 flex justify-center text-gray-400">
                        <Loader2 className="animate-spin" size={32} />
                    </div>
                ) : filteredCampaigns.length === 0 ? (
                    <div className="text-center py-20 bg-white rounded-2xl border border-gray-200 border-dashed">
                        <Target className="mx-auto text-gray-300 mb-4" size={48} />
                        <h3 className="text-lg font-bold text-slate-700 mb-2">Nenhuma campanha encontrada</h3>
                        <p className="text-gray-500 mb-6">Comece criando sua primeira campanha de prospec√ß√£o.</p>
                        <button
                            onClick={() => setIsCreateModalOpen(true)}
                            className="px-5 py-2 rounded-lg bg-orange-50 text-orange-600 font-bold hover:bg-orange-100 transition-colors"
                        >
                            Criar Campanha
                        </button>
                    </div>
                ) : (
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        {filteredCampaigns.map(campaign => (
                            <div
                                key={campaign.id}
                                onClick={() => navigate(`/campaigns/${campaign.id}`)}
                                className="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm hover:shadow-md hover:border-orange-200 transition-all cursor-pointer group"
                            >
                                <div className="flex justify-between items-start mb-4">
                                    <div className={`w-10 h-10 rounded-lg flex items-center justify-center ${campaign.status === 'active' ? 'bg-green-100 text-green-600' : 'bg-gray-100 text-slate-500'
                                        }`}>
                                        <Target size={20} />
                                    </div>
                                    <span className={`px-2.5 py-1 rounded-full text-xs font-bold uppercase tracking-wide border ${campaign.status === 'active'
                                        ? 'bg-green-50 text-green-600 border-green-100'
                                        : 'bg-slate-100 text-slate-500 border-slate-200'
                                        }`}>
                                        {campaign.status === 'active' ? 'Ativa' : 'Pausada'}
                                    </span>
                                </div>

                                <h3 className="text-xl font-bold text-slate-900 mb-2 group-hover:text-orange-600 transition-colors line-clamp-1">
                                    {campaign.name}
                                </h3>
                                <p className="text-sm text-slate-600 font-medium mb-6 line-clamp-2">
                                    {campaign.description || "Sem descri√ß√£o definida."}
                                </p>

                                <div className="flex items-center gap-4 text-xs font-bold text-slate-500 border-t border-slate-100 pt-4">
                                    <div className="flex items-center gap-1.5">
                                        <Calendar size={14} />
                                        {new Date(campaign.created_at).toLocaleDateString()}
                                    </div>
                                    <div className="flex items-center gap-1.5 ml-auto text-orange-600 opacity-0 group-hover:opacity-100 transition-opacity">
                                        Acessar <ArrowRight size={14} />
                                    </div>
                                </div>
                            </div>
                        ))}
                    </div>
                )}
            </div>

            {/* CREATE MODAL */}
            {isCreateModalOpen && (
                <div className="fixed inset-0 z-50 flex items-center justify-center bg-slate-900/50 backdrop-blur-sm p-4">
                    <div className="bg-white w-full max-w-md rounded-2xl shadow-2xl overflow-hidden animate-scale-in">
                        <div className="p-6 border-b border-gray-100">
                            <h2 className="text-xl font-bold text-slate-800">Nova Campanha</h2>
                            <p className="text-sm text-gray-500 mt-1">D√™ um nome para sua nova campanha de prospec√ß√£o.</p>
                        </div>
                        <form onSubmit={handleCreateCampaign} className="p-6">
                            <div className="mb-6">
                                <label className="block text-sm font-bold text-slate-700 mb-2">Nome da Campanha</label>
                                <input
                                    autoFocus
                                    type="text"
                                    value={newCampaignName}
                                    onChange={e => setNewCampaignName(e.target.value)}
                                    placeholder="Ex: Prospec√ß√£o CEO Tech Q1"
                                    className="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl text-slate-800 focus:outline-none focus:border-orange-500 focus:ring-2 focus:ring-orange-200 transition-all font-medium"
                                />
                            </div>
                            <div className="flex gap-3 justify-end">
                                <button
                                    type="button"
                                    onClick={() => setIsCreateModalOpen(false)}
                                    className="px-5 py-2.5 rounded-xl text-slate-600 font-bold hover:bg-gray-100 transition-colors"
                                >
                                    Cancelar
                                </button>
                                <button
                                    type="submit"
                                    disabled={!newCampaignName.trim() || createLoading}
                                    className="px-5 py-2.5 rounded-xl bg-orange-600 text-white font-bold hover:bg-orange-700 transition-all shadow-lg shadow-orange-200 disabled:opacity-70 disabled:cursor-not-allowed flex items-center gap-2"
                                >
                                    {createLoading && <Loader2 className="animate-spin" size={18} />}
                                    Criar Campanha
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            )}
        </div>
    )
}

export default CampaignsPage

```

## File: src\pages\ClientDashboard.css
```css
/* 
  DEPRECATED: Styles have been moved to Tailwind classes in ClientDashboard.jsx
  as part of the Obsidian Glass visual overhaul.
*/
```

## File: src\pages\ClientDashboard.jsx
```javascript
import React, { useState, useEffect } from 'react'
import { useNavigate } from 'react-router-dom'
import { supabase } from '../services/supabaseClient'
import { useAuth } from '../contexts/AuthContext'
import { Loader2, Camera, ArrowRight, RefreshCw, LayoutGrid } from 'lucide-react'

const ClientDashboard = () => {
    const { profile } = useAuth()
    const [posts, setPosts] = useState([])
    const [loading, setLoading] = useState(true)
    const navigate = useNavigate()

    useEffect(() => {
        if (profile?.nome_empresa) {
            fetchClientPosts(profile.nome_empresa)
        }
    }, [profile])


    const fetchClientPosts = async (clientName) => {
        setLoading(true)
        try {
            const { data, error } = await supabase
                .from('tabela_projetofred1')
                .select('*')
                .eq('nome_cliente', clientName)
                .order('id', { ascending: false })

            if (error) throw error
            setPosts(data || [])
        } catch (err) {
            console.error('Erro ao buscar posts:', err)
        } finally {
            setLoading(false)
        }
    }

    const clientName = profile?.nome_empresa

    return (
        <div className="p-2 md:p-6 animate-fade-in-up">
            {/* Header */}
            <div className="mb-8 flex flex-col md:flex-row justify-between items-end gap-4 glass-panel p-6 rounded-2xl border-glass-border bg-gradient-to-r from-white/5 to-transparent">
                <div>
                    <h1 className="text-3xl font-bold text-white mb-2 flex items-center gap-3">
                        Ol√°, {clientName || 'Cliente'} <span className="text-2xl">üëã</span>
                    </h1>
                    <p className="text-gray-400">
                        Voc√™ tem <span className="text-primary font-bold">{posts.length} posts</span> no hist√≥rico.
                    </p>
                </div>
                <button
                    onClick={() => window.location.reload()}
                    className="flex items-center gap-2 px-4 py-2 rounded-xl bg-white/5 hover:bg-white/10 text-gray-300 hover:text-white transition-all text-sm font-medium border border-glass-border hover:border-white/20"
                >
                    <RefreshCw size={14} /> Atualizar Dados
                </button>
            </div>

            {loading ? (
                <div className="flex flex-col items-center justify-center py-20 text-gray-500">
                    <Loader2 className="animate-spin mb-4 text-primary" size={32} />
                    <p className="text-sm font-medium">Carregando galeria...</p>
                </div>
            ) : (
                /* Grid de Cards */
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    {posts.map((post) => (
                        <div key={post.id} className="group glass-panel rounded-2xl border-glass-border overflow-hidden flex flex-col hover:border-primary/30 transition-all duration-300 hover:shadow-lg hover:shadow-primary/5">

                            {/* √Årea da Imagem */}
                            <div className="h-48 bg-black/40 relative overflow-hidden">
                                {post.image_url ? (
                                    <img src={post.image_url} alt="Post" className="w-full h-full object-cover opacity-80 group-hover:opacity-100 group-hover:scale-105 transition-all duration-500" />
                                ) : (
                                    <div className="w-full h-full flex items-center justify-center bg-white/5 text-gray-600">
                                        <Camera className="w-12 h-12 opacity-20" />
                                    </div>
                                )}

                                {/* Badge de Status */}
                                <div className="absolute top-3 right-3">
                                    <span className={`px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-wider backdrop-blur-md border ${(() => {
                                        const s = (post.status || '').toUpperCase();
                                        if (s === 'APPROVED' || s.includes('APPROV')) return 'bg-green-500/20 text-green-400 border-green-500/30';
                                        if (s.includes('WAITING') || s.includes('PEND')) return 'bg-amber-500/20 text-amber-400 border-amber-500/30';
                                        return 'bg-gray-500/20 text-gray-400 border-gray-500/30';
                                    })()}`}>
                                        {(() => {
                                            const s = (post.status || '').toUpperCase();
                                            if (s === 'APPROVED' || s.includes('APPROV')) return 'Aprovado';
                                            if (s.includes('WAITING') || s.includes('PEND')) return 'Pendente';
                                            return 'Em Revis√£o';
                                        })()}
                                    </span>
                                </div>
                            </div>

                            {/* Conte√∫do do Card */}
                            <div className="p-5 flex-1 flex flex-col bg-gradient-to-b from-transparent to-black/20">
                                <div className="flex-1">
                                    <h3 className="font-bold text-lg text-white leading-tight mb-2 line-clamp-2">
                                        {post.titulo_hook || post.tema || "Sem t√≠tulo"}
                                    </h3>
                                    <p className="text-xs text-gray-500 font-medium mb-4 flex items-center gap-2">
                                        <span className="w-1 h-1 rounded-full bg-gray-600"></span>
                                        {new Date(post.created_at).toLocaleDateString('pt-BR')}
                                    </p>
                                </div>

                                <button
                                    onClick={() => navigate(`/post-feedback/${post.id}`)}
                                    className="w-full mt-4 py-3 rounded-xl bg-white/5 hover:bg-white/10 text-gray-300 hover:text-white border border-glass-border hover:border-primary/50 font-medium text-sm transition-all duration-300 flex items-center justify-center gap-2 group-hover:bg-primary/10 group-hover:text-primary group-hover:border-primary/30"
                                >
                                    {(post.status || '').toUpperCase().includes('APPROV') ? 'Ver Detalhes' : 'Revisar Conte√∫do'}
                                    <ArrowRight size={14} className="group-hover:translate-x-1 transition-transform" />
                                </button>
                            </div>
                        </div>
                    ))}

                    {posts.length === 0 && (
                        <div className="col-span-full py-20 glass-panel rounded-2xl border-glass-border border-dashed flex flex-col items-center justify-center text-center">
                            <LayoutGrid className="w-16 h-16 text-gray-700 mb-4" />
                            <h3 className="text-gray-300 font-medium text-lg">Nenhum post encontrado.</h3>
                            <p className="text-sm text-gray-500 mt-2">Seu hist√≥rico est√° vazio por enquanto.</p>
                        </div>
                    )}
                </div>
            )}
        </div>
    )
}

export default ClientDashboard

```

## File: src\pages\ClientInsightsPage.jsx
```javascript
import React, { useState, useEffect, useRef } from 'react'
import { useClientAuth } from '../contexts/ClientAuthContext'
import { supabase } from '../services/supabaseClient'
import { useParams } from 'react-router-dom'
import {
    LayoutDashboard,
    CheckCircle2,
    AlertCircle,
    Mic,
    StopCircle,
    Play,
    Trash2,
    Send,
    Loader2,
    X,
    ChevronRight,
    MessageSquare,
    Image as ImageIcon,
    Clock,
    MoreHorizontal,
    FileText,
    CalendarClock
} from 'lucide-react'
import ContentCalendar from '../components/ContentCalendar'

// --- STYLES (Responsive Grid & UI) ---
const pageStyles = `
  .insights-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 2rem 1.5rem 6rem;
    font-family: 'Inter', system-ui, sans-serif;
    color: #1e293b;
  }
  
  /* Header */
  .insights-header {
    margin-bottom: 3rem;
  }
  .insights-header h1 {
    font-size: 2rem;
    font-weight: 800;
    color: #111827;
    margin-bottom: 0.5rem;
    letter-spacing: -0.025em;
  }
  .insights-header p {
    font-size: 1.125rem;
    color: #64748b;
    line-height: 1.6;
  }
  .highlight-stats {
    color: #7c3aed; /* Purple brand */
    font-weight: 700;
  }

  /* Grid Layout */
  .insights-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 2rem;
    margin-bottom: 4rem;
  }
  @media (min-width: 768px) {
    .insights-grid { grid-template-columns: repeat(2, 1fr); }
  }
  @media (min-width: 1024px) {
    .insights-grid { grid-template-columns: repeat(3, 1fr); }
  }

  /* Card Component */
  .insight-card {
    background: #ffffff;
    border-radius: 20px;
    border: 1px solid #e2e8f0;
    overflow: hidden;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
    transition: all 0.3s ease;
    display: flex;
    flex-direction: column;
    height: 100%;
    position: relative;
  }
  .insight-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
    border-color: #cbd5e1;
  }

  /* Card Image */
  .card-image-wrapper {
    height: 200px;
    background: #f1f5f9;
    position: relative;
    overflow: hidden;
  }
  .card-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.5s ease;
  }
  .insight-card:hover .card-image {
    transform: scale(1.05);
  }
  .card-placeholder {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
    color: #94a3b8;
  }

  /* Floating Badge */
  .status-badge-float {
    position: absolute;
    top: 1rem;
    right: 1rem;
    padding: 0.35rem 0.85rem;
    border-radius: 9999px;
    font-size: 0.75rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    backdrop-filter: blur(8px);
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
  }

  /* Card Content */
  .card-body {
    padding: 1.5rem;
    flex: 1;
    display: flex;
    flex-direction: column;
  }
  .card-title {
    font-size: 1.125rem;
    font-weight: 700;
    color: #0f172a;
    line-height: 1.4;
    margin-bottom: 0.75rem;
    
    /* Line Clamp 2 */
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  .card-meta {
    font-size: 0.825rem;
    color: #94a3b8;
    display: flex;
    align-items: center;
    gap: 6px;
    margin-bottom: auto; /* Pushes footer down */
  }

  /* Card Actions */
  .card-actions {
    margin-top: 1.5rem;
    padding-top: 1.25rem;
    border-top: 1px solid #f1f5f9;
  }
  .btn-action {
    width: 100%;
    padding: 0.75rem;
    border-radius: 12px;
    font-weight: 600;
    font-size: 0.875rem;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    border: none;
    cursor: pointer;
    transition: background 0.2s;
  }
  /* Primary Action (Purple) */
  .btn-primary {
    background: #7c3aed;
    color: white;
  }
  .btn-primary:hover {
    background: #6d28d9;
  }
  /* Secondary Action (Outline) */
  .btn-outline {
    background: transparent;
    color: #7c3aed;
    border: 1px solid #e9d5ff;
  }
  .btn-outline:hover {
    background: #faf5ff;
    border-color: #d8b4fe;
  }

  /* Questions List */
  .questions-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }
  .question-item {
    background: white;
    padding: 1.5rem;
    border-radius: 16px;
    border: 1px solid #e2e8f0;
    display: flex;
    justify-content: space-between;
    align-items: center;
    transition: transform 0.2s;
  }
  .question-item:hover {
    transform: translateX(4px);
    border-color: #cbd5e1;
  }

  /* Image Count Badge */
  .image-count-badge {
    position: absolute;
    bottom: 0.5rem;
    right: 0.5rem;
    background: rgba(0, 0, 0, 0.7);
    color: white;
    padding: 0.25rem 0.6rem;
    border-radius: 8px;
    font-size: 0.75rem;
    font-weight: 700;
    backdrop-filter: blur(4px);
    display: flex;
    align-items: center;
    gap: 4px;
  }
`

// --- HELPERS ---
const getImagesFromPost = (post) => {
    if (!post.sugestao_imagem) return []

    // 1. If it's already an array (Supabase JSON/Array column), return it
    if (Array.isArray(post.sugestao_imagem)) {
        return post.sugestao_imagem
    }

    try {
        const val = String(post.sugestao_imagem).trim()
        // 2. Check if it looks like a JSON array
        if (val.startsWith('[')) {
            const parsed = JSON.parse(val)
            if (Array.isArray(parsed)) return parsed
        }
        // 3. Fallback for single string URL
        return [val]
    } catch (e) {
        // Failsafe
        return [post.sugestao_imagem]
    }
}

// --- SUB-COMPONENT: QUESTION RESPONSE MODAL ---
const QuestionResponseModal = ({ question, onClose, onResponseSent }) => {
    const [answerText, setAnswerText] = useState('')
    const [isRecording, setIsRecording] = useState(false)
    const [audioBlob, setAudioBlob] = useState(null)
    const [audioUrl, setAudioUrl] = useState(null)
    const [publicAudioUrl, setPublicAudioUrl] = useState(null)
    const [recordingTime, setRecordingTime] = useState(0)

    const [isProcessing, setIsProcessing] = useState(false)
    const [isReviewing, setIsReviewing] = useState(false)
    const [isSaving, setIsSaving] = useState(false)

    const mediaRecorderRef = useRef(null)
    const timerRef = useRef(null)

    useEffect(() => { return () => { if (audioUrl) URL.revokeObjectURL(audioUrl) } }, [audioUrl])

    const startRecording = async () => {
        try {
            const stream = await navigator.mediaDevices.getUserMedia({ audio: true })
            const mediaRecorder = new MediaRecorder(stream)
            mediaRecorderRef.current = mediaRecorder
            const chunks = []
            mediaRecorder.ondataavailable = (e) => { if (e.data.size > 0) chunks.push(e.data) }
            mediaRecorder.onstop = () => {
                const blob = new Blob(chunks, { type: 'audio/webm' })
                const url = URL.createObjectURL(blob)
                setAudioBlob(blob)
                setAudioUrl(url)
                stream.getTracks().forEach(track => track.stop())
            }
            mediaRecorder.start()
            setIsRecording(true)
            setRecordingTime(0)
            timerRef.current = setInterval(() => { setRecordingTime(prev => prev + 1) }, 1000)
        } catch (err) { alert('Erro microfone: ' + err.message) }
    }

    // Cleanup interval on unmount
    useEffect(() => {
        return () => {
            if (timerRef.current) clearInterval(timerRef.current)
        }
    }, [])

    const stopRecording = () => {
        if (mediaRecorderRef.current && isRecording) {
            mediaRecorderRef.current.stop()
            setIsRecording(false)
            clearInterval(timerRef.current)
        }
    }

    const discardRecording = () => {
        setAudioBlob(null); setAudioUrl(null); setRecordingTime(0); setIsReviewing(false); setPublicAudioUrl(null)
    }

    const handleProcessAudio = async () => {
        if (!audioBlob) return alert("√Åudio vazio.")
        if (audioBlob.size > 50 * 1024 * 1024) return alert("O arquivo de √°udio excede o limite de 50MB.")
        setIsProcessing(true)
        try {
            const fileName = "audio_" + Date.now() + ".webm"
            const audioFile = new File([audioBlob], fileName, { type: 'audio/webm' })
            const { error: upErr } = await supabase.storage.from('audio-responses').upload(fileName, audioFile)
            if (upErr) throw upErr
            const { data: pubData } = supabase.storage.from('audio-responses').getPublicUrl(fileName)
            const generatedUrl = pubData.publicUrl
            setPublicAudioUrl(generatedUrl)

            const response = await fetch('https://n8n-n8n-start.kfocge.easypanel.host/webhook/transcrever-audio', {
                method: 'POST', headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ question_id: question.id, audio_url: generatedUrl })
            })
            if (response.ok) {
                const webData = await response.json()
                if (webData?.transcription) setAnswerText(webData.transcription)
            }
            setIsReviewing(true)
        } catch (err) { alert("Erro processar: " + err.message) } finally { setIsProcessing(false) }
    }

    const handleConfirmSend = async () => {
        if (!answerText.trim() && !audioBlob) return alert('Escreva ou grave algo.')
        setIsSaving(true)
        try {
            const { error } = await supabase.from('interview_questions').update({
                answer_text: answerText, answer_audio_url: publicAudioUrl, status: 'answered'
            }).eq('id', question.id)
            if (error) throw error
            onResponseSent(question.id); onClose()
        } catch (err) { alert('Erro salvar: ' + err.message) } finally { setIsSaving(false) }
    }

    return (
        <div style={{ position: 'fixed', top: 0, left: 0, right: 0, bottom: 0, background: 'rgba(0,0,0,0.5)', display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 10000 }}>
            <div style={{ background: 'white', padding: '2rem', borderRadius: '24px', width: '90%', maxWidth: '600px', position: 'relative' }}>
                <button onClick={onClose} style={{ position: 'absolute', top: '1.5rem', right: '1.5rem', background: 'none', border: 'none', cursor: 'pointer' }}><X size={24} color="#94a3b8" /></button>
                <h3 style={{ fontSize: '1.25rem', fontWeight: 700, color: '#1e293b', marginBottom: '1.5rem', paddingRight: '2rem' }}>{question.question_text}</h3>

                {!isReviewing ? (
                    <div style={{ display: 'flex', flexDirection: 'column', gap: '1rem' }}>
                        {!audioBlob && <textarea placeholder="Escreva sua resposta..." value={answerText} onChange={e => setAnswerText(e.target.value)} style={{ width: '100%', minHeight: '120px', padding: '1rem', borderRadius: '12px', border: '1px solid #e2e8f0' }} />}
                        <div style={{ display: 'flex', gap: '1rem', alignItems: 'center', background: '#f8fafc', padding: '1rem', borderRadius: '12px' }}>
                            {!isRecording && !audioBlob && <button onClick={startRecording} style={{ display: 'flex', gap: '8px', color: '#ef4444', fontWeight: 600, border: 'none', background: 'none', cursor: 'pointer' }}><Mic /> Gravar √Åudio</button>}
                            {isRecording && <span style={{ color: '#ef4444', fontWeight: 600 }}>Gravando... {Math.floor(recordingTime / 60)}:{recordingTime % 60 < 10 ? '0' : ''}{recordingTime % 60}</span>}
                            {isRecording && <button onClick={stopRecording} style={{ marginLeft: 'auto', background: '#ef4444', color: 'white', border: 'none', padding: '0.4rem 1rem', borderRadius: '99px' }}>Parar</button>}
                            {audioBlob && <div style={{ display: 'flex', gap: '1rem', width: '100%', alignItems: 'center' }}><audio src={audioUrl} controls style={{ flex: 1, height: 36 }} /><button onClick={discardRecording} style={{ border: 'none', background: 'none' }}><Trash2 color="#64748b" /></button></div>}
                        </div>
                        <button onClick={audioBlob ? handleProcessAudio : handleConfirmSend} disabled={(!answerText.trim() && !audioBlob) || isProcessing || isSaving} style={{ width: '100%', padding: '1rem', background: '#7c3aed', color: 'white', border: 'none', borderRadius: '12px', fontWeight: 600, opacity: (!answerText.trim() && !audioBlob) ? 0.5 : 1 }}>{isProcessing ? 'Processando...' : isSaving ? 'Enviando...' : audioBlob ? 'Transcrever e Revisar' : 'Enviar Resposta'}</button>
                    </div>
                ) : (
                    <div style={{ display: 'flex', flexDirection: 'column', gap: '1rem' }}>
                        <div style={{ background: '#f0fdf4', color: '#16a34a', padding: '1rem', borderRadius: '12px', display: 'flex', gap: '8px' }}><CheckCircle2 /> Transcri√ß√£o pronta!</div>
                        <textarea value={answerText} onChange={e => setAnswerText(e.target.value)} style={{ width: '100%', minHeight: '150px', padding: '1rem', borderRadius: '12px', border: '1px solid #e2e8f0' }} />
                        <div style={{ display: 'flex', gap: '1rem' }}><button onClick={() => setIsReviewing(false)} style={{ flex: 1, padding: '1rem', background: 'white', border: '1px solid #e2e8f0', borderRadius: '12px' }}>Voltar</button><button onClick={handleConfirmSend} style={{ flex: 1, padding: '1rem', background: '#16a34a', color: 'white', border: 'none', borderRadius: '12px', fontWeight: 600 }}>Confirmar Envio</button></div>
                    </div>
                )}
            </div>
        </div>
    )
}

// --- SUB-COMPONENT: POST REVIEW MODAL ---
const PostReviewModal = ({ post, onClose, onReview }) => {
    const [comment, setComment] = useState('')
    const [isSubmitting, setIsSubmitting] = useState(false)
    const [currentImgIndex, setCurrentImgIndex] = useState(0)

    const images = getImagesFromPost(post)
    const currentImage = images[currentImgIndex]

    const handleAction = async (action) => {
        setIsSubmitting(true)
        try {
            await onReview(post.id, action === 'approve' ? 'aprovado' : 'revis√£o', comment)
            onClose()
        } catch (err) { alert(err.message) } finally { setIsSubmitting(false) }
    }

    return (
        <div style={{ position: 'fixed', top: 0, left: 0, right: 0, bottom: 0, background: 'rgba(0,0,0,0.85)', display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 10000 }}>
            <div style={{ background: 'white', width: '95%', maxWidth: '1000px', height: '85vh', borderRadius: '24px', overflow: 'hidden', display: 'flex', flexDirection: window.innerWidth < 768 ? 'column' : 'row' }}>
                <div style={{ flex: 1.5, background: 'black', display: 'flex', alignItems: 'center', justifyContent: 'center', position: 'relative' }}>

                    {/* Image */}
                    {currentImage ? (
                        <img src={currentImage} style={{ maxWidth: '100%', maxHeight: '100%', objectFit: 'contain' }} alt="Post" />
                    ) : (
                        <div style={{ color: 'white' }}>Sem Imagem</div>
                    )}

                    {/* Navigation Buttons */}
                    {images.length > 1 && (
                        <>
                            <button
                                onClick={(e) => { e.stopPropagation(); setCurrentImgIndex(prev => prev > 0 ? prev - 1 : images.length - 1) }}
                                style={{ position: 'absolute', left: '1rem', background: 'rgba(255,255,255,0.2)', color: 'white', border: 'none', borderRadius: '50%', padding: '0.5rem', cursor: 'pointer', backdropFilter: 'blur(4px)' }}
                            >
                                <ChevronRight style={{ transform: 'rotate(180deg)' }} />
                            </button>
                            <button
                                onClick={(e) => { e.stopPropagation(); setCurrentImgIndex(prev => prev < images.length - 1 ? prev + 1 : 0) }}
                                style={{ position: 'absolute', right: '1rem', background: 'rgba(255,255,255,0.2)', color: 'white', border: 'none', borderRadius: '50%', padding: '0.5rem', cursor: 'pointer', backdropFilter: 'blur(4px)' }}
                            >
                                <ChevronRight />
                            </button>
                            {/* Dots */}
                            <div style={{ position: 'absolute', bottom: '1rem', display: 'flex', gap: '6px' }}>
                                {images.map((_, idx) => (
                                    <div key={idx} style={{ width: 8, height: 8, borderRadius: '50%', background: idx === currentImgIndex ? 'white' : 'rgba(255,255,255,0.4)' }} />
                                ))}
                            </div>
                        </>
                    )}
                </div>
                <div style={{ flex: 1, padding: '2rem', display: 'flex', flexDirection: 'column', background: 'white' }}>
                    <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '1.5rem' }}>
                        <h3 style={{ fontSize: '1.25rem', fontWeight: 700 }}>Revis√£o de Conte√∫do</h3>
                        <button onClick={onClose} style={{ border: 'none', background: 'none', cursor: 'pointer' }}><X /></button>
                    </div>
                    <div style={{ flex: 1, overflowY: 'auto' }}>
                        <p style={{ whiteSpace: 'pre-wrap', color: '#334155', lineHeight: 1.6 }}>{post.corpo_post}</p>
                    </div>
                    <div style={{ borderTop: '1px solid #e2e8f0', paddingTop: '1.5rem', marginTop: '1rem' }}>
                        {post.status.includes('approv') ? <div style={{ textAlign: 'center', padding: '1rem', background: '#dcfce7', color: '#166534', borderRadius: '12px', fontWeight: 600 }}>Este post j√° est√° aprovado! üöÄ</div> : (
                            <>
                                <textarea value={comment} onChange={e => setComment(e.target.value)} placeholder="Deixe um coment√°rio se precisar de ajustes..." style={{ width: '100%', height: '80px', padding: '0.75rem', border: '1px solid #cbd5e1', borderRadius: '8px', marginBottom: '1rem' }} />
                                <div style={{ display: 'flex', gap: '1rem' }}>
                                    <button onClick={() => handleAction('reject')} disabled={isSubmitting} style={{ flex: 1, padding: '1rem', border: '1px solid #ef4444', color: '#ef4444', background: 'white', borderRadius: '12px', fontWeight: 600, cursor: 'pointer' }}>Solicitar Ajuste</button>
                                    <button onClick={() => handleAction('approve')} disabled={isSubmitting} style={{ flex: 1, padding: '1rem', background: '#ea580c', color: 'white', border: 'none', borderRadius: '12px', fontWeight: 600, cursor: 'pointer' }}>Aprovar Agora</button>
                                </div>
                            </>
                        )}
                    </div>
                </div>
            </div>
        </div>
    )
}

// --- MAIN PAGE ---
const ClientInsightsPage = () => {
    // Legacy/Context access (still used for Admin Emulation or Standard Login)
    const { clientId: contextId, clientLegacyId, clientName: contextName } = useClientAuth()

    const [posts, setPosts] = useState([])
    const [questions, setQuestions] = useState([])
    const [status, setStatus] = useState('loading') // 'loading', 'success', 'error'
    const [errorMessage, setErrorMessage] = useState('')
    const [clientData, setClientData] = useState(null) // Local client data for Magic Link

    const [selectedQuestion, setSelectedQuestion] = useState(null)
    const [selectedPost, setSelectedPost] = useState(null)

    // "RADICAL SIMPLIFICATION" - Single Load Logic
    useEffect(() => {
        let isMounted = true

        const carregarDados = async () => {
            // 1. Detect Token Mode
            const pathname = window.location.pathname;
            const isMagicLink = pathname.includes('/portal/') && !pathname.includes('insights') && !pathname.includes('login');

            if (!isMagicLink) {
                // Not Magic Link -> Standard Context logic
                if (contextName && status !== 'success') {
                    // Check if context has valid data
                    supabase.from('tabela_projetofred1')
                        .select('*')
                        .eq('nome_cliente', contextName)
                        .order('created_at', { ascending: false })
                        .range(0, 49) // Pagina√ß√£o Auto (Limit 50)
                        .then(({ data }) => {
                            if (isMounted) {
                                setPosts(data || [])
                                setClientData({ name: contextName })
                                setStatus('success')
                            }
                        })
                }
                return;
            }

            console.log("Iniciando carga √∫nica (Magic Link)...");

            const token = pathname.split('/').pop();

            // 2. Busca Cliente
            const { data: cliente, error: erroCliente } = await supabase
                .from('clients')
                .select('*')
                .eq('access_token', token)
                .maybeSingle();

            if (erroCliente) console.error("Erro Cliente:", erroCliente);

            if (!cliente) {
                if (isMounted) {
                    setStatus('error');
                    setErrorMessage("Link inv√°lido ou expirado.");
                }
                return;
            }

            // 3. Busca Posts (Cruzando nome)
            const { data: postsData, error: erroPosts } = await supabase
                .from('tabela_projetofred1')
                .select('*')
                .eq('nome_cliente', cliente.name)
                .order('created_at', { ascending: false })
                .range(0, 49); // Pagina√ß√£o Auto

            if (erroPosts) console.error("Erro Posts:", erroPosts);

            // 4. Busca Perguntas (Via UUID id_client)
            let questionsData = [];
            if (cliente.id_client) {
                const { data: qData, error: qError } = await supabase
                    .from('interview_questions')
                    .select('*')
                    .eq('id_client', cliente.id_client)
                    .eq('status', 'pending')
                    .order('created_at', { ascending: false })
                    .range(0, 49); // Pagina√ß√£o Auto

                if (qError) console.error("Erro Questions:", qError);
                questionsData = qData || [];
            } else {
                console.warn("Cliente sem id_client (UUID) para buscar perguntas.");
            }

            if (isMounted) {
                setClientData(cliente);
                setPosts(postsData || []);
                setQuestions(questionsData);
                setStatus('success');
            }
        };

        carregarDados();

        return () => {
            isMounted = false
        }
    }, [contextName]); // Dependency on contextName helps trigger standard auth load if needed

    // --- HELPERS ---
    const handlePostReview = async (postId, status, comment) => {
        const { error } = await supabase.from('tabela_projetofred1').update({ status }).eq('id', postId)
        if (!error) {
            setPosts(prev => prev.map(p => p.id === postId ? { ...p, status } : p))
            if (status === 'aprovado') alert("Post aprovado com sucesso! üöÄ")
        }
    }
    const handleQuestionResponse = (qId) => setQuestions(prev => prev.filter(q => q.id !== qId))
    const getStatusStyle = (status) => {
        const s = (status || '').toUpperCase()
        if (s === 'WAITING_APPROVAL' || s === 'PENDING') return { bg: '#fef3c7', color: '#b45309', label: 'Aguardando Aprova√ß√£o', icon: <Clock size={12} /> }
        if (s === 'APPROVED' || s === 'APROVADO') return { bg: '#dcfce7', color: '#166534', label: 'Aprovado', icon: <CheckCircle2 size={12} /> }
        if (s === 'CHANGES_REQUESTED' || s.includes('REVI')) return { bg: '#f3e8ff', color: '#7e22ce', label: 'Altera√ß√£o Solicitada', icon: <Mic size={12} /> }
        if (s === 'POSTADO') return { bg: '#e0f2fe', color: '#0369a1', label: 'Publicado', icon: <Send size={12} /> }
        return { bg: '#f1f5f9', color: '#64748b', label: 'Status: ' + status, icon: <AlertCircle size={12} /> }
    }

    // MOVED TO TOP LEVEL SCOPE

    if (status === 'loading') {
        return (
            <div style={{ padding: '4rem', textAlign: 'center', color: '#64748b' }}>
                <h1>Carregando Portal... <Loader2 className="animate-spin inline ml-2" /></h1>
            </div>
        )
    }

    if (status === 'error') {
        return (
            <div style={{ padding: '4rem', textAlign: 'center' }}>
                <h1 style={{ color: '#ef4444' }}>Erro: {errorMessage}</h1>
            </div>
        )
    }

    // --- Filtering Logic ---
    const pendingPosts = posts.filter(p => {
        const s = (p.status || '').toUpperCase()
        return (s === 'WAITING_APPROVAL' || s === 'CHANGES_REQUESTED') && s !== 'POSTADO'
    })

    const scheduledPosts = posts.filter(p => {
        const s = (p.status || '').toUpperCase()
        return (s === 'APPROVED' || s === 'AGENDADO' || s === 'APROVADO') && s !== 'POSTADO'
    })

    const displayName = clientData?.name || contextName || 'Cliente';

    // SUCCESS RENDER
    return (
        <div className="insights-container">
            <style>{pageStyles}</style>

            {/* Header */}
            <div className="insights-header">
                <h1>Ol√°, {displayName}</h1>
                <p>
                    Voc√™ tem <span className="highlight-stats">{questions.length} perguntas pendentes</span> e <span className="highlight-stats">{posts.length} posts</span> na sua galeria.
                </p>
            </div>

            {/* Section: Posts Grid (MOVED TO TOP) */}
            {/* --- SE√á√ÉO: POSTAGENS PENDENTES --- */}
            <div className="mb-12">
                <h2 className="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                    <div className="w-2 h-8 bg-orange-500 rounded-full"></div>
                    Postagens Pendentes ({pendingPosts.length})
                </h2>

                <div className="flex flex-col gap-3">
                    {pendingPosts.length > 0 ? (
                        pendingPosts.map(post => (
                            <div key={post.id} className="bg-white border border-gray-200 rounded-lg p-4 flex items-center justify-between shadow-sm hover:shadow-md transition-all">
                                <div className="flex-1 pr-4">
                                    <h3 className="font-semibold text-gray-800 text-lg mb-1 line-clamp-1">{post.tema || 'Sem T√≠tulo'}</h3>
                                    <p className="text-sm text-gray-500 flex items-center gap-2">
                                        <Clock size={14} />
                                        {post.data_criacao ? new Date(post.data_criacao).toLocaleDateString('pt-BR') : 'Data N/A'}
                                        <span className="text-xs bg-orange-100 text-orange-700 px-2 py-0.5 rounded-full font-medium ml-2">
                                            {getStatusStyle(post.status).label}
                                        </span>
                                    </p>
                                </div>
                                <button
                                    onClick={() => window.location.href = `/post-feedback/${post.id}`}
                                    className="bg-gray-900 text-white px-6 py-2 rounded-lg font-medium text-sm hover:bg-gray-800 transition-colors shrink-0"
                                >
                                    Verificar
                                </button>
                            </div>
                        ))
                    ) : (
                        <div className="text-center py-8 bg-gray-50 rounded-lg border border-dashed border-gray-300">
                            <p className="text-gray-500">Nenhuma postagem pendente no momento.</p>
                        </div>
                    )}
                </div>
            </div>

            {/* --- SE√á√ÉO: POSTAGENS AGENDADAS / APROVADAS --- */}
            <div style={{ marginBottom: '4rem' }}>
                <h2 className="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                    <div className="w-2 h-8 bg-green-500 rounded-full"></div>
                    Postagens Agendadas ({scheduledPosts.length})
                </h2>

                <div className="flex flex-col gap-3">
                    {scheduledPosts.length > 0 ? (
                        scheduledPosts.map(post => (
                            <div key={post.id} className="bg-white border border-gray-200 rounded-lg p-4 flex items-center justify-between shadow-sm hover:shadow-md transition-all">
                                <div className="flex-1 pr-4">
                                    <h3 className="font-semibold text-gray-800 text-lg mb-1 line-clamp-1">{post.tema || 'Sem T√≠tulo'}</h3>
                                    <p className="text-sm text-gray-500 flex items-center gap-2">
                                        <CalendarClock size={14} />
                                        {post.data_agendamento ? new Date(post.data_agendamento).toLocaleDateString('pt-BR') : 'Agendamento N/A'}
                                        <span className="text-xs bg-green-100 text-green-700 px-2 py-0.5 rounded-full font-medium ml-2">
                                            {getStatusStyle(post.status).label}
                                        </span>
                                    </p>
                                </div>
                                <button
                                    onClick={() => window.location.href = `/post-feedback/${post.id}`}
                                    className="bg-white border border-gray-300 text-gray-700 px-6 py-2 rounded-lg font-medium text-sm hover:bg-gray-50 transition-colors shrink-0"
                                >
                                    Ver Detalhes
                                </button>
                            </div>
                        ))
                    ) : (
                        <div className="text-center py-8 bg-gray-50 rounded-lg border border-dashed border-gray-300">
                            <p className="text-gray-500">Nenhuma postagem agendada no momento.</p>
                        </div>
                    )}
                </div>
            </div>

            {/* Section: Questions (Pending) */}
            {questions.length > 0 && (
                <div style={{ marginBottom: '4rem' }}>
                    <h3 style={{ fontSize: '1.25rem', fontWeight: 700, color: '#334155', marginBottom: '1.5rem', display: 'flex', alignItems: 'center', gap: '8px' }}>
                        <Mic size={20} /> Perguntas Pendentes
                    </h3>
                    <div className="questions-list">
                        {questions.map(q => (
                            <div key={q.id} className="question-item">
                                <div style={{ display: 'flex', gap: '1rem', alignItems: 'center' }}>
                                    <div style={{ background: '#fef3c7', padding: '0.75rem', borderRadius: '50%', color: '#d97706' }}>
                                        <MessageSquare size={20} />
                                    </div>
                                    <div>
                                        <p style={{ fontWeight: 600, color: '#1e293b', marginBottom: '4px' }}>{q.question_text}</p>
                                        <span style={{ fontSize: '0.875rem', color: '#64748b' }}>Aguardando sua resposta</span>
                                    </div>
                                </div>
                                <button
                                    onClick={() => setSelectedQuestion(q)}
                                    style={{ padding: '0.75rem 1.5rem', background: '#7c3aed', color: 'white', border: 'none', borderRadius: '12px', fontWeight: 600, cursor: 'pointer', display: 'flex', alignItems: 'center', gap: '8px' }}
                                >
                                    Responder <ChevronRight size={16} />
                                </button>
                            </div>
                        ))}
                    </div>
                </div>
            )}

            {/* Section: Content Calendar (MOVED TO BOTTOM) */}
            {posts.length > 0 && (
                <ContentCalendar posts={posts} />
            )}

            {/* Modals */}
            {selectedQuestion && <QuestionResponseModal question={selectedQuestion} onClose={() => setSelectedQuestion(null)} onResponseSent={handleQuestionResponse} />}
            {selectedPost && <PostReviewModal post={selectedPost} onClose={() => setSelectedPost(null)} onReview={handlePostReview} />}
        </div >
    )
}

export default ClientInsightsPage

```

## File: src\pages\ClientLoginPage.jsx
```javascript
import React, { useState } from 'react'
import { supabase } from '../services/supabaseClient'
import { useNavigate } from 'react-router-dom'
import { Loader2, Lock } from 'lucide-react'

const ClientLoginPage = () => {
    const [email, setEmail] = useState('')
    const [password, setPassword] = useState('')
    const [loading, setLoading] = useState(false)
    const [error, setError] = useState(null)
    const navigate = useNavigate()

    const handleLogin = async (e) => {
        e.preventDefault()
        setLoading(true)
        setError(null)

        try {
            const { data, error: signInError } = await supabase.auth.signInWithPassword({
                email,
                password
            })

            if (signInError) throw signInError

            // Check if user is actually a client
            const { data: profile, error: profileError } = await supabase
                .from('profiles')
                .select('role')
                .eq('id', data.user.id)
                .single()

            if (profileError) throw profileError

            if (profile.role !== 'client') {
                await supabase.auth.signOut()
                throw new Error('Acesso n√£o autorizado. Apenas clientes podem acessar esta √°rea.')
            }

            // Success redirect
            navigate('/portal/insights')

        } catch (err) {
            console.error(err)
            setError(err.message || 'Falha no login')
        } finally {
            setLoading(false)
        }
    }

    return (
        <div style={{
            minHeight: '100vh',
            display: 'flex',
            flexDirection: 'column',
            justifyContent: 'center',
            alignItems: 'center',
            background: 'linear-gradient(to bottom, #f3f4f6, #ffffff)', // bg-gray-100 to white
            fontFamily: "'Inter', sans-serif",
            padding: '1rem'
        }}>

            {/* --- LOGO (OUTSIDE CARD) --- */}
            <img
                src="/logo-linklead.png"
                alt="Link&Lead Logo"
                style={{
                    height: '64px', // h-16
                    width: 'auto',
                    marginBottom: '2rem', // mb-8
                    display: 'block'
                }}
            />

            {/* --- MAIN CARD --- */}
            <div style={{
                background: '#ffffff',
                width: '100%',
                maxWidth: '480px', // max-w-md (approx)
                borderRadius: '16px', // rounded-2xl
                boxShadow: '0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1)', // shadow-xl
                padding: '3rem', // p-10/12
                boxSizing: 'border-box'
            }}>
                <div style={{ textAlign: 'center', marginBottom: '2rem' }}>
                    <h1 style={{
                        fontSize: '1.875rem', // text-3xl
                        fontWeight: 700,
                        color: '#111827', // text-gray-900
                        marginBottom: '0.5rem'
                    }}>
                        Bem-vindo de volta
                    </h1>
                    <p style={{
                        color: '#4b5563', // text-gray-600
                        fontSize: '0.95rem'
                    }}>
                        Acesse o Portal do Cliente Link&Lead
                    </p>
                </div>

                {error && (
                    <div style={{
                        background: '#fef2f2',
                        border: '1px solid #fee2e2',
                        color: '#ef4444',
                        padding: '1rem',
                        borderRadius: '8px',
                        marginBottom: '1.5rem',
                        fontSize: '0.875rem',
                        textAlign: 'center'
                    }}>
                        {error}
                    </div>
                )}

                <form onSubmit={handleLogin}>
                    <div style={{ marginBottom: '1.5rem' }}>
                        <label style={{
                            display: 'block',
                            fontSize: '0.875rem',
                            fontWeight: 600,
                            color: '#374151', // text-gray-700
                            marginBottom: '0.5rem'
                        }}>
                            Email Corporativo
                        </label>
                        <input
                            type="email"
                            value={email}
                            onChange={e => setEmail(e.target.value)}
                            required
                            className="clean-input"
                            placeholder="seu@empresa.com"
                        />
                    </div>

                    <div style={{ marginBottom: '2rem' }}>
                        <label style={{
                            display: 'block',
                            fontSize: '0.875rem',
                            fontWeight: 600,
                            color: '#374151',
                            marginBottom: '0.5rem'
                        }}>
                            Senha
                        </label>
                        <input
                            type="password"
                            value={password}
                            onChange={e => setPassword(e.target.value)}
                            required
                            className="clean-input"
                            placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                        />
                    </div>

                    <button
                        type="submit"
                        disabled={loading}
                        className="clean-button"
                    >
                        {loading && <Loader2 className="spinner" size={20} />}
                        {loading ? 'Validando...' : 'Entrar na Plataforma'}
                    </button>
                </form>
            </div>

            <style>{`
                .clean-input {
                    display: block;
                    width: 100%;
                    padding: 0.875rem 1rem; /* py-3.5 */
                    background-color: #f9fafb; /* bg-gray-50 */
                    border: 1px solid #d1d5db; /* border-gray-300 */
                    border-radius: 8px;
                    color: #111827; /* text-gray-900 */
                    font-size: 1rem;
                    line-height: 1.5;
                    outline: none;
                    transition: all 0.2s ease-in-out;
                }
                .clean-input:focus {
                    background-color: #ffffff;
                    border-color: #f97316; /* orange-500 */
                    box-shadow: 0 0 0 4px rgba(249, 115, 22, 0.15); /* ring-orange-500/15 */
                }
                .clean-input::placeholder {
                    color: #9ca3af; /* text-gray-400 */
                }

                .clean-button {
                    width: 100%;
                    padding: 0.875rem;
                    background: linear-gradient(to right, #ea580c, #fb923c); /* brand gradient */
                    color: white;
                    border: none;
                    border-radius: 8px;
                    font-weight: 600;
                    font-size: 1.125rem; /* text-lg */
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    gap: 10px;
                    transition: all 0.2s ease;
                    box-shadow: 0 4px 6px -1px rgba(234, 88, 12, 0.4);
                }
                .clean-button:hover:not(:disabled) {
                    filter: brightness(1.05); /* slightly lighter */
                    transform: translateY(-1px);
                    box-shadow: 0 10px 15px -3px rgba(234, 88, 12, 0.3);
                }
                .clean-button:disabled {
                    opacity: 0.7;
                    cursor: not-allowed;
                    filter: grayscale(1);
                }

                .spinner {
                    animation: spin 1s linear infinite;
                }
                @keyframes spin { 
                    to { transform: rotate(360deg); } 
                }
            `}</style>
        </div>
    )
}

export default ClientLoginPage

```

## File: src\pages\ClientPortal.css
```css
.client-container {
    min-height: 100vh;
    background-color: #f3f4f6;
    font-family: 'Inter', system-ui, -apple-system, sans-serif;
    padding-bottom: 120px;
    /* Space for fixed footer/banners */
}

.client-header {
    background: white;
    padding: 1rem 1.5rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid #e5e7eb;
    position: sticky;
    top: 0;
    z-index: 10;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
}

.logo-area {
    font-weight: 700;
    color: #111827;
    font-size: 1.1rem;
}

.status-badge {
    padding: 0.25rem 0.75rem;
    border-radius: 999px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
}

.status-aprovado {
    background-color: #dcfce7;
    color: #166534;
}

.status-revis√£o,
.status-revisao {
    background-color: #fef9c3;
    color: #854d0e;
}

.status-aguardando,
.status-aguardando-aprova√ß√£o {
    background-color: #e0f2fe;
    color: #075985;
}

.status-postado {
    background-color: #f3e8ff;
    color: #6b21a8;
}

.post-view {
    max-width: 600px;
    margin: 2rem auto;
    padding: 0 1rem;
}

.post-card {
    background: white;
    border-radius: 12px;
    padding: 2rem;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
}

.post-title {
    font-size: 1.5rem;
    font-weight: 800;
    color: #111827;
    margin-top: 0;
    margin-bottom: 0.5rem;
    line-height: 1.3;
}

.post-meta {
    margin-bottom: 1.5rem;
}

.post-meta span {
    background-color: #f3f4f6;
    color: #4b5563;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.8rem;
    font-weight: 500;
}

.post-body p {
    line-height: 1.7;
    color: #374151;
    margin-bottom: 1rem;
    font-size: 1.05rem;
}

.post-body ul {
    padding-left: 1.25rem;
    margin-bottom: 1rem;
}

.post-body li {
    margin-bottom: 0.5rem;
    color: #374151;
}

.post-body strong {
    color: #111827;
}

.image-suggestion-box {
    background-color: #f8fafc;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    padding: 1.25rem;
    display: flex;
    gap: 1rem;
    margin-top: 2rem;
    align-items: flex-start;
}

.box-icon {
    color: #64748b;
}

.box-content strong {
    display: block;
    font-size: 0.9rem;
    color: #0f172a;
    margin-bottom: 0.25rem;
}

.box-content p {
    margin: 0;
    color: #475569;
    font-size: 0.95rem;
    line-height: 1.5;
}

/* Footer Actions */
.action-footer {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    background: white;
    border-top: 1px solid #e5e7eb;
    padding: 1rem;
    box-shadow: 0 -4px 6px -1px rgba(0, 0, 0, 0.05);
    box-sizing: border-box;
    z-index: 20;
}

.button-group {
    display: flex;
    gap: 1rem;
    max-width: 600px;
    margin: 0 auto;
}

.button-group button,
.feedback-actions button {
    flex: 1;
    padding: 0.875rem;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    border: none;
    font-size: 1rem;
    transition: transform 0.1s;
}

.button-group button:active {
    transform: scale(0.98);
}

.btn-approve {
    background-color: #10b981;
    color: white;
}

.btn-revise {
    background-color: #ffffff;
    border: 1px solid #e5e7eb !important;
    color: #374151;
}

.btn-revise:hover {
    background-color: #f9fafb;
}

/* Feedback Mode */
.feedback-area {
    max-width: 600px;
    margin: 0 auto;
}

.feedback-area textarea {
    width: 100%;
    height: 100px;
    border: 1px solid #cbd5e1;
    border-radius: 8px;
    padding: 0.75rem;
    margin-bottom: 1rem;
    font-family: inherit;
    font-size: 1rem;
    resize: vertical;
    box-sizing: border-box;
}

.feedback-actions {
    display: flex;
    gap: 0.75rem;
}

.btn-cancel {
    background: transparent;
    color: #64748b;
    border: 1px solid transparent !important;
}

.btn-confirm-change {
    background-color: #2563eb;
    color: white;
}

/* ALERTS & BANNERS */
.success-banner {
    position: fixed;
    bottom: 2rem;
    left: 50%;
    transform: translateX(-50%);
    background-color: #10b981;
    color: white;
    padding: 1rem 2rem;
    border-radius: 999px;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-weight: 600;
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    animation: slideUp 0.3s ease-out;
    z-index: 30;
    width: max-content;
}

.info-banner {
    max-width: 600px;
    margin: 2rem auto;
    padding: 1.5rem;
    border-radius: 8px;
    display: flex;
    align-items: center;
    gap: 1rem;
    font-weight: 600;
}

.info-banner.success {
    background-color: #dcfce7;
    color: #166534;
    border: 1px solid #bbf7d0;
}

.info-banner.purple {
    background-color: #f3e8ff;
    color: #6b21a8;
    border: 1px solid #e9d5ff;
}

@keyframes slideUp {
    from {
        transform: translate(-50%, 100%);
        opacity: 0;
    }

    to {
        transform: translate(-50%, 0);
        opacity: 1;
    }
}

.loading-screen,
.error-screen {
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #64748b;
    gap: 0.5rem;
}

/* Mobile Adjustments */
@media (max-width: 640px) {
    .post-card {
        padding: 1.5rem;
        border-radius: 0;
        box-shadow: none;
    }

    .post-view {
        margin: 0;
        padding: 0;
    }
}

.client-badge-display {
    display: inline-block;
    background-color: #f1f5f9;
    color: #475569;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    margin-bottom: 0.5rem;
}
```

## File: src\pages\ClientPortal.jsx
```javascript

import React, { useEffect, useState } from 'react'
import { useSearchParams } from 'react-router-dom'
import { supabase } from '../services/supabaseClient'
import { CheckCircle, Edit3, Image as ImageIcon, Loader2 } from 'lucide-react'
import ReactMarkdown from 'react-markdown'
import './ClientPortal.css'

const ClientPortal = () => {
    const [searchParams] = useSearchParams()
    const id = searchParams.get('id')

    const [post, setPost] = useState(null)
    const [loading, setLoading] = useState(true)
    const [error, setError] = useState(null)

    const [feedbackMode, setFeedbackMode] = useState(false)
    const [feedbackText, setFeedbackText] = useState('')
    const [actionLoading, setActionLoading] = useState(false)
    const [successMessage, setSuccessMessage] = useState(null)

    useEffect(() => {
        const numericId = parseInt(id, 10);
        if (!id || isNaN(numericId)) {
            setError('ID do projeto inv√°lido ou n√£o fornecido.');
            setLoading(false);
            return;
        }
        fetchPost(numericId);
    }, [id]);

    const fetchPost = async (numericId) => {
        setLoading(true);
        try {
            const { data, error } = await supabase
                .from('tabela_projetofred1')
                .select('*')
                .eq('id', numericId)
                .single();

            if (error) {
                // PGRST116 means no rows returned (JSON) or row count 0
                if (error.code === 'PGRST116') {
                    throw new Error('Post n√£o encontrado ou acesso negado.');
                }
                throw error;
            }

            if (!data) {
                throw new Error('Post n√£o encontrado.');
            }

            setPost(data);
        } catch (err) {
            console.error(err);
            setError(err.message || 'Erro ao carregar o post.');
        } finally {
            setLoading(false);
        }
    }

    const handleApprove = async () => {
        setActionLoading(true)
        try {
            const { error } = await supabase
                .from('tabela_projetofred1')
                .update({ status: 'Aprovado' })
                .eq('id', id)

            if (error) throw error

            setPost(prev => ({ ...prev, status: 'Aprovado' }))
            setSuccessMessage('Conte√∫do aprovado! Em breve ser√° publicado.')
        } catch (err) {
            alert('Erro ao aprovar: ' + err.message)
        } finally {
            setActionLoading(false)
        }
    }

    const handleRequestChange = async () => {
        if (!feedbackText.trim()) return

        setActionLoading(true)
        try {
            const { error } = await supabase
                .from('tabela_projetofred1')
                .update({
                    status: 'Revis√£o',
                    feedback_cliente: feedbackText
                })
                .eq('id', id)

            if (error) throw error

            setPost(prev => ({ ...prev, status: 'Revis√£o', feedback_cliente: feedbackText }))
            setFeedbackMode(false)
            setSuccessMessage('Solicita√ß√£o enviada. Vamos ajustar para voc√™!')
        } catch (err) {
            alert('Erro ao enviar feedback: ' + err.message)
        } finally {
            setActionLoading(false)
        }
    }

    if (loading) return <div className="loading-screen"><Loader2 className="spinner" /> Carregando post...</div>
    if (error) return <div className="error-screen">{error}</div>
    if (!post) return null

    // Logic to determine if footer info should be shown or if actions are available
    const isApproved = post.status?.toLowerCase().includes('aprovado')
    const isPosted = post.status?.toLowerCase().includes('postado')
    const isActionable = !isApproved && !isPosted && !successMessage

    return (
        <div className="client-container">
            <header className="client-header">
                <div className="logo-area">Portal de Aprova√ß√£o</div>
                <div className={`status-badge status-${post.status?.toLowerCase().replace(/\s/g, '-')}`}>
                    {post.status || 'Aguardando'}
                </div>
            </header>

            <main className="post-view">
                <article className="post-card">
                    {post.nome_cliente && (
                        <div className="client-badge-display">
                            Cliente: {post.nome_cliente}
                        </div>
                    )}
                    <h1 className="post-title">{post.titulo_hook || 'Sem T√≠tulo'}</h1>

                    <div className="post-meta">
                        <span>#{post.tema}</span>
                    </div>

                    <div className="post-body">
                        <ReactMarkdown>{post.corpo_post || 'Conte√∫do vazio...'}</ReactMarkdown>
                    </div>

                    {post.sugestao_imagem && (
                        <div className="image-suggestion-box">
                            <div className="box-icon">
                                <ImageIcon size={24} />
                            </div>
                            <div className="box-content">
                                <strong>Sugest√£o de Imagem:</strong>
                                <p>{post.sugestao_imagem}</p>
                            </div>
                        </div>
                    )}
                </article>
            </main>

            {/* Success Banner (after action in this session) */}
            {successMessage && (
                <div className="success-banner">
                    <CheckCircle /> {successMessage}
                </div>
            )}

            {/* Permanent State Banners (if status loaded from DB) */}
            {!successMessage && isApproved && (
                <div className="info-banner success">
                    <CheckCircle size={20} /> Este post j√° foi aprovado.
                </div>
            )}

            {!successMessage && isPosted && (
                <div className="info-banner purple">
                    <CheckCircle size={20} /> Este conte√∫do j√° foi publicado no LinkedIn.
                </div>
            )}

            {/* Actions Footer */}
            {isActionable && (
                <footer className="action-footer">
                    {feedbackMode ? (
                        <div className="feedback-area">
                            <textarea
                                placeholder="Descreva o que precisa ser alterado..."
                                value={feedbackText}
                                onChange={(e) => setFeedbackText(e.target.value)}
                            />
                            <div className="feedback-actions">
                                <button className="btn-cancel" onClick={() => setFeedbackMode(false)}>Cancelar</button>
                                <button className="btn-confirm-change" onClick={handleRequestChange} disabled={actionLoading}>
                                    {actionLoading ? 'Enviando...' : 'Enviar Feedback'}
                                </button>
                            </div>
                        </div>
                    ) : (
                        <div className="button-group">
                            <button
                                className="btn-revise"
                                onClick={() => setFeedbackMode(true)}
                            >
                                <Edit3 size={18} /> Solicitar Altera√ß√£o
                            </button>
                            <button
                                className="btn-approve"
                                onClick={handleApprove}
                            >
                                <CheckCircle size={18} /> Aprovar Post
                            </button>
                        </div>
                    )}
                </footer>
            )}
        </div>
    )
}

export default ClientPortal

```

## File: src\pages\ClientsPage.jsx
```javascript
import React, { useEffect, useState } from 'react';
import { supabase } from '../services/supabaseClient';
import { useAuth } from '../contexts/AuthContext'; // Import Auth
import { Pencil, Upload, FileText, X, Check, Link as LinkIcon, Info, AlertTriangle, Linkedin } from 'lucide-react';

const N8N_UPLOAD_DOC_URL = 'https://n8n-n8n-start.kfocge.easypanel.host/webhook/upload-client-doc'

export default function ClientsPage() {
    const { user } = useAuth(); // Hook Auth
    const [clients, setClients] = useState([]);
    const [loading, setLoading] = useState(true);
    const [showModal, setShowModal] = useState(false);
    const [saving, setSaving] = useState(false);
    const [editingClient, setEditingClient] = useState(null);
    const [toast, setToast] = useState(null); // { message, type }

    // ... (rest of local state) ...
    // Note: I am NOT changing the lines between 14-27, just re-stating them if needed for context but 'replace_file_content' replaces the block.
    // To minimize context, I will target specific blocks if possible, but multiple edits are needed.
    // Better to use a single large block or multiple chunks?
    // I will use multiple chunks with multi_replace_file_content logic simulated via single call if continuous, or just use replace_file_content for the whole file? No, too large.
    // I will use replace_file_content for the imports and state first.
    // Wait, I can't do multiple disparate chunks with replace_file_content.
    // I should use `multi_replace_file_content` if available? 
    // Checking tools... `multi_replace_file_content` IS available. 
    // I will use `default_api:multi_replace_file_content`.
    // Wait, the user prompt showed `default_api:replace_file_content` and `default_api:multi_replace_file_content` descriptors.
    // Yes, I have `multi_replace_file_content`.

    // Proceeding with `multi_replace_file_content`.

    // Chunk 1: Imports
    // Chunk 2: Toast State
    // Chunk 3: handleCopyLink function
    // Chunk 4: Button in Table
    // Chunk 5: Toast UI render


    // ... (rest of local state) ...

    // File Upload State
    const [filesToUpload, setFilesToUpload] = useState([]);
    const [existingFiles, setExistingFiles] = useState([]);

    const [formData, setFormData] = useState({
        name: '',
        description: '',
        tone_of_voice: 'Profissional',
        target_audience_default: '',
        pain_points: '',
        unipile_account_id: ''
    });

    useEffect(() => {
        fetchClients();
    }, []);

    async function fetchClients() {
        try {
            setLoading(true);
            const { data, error } = await supabase.from('clients').select('*').order('created_at', { ascending: false });
            if (error) throw error;
            setClients(data || []);
        } catch (error) {
            console.error('Erro ao buscar clientes:', error);
        } finally {
            setLoading(false);
        }
    }

    async function fetchClientFiles(clientId) {
        try {
            const { data, error } = await supabase
                .from('client_knowledge')
                .select('*')
                .eq('client_id', clientId);

            if (error) throw error;
            setExistingFiles(data || []);
        } catch (error) {
            console.error('Erro ao buscar arquivos do cliente:', error);
        }
    }

    const handleInputChange = (e) => {
        const { name, value } = e.target;
        setFormData(prev => ({
            ...prev,
            [name]: value
        }));
    };

    const handleFileChange = (e) => {
        if (e.target.files && e.target.files.length > 0) {
            const newFiles = Array.from(e.target.files);
            setFilesToUpload(prev => [...prev, ...newFiles]);
        }
    };

    const removeFileToUpload = (index) => {
        setFilesToUpload(prev => prev.filter((_, i) => i !== index));
    };

    const handleEdit = (client) => {
        setEditingClient(client);
        setFormData({
            name: client.name || '',
            description: client.description || '',
            tone_of_voice: client.tone_of_voice || 'Profissional',
            target_audience_default: client.target_audience_default || '',
            pain_points: client.pain_points || '',
            unipile_account_id: client.unipile_account_id || ''
        });
        setFilesToUpload([]);
        setExistingFiles([]);
        fetchClientFiles(client.id);
        setShowModal(true);
    };

    const handleNew = () => {
        setEditingClient(null);
        setFormData({
            name: '',
            description: '',
            tone_of_voice: 'Profissional',
            target_audience_default: '',
            pain_points: '',
            unipile_account_id: ''
        });
        setFilesToUpload([]);
        setExistingFiles([]);
        setShowModal(true);
    };

    const handleDelete = async () => {
        if (!editingClient || !window.confirm('Tem certeza que deseja excluir este cliente? Esta a√ß√£o n√£o pode ser desfeita.')) return;

        setSaving(true);
        try {
            const { error } = await supabase
                .from('clients')
                .delete()
                .eq('id', editingClient.id);

            if (error) throw error;

            setShowModal(false);
            fetchClients();
            alert('Cliente exclu√≠do com sucesso!');
        } catch (error) {
            console.error('Erro ao excluir:', error);
            alert('Erro ao excluir: ' + error.message);
        } finally {
            setSaving(false);
        }
    };

    const handleCopyLink = (client) => {
        if (!client.access_token) {
            alert("Este cliente n√£o possui um token de acesso.");
            return;
        }
        const link = `${window.location.origin}/portal/${client.access_token}`;
        navigator.clipboard.writeText(link);

        setToast({ message: "Link de acesso copiado!", type: "success" });
        setTimeout(() => setToast(null), 3000);
    };

    const sanitizeFileName = (originalName) => {
        return originalName.replace(/[^a-zA-Z0-9.]/g, '_');
    };

    const uploadFiles = async (clientId) => {
        if (!filesToUpload || filesToUpload.length === 0) return;

        console.log(`[DEBUG] uploadFiles chamado com clientID: ${clientId} (Tipo: ${typeof clientId})`);

        for (const file of filesToUpload) {
            if (!file) continue;

            console.log(`[DEBUG] Preparando envio de ${file.name} para webhook`);

            // Create FormData with file and clientId
            const formData = new FormData();
            formData.append('file', file);
            formData.append('clientId', clientId);

            console.log(`[DEBUG] Enviando para webhook: ${N8N_UPLOAD_DOC_URL}`);

            try {
                const response = await fetch(N8N_UPLOAD_DOC_URL, {
                    method: 'POST',
                    body: formData
                    // Note: Do NOT set Content-Type header - browser will set it automatically with boundary
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`Webhook retornou erro ${response.status}: ${errorText}`);
                }

                const result = await response.json();
                console.log(`[DEBUG] Upload de ${file.name} conclu√≠do:`, result);

            } catch (error) {
                console.error(`[DEBUG] Erro ao enviar ${file.name} para webhook:`, error);
                throw new Error(`Falha no upload de "${file.name}": ${error.message}`);
            }
        }
    };

    const handleSubmit = async (e) => {
        e.preventDefault(); // 1. Prevent Default
        console.log("1. Iniciou handleSave");
        setSaving(true);

        try {
            console.log("2. User ID:", user?.id);

            // PAYLOAD CONSTRUCTION & LOGGING
            let payload = {};
            try {
                payload = {
                    name: formData.name,
                    description: formData.description,
                    tone_of_voice: formData.tone_of_voice,
                    target_audience_default: formData.target_audience_default,
                    pain_points: formData.pain_points,
                    unipile_account_id: formData.unipile_account_id
                    // Add other fields here if needed
                };
                console.log("3. Payload montado:", payload);
            } catch (payloadError) {
                throw new Error("Erro ao montar o payload: " + payloadError.message);
            }

            // --- EXECUTE SUPABASE CALLS AFTER PAYLOAD IS READY ---
            let clientData = null;
            let realClientId = null;

            if (editingClient) {
                console.log("[DEBUG] Atualizando cliente existente...", editingClient.id);
                const { data, error } = await supabase
                    .from('clients')
                    .update(payload) // Use the constructed payload
                    .eq('id', editingClient.id)
                    .select()
                    .single();

                if (error) throw error;
                clientData = data;
            } else {
                console.log("[DEBUG] Criando novo cliente...");
                const { data, error } = await supabase
                    .from('clients')
                    .insert([payload]) // Use the constructed payload
                    .select()
                    .single();

                if (error) throw error;
                clientData = data;
            }

            // SAFETY CHECKS
            if (!clientData) throw new Error("Erro cr√≠tico: Dados do cliente n√£o retornaram do banco.");
            realClientId = clientData.id;
            console.log("[DEBUG] ID Num√©rico capturado:", realClientId);
            if (!realClientId) throw new Error("Erro cr√≠tico: ID do cliente √© inv√°lido.");

            // UPLOAD
            if (filesToUpload.length > 0) {
                console.log(`[DEBUG] Iniciando uploads para ID: ${realClientId}`);
                await uploadFiles(realClientId);
            }

            // SUCCESS
            alert(editingClient ? 'Cliente atualizado com sucesso!' : 'Cliente cadastrado com sucesso!');
            setShowModal(false);
            fetchClients();

        } catch (error) {
            console.error("ERRO CR√çTICO NO SALVAMENTO:", error);
            alert("Erro: " + (error.message || "Erro desconhecido"));
        } finally {
            console.log("[DEBUG] Finalizando processo (finally).");
            setSaving(false);
        }
    };

    return (
        <div style={{ padding: '2rem' }}>
            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1.5rem' }}>
                <h1 style={{ fontSize: '1.5rem', fontWeight: 'bold', color: '#1f2937' }}>Gerenciar Clientes</h1>
                <button
                    onClick={handleNew}
                    style={{
                        backgroundColor: '#ea580c',
                        color: 'white',
                        padding: '0.5rem 1rem',
                        borderRadius: '0.25rem',
                        border: 'none',
                        cursor: 'pointer'
                    }}
                >
                    + Novo Cliente
                </button>
            </div>

            {loading ? (
                <p>Carregando...</p>
            ) : (
                <div style={{ background: 'white', boxShadow: '0 1px 3px 0 rgba(0, 0, 0, 0.1)', borderRadius: '0.5rem', overflow: 'hidden' }}>
                    <table style={{ width: '100%', textAlign: 'left', borderCollapse: 'collapse' }}>
                        <thead style={{ background: '#f9fafb', borderBottom: '1px solid #e5e7eb' }}>
                            <tr>
                                <th style={{ padding: '1rem', fontWeight: '600', color: '#4b5563' }}>Empresa</th>
                                <th style={{ padding: '1rem', fontWeight: '600', color: '#4b5563' }}>Descri√ß√£o</th>
                                <th style={{ padding: '1rem', fontWeight: '600', color: '#4b5563' }}>Tom de Voz</th>
                                <th style={{ padding: '1rem', fontWeight: '600', color: '#4b5563', width: '120px' }}>Conex√£o</th>
                                <th style={{ padding: '1rem', fontWeight: '600', color: '#4b5563', textAlign: 'right' }}>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody>
                            {clients.length === 0 ? (
                                <tr>
                                    <td colSpan="4" style={{ padding: '2rem', textAlign: 'center', color: '#6b7280' }}>
                                        Nenhum cliente cadastrado.
                                    </td>
                                </tr>
                            ) : (
                                clients.map((client) => (
                                    <tr key={client.id} style={{ borderBottom: '1px solid #e5e7eb' }}>
                                        <td style={{ padding: '1rem', fontWeight: '500' }}>{client.name}</td>
                                        <td style={{ padding: '1rem', color: '#6b7280', fontSize: '0.875rem', maxWidth: '20rem', whiteSpace: 'nowrap', overflow: 'hidden', textOverflow: 'ellipsis' }}>
                                            {client.description}
                                        </td>
                                        <td style={{ padding: '1rem', fontSize: '0.875rem' }}>{client.tone_of_voice}</td>
                                        <td style={{ padding: '1rem' }}>
                                            {client.unipile_account_id ? (
                                                <div style={{ display: 'flex', alignItems: 'center', gap: '4px', color: '#0077b5', fontSize: '0.8rem', fontWeight: '600' }}>
                                                    <Linkedin size={16} /> OK
                                                </div>
                                            ) : (
                                                <div style={{ display: 'flex', alignItems: 'center', gap: '4px', color: '#9ca3af', fontSize: '0.8rem' }} title="Pendente Unipile ID">
                                                    <AlertTriangle size={16} /> Pendente
                                                </div>
                                            )}
                                        </td>
                                        <td style={{ padding: '1rem', textAlign: 'right' }}>
                                            <button
                                                onClick={() => handleCopyLink(client)}
                                                style={{
                                                    background: 'transparent',
                                                    border: 'none',
                                                    cursor: 'pointer',
                                                    color: '#16a34a', // Green
                                                    padding: '0.25rem',
                                                    marginRight: '0.5rem'
                                                }}
                                                title="Copiar Link de Acesso"
                                            >
                                                <LinkIcon size={18} />
                                            </button>
                                            <button
                                                onClick={() => handleEdit(client)}
                                                style={{
                                                    background: 'transparent',
                                                    border: 'none',
                                                    cursor: 'pointer',
                                                    color: '#2563eb',
                                                    padding: '0.25rem'
                                                }}
                                                title="Editar / Ver Detalhes"
                                            >
                                                <Pencil size={18} />
                                            </button>
                                        </td>
                                    </tr>
                                ))
                            )}
                        </tbody>
                    </table>
                </div>
            )}

            {/* TOAST */}
            {toast && (
                <div style={{
                    position: 'fixed',
                    bottom: '2rem',
                    right: '2rem',
                    background: toast.type === 'error' ? '#ef4444' : '#22c55e',
                    color: 'white',
                    padding: '1rem 1.5rem',
                    borderRadius: '8px',
                    boxShadow: '0 4px 6px rgba(0,0,0,0.1)',
                    display: 'flex',
                    alignItems: 'center',
                    gap: '8px',
                    zIndex: 100,
                    animation: 'slideIn 0.3s ease-out'
                }}>
                    <Check size={18} />
                    <span style={{ fontWeight: 600 }}>{toast.message}</span>
                </div>
            )}

            {/* MODAL */}
            {showModal && (
                <div style={{
                    position: 'fixed', top: 0, left: 0, right: 0, bottom: 0,
                    background: 'rgba(0,0,0,0.5)', display: 'flex', justifyContent: 'center', alignItems: 'center', zIndex: 50
                }}>
                    <div style={{ background: 'white', padding: '2rem', borderRadius: '0.5rem', width: '100%', maxWidth: '500px', maxHeight: '90vh', overflowY: 'auto' }}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1rem' }}>
                            <h2 style={{ margin: 0 }}>
                                {editingClient ? 'Editar Cliente' : 'Novo Cliente'}
                            </h2>
                            <button
                                type="button"
                                onClick={() => setShowModal(false)}
                                style={{
                                    background: 'transparent',
                                    border: 'none',
                                    cursor: 'pointer',
                                    color: '#6b7280',
                                    padding: '4px',
                                    borderRadius: '50%',
                                    display: 'flex',
                                    alignItems: 'center',
                                    justifyContent: 'center',
                                    transition: 'background 0.2s'
                                }}
                                onMouseEnter={(e) => e.currentTarget.style.background = '#f3f4f6'}
                                onMouseLeave={(e) => e.currentTarget.style.background = 'transparent'}
                            >
                                <X size={24} />
                            </button>
                        </div>
                        <form onSubmit={handleSubmit} style={{ display: 'flex', flexDirection: 'column', gap: '1rem' }}>

                            {/* Unipile ID Section - Priority */}
                            <div style={{ background: '#eff6ff', border: '1px solid #bfdbfe', borderRadius: '6px', padding: '1rem' }}>
                                <div style={{ display: 'flex', gap: '0.75rem', marginBottom: '0.75rem' }}>
                                    <Info style={{ color: '#2563eb', flexShrink: 0, marginTop: '2px' }} size={20} />
                                    <div>
                                        <h4 style={{ margin: '0 0 0.25rem 0', fontSize: '0.9rem', color: '#1e40af' }}>Integra√ß√£o LinkedIn (Obrigat√≥rio)</h4>
                                        <p style={{ margin: 0, fontSize: '0.8rem', color: '#1e3a8a', lineHeight: '1.4' }}>
                                            ‚ö†Ô∏è Importante: Para obter este ID, voc√™ deve primeiro conectar o perfil do LinkedIn deste cliente manualmente atrav√©s do Dashboard da Unipile. Copie o <strong>'Account ID'</strong> gerado l√° e cole abaixo.
                                        </p>
                                    </div>
                                </div>
                                <div>
                                    <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.85rem', fontWeight: 'bold', color: '#1e3a8a' }}>
                                        ID da Conta Unipile (LinkedIn)
                                    </label>
                                    <input
                                        name="unipile_account_id"
                                        value={formData.unipile_account_id}
                                        onChange={handleInputChange}
                                        placeholder="Ex: f7NRx9..."
                                        style={{ width: '100%', padding: '0.5rem', border: '1px solid #93c5fd', borderRadius: '4px', fontFamily: 'monospace', color: '#1f2937' }}
                                    />
                                </div>
                            </div>

                            <div>
                                <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.875rem' }}>Nome da Empresa</label>
                                <input
                                    required
                                    name="name"
                                    value={formData.name}
                                    onChange={handleInputChange}
                                    style={{ width: '100%', padding: '0.5rem', border: '1px solid #d1d5db', borderRadius: '0.25rem', color: '#1f2937' }}
                                />
                            </div>

                            <div>
                                <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.875rem' }}>Descri√ß√£o do Neg√≥cio</label>
                                <textarea
                                    required
                                    name="description"
                                    value={formData.description}
                                    onChange={handleInputChange}
                                    style={{ width: '100%', padding: '0.5rem', border: '1px solid #d1d5db', borderRadius: '0.25rem', color: '#1f2937' }}
                                    rows="3"
                                />
                            </div>

                            <div>
                                <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.875rem' }}>Tom de Voz</label>
                                <select
                                    name="tone_of_voice"
                                    value={formData.tone_of_voice}
                                    onChange={handleInputChange}
                                    style={{ width: '100%', padding: '0.5rem', border: '1px solid #d1d5db', borderRadius: '0.25rem', color: '#1f2937' }}
                                >
                                    <option>Profissional</option>
                                    <option>Descontra√≠do</option>
                                    <option>Autorit√°rio</option>
                                    <option>Educativo</option>
                                </select>
                            </div>

                            <div>
                                <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.875rem' }}>P√∫blico Alvo (Padr√£o)</label>
                                <input
                                    name="target_audience_default"
                                    value={formData.target_audience_default}
                                    onChange={handleInputChange}
                                    style={{ width: '100%', padding: '0.5rem', border: '1px solid #d1d5db', borderRadius: '0.25rem', color: '#1f2937' }}
                                />
                            </div>

                            <div>
                                <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.875rem' }}>Dores e Problemas</label>
                                <textarea
                                    name="pain_points"
                                    value={formData.pain_points}
                                    onChange={handleInputChange}
                                    style={{ width: '100%', padding: '0.5rem', border: '1px solid #d1d5db', borderRadius: '0.25rem', color: '#1f2937' }}
                                    rows="3"
                                />
                            </div>

                            {/* DOCUMENT UPLOAD SECTION */}
                            <div style={{ borderTop: '1px solid #e5e7eb', paddingTop: '1rem', marginTop: '0.5rem' }}>
                                <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.875rem', fontWeight: '600' }}>
                                    Arquivos de Contexto (PDF, DOC)
                                </label>

                                <div style={{
                                    border: '1px dashed #d1d5db',
                                    borderRadius: '0.25rem',
                                    padding: '1rem',
                                    textAlign: 'center',
                                    marginBottom: '1rem',
                                    cursor: 'pointer',
                                    position: 'relative'
                                }}>
                                    <input
                                        type="file"
                                        multiple
                                        onChange={handleFileChange}
                                        style={{
                                            position: 'absolute',
                                            top: 0,
                                            left: 0,
                                            width: '100%',
                                            height: '100%',
                                            opacity: 0,
                                            cursor: 'pointer'
                                        }}
                                    />
                                    <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', gap: '0.5rem', color: '#6b7280' }}>
                                        <Upload size={24} />
                                        <span style={{ fontSize: '0.875rem' }}>Clique ou arraste arquivos aqui</span>
                                    </div>
                                </div>

                                {/* LISTA DE ARQUIVOS PENDENTES */}
                                {filesToUpload.length > 0 && (
                                    <div style={{ marginBottom: '1rem' }}>
                                        <p style={{ fontSize: '0.75rem', fontWeight: 'bold', color: '#4b5563', marginBottom: '0.25rem' }}>Prontos para enviar:</p>
                                        <ul style={{ listStyle: 'none', padding: 0, margin: 0 }}>
                                            {filesToUpload.map((file, idx) => (
                                                <li key={idx} style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', fontSize: '0.875rem', background: '#f9fafb', padding: '0.25rem 0.5rem', marginBottom: '0.25rem', borderRadius: '0.25rem' }}>
                                                    <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem', overflow: 'hidden' }}>
                                                        <FileText size={14} color="#4b5563" />
                                                        <span style={{ whiteSpace: 'nowrap', overflow: 'hidden', textOverflow: 'ellipsis' }}>{file.name}</span>
                                                    </div>
                                                    <button
                                                        type="button"
                                                        onClick={() => removeFileToUpload(idx)}
                                                        style={{ background: 'none', border: 'none', cursor: 'pointer', color: '#ef4444', padding: 0 }}
                                                    >
                                                        <X size={14} />
                                                    </button>
                                                </li>
                                            ))}
                                        </ul>
                                    </div>
                                )}

                                {/* LISTA DE ARQUIVOS J√Å EXISTENTES */}
                                {existingFiles.length > 0 && (
                                    <div>
                                        <p style={{ fontSize: '0.75rem', fontWeight: 'bold', color: '#4b5563', marginBottom: '0.25rem' }}>Arquivos Anteriores:</p>
                                        <ul style={{ listStyle: 'none', padding: 0, margin: 0 }}>
                                            {existingFiles.map((file) => (
                                                <li key={file.id} style={{ display: 'flex', alignItems: 'center', gap: '0.5rem', fontSize: '0.875rem', color: '#059669', marginBottom: '0.25rem' }}>
                                                    <Check size={14} />
                                                    <span style={{ whiteSpace: 'nowrap', overflow: 'hidden', textOverflow: 'ellipsis' }}>{file.file_name}</span>
                                                    <span style={{ fontSize: '0.75rem', color: '#6b7280' }}>- Enviado</span>
                                                </li>
                                            ))}
                                        </ul>
                                    </div>
                                )}
                            </div>

                            <div style={{ display: 'flex', gap: '0.5rem', marginTop: '1rem' }}>
                                <button
                                    type="button"
                                    onClick={() => setShowModal(false)}
                                    style={{ flex: 1, padding: '0.5rem', background: '#f3f4f6', border: 'none', borderRadius: '0.25rem', cursor: 'pointer' }}
                                >
                                    Cancelar
                                </button>
                                <button
                                    type="submit"
                                    disabled={saving}
                                    style={{ flex: 1, padding: '0.5rem', background: '#ea580c', color: 'white', border: 'none', borderRadius: '0.25rem', cursor: 'pointer' }}
                                >
                                    {saving ? 'Salvando...' : (editingClient ? 'Salvar Altera√ß√µes' : 'Salvar Cliente')}
                                </button>
                            </div>

                            {editingClient && (
                                <button
                                    type="button"
                                    onClick={handleDelete}
                                    disabled={saving}
                                    style={{ width: '100%', marginTop: '0.5rem', padding: '0.5rem', background: '#fee2e2', color: '#ef4444', border: 'none', borderRadius: '0.25rem', cursor: 'pointer', fontWeight: '500' }}
                                >
                                    Excluir Cliente
                                </button>
                            )}
                        </form>
                    </div>
                </div>
            )}
        </div>
    );
}

```

## File: src\pages\IdeasPage.css
```css
.ideas-page-container {
    padding: 2rem;
    height: 100%;
}

.ideas-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
}

.ideas-header h1 {
    font-size: 1.5rem;
    font-weight: 700;
    color: #1e293b;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.client-selector-container {
    margin-bottom: 2rem;
    max-width: 400px;
}

.ideas-columns {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 2rem;
    height: calc(100vh - 250px);
}

.ideas-column {
    background: #f8fafc;
    border-radius: 12px;
    padding: 1.5rem;
    display: flex;
    flex-direction: column;
    overflow-y: auto;
}

.column-header {
    font-size: 1rem;
    font-weight: 600;
    color: #475569;
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid #e2e8f0;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.column-header .badge-count {
    background: #e2e8f0;
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 0.75rem;
    color: #475569;
}

.question-card {
    background: white;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    padding: 1rem;
    margin-bottom: 1rem;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
    transition: all 0.2s ease;
}

.question-card:hover {
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
}

.question-text {
    font-size: 1rem;
    color: #0f172a;
    margin-bottom: 0.5rem;
    font-weight: 500;
    line-height: 1.5;
}

.answer-text {
    background: #f0fdf4;
    padding: 0.75rem;
    border-radius: 6px;
    color: #166534;
    font-size: 0.9rem;
    margin-top: 0.5rem;
    border-left: 3px solid #22c55e;
}

.card-actions {
    display: flex;
    justify-content: flex-end;
    gap: 0.5rem;
    margin-top: 1rem;
    padding-top: 0.75rem;
    border-top: 1px solid #f1f5f9;
}

.btn-card-action {
    background: transparent;
    border: none;
    font-size: 0.8rem;
    color: #64748b;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 4px;
    padding: 4px 8px;
    border-radius: 4px;
}

.btn-card-action:hover {
    background: #f1f5f9;
    color: #334155;
}

.btn-card-action.danger:hover {
    background: #fef2f2;
    color: #ef4444;
}

.btn-card-action.primary {
    color: #2563eb;
    font-weight: 500;
}

.btn-card-action.primary:hover {
    background: #eff6ff;
}

/* Modal styles simplified for inline usage */
.mini-modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
}

.mini-modal {
    background: white;
    padding: 2rem;
    border-radius: 12px;
    width: 90%;
    max-width: 500px;
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
}

.mini-modal h3 {
    margin-top: 0;
    margin-bottom: 1.5rem;
    color: #0f172a;
}

.mini-modal textarea {
    width: 100%;
    padding: 0.75rem;
    border: 1px solid #cbd5e1;
    border-radius: 8px;
    min-height: 100px;
    margin-bottom: 1.5rem;
    font-family: inherit;
}

.mini-modal-actions {
    display: flex;
    justify-content: flex-end;
    gap: 1rem;
}
```

## File: src\pages\IdeasPage.jsx
```javascript

import React, { useState, useEffect } from 'react'
import { supabase } from '../services/supabaseClient'
import { useLanguage } from '../contexts/LanguageContext'
import {
    Lightbulb,
    Plus,
    Trash2,
    MessageSquare,
    Loader2,
    Building2,
    Sparkles // Added
} from 'lucide-react'
import './IdeasPage.css'

const IdeasPage = () => {
    const { t } = useLanguage()

    // Data
    const [clients, setClients] = useState([])
    const [questions, setQuestions] = useState([])

    // Selection
    const [selectedClientId, setSelectedClientId] = useState('')

    // Loading
    const [loadingClients, setLoadingClients] = useState(true)
    const [loadingQuestions, setLoadingQuestions] = useState(false)
    const [suggesting, setSuggesting] = useState(false) // New State for AI
    const [generatingIds, setGeneratingIds] = useState([]) // State for per-insight generation loading

    // Modals
    const [isCreateModalOpen, setIsCreateModalOpen] = useState(false)
    const [isAnswerModalOpen, setIsAnswerModalOpen] = useState(false)

    // Inputs
    const [newQuestionText, setNewQuestionText] = useState('')
    const [answerText, setAnswerText] = useState('')
    const [currentQuestionId, setCurrentQuestionId] = useState(null)

    // 1. Fetch Clients on Mount
    useEffect(() => {
        const fetchClients = async () => {
            try {
                const { data, error } = await supabase
                    .from('clients')
                    .select('id, name') // Need ID for relation
                    .order('name')

                if (error) throw error
                setClients(data || [])

                // Auto-select first client if available
                if (data && data.length > 0) {
                    setSelectedClientId(data[0].id)
                }
            } catch (err) {
                console.error('Error fetching clients:', err)
            } finally {
                setLoadingClients(false)
            }
        }
        fetchClients()
    }, [])

    // 2. Fetch Questions when Client Changes
    useEffect(() => {
        if (!selectedClientId) return

        const fetchQuestions = async () => {
            setLoadingQuestions(true)
            try {
                const { data, error } = await supabase
                    .from('interview_questions')
                    .select('*')
                    .eq('client_id', selectedClientId)
                    .order('created_at', { ascending: false })

                if (error) throw error
                setQuestions(data || [])
            } catch (err) {
                console.error('Error fetching questions:', err)
            } finally {
                setLoadingQuestions(false)
            }
        }
        fetchQuestions()
    }, [selectedClientId])

    // ACTIONS

    const handleCreateQuestion = async () => {
        // 1. VALIDA√á√ÉO
        if (!selectedClientId) {
            alert('Erro: Nenhum cliente selecionado.')
            return
        }
        if (!newQuestionText.trim()) {
            alert('Por favor, digite o texto da pergunta.')
            return
        }

        try {
            // 2. GRAVA√á√ÉO NO SUPABASE
            const { error } = await supabase
                .from('interview_questions')
                .insert([
                    {
                        client_id: selectedClientId,
                        question_text: newQuestionText,
                        status: 'pending'
                    }
                ])

            if (error) throw error

            // 3. ATUALIZA√á√ÉO DA LISTA (Recarregar Perguntas)
            const { data: refreshedData, error: refreshError } = await supabase
                .from('interview_questions')
                .select('*')
                .eq('client_id', selectedClientId)
                .order('created_at', { ascending: false })

            if (refreshError) throw refreshError

            // Atualiza estado
            setQuestions(refreshedData || [])

            // Limpa e Fecha
            setNewQuestionText('')
            setIsCreateModalOpen(false)

        } catch (err) {
            console.error('Erro ao salvar pergunta:', err)
            alert('Erro ao criar pergunta: ' + err.message)
        }
    }

    const handleSuggestAI = async () => {
        if (!selectedClientId) return
        setSuggesting(true)
        try {
            const response = await fetch('https://n8n-n8n-start.kfocge.easypanel.host/webhook/gerar-pergunta', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ clientId: selectedClientId })
            })

            if (!response.ok) throw new Error('Falha na conex√£o com IA')

            const data = await response.json()
            if (data && data.question) {
                setNewQuestionText(data.question)
            } else {
                throw new Error('Formato de resposta inv√°lido (esperado: { question: "..." })')
            }

        } catch (err) {
            console.error(err)
            alert('Erro ao gerar sugest√£o: ' + err.message)
        } finally {
            setSuggesting(false)
        }
    }

    const handleGenerateFromInsight = async (question) => {
        if (generatingIds.includes(question.id)) return

        // Finds the selected client to send the name
        const selectedClientObj = clients.find(c => c.id === selectedClientId)
        const clientName = selectedClientObj ? selectedClientObj.name : 'Unknown'

        setGeneratingIds(prev => [...prev, question.id])
        try {
            const response = await fetch('https://n8n-n8n-start.kfocge.easypanel.host/webhook/criar-post-respostas', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    client_id: selectedClientId,
                    nome_cliente: clientName, // Fix: Sending client name
                    pergunta_original: question.question_text,
                    resposta_expert: question.answer_text
                })
            })

            if (!response.ok) throw new Error('Falha ao enviar solicita√ß√£o para IA')

            alert('Solicita√ß√£o enviada! O post aparecer√° em breve.')

        } catch (err) {
            console.error(err)
            alert('Erro ao criar post: ' + err.message)
        } finally {
            setGeneratingIds(prev => prev.filter(id => id !== question.id))
        }
    }

    const handleDelete = async (id) => {
        if (!window.confirm(t('delete') + '?')) return
        try {
            const { error } = await supabase.from('interview_questions').delete().eq('id', id)
            if (error) throw error
            setQuestions(prev => prev.filter(q => q.id !== id))
        } catch (err) {
            console.error(err)
        }
    }

    const openAnswerModal = (q) => {
        setCurrentQuestionId(q.id)
        setAnswerText(q.answer_text || '')
        setIsAnswerModalOpen(true)
    }

    const handleSaveAnswer = async () => {
        if (!currentQuestionId) return
        try {
            const { error } = await supabase
                .from('interview_questions')
                .update({
                    answer_text: answerText,
                    status: 'answered'
                })
                .eq('id', currentQuestionId)

            if (error) throw error

            // Update local state
            setQuestions(prev => prev.map(q => {
                if (q.id === currentQuestionId) {
                    return { ...q, answer_text: answerText, status: 'answered' }
                }
                return q
            }))

            setIsAnswerModalOpen(false)
        } catch (err) {
            alert('Erro ao salvar resposta: ' + err.message)
        }
    }

    // LISTS
    const pendingList = questions.filter(q => q.status === 'pending')
    const answeredList = questions.filter(q => q.status === 'answered')

    return (
        <div className="ideas-page-container">
            <header className="ideas-header">
                <h1><Lightbulb size={28} color="#eab308" /> {t('ideas')}</h1>
                <button className="btn-primary" onClick={() => setIsCreateModalOpen(true)} disabled={!selectedClientId}>
                    <Plus size={18} /> {t('newQuestion')}
                </button>
            </header>

            <div className="client-selector-container">
                <div className="input-wrapper" style={{ background: 'white', padding: '0.5rem', borderRadius: '8px', border: '1px solid #cbd5e1' }}>
                    <Building2 className="input-icon" size={18} color="#64748b" />
                    <select
                        value={selectedClientId}
                        onChange={(e) => setSelectedClientId(e.target.value)}
                        className="modern-input"
                        style={{ border: 'none', outline: 'none', width: '100%' }}
                    >
                        {loadingClients ? <option>{t('loading')}</option> : null}
                        {!loadingClients && clients.map(c => (
                            <option key={c.id} value={c.id}>{c.name}</option>
                        ))}
                    </select>
                </div>
            </div>

            {loadingQuestions ? (
                <div style={{ display: 'flex', gap: '1rem', alignItems: 'center', color: '#64748b' }}>
                    <Loader2 className="spinner" /> {t('loading')}
                </div>
            ) : (
                <div className="ideas-columns">
                    {/* LEFT: PENDING */}
                    <div className="ideas-column">
                        <div className="column-header">
                            {t('pendingQuestions')}
                            <span className="badge-count">{pendingList.length}</span>
                        </div>
                        {pendingList.length === 0 && <p style={{ color: '#94a3b8', fontStyle: 'italic', marginTop: '1rem' }}>Nenhuma pendente.</p>}
                        {pendingList.map(q => (
                            <div key={q.id} className="question-card">
                                <div className="question-text">{q.question_text}</div>
                                <div className="card-actions">
                                    <button className="btn-card-action danger" onClick={() => handleDelete(q.id)}>
                                        <Trash2 size={14} /> {t('delete')}
                                    </button>
                                    <button className="btn-card-action primary" onClick={() => openAnswerModal(q)}>
                                        <MessageSquare size={14} /> {t('answer')}
                                    </button>
                                </div>
                            </div>
                        ))}
                    </div>

                    {/* RIGHT: ANSWERED */}
                    <div className="ideas-column">
                        <div className="column-header">
                            {t('answeredQuestions')}
                            <span className="badge-count">{answeredList.length}</span>
                        </div>
                        {answeredList.length === 0 && <p style={{ color: '#94a3b8', fontStyle: 'italic', marginTop: '1rem' }}>Nenhuma respondida.</p>}
                        {answeredList.map(q => (
                            <div key={q.id} className="question-card">
                                <div className="question-text">{q.question_text}</div>
                                <div className="answer-text">
                                    <strong>Insight:</strong> {q.answer_text}
                                </div>
                                <div className="card-actions">
                                    <button
                                        className="btn-card-action"
                                        style={{ color: '#7c3aed', background: '#f5f3ff', border: '1px solid #ddd6fe', fontWeight: 600 }}
                                        onClick={() => handleGenerateFromInsight(q)}
                                        disabled={generatingIds.includes(q.id)}
                                        title="Gerar Post com IA"
                                    >
                                        {generatingIds.includes(q.id) ? (
                                            <>
                                                <Loader2 size={14} className="spinner" /> Gerando...
                                            </>
                                        ) : (
                                            <>
                                                <Sparkles size={14} /> Gerar Post
                                            </>
                                        )}
                                    </button>
                                    <button className="btn-card-action danger" onClick={() => handleDelete(q.id)}>
                                        <Trash2 size={14} /> {t('delete')}
                                    </button>
                                    <button className="btn-card-action" onClick={() => openAnswerModal(q)}>
                                        Edit
                                    </button>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            )}

            {/* CREATE MODAL */}
            {isCreateModalOpen && (
                <div className="mini-modal-overlay">
                    <div className="mini-modal">
                        <h3>{t('newQuestion')}</h3>

                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '0.5rem' }}>
                            <span style={{ fontSize: '0.9rem', fontWeight: 600, color: '#334155' }}>Texto da Pergunta</span>
                            <button
                                onClick={handleSuggestAI}
                                disabled={suggesting}
                                className="btn-text-primary"
                                style={{
                                    fontSize: '0.85rem',
                                    display: 'flex',
                                    alignItems: 'center',
                                    gap: '6px',
                                    color: '#7c3aed',
                                    background: '#f5f3ff',
                                    border: '1px solid #ddd6fe',
                                    borderRadius: '6px',
                                    padding: '4px 8px',
                                    cursor: suggesting ? 'wait' : 'pointer',
                                    fontWeight: 500
                                }}
                            >
                                {suggesting ? <Loader2 size={14} className="spinner" /> : <Sparkles size={14} />}
                                {suggesting ? 'Criando...' : 'Sugerir com IA'}
                            </button>
                        </div>

                        <textarea
                            value={newQuestionText}
                            onChange={e => setNewQuestionText(e.target.value)}
                            placeholder={t('questionPlaceholder')}
                            autoFocus
                            disabled={suggesting}
                        />
                        <div className="mini-modal-actions">
                            <button className="btn-secondary" onClick={() => setIsCreateModalOpen(false)} disabled={suggesting}>{t('cancel')}</button>
                            <button className="btn-primary" onClick={handleCreateQuestion} disabled={suggesting}>{t('save')}</button>
                        </div>
                    </div>
                </div>
            )}

            {/* ANSWER MODAL */}
            {isAnswerModalOpen && (
                <div className="mini-modal-overlay">
                    <div className="mini-modal">
                        <h3>{t('answer')} / Insight</h3>
                        <textarea
                            value={answerText}
                            onChange={e => setAnswerText(e.target.value)}
                            placeholder={t('answerPlaceholder')}
                            autoFocus
                        />
                        <div className="mini-modal-actions">
                            <button className="btn-secondary" onClick={() => setIsAnswerModalOpen(false)}>{t('cancel')}</button>
                            <button className="btn-primary" onClick={handleSaveAnswer}>{t('save')}</button>
                        </div>
                    </div>
                </div>
            )}
        </div>
    )
}

export default IdeasPage

```

## File: src\pages\LeadsPage.css
```css
/* LeadsPage.css */

.leads-container {
    padding: 2rem;
    height: calc(100vh - 64px);
    /* Full height minus header/padding estimates */
    display: flex;
    flex-direction: column;
    overflow: hidden;
    background-color: #f8fafc;
}

.leads-header {
    margin-bottom: 2rem;
}

.leads-header h1 {
    font-size: 1.875rem;
    font-weight: 700;
    color: #1e293b;
    margin-bottom: 0.5rem;
}

.leads-header p {
    color: #64748b;
}

.kanban-board {
    display: flex;
    gap: 1.5rem;
    overflow-x: auto;
    padding-bottom: 1rem;
    height: 100%;
    align-items: flex-start;
}

.kanban-column {
    background: #f1f5f9;
    border-radius: 12px;
    min-width: 300px;
    max-width: 300px;
    display: flex;
    flex-direction: column;
    max-height: 100%;
}

.column-header {
    padding: 1rem;
    border-bottom: 1px solid #e2e8f0;
    display: flex;
    justify-content: space-between;
    align-items: center;
    position: sticky;
    top: 0;
    background: inherit;
    border-radius: 12px 12px 0 0;
    z-index: 10;
}

.column-header h3 {
    font-size: 0.95rem;
    font-weight: 600;
    color: #475569;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.count-badge {
    background: #cbd5e1;
    color: #475569;
    font-size: 0.75rem;
    padding: 0.1rem 0.5rem;
    border-radius: 999px;
    font-weight: 700;
}

.column-content {
    padding: 1rem;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 1rem;
    flex: 1;
}

/* Kanban Card */
.lead-card {
    background: white;
    padding: 1rem;
    border-radius: 8px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    cursor: pointer;
    transition: all 0.2s ease;
    border: 1px solid transparent;
}

.lead-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    border-color: #cbd5e1;
}

.lead-name {
    font-weight: 600;
    color: #1e293b;
    margin-bottom: 0.25rem;
}

.lead-role {
    font-size: 0.85rem;
    color: #64748b;
    margin-bottom: 0.75rem;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.lead-meta {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 0.75rem;
    color: #94a3b8;
    border-top: 1px solid #f1f5f9;
    padding-top: 0.75rem;
}

.company-name {
    display: flex;
    align-items: center;
    gap: 0.25rem;
}

/* Modal/Drawer Styles */
.lead-modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    display: flex;
    justify-content: flex-end;
    /* Align right for Drawer feel */
    z-index: 1000;
    backdrop-filter: blur(2px);
    animation: fadeIn 0.2s ease-out;
}

.lead-modal-content {
    background: white;
    width: 500px;
    max-width: 90vw;
    height: 100%;
    padding: 2rem;
    box-shadow: -4px 0 15px rgba(0, 0, 0, 0.1);
    overflow-y: auto;
    animation: slideIn 0.3s ease-out;
    display: flex;
    flex-direction: column;
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 2rem;
    border-bottom: 1px solid #e2e8f0;
    padding-bottom: 1.5rem;
}

.profile-info h2 {
    font-size: 1.5rem;
    font-weight: 700;
    color: #1e293b;
    margin-bottom: 0.25rem;
}

.profile-actions {
    display: flex;
    gap: 0.5rem;
}

.close-btn {
    background: none;
    border: none;
    cursor: pointer;
    color: #94a3b8;
    padding: 0.5rem;
    border-radius: 6px;
    transition: all 0.2s;
}

.close-btn:hover {
    background: #f1f5f9;
    color: #ef4444;
}

.section-title {
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: #64748b;
    font-weight: 700;
    margin-bottom: 0.75rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.ai-box {
    background: #f8fafc;
    /* Lighter background */
    border: 1px solid #e2e8f0;
    border-left: 4px solid #8b5cf6;
    /* Purple accent for AI */
    padding: 1rem;
    border-radius: 8px;
    margin-bottom: 1.5rem;
}

.ai-content {
    font-size: 0.95rem;
    color: #334155;
    line-height: 1.6;
    white-space: pre-wrap;
}

.action-bar {
    margin-top: auto;
    padding-top: 2rem;
    border-top: 1px solid #e2e8f0;
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
}

.status-btn {
    flex: 1;
    padding: 0.75rem;
    border: 1px solid #e2e8f0;
    background: white;
    border-radius: 8px;
    font-weight: 600;
    color: #475569;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
}

.status-btn:hover {
    background: #f8fafc;
    border-color: #cbd5e1;
}

.status-btn.active {
    background: #eff6ff;
    border-color: #3b82f6;
    color: #2563eb;
}

.linkedin-btn {
    background: #0077b5;
    color: white;
    border: none;
    padding: 0.5rem 1rem;
    border-radius: 6px;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    text-decoration: none;
    font-size: 0.9rem;
    transition: opacity 0.2s;
}

.linkedin-btn:hover {
    opacity: 0.9;
}

.copy-btn {
    background: white;
    border: 1px solid #e2e8f0;
    padding: 0.25rem 0.75rem;
    border-radius: 6px;
    font-size: 0.8rem;
    cursor: pointer;
    margin-top: 0.5rem;
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    color: #64748b;
    transition: all 0.2s;
}

.copy-btn:hover {
    border-color: #94a3b8;
    color: #475569;
}

@keyframes slideIn {
    from {
        transform: translateX(100%);
        opacity: 0;
    }

    to {
        transform: translateX(0);
        opacity: 1;
    }
}

@keyframes fadeIn {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Colors for specific statuses if needed */
.status-pill {
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.7rem;
    font-weight: 700;
    text-transform: uppercase;
}
```

## File: src\pages\LeadsPage.jsx
```javascript
import React, { useState, useEffect } from 'react'
import { supabase } from '../services/supabaseClient'
import { useLanguage } from '../contexts/LanguageContext'
import { useClientSelection } from '../contexts/ClientSelectionContext'
import './LeadsPage.css'
import {
    Briefcase,
    Linkedin,
    MessageSquare,
    Calendar,
    XOctagon,
    MoreHorizontal,
    ExternalLink,
    BrainCircuit,
    Copy,
    Check,
    Search,
    Loader2
} from 'lucide-react'

// Status Configuration
const STATUS_COLUMNS = [
    { id: 'new', label: 'Novos', icon: <Briefcase size={16} />, color: '#3b82f6' },
    { id: 'contacted', label: 'Contatados', icon: <MessageSquare size={16} />, color: '#eab308' },
    { id: 'in_conversation', label: 'Em Conversa', icon: <MessageSquare size={16} strokeWidth={3} />, color: '#f97316' },
    { id: 'meeting_scheduled', label: 'Reuni√£o', icon: <Calendar size={16} />, color: '#22c55e' },
    { id: 'disqualified', label: 'Desqualificado', icon: <XOctagon size={16} />, color: '#ef4444' }
]

const LeadsPage = () => {
    const { t } = useLanguage()
    const { selectedClientId } = useClientSelection()
    // State
    const [leads, setLeads] = useState([])
    const [loading, setLoading] = useState(false)
    const [selectedLead, setSelectedLead] = useState(null)

    // Pagination
    const [page, setPage] = useState(0)
    const [hasMore, setHasMore] = useState(true)
    const [loadingMore, setLoadingMore] = useState(false)
    const ITEMS_per_PAGE = 50

    useEffect(() => {
        if (selectedClientId) {
            setLeads([])
            setPage(0)
            setHasMore(true)
            fetchLeads(0, true)
        } else {
            setLeads([])
        }
    }, [selectedClientId])

    const fetchLeads = async (pageIndex = 0, isRefresh = false) => {
        if (!selectedClientId) return

        try {
            if (pageIndex === 0) setLoading(true)
            else setLoadingMore(true)

            const from = pageIndex * ITEMS_per_PAGE
            const to = from + ITEMS_per_PAGE - 1

            const { data, error } = await supabase
                .from('leads')
                .select('*')
                .eq('client_id', selectedClientId)
                .order('created_at', { ascending: false })
                .range(from, to)

            if (error) throw error

            if (data) {
                if (isRefresh || pageIndex === 0) {
                    setLeads(data)
                } else {
                    setLeads(prev => [...prev, ...data])
                }
                setHasMore(data.length === ITEMS_per_PAGE)
            }
        } catch (err) {
            console.error('Error fetching leads:', err)
        } finally {
            setLoading(false)
            setLoadingMore(false)
        }
    }

    const loadMore = () => {
        if (!loadingMore && hasMore) {
            const nextPage = page + 1
            setPage(nextPage)
            fetchLeads(nextPage, false)
        }
    }

    // Intersection Observer
    const observerTarget = React.useRef(null);
    useEffect(() => {
        const observer = new IntersectionObserver(
            entries => {
                if (entries[0].isIntersecting && hasMore && !loading && !loadingMore) {
                    loadMore();
                }
            },
            { threshold: 1.0 }
        );
        if (observerTarget.current) observer.observe(observerTarget.current);
        return () => observer.disconnect();
    }, [hasMore, loading, loadingMore, leads]); // Re-attach on list change

    const updateLeadStatus = async (leadId, newStatus) => {
        // MAPPING: Label/Input -> Database Enum Value
        const STATUS_MAPPING = {
            'Novos': 'TO_CONTACT',
            'Contatados': 'CONTACTED',
            'Em Conversa': 'IN_CONVERSATION',
            'Reuni√£o': 'MEETING_SCHEDULED',
            'Desqualificado': 'DISQUALIFIED',
            // Fallbacks
            'to_contact': 'TO_CONTACT',
            'contacted': 'CONTACTED',
            'in_conversation': 'IN_CONVERSATION',
            'meeting_scheduled': 'MEETING_SCHEDULED',
            'disqualified': 'DISQUALIFIED',
        }

        const dbStatus = STATUS_MAPPING[newStatus] || newStatus

        // Optimistic UI Update
        const previousLeads = [...leads]
        setLeads(leads.map(l => l.id === leadId ? { ...l, status: dbStatus } : l))

        // Also update selected lead if open
        if (selectedLead && selectedLead.id === leadId) {
            setSelectedLead({ ...selectedLead, status: dbStatus })
        }

        try {
            const { error } = await supabase
                .from('leads')
                .update({ status_pipeline: dbStatus })
                .eq('id', leadId)

            if (error) throw error
        } catch (err) {
            console.error('Error updating status:', err)
            // Revert on error
            setLeads(previousLeads)
            alert('Erro ao atualizar status.')
        }
    }

    // Filter leads by status
    const getLeadsByStatus = (statusId) => {
        return leads.filter(lead => (lead.status || 'new') === statusId)
    }

    return (
        <div className="leads-container">
            <div className="leads-header">
                <h1>Gest√£o de Leads</h1>
                <p>Gerencie suas oportunidades comerciais e acompanhe o progresso.</p>
            </div>

            {!selectedClientId ? (
                <div style={{
                    marginTop: '4rem',
                    flex: 1,
                    display: 'flex',
                    flexDirection: 'column',
                    alignItems: 'center',
                    justifyContent: 'center',
                    color: '#64748b'
                }}>
                    <div style={{ background: '#f1f5f9', padding: '1rem', borderRadius: '50%', marginBottom: '1rem' }}>
                        <Search size={32} />
                    </div>
                    <h3 style={{ fontSize: '1.2rem', fontWeight: 'bold', color: '#1e293b', marginBottom: '0.5rem' }}>Nenhum Cliente Selecionado</h3>
                    <p>Selecione um cliente no topo da p√°gina para gerenciar a prospec√ß√£o.</p>
                </div>
            ) : loading ? (
                <div className="loading-state">Carregando leads...</div>
            ) : (
                <div className="kanban-board">
                    {STATUS_COLUMNS.map(column => {
                        const columnLeads = getLeadsByStatus(column.id)

                        return (
                            <div key={column.id} className="kanban-column">
                                <div className="column-header" style={{ borderTop: `4px solid ${column.color}` }}>
                                    <h3>
                                        {column.icon}
                                        {column.label}
                                    </h3>
                                    <span className="count-badge">{columnLeads.length}</span>
                                </div>

                                <div className="column-content">
                                    {columnLeads.map(lead => (
                                        <div
                                            key={lead.id}
                                            className="lead-card"
                                            onClick={() => setSelectedLead(lead)}
                                        >
                                            <div className="lead-name">{lead.nome || 'Sem Nome'}</div>
                                            <div className="lead-role" title={lead.headline}>
                                                {lead.headline || 'Cargo n√£o informado'}
                                            </div>
                                            <div className="lead-meta">
                                                <span className="company-name">
                                                    @{lead.company || '?'}
                                                </span>
                                            </div>
                                        </div>
                                    ))}
                                    {columnLeads.length === 0 && (
                                        <div style={{ textAlign: 'center', padding: '1rem', color: '#cbd5e1', fontSize: '0.9rem' }}>
                                            Vazio
                                        </div>
                                    )}
                                </div>
                            </div>
                        )
                    })}
                </div>
            )}

            {/* Sentinel */}
            {!loading && (
                <div ref={observerTarget} style={{ height: '40px', width: '100%', display: 'flex', justifyContent: 'center', alignItems: 'center', padding: '10px' }}>
                    {loadingMore && <div style={{ display: 'flex', color: '#64748b' }}><Loader2 className="spinner" size={24} /></div>}
                    {!hasMore && leads.length > 0 && <span style={{ color: '#cbd5e1' }}>Todos os leads carregados.</span>}
                </div>
            )}

            {selectedLead && (
                <LeadDetailsDrawer
                    lead={selectedLead}
                    onClose={() => setSelectedLead(null)}
                    onStatusChange={updateLeadStatus}
                />
            )}
        </div>
    )
}

const LeadDetailsDrawer = ({ lead, onClose, onStatusChange }) => {
    const [copied, setCopied] = useState(false)

    const handleCopy = (text) => {
        navigator.clipboard.writeText(text)
        setCopied(true)
        setTimeout(() => setCopied(false), 2000)
    }

    return (
        <div className="lead-modal-overlay" onClick={(e) => {
            if (e.target === e.currentTarget) onClose()
        }}>
            <div className="lead-modal-content">
                <div className="modal-header">
                    <div className="profile-info">
                        <h2>{lead.nome}</h2>
                        <p style={{ color: '#64748b', fontSize: '1.1rem' }}>{lead.headline} @ {lead.company}</p>
                        {lead.linkedin_profile_url && (
                            <a
                                href={lead.linkedin_profile_url}
                                target="_blank"
                                rel="noreferrer"
                                className="linkedin-btn"
                                style={{ marginTop: '1rem', display: 'inline-flex' }}
                            >
                                <Linkedin size={18} /> Ver Perfil LinkedIn <ExternalLink size={14} style={{ marginLeft: 'auto' }} />
                            </a>
                        )}
                    </div>
                    <button className="close-btn" onClick={onClose}>
                        <XOctagon size={24} />
                    </button>
                </div>

                <div className="modal-body">
                    {/* Origin */}
                    <div style={{ marginBottom: '2rem' }}>
                        <div className="section-title">Origem</div>
                        <div style={{
                            background: '#f1f5f9',
                            padding: '0.75rem',
                            borderRadius: '6px',
                            color: '#334155',
                            fontSize: '0.9rem'
                        }}>
                            üìç Veio do Post: <strong>{lead.post_title || 'Desconhecido'}</strong>
                        </div>
                    </div>

                    {/* AI Intelligence */}
                    <div className="ai-section">
                        <div className="section-title" style={{ color: '#7c3aed' }}>
                            <BrainCircuit size={16} /> Intelig√™ncia Artificial
                        </div>

                        {lead.ai_summary && (
                            <div className="ai-box">
                                <strong style={{ display: 'block', marginBottom: '0.5rem', color: '#5b21b6' }}>Resumo do Perfil</strong>
                                <div className="ai-content">{lead.ai_summary}</div>
                            </div>
                        )}

                        {lead.ai_icebreaker && (
                            <div className="ai-box" style={{ borderLeftColor: '#ec4899' }}>
                                <strong style={{ display: 'block', marginBottom: '0.5rem', color: '#9d174d' }}>
                                    Sugest√£o de Quebra-gelo
                                </strong>
                                <div className="ai-content" style={{ fontStyle: 'italic' }}>
                                    "{lead.ai_icebreaker}"
                                </div>
                                <button
                                    className="copy-btn"
                                    onClick={() => handleCopy(lead.ai_icebreaker)}
                                >
                                    {copied ? <Check size={14} color="green" /> : <Copy size={14} />}
                                    {copied ? 'Copiado!' : 'Copiar Mensagem'}
                                </button>
                            </div>
                        )}
                    </div>
                </div>

                <div className="action-bar">
                    {STATUS_COLUMNS.map(status => (
                        <button
                            key={status.id}
                            className={`status-btn ${lead.status === status.id ? 'active' : ''}`}
                            onClick={() => onStatusChange(lead.id, status.id)}
                            title={`Mover para ${status.label}`}
                        >
                            {status.id === lead.status && <Check size={16} />}
                            {status.label}
                        </button>
                    ))}
                </div>
            </div>
        </div>
    )
}

export default LeadsPage

```

## File: src\pages\LinkedInEngagementPage.jsx
```javascript
import React, { useState, useEffect, useCallback } from 'react'
import { supabase } from '../services/supabaseClient'
import { useClientSelection } from '../contexts/ClientSelectionContext'
import {
    ThumbsUp,
    MessageCircle,
    UserPlus,
    Send,
    X,
    Clock,
    Users,
    Loader2,
    MessageSquare,
    Linkedin,
    RefreshCw,
    Check
} from 'lucide-react'

// Helper: relative time in Portuguese
const timeAgo = (dateString) => {
    if (!dateString) return ''
    const now = new Date()
    const date = new Date(dateString)
    const diffMs = now - date
    const diffMins = Math.floor(diffMs / 60000)
    const diffHours = Math.floor(diffMs / 3600000)
    const diffDays = Math.floor(diffMs / 86400000)

    if (diffMins < 1) return 'Agora mesmo'
    if (diffMins < 60) return `H√° ${diffMins} min`
    if (diffHours < 24) return `H√° ${diffHours}h`
    if (diffDays === 1) return 'H√° 1 dia'
    if (diffDays < 30) return `H√° ${diffDays} dias`
    return date.toLocaleDateString('pt-BR')
}

const LinkedInEngagementPage = () => {
    const { selectedClientId } = useClientSelection()

    // Posts state
    const [posts, setPosts] = useState([])
    const [loadingPosts, setLoadingPosts] = useState(false)
    const [selectedPost, setSelectedPost] = useState(null)

    // Comments state
    const [comments, setComments] = useState([])
    const [loadingComments, setLoadingComments] = useState(false)

    // Connect modal state
    const [connectModal, setConnectModal] = useState(null) // { author_name, author_urn_id }
    const [connectNote, setConnectNote] = useState('')

    // Sync state
    const [isSyncing, setIsSyncing] = useState(false)
    const [notification, setNotification] = useState(null) // { message, type }

    // Reusable fetch function
    const fetchPosts = useCallback(async (resetSelection = true) => {
        if (!selectedClientId) return
        setLoadingPosts(true)
        try {
            const { data, error } = await supabase
                .from('linkedin_posts')
                .select('*')
                .eq('client_id', selectedClientId)
                .order('created_at_linkedin', { ascending: false })

            if (error) throw error
            setPosts(data || [])
            if (resetSelection) {
                setSelectedPost(null)
                setComments([])
            }
        } catch (err) {
            console.error('Error fetching LinkedIn posts:', err)
        } finally {
            setLoadingPosts(false)
        }
    }, [selectedClientId])

    // 1. Initial fetch
    useEffect(() => {
        if (!selectedClientId) {
            setPosts([])
            setSelectedPost(null)
            return
        }
        fetchPosts()
    }, [selectedClientId, fetchPosts])

    // 2. Fetch Comments for selected post
    useEffect(() => {
        if (!selectedPost) {
            setComments([])
            return
        }

        const fetchComments = async () => {
            setLoadingComments(true)
            try {
                const { data, error } = await supabase
                    .from('linkedin_comments')
                    .select('*')
                    .eq('post_id', selectedPost.id)
                    .order('created_at', { ascending: false })

                if (error) throw error
                setComments(data || [])
            } catch (err) {
                console.error('Error fetching comments:', err)
            } finally {
                setLoadingComments(false)
            }
        }

        fetchComments()
    }, [selectedPost?.id])

    // 3. Sync Handler
    const handleSyncLinkedIn = async () => {
        setIsSyncing(true)
        setNotification(null)
        try {
            const { data: { user } } = await supabase.auth.getUser()

            const response = await fetch('https://n8n-n8n-start.kfocge.easypanel.host/webhook-test/sync-linkedin-comments', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    user_id: user?.id || 'system_user',
                    client_id: selectedClientId
                })
            })

            if (!response.ok) throw new Error('Erro na sincroniza√ß√£o')

            // Refetch posts (keep current selection if possible)
            await fetchPosts(false)

            setNotification({ message: 'Posts e coment√°rios atualizados!', type: 'success' })
        } catch (err) {
            console.error('Sync error:', err)
            setNotification({ message: err.message || 'Erro ao sincronizar. Tente novamente.', type: 'error' })
        } finally {
            setIsSyncing(false)
            setTimeout(() => setNotification(null), 5000)
        }
    }

    // 4. Action Handlers
    const handleOpenChat = (authorUrnId) => {
        console.log('handleOpenChat:', authorUrnId)
    }

    const handleConnect = (authorUrnId, noteText) => {
        console.log('handleConnect:', authorUrnId, noteText)
        setConnectModal(null)
        setConnectNote('')
    }

    const handleSelectPost = (post) => {
        setSelectedPost(post)
    }

    // Extract metrics safely
    const getMetrics = (post) => {
        const metrics = post.metrics || {}
        return {
            likes: metrics.likes_count || 0,
            comments: metrics.comments_count || 0
        }
    }

    // No client selected
    if (!selectedClientId) {
        return (
            <div className="flex items-center justify-center h-[80vh]">
                <div className="text-center space-y-3">
                    <Users size={48} className="mx-auto text-slate-300" />
                    <h2 className="text-xl font-bold text-slate-600">Selecione um Cliente</h2>
                    <p className="text-sm text-slate-400">Escolha um cliente no seletor acima para ver o engajamento LinkedIn.</p>
                </div>
            </div>
        )
    }

    return (
        <div className="p-4 md:p-6 h-full">
            {/* TOAST NOTIFICATION */}
            {notification && (
                <div className={`fixed top-6 right-6 z-50 px-5 py-4 rounded-xl shadow-2xl border-2 flex items-center gap-3 animate-slide-in-right min-w-[300px] ${notification.type === 'error'
                    ? 'bg-red-50 border-red-300 text-red-700'
                    : 'bg-emerald-50 border-emerald-300 text-emerald-700'
                    }`}>
                    {notification.type === 'error' ? <X size={20} className="shrink-0" /> : <Check size={20} className="shrink-0" />}
                    <span className="text-sm font-semibold flex-1">{notification.message}</span>
                </div>
            )}

            {/* PAGE HEADER */}
            <div className="mb-6">
                <div className="flex items-center gap-3 mb-1">
                    <div className="w-10 h-10 rounded-xl bg-blue-100 flex items-center justify-center">
                        <Linkedin size={22} className="text-blue-600" />
                    </div>
                    <div>
                        <h1 className="text-2xl font-bold text-slate-800">Engajamento LinkedIn</h1>
                        <p className="text-sm text-slate-500">Analise posts e interaja com quem comentou</p>
                    </div>
                </div>
            </div>

            {/* SPLIT VIEW */}
            <div className="flex gap-4 h-[calc(100vh-220px)]">

                {/* LEFT COLUMN ‚Äî Posts List */}
                <div className="w-[380px] shrink-0 bg-white rounded-xl border border-slate-200 shadow-sm flex flex-col overflow-hidden">
                    <div className="p-4 border-b border-slate-100 flex items-center justify-between">
                        <div>
                            <h2 className="text-sm font-bold text-slate-700 uppercase tracking-wider">Posts Recentes</h2>
                            <p className="text-xs text-slate-400 mt-0.5">{posts.length} posts encontrados</p>
                        </div>
                        <button
                            onClick={handleSyncLinkedIn}
                            disabled={isSyncing}
                            className={`flex items-center gap-1.5 px-3 py-2 rounded-lg text-xs font-semibold transition-all ${isSyncing
                                ? 'bg-blue-50 text-blue-400 cursor-not-allowed'
                                : 'bg-blue-50 text-blue-600 hover:bg-blue-100 border border-blue-200'
                                }`}
                            title="Buscar novos posts e coment√°rios"
                        >
                            <RefreshCw size={14} className={isSyncing ? 'animate-spin' : ''} />
                            {isSyncing ? 'Atualizando...' : 'Atualizar'}
                        </button>
                    </div>

                    <div className="flex-1 overflow-y-auto">
                        {loadingPosts ? (
                            <div className="flex items-center justify-center py-16">
                                <Loader2 size={24} className="animate-spin text-blue-500" />
                            </div>
                        ) : posts.length === 0 ? (
                            <div className="text-center py-16 px-4">
                                <Linkedin size={32} className="mx-auto text-slate-300 mb-2" />
                                <p className="text-sm text-slate-400">Nenhum post encontrado</p>
                            </div>
                        ) : (
                            <div className="divide-y divide-slate-100">
                                {posts.map(post => {
                                    const { likes, comments: commentCount } = getMetrics(post)
                                    const isSelected = selectedPost?.id === post.id

                                    return (
                                        <button
                                            key={post.id}
                                            onClick={() => handleSelectPost(post)}
                                            className={`w-full text-left p-4 transition-all hover:bg-slate-50 ${isSelected
                                                ? 'bg-blue-50 border-l-4 border-l-blue-500'
                                                : 'border-l-4 border-l-transparent'
                                                }`}
                                        >
                                            <div className="flex gap-3">
                                                {/* Post Thumbnail */}
                                                {post.post_image_url && (
                                                    <img
                                                        src={post.post_image_url}
                                                        alt=""
                                                        className="w-14 h-14 rounded-lg object-cover shrink-0 border border-slate-200"
                                                        onError={(e) => { e.target.style.display = 'none' }}
                                                    />
                                                )}

                                                {/* Text content */}
                                                <div className="flex-1 min-w-0">
                                                    {/* Snippet ‚Äî max 2 lines */}
                                                    <p className="text-sm text-slate-700 font-medium line-clamp-2 leading-snug">
                                                        {post.content_snippet || 'Post sem conte√∫do'}
                                                    </p>

                                                    {/* Meta row */}
                                                    <div className="flex items-center gap-3 mt-2.5">
                                                        <span className="text-[11px] text-slate-400 flex items-center gap-1">
                                                            <Clock size={11} />
                                                            {timeAgo(post.created_at_linkedin)}
                                                        </span>
                                                        <span className="text-[11px] text-blue-600 bg-blue-50 px-2 py-0.5 rounded-full font-semibold flex items-center gap-1">
                                                            <ThumbsUp size={10} /> {likes}
                                                        </span>
                                                        <span className="text-[11px] text-emerald-600 bg-emerald-50 px-2 py-0.5 rounded-full font-semibold flex items-center gap-1">
                                                            <MessageCircle size={10} /> {commentCount}
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </button>
                                    )
                                })}
                            </div>
                        )}
                    </div>
                </div>

                {/* RIGHT COLUMN ‚Äî Comments */}
                <div className="flex-1 bg-white rounded-xl border border-slate-200 shadow-sm flex flex-col overflow-hidden">
                    {!selectedPost ? (
                        <div className="flex-1 flex items-center justify-center">
                            <div className="text-center space-y-2">
                                <MessageSquare size={40} className="mx-auto text-slate-300" />
                                <p className="text-sm text-slate-400 font-medium">Selecione um post para ver os coment√°rios</p>
                            </div>
                        </div>
                    ) : (
                        <>
                            {/* Selected Post Header */}
                            <div className="p-4 border-b border-slate-100 bg-slate-50/50">
                                <p className="text-sm text-slate-700 font-medium line-clamp-3 leading-relaxed">
                                    {selectedPost.content_snippet}
                                </p>
                                <div className="flex items-center gap-3 mt-2">
                                    <span className="text-[11px] text-slate-400">
                                        {timeAgo(selectedPost.created_at_linkedin)}
                                    </span>
                                    <span className="text-[11px] text-slate-500 font-medium">
                                        {comments.length} coment√°rios carregados
                                    </span>
                                </div>
                            </div>

                            {/* Comments List */}
                            <div className="flex-1 overflow-y-auto p-4 space-y-3">
                                {loadingComments ? (
                                    <div className="flex items-center justify-center py-16">
                                        <Loader2 size={24} className="animate-spin text-blue-500" />
                                    </div>
                                ) : comments.length === 0 ? (
                                    <div className="text-center py-16">
                                        <MessageCircle size={32} className="mx-auto text-slate-300 mb-2" />
                                        <p className="text-sm text-slate-400">Nenhum coment√°rio neste post</p>
                                    </div>
                                ) : (
                                    comments.map(comment => (
                                        <div
                                            key={comment.id}
                                            className="flex items-start gap-3 p-3 rounded-xl border border-slate-100 hover:border-slate-200 transition-colors group"
                                        >
                                            {/* Avatar */}
                                            {comment.author_image_url ? (
                                                <img
                                                    src={comment.author_image_url}
                                                    alt={comment.author_name || 'Autor'}
                                                    className="w-10 h-10 rounded-full shrink-0 object-cover border border-slate-200"
                                                    onError={(e) => {
                                                        e.target.style.display = 'none'
                                                        e.target.nextSibling.style.display = 'flex'
                                                    }}
                                                />
                                            ) : null}
                                            <div className={`w-10 h-10 rounded-full bg-gradient-to-br from-blue-400 to-blue-600 flex items-center justify-center text-white font-bold text-sm shrink-0 ${comment.author_image_url ? 'hidden' : ''}`}>
                                                {(comment.author_name || '?')[0].toUpperCase()}
                                            </div>

                                            {/* Content */}
                                            <div className="flex-1 min-w-0">
                                                <div className="flex items-start justify-between gap-2">
                                                    <div>
                                                        <a
                                                            href={comment.author_profile_url || '#'}
                                                            target="_blank"
                                                            rel="noopener noreferrer"
                                                            className="text-sm font-semibold text-slate-800 hover:text-blue-600 transition-colors"
                                                        >
                                                            {comment.author_name || 'Autor desconhecido'}
                                                        </a>
                                                        {comment.author_headline && (
                                                            <p className="text-xs text-slate-400 truncate max-w-[300px]">
                                                                {comment.author_headline}
                                                            </p>
                                                        )}
                                                    </div>

                                                    {/* Action Button */}
                                                    {comment.is_connection ? (
                                                        <button
                                                            onClick={() => handleOpenChat(comment.author_urn_id)}
                                                            className="shrink-0 flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-semibold bg-emerald-50 text-emerald-600 hover:bg-emerald-100 border border-emerald-200 transition-colors opacity-0 group-hover:opacity-100"
                                                            title="Enviar mensagem"
                                                        >
                                                            <MessageCircle size={13} />
                                                            Mensagem
                                                        </button>
                                                    ) : (
                                                        <button
                                                            onClick={() => setConnectModal({
                                                                author_name: comment.author_name,
                                                                author_urn_id: comment.author_urn_id
                                                            })}
                                                            className="shrink-0 flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-semibold bg-blue-50 text-blue-600 hover:bg-blue-100 border border-blue-200 transition-colors opacity-0 group-hover:opacity-100"
                                                            title="Enviar convite de conex√£o"
                                                        >
                                                            <UserPlus size={13} />
                                                            Conectar
                                                        </button>
                                                    )}
                                                </div>

                                                {/* Comment Text */}
                                                <div className="mt-2 p-3 bg-slate-50 rounded-lg">
                                                    <p className="text-sm text-slate-700 leading-relaxed whitespace-pre-wrap">
                                                        {comment.content}
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                    ))
                                )}
                            </div>
                        </>
                    )}
                </div>
            </div>

            {/* CONNECT MODAL */}
            {connectModal && (
                <div className="fixed inset-0 z-50 flex items-center justify-center bg-slate-900/50 backdrop-blur-sm p-4">
                    <div className="bg-white rounded-2xl shadow-2xl border border-slate-200 w-full max-w-md animate-fade-in">
                        {/* Modal Header */}
                        <div className="flex items-center justify-between p-5 border-b border-slate-100">
                            <div>
                                <h3 className="text-lg font-bold text-slate-800">Enviar Convite</h3>
                                <p className="text-sm text-slate-400 mt-0.5">
                                    Conectar com <span className="font-semibold text-slate-600">{connectModal.author_name}</span>
                                </p>
                            </div>
                            <button
                                onClick={() => { setConnectModal(null); setConnectNote('') }}
                                className="p-2 rounded-lg hover:bg-slate-100 text-slate-400 hover:text-slate-600 transition-colors"
                            >
                                <X size={18} />
                            </button>
                        </div>

                        {/* Modal Body */}
                        <div className="p-5">
                            <label className="block text-sm font-medium text-slate-700 mb-2">
                                Nota de Conex√£o (opcional)
                            </label>
                            <textarea
                                value={connectNote}
                                onChange={(e) => setConnectNote(e.target.value)}
                                placeholder="Escreva uma nota personalizada para o convite..."
                                className="w-full h-28 p-3 border border-slate-200 rounded-xl text-sm text-slate-700 placeholder-slate-400 resize-none focus:outline-none focus:ring-2 focus:ring-blue-200 focus:border-blue-400 transition-all"
                                maxLength={300}
                            />
                            <p className="text-xs text-slate-400 mt-1 text-right">{connectNote.length}/300</p>
                        </div>

                        {/* Modal Footer */}
                        <div className="flex items-center justify-end gap-3 p-5 border-t border-slate-100">
                            <button
                                onClick={() => { setConnectModal(null); setConnectNote('') }}
                                className="px-4 py-2.5 rounded-xl text-sm font-medium text-slate-600 hover:bg-slate-100 transition-colors"
                            >
                                Cancelar
                            </button>
                            <button
                                onClick={() => handleConnect(connectModal.author_urn_id, connectNote)}
                                className="flex items-center gap-2 px-5 py-2.5 rounded-xl text-sm font-semibold bg-blue-600 text-white hover:bg-blue-700 transition-colors shadow-sm"
                            >
                                <Send size={14} />
                                Enviar Convite
                            </button>
                        </div>
                    </div>
                </div>
            )}
        </div>
    )
}

export default LinkedInEngagementPage

```

## File: src\pages\ListDetailsPage.jsx
```javascript
import React, { useState, useEffect } from 'react'
import { supabase } from '../services/supabaseClient'
import { useParams, useNavigate } from 'react-router-dom'
import {
    ArrowLeft,
    Search,
    Loader2,
    Plus,
    Trash2,
    RefreshCw,
    Download,
    Check
} from 'lucide-react'
import ImportContactsModal from '../components/ImportContactsModal'
import { useClientSelection } from '../contexts/ClientSelectionContext'

const ListDetailsPage = () => {
    const { id } = useParams()
    const navigate = useNavigate()
    const { selectedClientId } = useClientSelection()
    const [list, setList] = useState(null)
    const [leads, setLeads] = useState([])
    const [loading, setLoading] = useState(true)
    const [searchTerm, setSearchTerm] = useState('')
    const [isImportModalOpen, setIsImportModalOpen] = useState(false)
    const [selectedLeads, setSelectedLeads] = useState([])

    useEffect(() => {
        fetchListAndLeads()

        // Polling for processing status
        let interval
        if (list?.status === 'PROCESSING') {
            interval = setInterval(() => {
                fetchListAndLeads(true) // Silent refresh
            }, 10000)
        }
        return () => clearInterval(interval)
    }, [id, list?.status])

    const fetchListAndLeads = async (silent = false) => {
        if (!silent) setLoading(true)
        try {
            // Fetch List Details
            const { data: listData, error: listError } = await supabase
                .from('contact_lists')
                .select('*')
                .eq('id', id)
                .single()

            if (listError) throw listError
            setList(listData)

            // Fetch Leads
            const { data: leadsData, error: leadsError } = await supabase
                .from('contact_list_leads')
                .select('*, leads(*)')
                .eq('list_id', id)

            if (leadsError) throw leadsError

            // Flatten structure
            const flattenedLeads = leadsData?.map(item => ({
                ...item,
                lead_data: item.leads
            })) || []

            setLeads(flattenedLeads)

        } catch (error) {
            console.error('Error fetching details:', error)
        } finally {
            setLoading(false)
        }
    }

    const filteredLeads = leads.filter(l =>
        l.lead_data?.nome?.toLowerCase().includes(searchTerm.toLowerCase()) ||
        l.lead_data?.headline?.toLowerCase().includes(searchTerm.toLowerCase())
    )

    const toggleSelectLead = (leadId) => {
        setSelectedLeads(prev =>
            prev.includes(leadId)
                ? prev.filter(id => id !== leadId)
                : [...prev, leadId]
        )
    }

    const toggleSelectAll = () => {
        if (selectedLeads.length === filteredLeads.length) {
            setSelectedLeads([])
        } else {
            setSelectedLeads(filteredLeads.map(l => l.id))
        }
    }

    const handleDeleteSelected = async () => {
        if (!selectedLeads.length || !window.confirm(`Tem certeza que deseja remover ${selectedLeads.length} leads desta lista?`)) return

        try {
            const { error } = await supabase
                .from('contact_list_leads')
                .delete()
                .in('id', selectedLeads)

            if (error) throw error

            setLeads(prev => prev.filter(l => !selectedLeads.includes(l.id)))
            setSelectedLeads([])
        } catch (error) {
            console.error('Error deleting leads:', error)
            alert('Erro ao remover leads.')
        }
    }

    return (
        <div className="min-h-screen bg-slate-50 p-6 md:p-8 font-sans text-slate-800">
            {/* HEADER */}
            <div className="max-w-7xl mx-auto mb-10">
                <button
                    onClick={() => navigate('/lists')}
                    className="flex items-center gap-2 text-slate-500 hover:text-indigo-600 transition-colors text-sm font-semibold mb-4"
                >
                    <ArrowLeft size={16} /> Voltar para Listas
                </button>

                <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-8">
                    <div>
                        <h1 className="text-3xl font-bold text-slate-900 tracking-tight mb-2">
                            {list ? list.name : 'Carregando...'}
                        </h1>
                        <p className="text-slate-500 text-lg">Detalhes e leads da lista de contatos.</p>
                    </div>
                    <div className="flex gap-3">
                        <button
                            onClick={() => setIsImportModalOpen(true)}
                            className="flex items-center gap-2 px-5 py-2.5 rounded-xl bg-indigo-600 text-white font-bold hover:bg-indigo-700 transition-all shadow-lg shadow-indigo-100"
                        >
                            <Download size={20} /> Importar Contatos
                        </button>
                    </div>

                </div>

                {/* PROGRESS BAR */}
                {list?.status === 'PROCESSING' && (
                    <div className="bg-white p-6 rounded-xl border border-blue-100 shadow-sm mb-6 animate-pulse">
                        <div className="flex justify-between items-end mb-2">
                            <div>
                                <h3 className="text-lg font-bold text-slate-800 flex items-center gap-2">
                                    <Loader2 className="animate-spin text-blue-600" size={20} />
                                    Importando Contatos...
                                </h3>
                                <p className="text-sm text-slate-500">
                                    Isso pode levar alguns minutos. Estamos capturando dados do LinkedIn.
                                </p>
                            </div>
                            <div className="text-right">
                                <span className="text-2xl font-bold text-blue-600">
                                    {Math.round((leads.length / (list.total_leads_expected || 1)) * 100)}%
                                </span>
                            </div>
                        </div>
                        <div className="w-full bg-slate-100 rounded-full h-2.5 overflow-hidden">
                            <div
                                className="bg-blue-600 h-2.5 rounded-full transition-all duration-500"
                                style={{ width: `${Math.min((leads.length / (list.total_leads_expected || 1)) * 100, 100)}%` }}
                            ></div>
                        </div>
                        {leads.length > 0 && (
                            <p className="text-xs text-slate-400 mt-2 text-right">
                                {leads.length} de {list.total_leads_expected || '?'} leads processados
                            </p>
                        )}
                    </div>
                )}

                {/* CONTROLS */}
                <div className="bg-white p-4 rounded-xl border border-slate-200 shadow-sm mb-6 flex flex-col md:flex-row justify-between items-center gap-4">
                    <div className="relative w-full md:w-96">
                        <Search className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400" size={18} />
                        <input
                            type="text"
                            placeholder="Buscar leads na lista..."
                            value={searchTerm}
                            onChange={e => setSearchTerm(e.target.value)}
                            className="w-full pl-10 pr-4 py-2.5 bg-slate-50 border border-slate-200 rounded-lg text-slate-800 focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 transition-all font-medium placeholder:text-slate-400"
                        />
                    </div>
                    {selectedLeads.length > 0 && (
                        <button
                            onClick={handleDeleteSelected}
                            className="flex items-center gap-2 px-4 py-2 rounded-lg bg-red-50 text-red-600 font-bold hover:bg-red-100 transition-colors border border-red-200"
                        >
                            <Trash2 size={16} /> Deletar ({selectedLeads.length})
                        </button>
                    )}
                </div>

                {/* TABLE */}
                <div className="bg-white border border-slate-200 rounded-xl shadow-sm overflow-hidden">
                    {loading ? (
                        <div className="py-20 flex justify-center text-gray-400">
                            <Loader2 className="animate-spin" size={32} />
                        </div>
                    ) : (
                        <table className="w-full text-left border-collapse">
                            <thead>
                                <tr className="bg-slate-50 border-b border-slate-200 text-xs font-bold text-slate-500 uppercase tracking-wider">
                                    <th className="py-4 px-6 w-12">
                                        <input
                                            type="checkbox"
                                            onChange={toggleSelectAll}
                                            checked={filteredLeads.length > 0 && selectedLeads.length === filteredLeads.length}
                                            className="w-4 h-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"
                                        />
                                    </th>
                                    <th className="py-4 px-6">Nome</th>
                                    <th className="py-4 px-6">Cargo & Empresa</th>
                                    <th className="py-4 px-6">Status na Lista</th>
                                    <th className="py-4 px-6 text-right">Adicionado em</th>
                                </tr>
                            </thead>
                            <tbody className="divide-y divide-gray-100">
                                {filteredLeads.length === 0 ? (
                                    <tr>
                                        <td colSpan="5" className="py-12 text-center text-gray-400">Nenhum lead encontrado nesta lista.</td>
                                    </tr>
                                ) : (
                                    filteredLeads.map(item => (
                                        <tr key={item.id} className="hover:bg-slate-50 transition-colors">
                                            <td className="py-4 px-6">
                                                <input
                                                    type="checkbox"
                                                    checked={selectedLeads.includes(item.id)}
                                                    onChange={() => toggleSelectLead(item.id)}
                                                    className="w-4 h-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"
                                                />
                                            </td>
                                            <td className="py-4 px-6">
                                                <div className="font-bold text-slate-900">{item.lead_data?.nome || 'Sem Nome'}</div>
                                            </td>
                                            <td className="py-4 px-6">
                                                <div className="text-sm font-medium text-slate-900">{item.lead_data?.headline}</div>
                                                <div className="text-xs text-slate-500">{item.lead_data?.company}</div>
                                            </td>
                                            <td className="py-4 px-6">
                                                <span className={`px-2 py-0.5 rounded text-xs font-bold border ${item.status === 'ENRICHED' ? 'bg-green-50 text-green-700 border-green-200' : 'bg-gray-100 text-gray-600 border-gray-200'
                                                    }`}>
                                                    {item.status || 'Pendente'}
                                                </span>
                                            </td>
                                            <td className="py-4 px-6 text-right text-sm text-slate-500">
                                                {new Date(item.created_at).toLocaleDateString()}
                                            </td>
                                        </tr>
                                    ))
                                )}
                            </tbody>
                        </table>
                    )}
                </div>
            </div>

            {/* IMPORT MODAL */}
            <ImportContactsModal
                isOpen={isImportModalOpen}
                onClose={() => setIsImportModalOpen(false)}
                listId={id}
                clientId={selectedClientId}
                accountId={list?.account_id}
                onSuccess={() => fetchListAndLeads()}
            />
        </div>
    )
}

export default ListDetailsPage

```

## File: src\pages\ListsPage.jsx
```javascript
import React, { useState, useEffect } from 'react'
import { supabase } from '../services/supabaseClient'
import { useNavigate } from 'react-router-dom'
import {
    Plus,
    Search,
    Loader2,
    Users,
    ArrowRight,
    RefreshCw,
    Building,
    AlertTriangle,
    CheckCircle2
} from 'lucide-react'
import { useClientSelection } from '../contexts/ClientSelectionContext'

const ListsPage = () => {
    const navigate = useNavigate()
    const { selectedClientId } = useClientSelection()
    const [lists, setLists] = useState([])
    const [loading, setLoading] = useState(false)
    const [searchTerm, setSearchTerm] = useState('')
    const [isCreateModalOpen, setIsCreateModalOpen] = useState(false)
    const [newListName, setNewListName] = useState('')
    const [createLoading, setCreateLoading] = useState(false)

    // Client Data (Unipile ID)
    const [clientUnipileId, setClientUnipileId] = useState(null)
    const [clientName, setClientName] = useState('')
    const [clientLoading, setClientLoading] = useState(false)
    const [allClients, setAllClients] = useState([])
    const [targetClientId, setTargetClientId] = useState(null)

    useEffect(() => {
        if (selectedClientId) {
            setTargetClientId(selectedClientId)
            fetchClientDetails(selectedClientId)
            fetchLists()
            fetchAllClients()
        } else {
            setLists([])
            setClientUnipileId(null)
            setClientName('')
            setTargetClientId(null)
            fetchAllClients()
        }
    }, [selectedClientId])

    const fetchAllClients = async () => {
        try {
            const { data, error } = await supabase
                .from('clients')
                .select('id, name, unipile_account_id')
                .order('name', { ascending: true })
            if (error) throw error
            setAllClients(data || [])
        } catch (error) {
            console.error('Error fetching clients:', error)
        }
    }

    const fetchClientDetails = async (clientId) => {
        if (!clientId) {
            setClientUnipileId(null)
            setClientName('')
            return
        }
        setClientLoading(true)
        try {
            // If we already have the client in allClients, use it to save a round trip
            const clientFromList = allClients.find(c => c.id == clientId)
            if (clientFromList) {
                setClientUnipileId(clientFromList.unipile_account_id)
                setClientName(clientFromList.name)
                setClientLoading(false)
                return
            }

            const { data, error } = await supabase
                .from('clients')
                .select('name, unipile_account_id')
                .eq('id', clientId)
                .single()

            if (error) throw error
            setClientUnipileId(data?.unipile_account_id || null)
            setClientName(data?.name || 'Cliente')
        } catch (error) {
            console.error('Error fetching client details:', error)
            setClientUnipileId(null)
            setClientName('')
        } finally {
            setClientLoading(false)
        }
    }

    const handleTargetClientChange = (e) => {
        const newId = e.target.value
        setTargetClientId(newId)
        fetchClientDetails(newId)
    }

    const fetchLists = async () => {
        setLoading(true)
        try {
            const { data, error } = await supabase
                .from('campaigns')
                .select('*')
                .eq('client_id', selectedClientId)
                .order('created_at', { ascending: false })

            if (error) throw error
            setLists(data || [])
        } catch (error) {
            console.error('Error fetching lists:', error)
        } finally {
            setLoading(false)
        }
    }

    const handleCreateList = async (e) => {
        e.preventDefault()
        if (!newListName.trim() || !clientUnipileId || !targetClientId) return

        setCreateLoading(true)
        try {
            const { data, error } = await supabase
                .from('campaigns')
                .insert([{
                    name: newListName,
                    status: 'EMPTY',
                    client_id: targetClientId,
                    account_id: clientUnipileId
                }])
                .select()

            if (error) throw error

            if (data) {
                // Only update list state if created for current view context
                if (targetClientId == selectedClientId) {
                    setLists([data[0], ...lists])
                } else {
                    alert('Campanha criada para outro cliente. Troque de cliente para visualizar.')
                }
                setIsCreateModalOpen(false)
                setNewListName('')
            }
        } catch (error) {
            console.error('Error creating campaign:', error)
            alert('Erro ao criar campanha: ' + error.message)
        } finally {
            setCreateLoading(false)
        }
    }

    const handlePullLeads = async (e, list) => {
        e.stopPropagation() // Prevent row click

        if (!clientUnipileId) {
            alert('Este cliente n√£o possui um ID da Unipile configurado. Configure em "Gerenciar Clientes".')
            return
        }

        try {
            const response = await fetch('https://n8n-n8n-start.kfocge.easypanel.host/webhook/pull-leads-placeholder', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    campaign_id: list.id,
                    client_id: selectedClientId,
                    unipile_account_id: clientUnipileId
                })
            })

            if (response.ok) {
                alert('Solicita√ß√£o de leads enviada com sucesso!')
            } else {
                alert('Erro ao solicitar leads.')
            }
        } catch (error) {
            console.error(error)
            alert('Erro de conex√£o ao solicitar leads.')
        }
    }

    const filteredLists = lists.filter(l =>
        l.name.toLowerCase().includes(searchTerm.toLowerCase())
    )

    // AGENCY LOCK: Block view if no client is selected
    if (!selectedClientId) {
        return (
            <div className="min-h-screen bg-slate-50 p-6 md:p-8 font-sans text-slate-800 flex items-center justify-center">
                <div className="text-center max-w-md">
                    <div className="bg-white p-6 rounded-full inline-flex mb-6 shadow-sm border border-slate-100">
                        <Building size={48} className="text-slate-300" />
                    </div>
                    <h2 className="text-2xl font-bold text-slate-800 mb-3">Selecione um Cliente</h2>
                    <p className="text-slate-500 text-lg leading-relaxed">
                        Voc√™ precisa selecionar um cliente no menu superior para visualizar ou criar listas de prospec√ß√£o.
                    </p>
                </div>
            </div>
        )
    }

    return (
        <div className="min-h-screen bg-slate-50 p-6 md:p-8 font-sans text-slate-800">
            {/* HEADER */}
            <div className="max-w-7xl mx-auto mb-10">
                <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-8">
                    <div>
                        <h1 className="text-3xl font-bold text-slate-900 tracking-tight mb-2">Campanhas e Listas</h1>
                        <p className="text-slate-500 text-lg">Gerencie suas campanhas de prospec√ß√£o.</p>
                    </div>
                    <button
                        onClick={() => setIsCreateModalOpen(true)}
                        className="flex items-center gap-2 px-5 py-2.5 rounded-xl bg-indigo-600 text-white font-bold hover:bg-indigo-700 transition-all shadow-lg shadow-indigo-100"
                    >
                        <Plus size={20} /> Nova Campanha
                    </button>
                </div>

                {/* CONTROLS */}
                <div className="bg-white p-4 rounded-xl border border-slate-200 shadow-sm mb-6 flex flex-col md:flex-row justify-between items-center gap-4">
                    <div className="relative w-full md:w-96">
                        <Search className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400" size={18} />
                        <input
                            type="text"
                            placeholder="Buscar campanhas..."
                            value={searchTerm}
                            onChange={e => setSearchTerm(e.target.value)}
                            className="w-full pl-10 pr-4 py-2.5 bg-slate-50 border border-slate-200 rounded-lg text-slate-800 focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 transition-all font-medium placeholder:text-slate-400"
                        />
                    </div>
                </div>

                {/* LIST TABLE */}
                {loading || clientLoading ? (
                    <div className="py-20 flex justify-center text-gray-400">
                        <Loader2 className="animate-spin" size={32} />
                    </div>
                ) : filteredLists.length === 0 ? (
                    <div className="text-center py-20 bg-white rounded-2xl border border-gray-200 border-dashed">
                        <Users className="mx-auto text-gray-300 mb-4" size={48} />
                        <h3 className="text-lg font-bold text-slate-700 mb-2">Nenhuma campanha encontrada</h3>
                        <p className="text-gray-500 mb-6">Crie sua primeira campanha para come√ßar.</p>
                        <button
                            onClick={() => setIsCreateModalOpen(true)}
                            className="px-5 py-2 rounded-lg bg-indigo-50 text-indigo-600 font-bold hover:bg-indigo-100 transition-colors"
                        >
                            Criar Campanha
                        </button>
                    </div>
                ) : (
                    <div className="bg-white border border-slate-200 rounded-xl shadow-sm overflow-hidden">
                        <table className="w-full text-left border-collapse">
                            <thead>
                                <tr className="bg-slate-50 border-b border-slate-200 text-xs font-bold text-slate-500 uppercase tracking-wider">
                                    <th className="py-4 px-6">Nome da Campanha</th>
                                    <th className="py-4 px-6">Status</th>
                                    <th className="py-4 px-6">Criado em</th>
                                    <th className="py-4 px-6 text-right">A√ß√£o</th>
                                </tr>
                            </thead>
                            <tbody className="divide-y divide-gray-100">
                                {filteredLists.map(list => (
                                    <tr
                                        key={list.id}
                                        className="hover:bg-slate-50 transition-colors cursor-pointer group"
                                        onClick={() => navigate(`/campaigns/${list.id}/leads`)}
                                    >
                                        <td className="py-4 px-6">
                                            <div className="font-bold text-slate-900">{list.name}</div>
                                        </td>
                                        <td className="py-4 px-6">
                                            <span className={`px-2.5 py-1 rounded-full text-xs font-bold uppercase tracking-wide border ${list.status === 'READY' ? 'bg-green-50 text-green-600 border-green-100' :
                                                list.status === 'PROCESSING' ? 'bg-blue-50 text-blue-600 border-blue-100 animate-pulse' :
                                                    'bg-gray-100 text-gray-500 border-gray-200'
                                                }`}>
                                                {list.status || 'Rascunho'}
                                            </span>
                                        </td>
                                        <td className="py-4 px-6 text-slate-500 text-sm">
                                            {new Date(list.created_at).toLocaleDateString()}
                                        </td>
                                        <td className="py-4 px-6 text-right flex items-center justify-end gap-3">
                                            <button
                                                onClick={(e) => handlePullLeads(e, list)}
                                                className={`flex items-center gap-1.5 px-3 py-1.5 rounded-lg font-bold text-xs transition-colors border ${clientUnipileId
                                                    ? 'bg-blue-50 text-blue-600 hover:bg-blue-100 border-blue-200'
                                                    : 'bg-gray-100 text-gray-400 cursor-not-allowed border-gray-200'
                                                    }`}
                                                title={clientUnipileId ? "Puxar Leads do LinkedIn" : "Cliente sem ID Unipile configurado"}
                                                disabled={!clientUnipileId}
                                            >
                                                <RefreshCw size={14} /> Puxar Leads
                                            </button>
                                            <ArrowRight size={18} className="text-gray-300 group-hover:text-indigo-600 transition-colors" />
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                )}
            </div>

            {/* CREATE MODAL */}
            {isCreateModalOpen && (
                <div className="fixed inset-0 z-50 flex items-center justify-center bg-slate-900/50 backdrop-blur-sm p-4">
                    <div className="bg-white w-full max-w-md rounded-2xl shadow-2xl overflow-hidden animate-scale-in">
                        <div className="p-6 border-b border-gray-100">
                            <h2 className="text-xl font-bold text-slate-800">Nova Campanha</h2>
                            <p className="text-sm text-gray-500 mt-1">D√™ um nome para sua nova campanha de prospec√ß√£o.</p>
                        </div>
                        <form onSubmit={handleCreateList} className="p-6">
                            <div className="mb-4">
                                <label className="block text-sm font-bold text-slate-700 mb-2">Nome da Campanha</label>
                                <input
                                    autoFocus
                                    type="text"
                                    value={newListName}
                                    onChange={e => setNewListName(e.target.value)}
                                    placeholder="Ex: Prospec√ß√£o LinkedIn - CEOs"
                                    className="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl text-slate-800 focus:outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 transition-all font-medium"
                                />
                            </div>

                            <div className="mb-6">
                                <label className="block text-sm font-bold text-slate-700 mb-2">Cliente da Campanha</label>
                                <div className="space-y-3">
                                    <select
                                        value={targetClientId || ''}
                                        onChange={handleTargetClientChange}
                                        className="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl text-slate-800 focus:outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 transition-all font-medium appearance-none"
                                    >
                                        <option value="" disabled>Selecione o Cliente...</option>
                                        {allClients.map(client => (
                                            <option key={client.id} value={client.id}>
                                                {client.name}
                                            </option>
                                        ))}
                                    </select>

                                    {targetClientId && (
                                        clientUnipileId ? (
                                            <div className="flex items-center gap-3 p-3 bg-green-50 text-green-700 rounded-lg border border-green-200 animate-fade-in">
                                                <CheckCircle2 size={20} className="shrink-0" />
                                                <div className="text-sm">
                                                    <p className="font-bold">Conta Conectada</p>
                                                    <p className="text-xs mt-0.5">ID: {clientUnipileId}</p>
                                                </div>
                                            </div>
                                        ) : (
                                            <div className="flex items-center gap-3 p-3 bg-red-50 text-red-700 rounded-lg border border-red-200 animate-fade-in">
                                                <AlertTriangle size={20} className="shrink-0" />
                                                <div className="text-sm">
                                                    <p className="font-bold">Cliente sem conex√£o</p>
                                                    <p className="text-xs mt-0.5">
                                                        Este cliente n√£o possui um ID conectado.
                                                        <br />
                                                        V√° em <strong>Gerenciar Clientes</strong> para configurar.
                                                    </p>
                                                </div>
                                            </div>
                                        )
                                    )}
                                </div>
                            </div>

                            <div className="flex gap-3 justify-end">
                                <button
                                    type="button"
                                    onClick={() => setIsCreateModalOpen(false)}
                                    className="px-5 py-2.5 rounded-xl text-slate-600 font-bold hover:bg-gray-100 transition-colors"
                                >
                                    Cancelar
                                </button>
                                <button
                                    type="submit"
                                    disabled={!newListName.trim() || !clientUnipileId || createLoading}
                                    className="px-5 py-2.5 rounded-xl bg-indigo-600 text-white font-bold hover:bg-indigo-700 transition-all shadow-lg shadow-indigo-200 disabled:opacity-70 disabled:cursor-not-allowed flex items-center gap-2"
                                >
                                    {createLoading && <Loader2 className="animate-spin" size={18} />}
                                    Criar Campanha
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            )}
        </div>
    )
}

export default ListsPage

```

## File: src\pages\Login.css
```css
/* 
  DEPRECATED: Styles have been moved to Tailwind classes in Login.jsx
  as part of the Obsidian Glass visual overhaul.
*/
```

## File: src\pages\Login.jsx
```javascript
import React, { useState } from 'react';
import { useAuth } from '../contexts/AuthContext';
import { useNavigate } from 'react-router-dom';
import { Loader2, Lock, ArrowRight, ShieldCheck, Mail } from 'lucide-react';

const Login = () => {
    const [email, setEmail] = useState('');
    const [password, setPassword] = useState('');
    const [loading, setLoading] = useState(false);
    const [error, setError] = useState('');
    const { signIn } = useAuth();
    const navigate = useNavigate();

    const handleLogin = async (e) => {
        e.preventDefault();
        setLoading(true);
        setError('');

        try {
            await signIn(email, password);
            navigate('/');
        } catch (err) {
            setError('Falha ao entrar. Verifique suas credenciais.');
            console.error(err);
        } finally {
            setLoading(false);
        }
    };

    return (
        <div className="min-h-screen bg-obsidian flex items-center justify-center p-4 relative overflow-hidden">

            {/* AMBIENT BACKGROUND */}
            <div className="fixed top-[-20%] left-[-10%] w-[600px] h-[600px] bg-primary/20 blur-[120px] rounded-full pointer-events-none z-0" />
            <div className="fixed bottom-[-20%] right-[-10%] w-[600px] h-[600px] bg-blue-600/10 blur-[120px] rounded-full pointer-events-none z-0" />

            <div className="bg-charcoal/80 backdrop-blur-xl border border-glass-border p-8 w-full max-w-md rounded-2xl relative z-10 shadow-2xl animate-fade-in-up">

                {/* HEADER */}
                <div className="flex flex-col items-center mb-8">
                    <div className="w-16 h-16 rounded-2xl bg-gradient-to-br from-gray-800 to-black border border-glass-border flex items-center justify-center mb-6 shadow-inner">
                        <img src="/logo-linklead.png" alt="Link&Lead" className="w-10 h-auto opacity-90" />
                    </div>
                    <h1 className="text-2xl font-bold text-white mb-2">Bem-vindo de volta</h1>
                    <p className="text-gray-400 text-sm text-center">Acesse o painel de aprova√ß√µes Link&Lead</p>
                </div>

                <form onSubmit={handleLogin} className="space-y-6">
                    <div className="space-y-2">
                        <label className="text-sm font-medium text-gray-400 ml-1">Email Corporativo</label>
                        <div className="relative group">
                            <div className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 group-focus-within:text-primary transition-colors">
                                <Mail size={18} />
                            </div>
                            <input
                                type="email"
                                value={email}
                                onChange={(e) => setEmail(e.target.value)}
                                placeholder="seu@email.com"
                                className="w-full bg-white/5 border border-glass-border rounded-xl pl-10 pr-4 py-3 text-white placeholder-gray-600 focus:outline-none focus:border-primary/50 focus:ring-1 focus:ring-primary/50 transition-all font-medium"
                                required
                            />
                        </div>
                    </div>

                    <div className="space-y-2">
                        <label className="text-sm font-medium text-gray-400 ml-1">Senha</label>
                        <div className="relative group">
                            <div className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 group-focus-within:text-primary transition-colors">
                                <Lock size={18} />
                            </div>
                            <input
                                type="password"
                                value={password}
                                onChange={(e) => setPassword(e.target.value)}
                                placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                                className="w-full bg-white/5 border border-glass-border rounded-xl pl-10 pr-4 py-3 text-white placeholder-gray-600 focus:outline-none focus:border-primary/50 focus:ring-1 focus:ring-primary/50 transition-all font-medium"
                                required
                            />
                        </div>
                    </div>

                    {error && (
                        <div className="p-3 bg-red-500/10 border border-red-500/20 rounded-lg text-red-400 text-sm text-center">
                            {error}
                        </div>
                    )}

                    <button
                        type="submit"
                        disabled={loading}
                        className="w-full btn-primary py-3.5 text-base shadow-lg shadow-primary/20 hover:shadow-primary/40"
                    >
                        {loading ? (
                            <Loader2 className="animate-spin" size={20} />
                        ) : (
                            <>Entrar na Plataforma <ArrowRight size={20} /></>
                        )}
                    </button>
                </form>

                <div className="mt-8 pt-6 border-t border-glass-border text-center">
                    <div className="flex items-center justify-center gap-2 text-xs text-gray-500 font-medium">
                        <ShieldCheck size={14} className="text-primary/60" />
                        Protegido por Link&Lead Security
                    </div>
                </div>
            </div>
        </div>
    );
};

export default Login;

```

## File: src\pages\MissionsPage.jsx
```javascript
import React, { useState, useEffect, useMemo, useCallback } from 'react'
import { supabase } from '../services/supabaseClient'
import { useAuth } from '../contexts/AuthContext'
import { useClientSelection } from '../contexts/ClientSelectionContext'
import {
    Crosshair,
    Flame,
    Trophy,
    PartyPopper,
    Loader2,
    RefreshCw,
    AlertTriangle,
    Sparkles,
    TrendingUp,
    Users,
    DollarSign,
    HandMetal,
    MessageCircle,
    CheckCircle2,
    Hammer
} from 'lucide-react'

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CONSTANTS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const HOT_STAGES = ['G4', 'G5']
const VISIBLE_COLD_CARDS = 8

const CADENCE_LABELS = {
    G1: 'Primeiro Contato',
    G2: 'Networking',
    G3: 'Nutri√ß√£o',
    G4: 'Aquecido',
    G5: 'Pronto p/ Fechar',
}

const CADENCE_STYLES = {
    G1: 'bg-slate-800 text-slate-300 border-slate-600',
    G2: 'bg-blue-900/50 text-blue-300 border-blue-700',
    G3: 'bg-cyan-900/50 text-cyan-300 border-cyan-700',
    G4: 'bg-orange-900/50 text-orange-300 border-orange-700',
    G5: 'bg-red-900/50 text-red-300 border-red-700',
}

const COLUMN_THEMES = {
    hot: {
        borderTop: 'linear-gradient(90deg, #ef4444, #f97316)',
        headerBg: 'bg-red-500/[0.06]',
        headerBorder: 'border-red-500/15',
        countBg: 'bg-red-900/40',
        countText: 'text-red-400',
        countBorder: 'border-red-700/50',
        iconColor: 'text-red-400',
        cardBorder: 'border-l-orange-500/60',
        columnBg: 'rgba(239, 68, 68, 0.015)',
        emptyBg: 'bg-red-500/5',
        emptyBorder: 'border-red-500/10',
    },
    cold: {
        borderTop: 'linear-gradient(90deg, #3b82f6, #64748b)',
        headerBg: 'bg-blue-500/[0.06]',
        headerBorder: 'border-blue-500/15',
        countBg: 'bg-blue-900/40',
        countText: 'text-blue-400',
        countBorder: 'border-blue-700/50',
        iconColor: 'text-blue-400',
        cardBorder: 'border-l-blue-500/30',
        columnBg: 'rgba(59, 130, 246, 0.015)',
        emptyBg: 'bg-blue-500/5',
        emptyBorder: 'border-blue-500/10',
    }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MAIN COMPONENT ‚Äî COCKPIT DE VENDAS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const SalesCockpitPage = () => {
    const { user } = useAuth()
    const { selectedClientId } = useClientSelection()

    const [pendingTasks, setPendingTasks] = useState([])
    const [doneCount, setDoneCount] = useState(0)
    const [loading, setLoading] = useState(true)
    const [refreshing, setRefreshing] = useState(false)
    const [error, setError] = useState(null)
    const [completingIds, setCompletingIds] = useState(new Set())
    const [showAllCold, setShowAllCold] = useState(false)

    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    // DATA FETCHING
    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    const fetchTasks = useCallback(async (isRefresh = false) => {
        if (!user?.id) return
        if (isRefresh) setRefreshing(true)
        else setLoading(true)
        setError(null)

        try {
            let pendingQuery = supabase
                .from('tasks')
                .select('*, leads!inner(client_id, nome, empresa, headline, linkedin_profile_url, cadence_stage, total_interactions_count)')
                .eq('status', 'PENDING')
                .order('created_at', { ascending: true })

            if (selectedClientId) {
                pendingQuery = pendingQuery.eq('leads.client_id', selectedClientId)
            }

            let doneQuery = supabase
                .from('tasks')
                .select('id, leads!inner(client_id)', { count: 'exact' })
                .eq('status', 'DONE')

            if (selectedClientId) {
                doneQuery = doneQuery.eq('leads.client_id', selectedClientId)
            }

            doneQuery = doneQuery.limit(1)

            const [pendingResult, doneResult] = await Promise.all([pendingQuery, doneQuery])

            if (pendingResult.error) throw pendingResult.error

            setPendingTasks(pendingResult.data || [])
            setDoneCount(doneResult.count || 0)
        } catch (err) {
            console.error('Error fetching cockpit tasks:', err)
            setError('Falha ao carregar tarefas. Tente novamente.')
        } finally {
            setLoading(false)
            setRefreshing(false)
        }
    }, [user?.id, selectedClientId])

    useEffect(() => {
        fetchTasks()
    }, [fetchTasks])

    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    // TASK ACTIONS
    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    const handleComplete = async (taskId) => {
        setCompletingIds(prev => new Set(prev).add(taskId))
        setPendingTasks(prev => prev.filter(t => t.id !== taskId))
        setDoneCount(prev => prev + 1)

        try {
            const { error: updateError } = await supabase
                .from('tasks')
                .update({ status: 'DONE' })
                .eq('id', taskId)

            if (updateError) throw updateError
        } catch (err) {
            console.error('Error completing task:', err)
            fetchTasks(true)
        } finally {
            setCompletingIds(prev => {
                const next = new Set(prev)
                next.delete(taskId)
                return next
            })
        }
    }

    const handleExecute = (linkedinUrl) => {
        if (linkedinUrl) {
            window.open(linkedinUrl, '_blank', 'noopener,noreferrer')
        }
    }

    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    // DERIVED STATE
    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    const { hotTasks, coldTasks } = useMemo(() => {
        const hot = []
        const cold = []
        pendingTasks.forEach(task => {
            const stage = task.leads?.cadence_stage
            if (HOT_STAGES.includes(stage)) {
                hot.push(task)
            } else {
                cold.push(task)
            }
        })
        return { hotTasks: hot, coldTasks: cold }
    }, [pendingTasks])

    const totalMissions = pendingTasks.length + doneCount
    const progressPercent = totalMissions > 0 ? Math.round((doneCount / totalMissions) * 100) : 0
    const allDone = pendingTasks.length === 0 && !loading
    const visibleColdTasks = showAllCold ? coldTasks : coldTasks.slice(0, VISIBLE_COLD_CARDS)
    const hiddenColdCount = coldTasks.length - VISIBLE_COLD_CARDS

    const getGreeting = () => {
        const hour = new Date().getHours()
        if (hour < 12) return 'Bom dia'
        if (hour < 18) return 'Boa tarde'
        return 'Boa noite'
    }

    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    // LOADING STATE
    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    if (loading) {
        return (
            <div className="min-h-screen bg-obsidian text-white flex items-center justify-center">
                <div className="flex flex-col items-center gap-4">
                    <Loader2 className="w-8 h-8 animate-spin text-primary" />
                    <span className="tracking-wide uppercase text-xs font-bold text-gray-400">Carregando cockpit...</span>
                </div>
            </div>
        )
    }

    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    // RENDER
    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    return (
        <div className="min-h-screen bg-obsidian text-white p-4 sm:p-6 lg:p-8 relative overflow-hidden">
            {/* Background glow */}
            <div className="fixed top-20 right-20 w-96 h-96 bg-primary/10 blur-[100px] rounded-full pointer-events-none z-0" />

            <div className="relative z-10 max-w-6xl mx-auto">

                {/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */}
                {/* HEADER + PROGRESS                  */}
                {/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */}
                <div className="glass-panel rounded-2xl p-5 sm:p-6 mb-6 relative overflow-hidden">
                    <div className="flex items-start justify-between gap-4 mb-5">
                        <div className="flex items-center gap-3">
                            <div className="w-10 h-10 rounded-xl bg-primary/10 border border-primary/20 flex items-center justify-center">
                                <Crosshair size={20} className="text-primary" />
                            </div>
                            <div>
                                <h1 className="text-2xl sm:text-3xl font-bold tracking-tight text-white mb-1">
                                    {getGreeting()}! üéØ
                                </h1>
                                <p className="text-sm text-gray-400">
                                    {hotTasks.length > 0
                                        ? <><span className="text-orange-400 font-semibold">{hotTasks.length} lead(s) quente(s)</span> ¬∑ {coldTasks.length} em prospec√ß√£o</>
                                        : pendingTasks.length > 0
                                            ? <>{pendingTasks.length} tarefas aguardando execu√ß√£o.</>
                                            : 'Nenhuma tarefa pendente!'
                                    }
                                </p>
                            </div>
                        </div>

                        <button
                            onClick={() => fetchTasks(true)}
                            disabled={refreshing}
                            className="p-2 rounded-lg hover:bg-white/10 transition-colors text-gray-500 hover:text-white"
                            title="Atualizar tarefas"
                        >
                            <RefreshCw size={16} className={refreshing ? 'animate-spin' : ''} />
                        </button>
                    </div>

                    {/* Progress Bar */}
                    <div className="space-y-2">
                        <div className="flex items-center justify-between">
                            <span className="text-xs font-medium text-gray-500 uppercase tracking-wider">Progresso do dia</span>
                            <span className="text-sm font-bold text-gray-300">{doneCount}/{totalMissions} conclu√≠das</span>
                        </div>
                        <div className="h-3 bg-white/[0.05] rounded-full overflow-hidden border border-white/[0.08]">
                            <div
                                className="h-full rounded-full transition-all duration-700 ease-out"
                                style={{
                                    width: `${progressPercent}%`,
                                    background: progressPercent === 100
                                        ? 'linear-gradient(90deg, #10b981, #34d399)'
                                        : 'linear-gradient(90deg, #ff4d00, #ff8800)',
                                    boxShadow: progressPercent === 100
                                        ? '0 0 16px rgba(16, 185, 129, 0.6)'
                                        : '0 0 16px rgba(255, 77, 0, 0.5)',
                                }}
                            />
                        </div>
                    </div>
                </div>

                {/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */}
                {/* ERROR STATE                        */}
                {/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */}
                {error && (
                    <div className="glass-panel rounded-2xl p-8 mb-6 border-red-500/20">
                        <div className="flex flex-col items-center justify-center py-8 gap-4 text-center">
                            <div className="w-14 h-14 rounded-2xl bg-red-500/10 border border-red-500/20 flex items-center justify-center">
                                <AlertTriangle size={28} className="text-red-400" />
                            </div>
                            <p className="text-sm text-gray-400">{error}</p>
                            <button
                                onClick={() => fetchTasks()}
                                className="px-4 py-2 rounded-lg bg-white/5 hover:bg-white/10 text-gray-300 text-sm font-medium border border-glass-border transition-all"
                            >
                                Tentar novamente
                            </button>
                        </div>
                    </div>
                )}

                {/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */}
                {/* ZERO INBOX ‚Äî ALL DONE              */}
                {/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */}
                {allDone && !error && (
                    <div className="glass-panel rounded-2xl p-10 sm:p-16 text-center">
                        <div className="flex justify-center mb-4">
                            <div className="w-16 h-16 rounded-2xl bg-emerald-900/30 border border-emerald-500/20 flex items-center justify-center">
                                {doneCount > 0
                                    ? <Trophy size={32} className="text-emerald-400" />
                                    : <PartyPopper size={32} className="text-emerald-400" />
                                }
                            </div>
                        </div>
                        <h2 className="text-xl font-bold text-white mb-2">
                            {doneCount > 0 ? 'Cockpit Limpo! üèÜ' : 'Tudo em dia! üéâ'}
                        </h2>
                        <p className="text-sm text-gray-400 max-w-sm mx-auto">
                            {doneCount > 0
                                ? `Voc√™ completou ${doneCount} tarefas hoje. Excelente trabalho!`
                                : 'Nenhuma tarefa gerada no momento. Quando a IA identificar oportunidades, elas aparecer√£o aqui.'
                            }
                        </p>
                    </div>
                )}

                {/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */}
                {/* KANBAN BOARD ‚Äî 2 COLUMNS           */}
                {/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */}
                {!allDone && !error && (
                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-4">

                        {/* LEFT: üî• PRIORIDADES (G4, G5) */}
                        <KanbanColumn
                            title="Prioridades"
                            emoji="üî•"
                            icon={<DollarSign size={15} />}
                            count={hotTasks.length}
                            themeKey="hot"
                            emptyIcon={<Sparkles size={28} className="text-orange-400/40" />}
                            emptyTitle="Pipeline limpo"
                            emptyText="Nenhum lead em est√°gio avan√ßado (G4/G5). Foque na prospec√ß√£o ‚Üí"
                        >
                            {hotTasks.map(task => (
                                <TaskCard
                                    key={task.id}
                                    task={task}
                                    themeKey="hot"
                                    completing={completingIds.has(task.id)}
                                    onComplete={handleComplete}
                                    onExecute={handleExecute}
                                />
                            ))}
                        </KanbanColumn>

                        {/* RIGHT: üî® MODERADAS */}
                        <KanbanColumn
                            title="Moderadas"
                            emoji="üî®"
                            icon={<Users size={15} />}
                            count={coldTasks.length}
                            themeKey="cold"
                            emptyIcon={<TrendingUp size={28} className="text-blue-400/40" />}
                            emptyTitle="Tudo em dia"
                            emptyText="Nenhuma tarefa de prospec√ß√£o pendente."
                            footer={
                                hiddenColdCount > 0 && !showAllCold ? (
                                    <button
                                        onClick={() => setShowAllCold(true)}
                                        className="w-full py-3 text-center text-xs font-semibold text-blue-400 hover:text-blue-300 bg-blue-500/[0.04] hover:bg-blue-500/[0.08] border-t border-blue-500/10 transition-colors rounded-b-2xl"
                                    >
                                        Mostrar mais {hiddenColdCount} tarefas
                                    </button>
                                ) : showAllCold && coldTasks.length > VISIBLE_COLD_CARDS ? (
                                    <button
                                        onClick={() => setShowAllCold(false)}
                                        className="w-full py-3 text-center text-xs font-semibold text-gray-500 hover:text-gray-300 bg-white/[0.02] hover:bg-white/[0.04] border-t border-white/[0.06] transition-colors rounded-b-2xl"
                                    >
                                        Mostrar menos
                                    </button>
                                ) : null
                            }
                        >
                            {visibleColdTasks.map(task => (
                                <TaskCard
                                    key={task.id}
                                    task={task}
                                    themeKey="cold"
                                    completing={completingIds.has(task.id)}
                                    onComplete={handleComplete}
                                    onExecute={handleExecute}
                                />
                            ))}
                        </KanbanColumn>
                    </div>
                )}
            </div>
        </div>
    )
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// KANBAN COLUMN
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const KanbanColumn = ({ title, emoji, icon, count, themeKey, children, emptyIcon, emptyTitle, emptyText, footer }) => {
    const theme = COLUMN_THEMES[themeKey]
    const isEmpty = React.Children.count(children) === 0

    return (
        <div
            className="rounded-2xl overflow-hidden border border-white/[0.06] flex flex-col"
            style={{ background: theme.columnBg, backdropFilter: 'blur(12px)' }}
        >
            {/* Gradient accent bar */}
            <div className="h-[3px] w-full shrink-0" style={{ background: theme.borderTop }} />

            {/* Header */}
            <div className={`flex items-center justify-between px-4 py-3 ${theme.headerBg} border-b ${theme.headerBorder}`}>
                <div className="flex items-center gap-2">
                    <span className={theme.iconColor}>{icon}</span>
                    <h3 className="text-xs font-bold text-gray-300 tracking-wider uppercase">
                        {emoji} {title}
                    </h3>
                </div>
                <span className={`text-[11px] font-bold px-2.5 py-1 rounded-full ${theme.countBg} ${theme.countText} border ${theme.countBorder}`}>
                    {count}
                </span>
            </div>

            {/* Cards area */}
            <div
                className="flex-1 p-3 space-y-2.5 overflow-y-auto"
                style={{ maxHeight: '600px', minHeight: '140px' }}
            >
                {isEmpty ? (
                    <div className={`flex flex-col items-center justify-center py-10 gap-2 rounded-xl ${theme.emptyBg} border ${theme.emptyBorder}`}>
                        {emptyIcon}
                        <p className="text-sm font-semibold text-gray-400">{emptyTitle}</p>
                        <p className="text-[11px] text-gray-500 text-center px-6">{emptyText}</p>
                    </div>
                ) : children}
            </div>

            {/* Optional footer (show more / less) */}
            {footer}
        </div>
    )
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TASK CARD ‚Äî Smart Action Button
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const TaskCard = ({ task, themeKey, completing, onComplete, onExecute }) => {
    const lead = task.leads || {}
    const theme = COLUMN_THEMES[themeKey]
    const initial = lead.nome?.charAt(0)?.toUpperCase() || '?'

    const stage = lead.cadence_stage || ''
    const stageStyle = CADENCE_STYLES[stage] || 'bg-gray-800 text-gray-400 border-gray-700'

    const interactionCount = lead.total_interactions_count || 0
    const isFirstContact = interactionCount === 0

    return (
        <div
            className={`
                rounded-xl p-3.5 group
                transition-all duration-300 ease-out
                bg-white/[0.025] border border-white/[0.06]
                hover:bg-white/[0.055] hover:border-white/[0.13]
                hover:shadow-lg hover:shadow-black/20
                border-l-[3px] ${theme.cardBorder}
                ${completing
                    ? 'opacity-0 scale-95 translate-x-4 pointer-events-none'
                    : 'opacity-100 scale-100 translate-x-0'
                }
            `}
            style={{ backdropFilter: 'blur(8px)' }}
        >
            {/* Row 1: Avatar + Lead Info + Stage Badge */}
            <div className="flex items-start gap-3 mb-2">
                <div className="w-9 h-9 rounded-lg shrink-0 bg-gradient-to-br from-gray-800 to-gray-900 border border-white/[0.08] flex items-center justify-center">
                    <span className="text-xs font-bold text-gray-300">{initial}</span>
                </div>
                <div className="flex-1 min-w-0">
                    <div className="flex items-center gap-2 mb-0.5">
                        <h4 className="text-sm font-semibold text-white truncate">{lead.nome || 'Lead'}</h4>
                        {stage && (
                            <span className={`shrink-0 text-[9px] font-bold px-1.5 py-0.5 rounded border ${stageStyle}`}>
                                {stage}
                            </span>
                        )}
                    </div>
                    <p className="text-[11px] text-gray-500 truncate leading-tight">
                        {lead.headline || ''}
                        {lead.empresa && lead.headline ? ` ¬∑ ${lead.empresa}` : lead.empresa || ''}
                    </p>
                </div>
            </div>

            {/* Row 2: AI Instruction */}
            {task.instruction && (
                <div className="mb-3">
                    <p className="text-[11px] text-gray-400 leading-relaxed line-clamp-2 bg-white/[0.02] rounded-lg px-3 py-2 border border-white/[0.04]">
                        <span className="mr-1">üí°</span>{task.instruction}
                    </p>
                </div>
            )}

            {/* Row 3: Smart Action Buttons */}
            <div className="flex items-center gap-2">
                {/* PRIMARY: Smart LinkedIn Action */}
                {lead.linkedin_profile_url && (
                    <button
                        onClick={() => onExecute(lead.linkedin_profile_url)}
                        className={`
                            flex-1 flex items-center justify-center gap-1.5 px-3 py-2 rounded-lg text-[11px] font-semibold
                            transition-all duration-200
                            ${isFirstContact
                                ? 'bg-indigo-500/15 text-indigo-300 border border-indigo-500/25 hover:bg-indigo-500/25 hover:border-indigo-500/40'
                                : 'bg-emerald-500/10 text-emerald-400 border border-emerald-500/20 hover:bg-emerald-500/20 hover:border-emerald-500/35'
                            }
                        `}
                        title={isFirstContact ? 'Enviar primeiro contato' : 'Continuar conversa'}
                    >
                        {isFirstContact ? (
                            <>
                                <HandMetal size={13} />
                                <span>Enviar Icebreaker</span>
                            </>
                        ) : (
                            <>
                                <MessageCircle size={13} />
                                <span>Continuar Conversa</span>
                            </>
                        )}
                    </button>
                )}

                {/* SECONDARY: Concluir */}
                <button
                    onClick={() => onComplete(task.id)}
                    disabled={completing}
                    className="
                        shrink-0 flex items-center justify-center gap-1 px-3 py-2 rounded-lg text-[11px] font-semibold
                        bg-white/[0.04] text-gray-400 border border-white/[0.08]
                        hover:bg-emerald-500/15 hover:text-emerald-400 hover:border-emerald-500/25
                        transition-all duration-200
                        disabled:opacity-50 disabled:cursor-not-allowed
                    "
                    title="Marcar como conclu√≠da"
                >
                    {completing ? (
                        <Loader2 size={13} className="animate-spin" />
                    ) : (
                        <CheckCircle2 size={13} />
                    )}
                </button>
            </div>
        </div>
    )
}

export default SalesCockpitPage

```

## File: src\pages\PostFeedbackPage.css
```css
/* PostFeedbackPage.css */
@import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700&display=swap');

/* We will rely mostly on Tailwind in the JSX, but keeping some custom classes for specific components can be useful */
.spin {
    animation: spin 1s linear infinite;
}

@keyframes spin {
    from {
        transform: rotate(0deg);
    }

    to {
        transform: rotate(360deg);
    }
}
```

## File: src\pages\PostFeedbackPage.jsx
```javascript
import React, { useState, useEffect, useRef } from 'react'
import { useParams, useNavigate } from 'react-router-dom'
import { supabase } from '../services/supabaseClient'
import { useAuth } from '../contexts/AuthContext'
import { Send, Check, AlertTriangle, ArrowLeft, Loader2, Image as ImageIcon, MessageSquare, ThumbsUp, MessageCircle, MessageSquarePlus } from 'lucide-react'
import { pdfjs, Document, Page } from 'react-pdf'
import 'react-pdf/dist/Page/AnnotationLayer.css';
import 'react-pdf/dist/Page/TextLayer.css';

// Worker setup
pdfjs.GlobalWorkerOptions.workerSrc = `//unpkg.com/pdfjs-dist@${pdfjs.version}/build/pdf.worker.min.mjs`;

// Sub-component for PDF Carousel
const PdfCarousel = ({ url }) => {
  const [numPages, setNumPages] = useState(null);

  function onDocumentLoadSuccess({ numPages }) {
    setNumPages(numPages);
  }

  return (
    <Document file={url} onLoadSuccess={onDocumentLoadSuccess} className="flex gap-2">
      {Array.from(new Array(numPages), (el, index) => (
        <div key={`page_${index + 1}`} style={{ scrollSnapAlign: 'center', display: 'flex', justifyContent: 'center' }}>
          <Page
            pageNumber={index + 1}
            renderTextLayer={false}
            renderAnnotationLayer={false}
            height={600}
            canvasBackground="white"
          />
        </div>
      ))}
    </Document>
  );
}

// --- CUSTOM CSS STYLES (Vertical Feed + Compact Fixed Footer) ---
const pageStyles = `
  .feedback-page {
    min-height: 100vh;
    background-color: #f8fafc; /* Lighter background for better contrast */
    font-family: 'Montserrat', system-ui, sans-serif;
    color: #1f2937;
    /* Extra padding at bottom to prevent footer overlap */
    padding-bottom: 160px; 
  }
  
  .page-container {
    max-width: 700px;
    margin: 0 auto;
    padding: 1rem;
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  /* Navigation */
  .back-nav {
    margin-bottom: 0.5rem;
  }
  .btn-back {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: #64748b;
    font-size: 0.875rem;
    font-weight: 600;
    background: none;
    border: none;
    cursor: pointer;
    transition: color 0.2s;
  }
  .btn-back:hover { color: #0f172a; }

  /* SECTION 1: POST PREVIEW CARD */
  .post-preview-card {
    background: white;
    border-radius: 16px;
    box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05);
    overflow: hidden;
    border: 1px solid #e2e8f0;
  }

  .preview-header {
    padding: 1rem 1.25rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    border-bottom: 1px solid #f8fafc;
  }
  .preview-avatar {
    width: 44px;
    height: 44px;
    border-radius: 50%;
    background: #f1f5f9;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    color: #64748b;
    font-size: 1.1rem;
  }
  .preview-meta h3 {
    margin: 0;
    font-size: 1rem;
    font-weight: 700;
    color: #0f172a;
  }
  .preview-subtext {
    margin: 0;
    font-size: 0.75rem;
    color: #64748b;
  }

  /* Status Banner inside Post Card */
  .status-banner {
    padding: 0.4rem 0.8rem;
    font-size: 0.7rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    border-radius: 99px;
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .status-approved { background: #dcfce7; color: #166534; }
  .status-pending { background: #fef9c3; color: #854d0e; }
  .status-changes { background: #ffedd5; color: #9a3412; }

  .post-content-text {
    padding: 1.25rem;
    white-space: pre-wrap;
    font-size: 0.95rem;
    line-height: 1.6;
    color: #334155;
  }

  .post-media {
    width: 100%;
    background: #000;
  }
  .post-media img {
    width: 100%;
    height: auto;
    display: block;
    max-height: 600px;
    object-fit: contain; /* Contain ensures full image visible */
  }
  .media-placeholder {
    background: #f8fafc;
    padding: 4rem;
    text-align: center;
    color: #94a3b8;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  /* Mock Social Actions Footer */
  .social-footer {
    padding: 0.75rem 1.25rem;
    display: flex;
    gap: 1.5rem;
    border-top: 1px solid #e2e8f0;
    color: #64748b;
    background: #fff;
  }
  .mock-action {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 0.8rem;
    font-weight: 600;
    cursor: default;
  }

  /* SECTION 2: FEEDBACK UI (Vertical below post) */
  .feedback-section {
    /* No visual container styles needed as it's just the messages */
    display: flex;
    flex-direction: column;
    gap: 1rem;
    margin-top: 1rem;
  }
  
  .feedback-title {
    font-size: 0.9rem;
    font-weight: 700;
    color: #64748b;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-left: 0.5rem;
  }

  .chat-scroll {
    /* Remove max-height so it flows naturally with the page */
    display: flex;
    flex-direction: column;
    gap: 1rem;
    padding-bottom: 2rem; /* Extra buffer */
  }

  .message-row {
    display: flex;
    flex-direction: column;
    max-width: 85%;
  }
  .row-admin { align-self: flex-end; align-items: flex-end; }
  .row-client { align-self: flex-start; }

  .chat-bubble {
    padding: 0.75rem 1rem;
    border-radius: 16px;
    font-size: 0.95rem;
    line-height: 1.5;
    position: relative;
    box-shadow: 0 1px 2px rgba(0,0,0,0.05);
  }
  .bubble-admin {
    background: #3b82f6; 
    color: white;
    border-bottom-right-radius: 4px;
  }
  .bubble-client {
    background: white;
    border: 1px solid #e2e8f0;
    color: #1e293b;
    border-top-left-radius: 4px;
  }

  .chat-meta {
    font-size: 0.7rem;
    color: #94a3b8;
    margin-top: 4px;
    padding: 0 4px;
  }

  /* --- FIXED BOTTOM ACTION BAR --- */
  .fixed-footer {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-top: 1px solid #e2e8f0;
    box-shadow: 0 -4px 6px -1px rgba(0,0,0,0.05);
    z-index: 1000;
    padding: 0.75rem 1rem;
  }

  .footer-content {
    max-width: 700px;
    margin: 0 auto;
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }

  /* Input Row */
  .input-wrapper {
    display: flex;
    gap: 0.5rem;
    background: #f1f5f9;
    padding: 0.25rem 0.25rem 0.25rem 1rem;
    border-radius: 99px;
    align-items: center;
  }
  .chat-input {
    flex: 1;
    border: none;
    background: transparent;
    padding: 0.5rem 0;
    outline: none;
    font-size: 0.9rem;
    color: #334155;
  }
  .btn-send {
    background: #3b82f6;
    color: white;
    border: none;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: background 0.2s;
    flex-shrink: 0;
  }
  .btn-send:hover { background: #2563eb; }

  /* Buttons Row (Client Only) */
  .approval-actions {
    display: flex;
    gap: 0.75rem;
  }
  .btn-action {
    flex: 1;
    padding: 0.6rem;
    border-radius: 10px;
    font-weight: 600;
    font-size: 0.85rem;
    cursor: pointer;
    text-align: center;
    transition: transform 0.1s;
  }
  .btn-action:active { transform: scale(0.98); }

  .btn-approve {
    background: #16a34a;
    color: white;
    border: none;
    box-shadow: 0 2px 4px rgba(22, 163, 74, 0.2);
  }
  .btn-request {
    background: white;
    color: #475569;
    border: 1px solid #cbd5e1;
  }
  
  /* Upload Button Style */
  .upload-btn-overlay {
    position: absolute;
    bottom: 1rem;
    right: 1rem;
    background: rgba(0,0,0,0.7);
    color: white;
    padding: 0.5rem 1rem;
    border-radius: 99px;
    font-size: 0.75rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 6px;
    cursor: pointer;
    backdrop-filter: blur(4px);
  }
`

const PostFeedbackPage = () => {
  const { id } = useParams()
  const navigate = useNavigate()
  const { user, profile, loading: authLoading } = useAuth()
  const [post, setPost] = useState(null)
  const [comments, setComments] = useState([])
  const [loading, setLoading] = useState(true)
  const [messageText, setMessageText] = useState('')
  const [sending, setSending] = useState(false)
  const [uploading, setUploading] = useState(false)

  const commentsEndRef = useRef(null)
  const inputRef = useRef(null)

  const isAdmin = profile?.role === 'admin'
  // Magic Link Logic: If not admin, assume it's the client (Public Access)
  const isClient = !isAdmin

  useEffect(() => { commentsEndRef.current?.scrollIntoView({ behavior: 'smooth' }) }, [comments])

  useEffect(() => {
    if (!id) return
    const fetchData = async () => {
      try {
        const { data: postData } = await supabase.from('tabela_projetofred1').select('*').eq('id', id).single()
        setPost(postData)
        const { data: commentsData } = await supabase.from('post_comments').select('*').eq('post_id', id).order('created_at', { ascending: true })
        setComments(commentsData || [])
      } catch (err) { console.error(err) } finally { setLoading(false) }
    }
    fetchData()
    const channel = supabase.channel(`post_feed_${id}`).on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'post_comments', filter: `post_id=eq.${id}` }, (pl) => setComments(prev => [...prev, pl.new])).subscribe()
    return () => { supabase.removeChannel(channel) }
  }, [id])

  const handleQuoteParagraph = (text) => {
    const maxLen = 100
    const truncated = text.length > maxLen ? text.substring(0, maxLen) + '...' : text
    const quote = `> "${truncated}"\n\n`

    // Append or set message
    setMessageText(prev => (prev ? prev + '\n' + quote : quote))

    // Scroll and Focus
    commentsEndRef.current?.scrollIntoView({ behavior: 'smooth' })
    setTimeout(() => {
      inputRef.current?.focus()
    }, 300)
  }

  const handleSendMessage = async () => {
    if (!messageText.trim()) return
    setSending(true)
    try {
      const authorName = isAdmin ? 'Link&Lead' : (post?.nome_cliente || 'Cliente')

      const payload = {
        post_id: id,
        content: messageText,
        role: isAdmin ? 'admin' : 'client',
        author_name: authorName
        // user_id is NOT sent for guests/clients as it doesn't exist in the table schema or is optional
      }

      await supabase.from('post_comments').insert([payload])
      setMessageText('')
    } catch (err) { alert('Erro ao enviar.') } finally { setSending(false) }
  }

  const handleUpdateStatus = async (newStatus) => {
    if (!isClient) return

    let finalStatus = newStatus
    let successMessage = 'Post Aprovado! üöÄ'

    // Smart Approval Logic
    if (newStatus === 'APPROVED') {
      if (post.data_agendamento) {
        finalStatus = 'AGENDADO'
        const date = new Date(post.data_agendamento).toLocaleString('pt-BR')
        successMessage = `Post aprovado e agendado automaticamente para ${date}! üìÖ`
      } else {
        successMessage = 'Post aprovado! Aguardando defini√ß√£o de data pela ag√™ncia. ‚úÖ'
      }
    }

    try {
      await supabase.from('tabela_projetofred1').update({ status: finalStatus }).eq('id', id)
      setPost({ ...post, status: finalStatus })

      if (newStatus === 'APPROVED' || finalStatus === 'AGENDADO') {
        alert(successMessage)
      } else {
        inputRef.current?.focus()
      }
    } catch (err) { alert('Erro ao atualizar status.') }
  }

  const handleImageUpload = async (e) => {
    const file = e.target.files[0]
    if (!file) return
    setUploading(true)
    try {
      const fileName = `${id}_${Date.now()}_${file.name}`
      await supabase.storage.from('post-images').upload(fileName, file)
      const { data } = supabase.storage.from('post-images').getPublicUrl(fileName)

      // Save as array [url]
      const newImageArray = [data.publicUrl]

      await supabase.from('tabela_projetofred1').update({ sugestao_imagem: newImageArray }).eq('id', id)
      setPost({ ...post, sugestao_imagem: newImageArray })
    } catch (err) { alert('Erro no upload.') } finally { setUploading(false) }
  }

  if (authLoading || loading) return <div style={{ height: '100vh', display: 'flex', alignItems: 'center', justifyContent: 'center' }}><Loader2 className="animate-spin" /></div>
  if (!post) return <div>404 Post Not Found</div>

  const normalizedStatus = (post.status || '').toUpperCase()
  let statusObj = { cls: 'status-pending', txt: 'Pendente' }

  if (normalizedStatus === 'APPROVED' || normalizedStatus === 'APROVADO') {
    statusObj = { cls: 'status-approved', txt: 'Aprovado' }
  } else if (normalizedStatus === 'WAITING_APPROVAL' || normalizedStatus === 'PENDING') {
    statusObj = { cls: 'status-pending', txt: 'Aguardando Aprova√ß√£o' }
  } else if (normalizedStatus === 'CHANGES_REQUESTED' || normalizedStatus.includes('REVI')) {
    statusObj = { cls: 'status-changes', txt: 'Revis√£o Solicitada' }
  } else if (normalizedStatus === 'AGENDADO') {
    statusObj = { cls: 'status-approved', txt: 'Agendado' } // Reusing approved style for scheduled
  } else if (normalizedStatus === 'POSTADO') {
    statusObj = { cls: 'status-approved', txt: 'Publicado' }
  }

  // Helper to get array
  const images = Array.isArray(post.sugestao_imagem) ? post.sugestao_imagem : post.sugestao_imagem ? [post.sugestao_imagem] : []

  return (
    <div className="feedback-page">
      <style>{pageStyles}</style>

      <div className="page-container">
        <div className="back-nav">
          <button onClick={() => navigate(-1)} className="btn-back">
            <ArrowLeft size={16} /> Voltar
          </button>
        </div>

        {/* --- 1. POST PREVIEW (Top) --- */}
        <div className="post-preview-card">
          {/* Header */}
          <div className="preview-header">
            <div className="preview-avatar">
              {post.nome_cliente ? post.nome_cliente.charAt(0).toUpperCase() : 'C'}
            </div>
            <div className="preview-meta">
              <h3>{post.nome_cliente || 'Nome do Cliente'}</h3>
              <p className="preview-subtext">
                {post.data_agendamento
                  ? `Post Agendado para ${new Date(post.data_agendamento).toLocaleDateString('pt-BR')}`
                  : 'Post ainda n√£o agendado'
                }
              </p>
            </div>
            <div style={{ marginLeft: 'auto' }}>
              <div className={`status-banner ${statusObj.cls}`}>
                {statusObj.txt}
              </div>
            </div>
          </div>

          {/* Text Content */}
          <div className="post-content-text">
            {post.corpo_post && post.corpo_post.split(/\r?\n/).map((paragraph, idx) => {
              // If it's an empty line, render a small spacer to simulate a paragraph break
              if (!paragraph.trim()) return <div key={idx} style={{ height: '0.5rem' }} />

              return (
                <div key={idx} className="group relative p-1 -mx-1 hover:bg-gray-50 rounded transition-colors flex items-start">
                  <p className="flex-1 whitespace-pre-wrap leading-relaxed">{paragraph}</p>
                  <button
                    onClick={() => handleQuoteParagraph(paragraph)}
                    className="ml-2 opacity-0 group-hover:opacity-100 focus:opacity-100 transition-all text-blue-500 bg-white border border-blue-100 shadow-sm p-1 rounded-md hover:bg-blue-50 hover:text-blue-700 flex-shrink-0"
                    title="Citar este trecho"
                    style={{ marginTop: '0px' }}
                  >
                    <MessageSquarePlus size={14} />
                  </button>
                </div>
              )
            })}
          </div>

          {/* Media Content */}
          <div className="post-media" style={{ position: 'relative', background: '#000', minHeight: '300px', display: 'flex', alignItems: 'center', justifyContent: 'center', overflow: 'hidden' }}>
            {images.length > 0 ? (
              <div style={{ display: 'flex', overflowX: 'auto', width: '100%', scrollSnapType: 'x mandatory', gap: '4px' }}>
                {images.map((url, idx) => {
                  const isPdf = url.toLowerCase().includes('.pdf')
                  return (
                    <div
                      key={idx}
                      style={{
                        flex: '0 0 100%',
                        width: '100%',
                        height: '600px',
                        scrollSnapAlign: 'start',
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center',
                        background: '#f1f5f9'
                      }}
                    >
                      {isPdf ? (
                        <div style={{ width: '100%', height: '100%', overflowY: 'hidden', overflowX: 'auto', display: 'flex', scrollSnapType: 'x mandatory' }}>
                          <PdfCarousel url={url} />
                        </div>
                      ) : (
                        <img
                          src={url}
                          alt={`Slide ${idx}`}
                          style={{
                            width: '100%',
                            height: 'auto',
                            maxHeight: '600px',
                            objectFit: 'contain'
                          }}
                        />
                      )}
                    </div>
                  )
                })}
              </div>
            ) : (
              <div className="media-placeholder">
                <ImageIcon size={48} style={{ opacity: 0.3, marginBottom: 4 }} />
                <span>Sem imagem selecionada</span>
              </div>
            )}

            {isClient && (
              <label className="upload-btn-overlay">
                {uploading ? <Loader2 size={12} className="animate-spin" /> : <ImageIcon size={12} />}
                {uploading ? '...' : 'Alterar Imagem'}
                <input type="file" onChange={handleImageUpload} hidden disabled={uploading} />
              </label>
            )}
          </div>

          {/* Mock Footer */}
          <div className="social-footer">
            <div className="mock-action"><ThumbsUp size={16} /> Curtir</div>
            <div className="mock-action"><MessageCircle size={16} /> Comentar</div>
          </div>
        </div>

        {/* --- 2. FEEDBACK (Messages) --- */}
        <div className="feedback-section">
          <div className="feedback-title">Coment√°rios</div>
          <div className="chat-scroll">
            {comments.length === 0 && <div style={{ textAlign: 'center', color: '#cbd5e1', padding: '1rem', fontSize: '0.9rem' }}>Nenhum coment√°rio ainda.</div>}
            {comments.map((msg, i) => {
              const isAdminMsg = msg.role === 'admin'
              return (
                <div key={i} className={`message-row ${isAdminMsg ? 'row-admin' : 'row-client'}`}>
                  <div className={`chat-bubble ${isAdminMsg ? 'bubble-admin' : 'bubble-client'}`}>
                    {msg.content}
                  </div>
                  <div className="chat-meta">{msg.author_name} ‚Ä¢ {new Date(msg.created_at).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</div>
                </div>
              )
            })}
            <div ref={commentsEndRef}></div>
          </div>
        </div>
      </div>

      {/* --- 4. STICKY ACTION BAR (Client Only & Pending) --- */}
      {isClient && (normalizedStatus === 'WAITING_APPROVAL' || normalizedStatus === 'PENDING') && (
        <div className="fixed bottom-0 left-0 right-0 w-full bg-white border-t border-gray-200 z-50 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] mb-[70px]">
          <div className="max-w-[700px] mx-auto px-4 py-4 flex justify-between gap-4">
            <button
              className="flex-1 px-4 py-3 rounded-xl border border-gray-300 text-gray-600 font-bold text-sm hover:bg-gray-50 transition-colors"
              onClick={() => {
                commentsEndRef.current?.scrollIntoView({ behavior: 'smooth' })
                setTimeout(() => {
                  inputRef.current?.focus()
                  setMessageText("Solicito ajuste em: ")
                }, 300)
              }}
            >
              Solicitar Altera√ß√£o
            </button>

            <button
              className="flex-1 px-4 py-3 rounded-xl bg-green-600 text-white font-bold text-sm hover:bg-green-700 shadow-md transition-transform active:scale-95 flex items-center justify-center gap-2"
              onClick={() => handleUpdateStatus('APPROVED')}
            >
              Aprovar Post <Check size={18} />
            </button>
          </div>
        </div>
      )}

      {/* --- 5. ALWAYS VISIBLE CHAT FOOTER --- */}
      <div className="fixed-footer" style={{ zIndex: 40 }}>
        <div className="footer-content">
          <div className="input-wrapper">
            <input
              ref={inputRef}
              className="chat-input"
              placeholder="Digite sua mensagem..."
              value={messageText}
              onChange={e => setMessageText(e.target.value)}
              onKeyDown={e => e.key === 'Enter' && handleSendMessage()}
            />
            <button className="btn-send" onClick={handleSendMessage} disabled={sending || !messageText.trim()}>
              {sending ? <Loader2 size={16} className="animate-spin" /> : <Send size={16} />}
            </button>
          </div>
        </div>
      </div>

      {/* Helper Spacer to prevent content from being hidden behind footer */}
      <div style={{ height: '100px' }}></div>
    </div>
  )
}

export default PostFeedbackPage

```

## File: src\pages\PostsPage.css
```css
:root {
  --primary-color: #0f172a;
  --accent-color: #2563eb;
  --sidebar-w: 200px;
  --header-h: 60px;
  --bg-body: #f1f5f9;
  --border-color: #e2e8f0;
}

body {
  background-color: var(--bg-body);
}

.dashboard-layout {
  display: flex;
  min-height: 100vh;
}

/* SIDEBAR */
.sidebar {
  width: var(--sidebar-w);
  background: white;
  border-right: 1px solid var(--border-color);
  display: flex;
  flex-direction: column;
  position: fixed;
  height: 100vh;
  left: 0;
  top: 0;
  z-index: 100;
}

.logo-area {
  padding: 1rem;
  border-bottom: 1px solid var(--border-color);
}

.logo-area h2 {
  margin: 0;
  font-size: 1.25rem;
  color: #0f172a;
}

.logo-area span {
  font-size: 0.8rem;
  color: #64748b;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.nav-menu {
  padding: 1rem 0.75rem;
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 0.35rem;
  overflow-y: auto;
  min-height: 0;
}

/* Scrollbar Styling for Sidebar */
.nav-menu::-webkit-scrollbar {
  width: 6px;
}

.nav-menu::-webkit-scrollbar-track {
  background: #f1f5f9;
  /* Light Gray */
}

.nav-menu::-webkit-scrollbar-thumb {
  background-color: #f97316;
  /* Orange */
  border-radius: 4px;
}

.nav-menu::-webkit-scrollbar-thumb:hover {
  background-color: #ea580c;
  /* Darker Orange */
}

.nav-item {
  display: flex;
  align-items: center;
  gap: 0.6rem;
  padding: 0.6rem 0.75rem;
  color: #64748b;
  text-decoration: none;
  border-radius: 6px;
  font-weight: 500;
  font-size: 0.875rem;
  transition: all 0.2s;
}

.nav-item:hover,
.nav-item.active {
  background-color: #eff6ff;
  color: var(--accent-color);
}

.sidebar-footer {
  padding: 1rem;
  border-top: 1px solid var(--border-color);
}

.btn-new-post {
  width: 100%;
  background-color: var(--accent-color);
  color: white;
  border: none;
  padding: 0.5rem;
  border-radius: 8px;
  font-weight: 600;
  font-size: 0.8rem;
  cursor: pointer;
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 0.4rem;
}

.btn-new-post:hover {
  background-color: #1d4ed8;
}

/* MAIN CONTENT */
.main-content {
  margin-left: var(--sidebar-w);
  flex: 1;
  width: calc(100% - var(--sidebar-w));
  min-height: 100vh;
  padding: 1rem 1.5rem;
  overflow-x: hidden;
  box-sizing: border-box;
}

.top-bar {
  margin-bottom: 2rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.top-bar h1 {
  margin: 0;
  font-size: 1.8rem;
  color: #0f172a;
}

.filters-bar {
  margin-bottom: 1.5rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.tabs {
  display: flex;
  gap: 0.5rem;
  background: white;
  padding: 0.25rem;
  border-radius: 8px;
  border: 1px solid var(--border-color);
}

.tab-btn {
  background: transparent;
  border: none;
  padding: 0.5rem 1rem;
  border-radius: 6px;
  color: #64748b;
  font-weight: 500;
  cursor: pointer;
}

.tab-btn.active {
  background-color: #e0f2fe;
  color: var(--accent-color);
}

/* TABLE MODERNIZATION */
.table-container {
  background: white;
  border-radius: 16px;
  /* Smooth rounded corners */
  border: 1px solid var(--border-color);
  overflow: hidden;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
  /* Modern soft shadow */
}

.posts-table {
  width: 100%;
  border-collapse: separate;
  /* Allow spacing for rows if needed */
  border-spacing: 0;
}

.posts-table th {
  background-color: #f8fafc;
  padding: 1rem 1.5rem;
  /* More breathing room */
  text-align: left;
  font-weight: 600;
  color: #64748b;
  border-bottom: 1px solid var(--border-color);
  font-size: 0.75rem;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.posts-table td {
  padding: 1rem 1.5rem;
  border-bottom: 1px solid #f1f5f9;
  /* Lighter border for rows */
  color: #334155;
  font-size: 0.875rem;
  vertical-align: middle;
}

.posts-table tr:last-child td {
  border-bottom: none;
}

.posts-table tr:hover {
  background-color: #f8fafc;
  /* Subtle hover effect */
  transition: background-color 0.2s ease;
}

.fw-500 {
  font-weight: 600;
  color: #0f172a;
}

/* COMPACT & MODERN BADGES */
.badge {
  padding: 0.25rem 0.75rem;
  border-radius: 6px;
  /* Slightly squared pill for modern look */
  font-size: 0.7rem;
  /* Smaller font */
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.02em;
  display: inline-flex;
  align-items: center;
  gap: 0.35rem;
  white-space: nowrap;
  /* Prevent wrapping essentially */
  line-height: 1;
  border: 1px solid transparent;
  /* Prepare for border styles */
}

/* Status: APROVADO */
.badge-success {
  background: #ecfdf5;
  /* Crisp mint */
  color: #059669;
  border-color: #d1fae5;
}

.badge-success::before {
  content: "‚óè";
  font-size: 0.6rem;
  color: #10b981;
}

/* Status: REVIS√ÉO / ALTERA√á√ÉO */
.badge-warning {
  background: #fffbeb;
  /* Soft amber */
  color: #b45309;
  border-color: #fef3c7;
}

.badge-warning::before {
  content: "‚óè";
  font-size: 0.6rem;
  color: #f59e0b;
}

/* Status: AGUARDANDO / PENDENTE */
.badge-info {
  background: #eff6ff;
  /* Soft blue */
  color: #0369a1;
  border-color: #dbeafe;
}

.badge-info::before {
  content: "‚óè";
  font-size: 0.6rem;
  color: #3b82f6;
}

/* Status: POSTADO */
.badge-purple {
  background: #faf5ff;
  /* Soft purple */
  color: #7e22ce;
  border-color: #f3e8ff;
}

.badge-purple::before {
  content: "‚óè";
  font-size: 0.6rem;
  color: #9333ea;
}

/* ACTION BUTTONS */
.actions-group {
  display: flex;
  gap: 0.5rem;
  align-items: center;
}

.icon-btn {
  background: white;
  border: 1px solid #e2e8f0;
  padding: 0.4rem;
  border-radius: 6px;
  cursor: pointer;
  color: #64748b;
  display: flex;
  /* Center icon */
  align-items: center;
  justify-content: center;
  transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
}

.icon-btn:hover {
  background-color: #f8fafc;
  border-color: #cbd5e1;
  color: #0f172a;
  transform: translateY(-1px);
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
}

.icon-btn.text-danger:hover {
  color: #ef4444;
  border-color: #fecaca;
  background-color: #fef2f2;
}

/* MODAL */
.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000;
  animation: fadeIn 0.2s ease-out;
}

.modal-content {
  background: white;
  padding: 2rem;
  border-radius: 12px;
  width: 100%;
  max-width: 500px;
  box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
  animation: slideUp 0.3s ease-out;
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1.5rem;
}

.modal-header h2 {
  margin: 0;
  font-size: 1.25rem;
}

.close-btn {
  background: none;
  border: none;
  cursor: pointer;
  color: #94a3b8;
}

.close-btn:hover {
  color: #0f172a;
}

@keyframes fadeIn {
  from {
    opacity: 0;
  }

  to {
    opacity: 1;
  }
}

@keyframes slideUp {
  from {
    transform: translateY(20px);
    opacity: 0;
  }

  to {
    transform: translateY(0);
    opacity: 1;
  }
}

.mini-preview {
  background: #f8fafc;
  padding: 1rem;
  border-radius: 8px;
  margin: 1rem 0;
  font-size: 0.9rem;
  color: #475569;
}

.modal-actions {
  display: flex;
  gap: 1rem;
  margin-top: 1.5rem;
}

.modal-actions button,
.modal-actions a {
  flex: 1;
  text-align: center;
}

/* Tooltip for Feedback */
.tooltip-container {
  position: relative;
  display: inline-block;
  margin-left: 0.5rem;
  vertical-align: middle;
}

.tooltip-text {
  visibility: hidden;
  width: 200px;
  background-color: #333;
  color: #fff;
  text-align: center;
  border-radius: 6px;
  padding: 8px;
  position: absolute;
  z-index: 1;
  bottom: 125%;
  left: 50%;
  margin-left: -100px;
  opacity: 0;
  transition: opacity 0.3s;
  font-size: 0.8rem;
  font-weight: normal;
  text-transform: none;
}

.tooltip-container:hover .tooltip-text {
  visibility: visible;
  opacity: 1;
}

.text-warning {
  color: #f59e0b;
  cursor: help;
}
```

## File: src\pages\PostsPage.jsx
```javascript
import React, { useState, useEffect } from 'react'
import { supabase } from '../services/supabaseClient'
import { useAuth } from '../contexts/AuthContext'
import { useSearchParams, Link, useNavigate } from 'react-router-dom'
import {
    Loader2,
    ExternalLink,
    FileText,
    Trash2,
    Link as LinkIcon,
    AlertCircle,
    Filter,
    Pencil,
    MessageCircle,
    CalendarClock
} from 'lucide-react'
import EditPostModal from '../components/EditPostModal'
import SchedulePostModal from '../components/SchedulePostModal'
import './PostsPage.css'

const PostsPage = () => {
    // Dashboard States
    // Helper for Status Translation
    const getStatusLabel = (status) => {
        if (!status) return 'Desconhecido'

        const map = {
            'WAITING_APPROVAL': 'Aguardando Aprova√ß√£o',
            'CHANGES_REQUESTED': 'Altera√ß√£o Solicitada',
            'APPROVED': 'Aprovado',
            'waiting_approval': 'Aguardando Aprova√ß√£o',
            'changes_requested': 'Altera√ß√£o Solicitada',
            'approved': 'Aprovado',
            'postado': 'Postado',
            'POSTADO': 'Postado',
            'AGENDADO': 'Agendado'
        }

        return map[status] || map[status.toUpperCase()] || map[status.toLowerCase()] || status
    }

    const { profile, loading: authLoading } = useAuth()
    const navigate = useNavigate()
    const [posts, setPosts] = useState([])
    const [loadingPosts, setLoadingPosts] = useState(true)
    const [statusFilter, setStatusFilter] = useState('Todos')
    const [editingPost, setEditingPost] = useState(null)
    const [schedulingPost, setSchedulingPost] = useState(null)
    const [searchParams] = useSearchParams()
    const clientFilter = searchParams.get('client')

    // Notifications State
    const [unreadCounts, setUnreadCounts] = useState({})

    // Stable Fetch Functions
    // Safe Mount Check
    const isMounted = React.useRef(true)
    useEffect(() => {
        return () => { isMounted.current = false }
    }, [])

    const fetchPosts = React.useCallback(async () => {
        setLoadingPosts(true)
        try {
            let query = supabase
                .from('tabela_projetofred1')
                .select('*')
                .order('id', { ascending: false })
                .range(0, 49) // Limit to last 50 items

            // Role-based filtering
            // IMPORTANT: If Admin, show ALL. If Client, show ONLY THEIRS.
            if (profile?.role === 'client') {
                if (profile.nome_empresa) {
                    query = query.eq('nome_cliente', profile.nome_empresa)
                } else {
                    console.warn('Cliente sem nome_empresa definido.')
                    setPosts([])
                    return
                }
            }
            // Admin gets standard "All Posts" query (unless client param exists for specific filter)
            if (clientFilter && clientFilter.trim() !== '') {
                query = query.eq('nome_cliente', clientFilter)
            }

            const { data, error } = await query
            if (error) throw error

            // BLINDAGEM: Se houver processamento de dados (ex: map), proteja-o
            // Normalize status strictly to Uppercase String or UNKNOWN
            const postsTratados = (data || []).map(post => ({
                ...post,
                status: post.status ? String(post.status).toUpperCase() : 'UNKNOWN'
            }));

            // FORCE STATE UPDATE - NO MOUNT CHECK
            setPosts(postsTratados);

        } catch (err) {
            console.error("Erro CR√çTICO no fetch ou processamento:", err);
        } finally {
            setLoadingPosts(false); // FOR√áAR REMO√á√ÉO DO SPINNER
        }
    }, [profile?.role, profile?.nome_empresa, clientFilter])

    const fetchUnreadMessages = React.useCallback(async () => {
        try {
            const { data, error } = await supabase
                .from('post_comments')
                .select('post_id')
                .eq('read_by_admin', false)
                .eq('role', 'client')

            if (error) throw error

            const counts = {}
            data.forEach(msg => {
                counts[msg.post_id] = (counts[msg.post_id] || 0) + 1
            })
            setUnreadCounts(counts)
        } catch (err) {
            console.error("Erro ao buscar notifica√ß√µes:", err)
        }
    }, [])

    useEffect(() => {
        if (!authLoading && profile) {
            // Initial Load
            fetchPosts()
            fetchUnreadMessages()

            // Realtime subscription (Cleanup enforced)
            const channel = supabase
                .channel('realtime:posts_and_comments')
                .on('postgres_changes', { event: '*', schema: 'public', table: 'tabela_projetofred1' }, () => {
                    fetchPosts()
                })
                .on('postgres_changes', { event: '*', schema: 'public', table: 'post_comments' }, () => {
                    fetchUnreadMessages()
                })
                .subscribe()

            return () => {
                supabase.removeChannel(channel)
            }
        }
    }, [authLoading, profile?.id, fetchPosts, fetchUnreadMessages]) // Primitive dependency + memozied functions



    const handleDelete = async (id) => {
        if (!window.confirm('Tem certeza que deseja excluir este post?')) return

        try {
            const { error } = await supabase
                .from('tabela_projetofred1')
                .delete()
                .eq('id', id)

            if (error) throw error
            setPosts(posts.filter(post => post.id !== id))
        } catch (err) {
            alert('Erro ao excluir: ' + err.message)
        }
    }

    const copyLink = (id) => {
        const url = `${window.location.origin}/aprovacao?id=${id}`
        navigator.clipboard.writeText(url)
        alert('Link copiado!')
    }

    const getStatusColor = (status) => {
        const s = (status || 'WAITING_APPROVAL').toUpperCase()
        if (s === 'APPROVED' || s === 'APROVADO' || s.includes('APPROV')) return 'badge-success'
        if (s === 'CHANGES_REQUESTED' || s.includes('CHANGE') || s.includes('REVI')) return 'badge-warning'
        if (s.includes('POSTADO')) return 'badge-purple'
        if (s === 'AGENDADO') return 'badge-purple' // Or another distinctive color like badge-primary
        return 'badge-info'
    }

    // Filter Logic
    const filteredPosts = posts.filter(post => {
        // 1. Client Filter (URL)
        if (clientFilter && clientFilter.trim() !== '' && post.nome_cliente !== clientFilter) return false

        // 2. Tab Filter
        if (statusFilter === 'Todos') return true

        const s = (post.status || 'WAITING_APPROVAL').toUpperCase()
        if (statusFilter === 'Pendentes') return s === 'WAITING_APPROVAL' || s.includes('WAITING')
        if (statusFilter === 'Aprovados') return s === 'APPROVED' || s.includes('APPROV')
        if (statusFilter === 'Revis√£o') return s === 'CHANGES_REQUESTED' || s.includes('REVI')
        return true
    })

    return (
        <div style={{ padding: '0' }}>
            <header className="top-bar">
                <div>
                    <h1>Meus Posts</h1>
                    {clientFilter && (
                        <span style={{ color: '#64748b', display: 'flex', alignItems: 'center', gap: '0.5rem', marginTop: '0.5rem' }}>
                            <Filter size={16} /> Filtrando por cliente: <strong>{clientFilter}</strong>
                            <Link to="/posts" style={{ color: '#2563eb', fontSize: '0.875rem', marginLeft: '0.5rem' }}>Limpar</Link>
                        </span>
                    )}
                </div>
                <div className="user-profile">
                    <span>Admin Ag√™ncia</span>
                </div>
            </header>

            <div className="filters-bar">
                <div className="tabs">
                    {['Todos', 'Pendentes', 'Aprovados', 'Revis√£o'].map(filter => (
                        <button
                            key={filter}
                            className={`tab-btn ${statusFilter === filter ? 'active' : ''}`}
                            onClick={() => setStatusFilter(filter)}
                        >
                            {filter}
                        </button>
                    ))}
                </div>
            </div>

            <div className="table-container">
                {loadingPosts ? (
                    <div className="loading-state">
                        <Loader2 className="spinner" /> Carregando posts...
                    </div>
                ) : (
                    <table className="posts-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Cliente</th>
                                <th>Tema</th>
                                <th>P√∫blico Alvo</th>
                                <th>Status</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody>
                            {filteredPosts.length > 0 ? (
                                filteredPosts.map(post => {
                                    const unreadCount = unreadCounts[post.id] || 0
                                    return (
                                        <tr key={post.id}>
                                            <td>#{post.id}</td>
                                            <td className="fw-500">
                                                <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                                                    {post.nome_cliente || 'N/A'}
                                                    {unreadCount > 0 && (
                                                        <span title={`${unreadCount} novas mensagens`} style={{
                                                            background: '#ef4444',
                                                            color: 'white',
                                                            fontSize: '0.7rem',
                                                            fontWeight: 'bold',
                                                            padding: '0.1rem 0.5rem',
                                                            borderRadius: '99px',
                                                            display: 'flex',
                                                            alignItems: 'center',
                                                            gap: '4px'
                                                        }}>
                                                            <MessageCircle size={10} fill="white" /> {unreadCount}
                                                        </span>
                                                    )}
                                                </div>
                                            </td>
                                            <td>{post.tema || 'Sem Tema'}</td>
                                            <td>{post.publico || '-'}</td>
                                            <td>
                                                <span className={`badge ${getStatusColor(post.status)}`}>
                                                    {getStatusLabel(post.status)}
                                                </span>
                                            </td>
                                            <td>
                                                <div className="actions-group">
                                                    <button
                                                        className="icon-btn"
                                                        title="Abrir Sala de Guerra"
                                                        onClick={() => navigate(`/post-feedback/${post.id}`)}
                                                        style={{ position: 'relative' }}
                                                    >
                                                        <ExternalLink size={18} />
                                                        {unreadCount > 0 && <span style={{ position: 'absolute', top: -2, right: -2, width: 8, height: 8, background: '#ef4444', borderRadius: '50%' }}></span>}
                                                    </button>
                                                    <button
                                                        className="icon-btn"
                                                        title="Editar Post"
                                                        onClick={() => setEditingPost(post)}
                                                    >
                                                        <Pencil size={18} />
                                                    </button>
                                                    <button
                                                        className="icon-btn"
                                                        title="Copiar Link"
                                                        onClick={() => copyLink(post.id)}
                                                    >
                                                        <LinkIcon size={18} />
                                                    </button>
                                                    <button
                                                        className="icon-btn text-danger"
                                                        title="Excluir"
                                                        onClick={() => handleDelete(post.id)}
                                                    >
                                                        <Trash2 size={18} />
                                                    </button>
                                                    <button
                                                        className="icon-btn"
                                                        title="Agendar Postagem"
                                                        onClick={() => setSchedulingPost(post)}
                                                        style={{ color: '#8b5cf6' }}
                                                    >
                                                        <CalendarClock size={18} />
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    )
                                })
                            ) : (
                                <tr>
                                    <td colSpan="6" style={{ textAlign: 'center', padding: '2rem', color: '#64748b' }}>
                                        Nenhum post encontrado.
                                    </td>
                                </tr>
                            )}
                        </tbody>
                    </table>
                )}
            </div>

            {editingPost && (
                <EditPostModal
                    post={editingPost}
                    onClose={() => setEditingPost(null)}
                    onSuccess={() => {
                        fetchPosts()
                        setEditingPost(null)
                    }}
                />
            )}

            {schedulingPost && (
                <SchedulePostModal
                    post={schedulingPost}
                    onClose={() => setSchedulingPost(null)}
                    onSuccess={() => {
                        fetchPosts()
                        setSchedulingPost(null)
                    }}
                />
            )}
        </div>
    )
}

export default PostsPage

```

## File: src\pages\SalesHub.css
```css
/* 
  DEPRECATED: Styles have been moved to Tailwind classes in SalesHubPage.jsx.
  Reverted to Light Theme (White/Orange) per user request.
*/
```

## File: src\pages\SalesHubPage.jsx
```javascript
import React, { useState, useEffect, useRef } from 'react'
import { supabase } from '../services/supabaseClient'
import { useClientSelection } from '../contexts/ClientSelectionContext'
import {
    Search,
    Filter,
    MessageCircle,
    X,
    Copy,
    RefreshCw,
    Loader2,
    Sparkles,
    Briefcase,
    MapPin,
    Hash,
    ArrowRight,
    Users,
    Zap,
    Gem,
    Building2,
    Globe,
    Send,
    CheckCircle2,
    XCircle,
    Bot
} from 'lucide-react'

const SalesHubPage = () => {
    const { selectedClientId } = useClientSelection()
    const [leads, setLeads] = useState([])
    const [loading, setLoading] = useState(false)
    const [selectedLead, setSelectedLead] = useState(null)
    const [searchTerm, setSearchTerm] = useState('')
    const [debouncedSearch, setDebouncedSearch] = useState('')
    const [stats, setStats] = useState({ total: 0, hot: 0, interactions: 0 })

    // Pagination State
    const [page, setPage] = useState(0)
    const [hasMore, setHasMore] = useState(true)
    const [loadingMore, setLoadingMore] = useState(false)
    const ITEMS_per_PAGE = 50

    // Sync Logic State
    const [syncLoading, setSyncLoading] = useState(false)
    const [enrichmentLoading, setEnrichmentLoading] = useState(false)
    const [notification, setNotification] = useState(null)

    // Strategy Logic State
    const [sendingMessage, setSendingMessage] = useState(false)
    const [messageDraft, setMessageDraft] = useState('')

    // Debounce Search
    useEffect(() => {
        const timer = setTimeout(() => {
            setDebouncedSearch(searchTerm)
        }, 500)
        return () => clearTimeout(timer)
    }, [searchTerm])

    useEffect(() => {
        if (selectedLead) {
            setMessageDraft(selectedLead.suggested_message || '')
        }
    }, [selectedLead])

    const handleSync = async () => {
        if (!selectedClientId) return
        setSyncLoading(true)

        try {
            const response = await fetch('https://n8n-n8n-start.kfocge.easypanel.host/webhook/sync-connections', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ client_id: selectedClientId })
            })

            if (response.ok) {
                setNotification({ message: 'A minera√ß√£o come√ßou! Os leads aparecer√£o na tela automaticamente.', type: 'info' })
            } else {
                setNotification({ message: 'Erro ao iniciar sincroniza√ß√£o (Webhook).', type: 'error' })
                setSyncLoading(false)
            }
        } catch (error) {
            console.error(error)
            setNotification({ message: 'Erro de conex√£o.', type: 'error' })
            setSyncLoading(false)
        }

        setTimeout(() => setNotification(null), 5000)
    }

    const handleEnrichment = async (singleLead = null) => {
        if (!selectedClientId) return
        setEnrichmentLoading(true)

        let leadsToProcess = []

        if (singleLead) {
            leadsToProcess = [singleLead]
            setNotification({ message: `Enviando ${singleLead.nome} para an√°lise...`, type: 'info' })
        } else {
            // Filter leads in current view that are not qualified yet
            leadsToProcess = leads.filter(l => !l.qualification_status)
            if (leadsToProcess.length === 0) {
                setNotification({ message: 'Todos os leads desta lista j√° foram analisados.', type: 'info' })
                setEnrichmentLoading(false)
                setTimeout(() => setNotification(null), 3000)
                return
            }
            setNotification({ message: `Enviando ${leadsToProcess.length} leads para an√°lise...`, type: 'info' })
        }


        try {
            // Loop and send requests
            let processedCount = 0

            for (const lead of leadsToProcess) {
                try {
                    await fetch('https://n8n-n8n-start.kfocge.easypanel.host/webhook-test/qualificacao-cascata', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            id: lead.id,
                            name: lead.nome,
                            headline: lead.headline,
                            summary: lead.summary || '',
                            company_name: lead.company || lead.empresa || '',
                            client_id: selectedClientId
                        })
                    })
                    processedCount++
                } catch (err) {
                    console.error(`Erro ao enviar lead ${lead.id}`, err)
                }
            }

            setNotification({ message: `Processo iniciado! ${processedCount} leads enviados para enriquecimento.`, type: 'success' })

        } catch (error) {
            console.error(error)
            setNotification({ message: 'Erro ao conectar com servidor de enriquecimento.', type: 'error' })
        } finally {
            setEnrichmentLoading(false)
            setTimeout(() => setNotification(null), 5000)
        }
    }

    const fetchStats = async () => {
        if (!selectedClientId) return

        try {
            const { count: totalCount } = await supabase
                .from('leads')
                .select('*', { count: 'exact', head: true })
                .eq('client_id', selectedClientId)

            const { count: hotCount } = await supabase
                .from('leads')
                .select('*', { count: 'exact', head: true })
                .eq('client_id', selectedClientId)
                .eq('icp_score', 'A')

            const sevenDaysAgo = new Date()
            sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7)

            const { count: interactionsCount } = await supabase
                .from('interactions')
                .select('*, leads!inner(client_id)', { count: 'exact', head: true })
                .eq('leads.client_id', selectedClientId)
                .gte('interaction_date', sevenDaysAgo.toISOString())

            setStats({
                total: totalCount || 0,
                hot: hotCount || 0,
                interactions: interactionsCount || 0
            })

        } catch (error) {
            console.error('Erro ao buscar KPIs:', error)
        }
    }

    useEffect(() => {
        if (selectedClientId) {
            setLeads([])
            setPage(0)
            setHasMore(true)
            fetchLeads(0, true)
            fetchStats()
        } else {
            setLeads([])
            setStats({ total: 0, hot: 0, interactions: 0 })
        }
    }, [selectedClientId, debouncedSearch])

    useEffect(() => {
        if (!selectedClientId) return
        const channel = supabase.channel('leads-changes')
            .on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'leads', filter: `client_id=eq.${selectedClientId}` }, () => {
                setNotification({ message: 'Novos leads encontrados!', type: 'success' })
                fetchLeads(0, true)
                fetchStats()
            })
            // Listen for UPDATES too (Enrichment coming back)
            .on('postgres_changes', { event: 'UPDATE', schema: 'public', table: 'leads', filter: `client_id=eq.${selectedClientId}` }, () => {
                // Determine if we should show toast? Maybe too noisy. Just refresh.
                fetchLeads(0, true)
                fetchStats()
            })
            .subscribe()
        return () => { supabase.removeChannel(channel) }
    }, [selectedClientId])

    const fetchLeads = async (pageIndex = 0, isRefresh = false) => {
        if (!selectedClientId) return

        try {
            if (pageIndex === 0) setLoading(true)
            else setLoadingMore(true)

            const from = pageIndex * ITEMS_per_PAGE
            const to = from + ITEMS_per_PAGE - 1

            let query = supabase
                .from('leads')
                .select('*', { count: 'exact' })
                .eq('client_id', selectedClientId)
                .range(from, to)

            if (debouncedSearch) {
                query = query.or(`nome.ilike.%${debouncedSearch}%,company.ilike.%${debouncedSearch}%,empresa.ilike.%${debouncedSearch}%`)
            }

            const { data, count, error } = await query.order('created_at', { ascending: false })

            if (error) throw error

            if (data) {
                if (isRefresh || pageIndex === 0) {
                    setLeads(data)
                } else {
                    setLeads(prev => [...prev, ...data])
                }

                if (pageIndex === 0 && count !== null) {
                    setStats(prev => ({ ...prev, total: count }))
                }

                setHasMore(data.length === ITEMS_per_PAGE)
            }
        } catch (err) {
            console.error(err)
        } finally {
            setLoading(false)
            setLoadingMore(false)
        }
    }

    const loadMore = () => {
        if (!loadingMore && hasMore) {
            const nextPage = page + 1
            setPage(nextPage)
            fetchLeads(nextPage, false)
        }
    }

    const observerTarget = useRef(null);
    useEffect(() => {
        const observer = new IntersectionObserver(
            entries => {
                if (entries[0].isIntersecting && hasMore && !loading && !loadingMore) {
                    loadMore();
                }
            },
            { threshold: 1.0 }
        );
        if (observerTarget.current) observer.observe(observerTarget.current);
        return () => observer.disconnect();
    }, [hasMore, loading, loadingMore, leads]);

    const handleCopy = (text) => {
        navigator.clipboard.writeText(text)
        setNotification({ message: 'Copiado para a √°rea de transfer√™ncia', type: 'info' })
        setTimeout(() => setNotification(null), 2000)
    }

    const handleSendMessage = async () => {
        if (!selectedLead) return
        setSendingMessage(true)

        try {
            await new Promise(resolve => setTimeout(resolve, 1500))
            setNotification({ message: 'Conex√£o enviada com sucesso!', type: 'success' })
            setSelectedLead(null)
        } catch (e) {
            setNotification({ message: 'Erro ao enviar.', type: 'error' })
        } finally {
            setSendingMessage(false)
            setTimeout(() => setNotification(null), 3000)
        }
    }

    // --- HELPER COMPONENTS ---
    const QualificationBadge = ({ isHighTicket, isB2B, companySize }) => {
        return (
            <div className="flex flex-wrap gap-1.5 justify-start">
                {isHighTicket && (
                    <div className="w-6 h-6 rounded-md bg-purple-50 text-purple-600 border border-purple-100 flex items-center justify-center shadow-sm" title="High Ticket Potential">
                        <Gem size={14} />
                    </div>
                )}

                {isB2B && (
                    <span className="px-1.5 py-0.5 rounded-md bg-blue-50 text-blue-700 text-[10px] font-extrabold border border-blue-100 flex items-center shadow-sm">
                        B2B
                    </span>
                )}

                {companySize && (
                    <span className={`px-1.5 py-0.5 rounded-md text-[10px] font-bold border flex items-center shadow-sm ${companySize === 'Enterprise'
                        ? 'bg-purple-100 text-purple-700 border-purple-200'
                        : companySize === 'Mid-Market'
                            ? 'bg-indigo-50 text-indigo-600 border-indigo-100'
                            : 'bg-gray-100 text-gray-600 border-gray-200'
                        }`}>
                        {companySize}
                    </span>
                )}
            </div>
        )
    }

    return (
        <div className="min-h-screen bg-gray-50 p-6 md:p-8 font-sans text-slate-800">

            {/* NOTIFICATION TOAST */}
            {notification && (
                <div className={`fixed top-6 right-6 z-50 px-4 py-3 rounded-lg shadow-lg border flex items-center gap-3 animate-slide-in-right ${notification.type === 'error' ? 'bg-red-50 border-red-200 text-red-600' : 'bg-white border-gray-200 text-slate-700'
                    }`}>
                    {notification.type === 'error' ? <Zap size={18} /> : <RefreshCw size={18} className={syncLoading || enrichmentLoading ? "animate-spin text-orange-500" : "text-green-500"} />}
                    <span className="text-sm font-medium">{notification.message}</span>
                </div>
            )}

            {/* HEADER */}
            <div className="max-w-7xl mx-auto mb-10">
                <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-8">
                    <div>
                        <h1 className="text-3xl font-bold text-slate-900 tracking-tight mb-2">Minera√ß√£o de Base & Cad√™ncia</h1>
                        <p className="text-slate-500 text-lg">Identifique oportunidades ocultas e inicie conversas com contexto.</p>
                    </div>
                </div>

                {/* KPI CARDS */}
                <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div className="bg-white p-6 rounded-2xl border border-gray-200 shadow-sm hover:shadow-md transition-all">
                        <div className="flex items-center gap-3 mb-2 text-slate-500 text-sm font-semibold uppercase tracking-wider">
                            <Users size={16} /> Total na Base
                        </div>
                        <div className="text-4xl font-extrabold text-slate-900">{stats.total}</div>
                    </div>
                    <div className="bg-white p-6 rounded-2xl border border-orange-100 shadow-sm hover:shadow-md transition-all relative overflow-hidden group">
                        <div className="absolute top-0 right-0 w-20 h-20 bg-orange-500/5 rounded-bl-full -mr-4 -mt-4 transition-transform group-hover:scale-110"></div>
                        <div className="flex items-center gap-3 mb-2 text-orange-600 text-sm font-bold uppercase tracking-wider">
                            <Zap size={16} fill="currentColor" /> Oportunidades ICP A
                        </div>
                        <div className="text-4xl font-extrabold text-orange-600">{stats.hot}</div>
                    </div>
                    <div className="bg-white p-6 rounded-2xl border border-blue-100 shadow-sm hover:shadow-md transition-all">
                        <div className="flex items-center gap-3 mb-2 text-blue-600 text-sm font-bold uppercase tracking-wider">
                            <MessageCircle size={16} /> Intera√ß√µes (7d)
                        </div>
                        <div className="text-4xl font-extrabold text-blue-600">{stats.interactions}</div>
                    </div>
                </div>

                {/* CONTROLS */}
                <div className="bg-white p-4 rounded-xl border border-gray-200 shadow-sm mb-6 flex flex-col md:flex-row justify-between items-center gap-4">
                    <div className="relative w-full md:w-96">
                        <Search className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400" size={18} />
                        <input
                            type="text"
                            placeholder="Buscar por nome, cargo ou empresa..."
                            value={searchTerm}
                            onChange={e => setSearchTerm(e.target.value)}
                            className="w-full pl-10 pr-4 py-2.5 bg-gray-50 border border-gray-200 rounded-lg text-slate-700 focus:outline-none focus:border-orange-500 focus:ring-1 focus:ring-orange-500 transition-all font-medium placeholder:text-gray-400"
                        />
                    </div>
                    <div className="flex gap-3 w-full md:w-auto">
                        <button
                            onClick={handleSync}
                            disabled={syncLoading || enrichmentLoading}
                            className={`flex items-center gap-2 px-4 py-2.5 rounded-lg font-semibold text-sm transition-all ${syncLoading
                                ? 'bg-orange-50 text-orange-400 cursor-not-allowed'
                                : 'bg-orange-50 text-orange-600 hover:bg-orange-100 hover:text-orange-700 border border-orange-200'
                                }`}
                        >
                            <RefreshCw size={16} className={syncLoading ? "animate-spin" : ""} />
                            {syncLoading ? 'Sincronizando...' : 'Sincronizar Conex√µes'}
                        </button>

                        <button
                            onClick={() => handleEnrichment()}
                            disabled={enrichmentLoading || syncLoading}
                            className={`flex items-center gap-2 px-4 py-2.5 rounded-lg font-semibold text-sm transition-all ${enrichmentLoading
                                ? 'bg-purple-50 text-purple-400 cursor-not-allowed'
                                : 'bg-purple-50 text-purple-600 hover:bg-purple-100 hover:text-purple-700 border border-purple-200'
                                }`}
                        >
                            <Sparkles size={16} className={enrichmentLoading ? "animate-spin" : ""} />
                            {enrichmentLoading ? 'Analisando...' : '‚ú® Enriquecer Base'}
                        </button>

                        <button className="flex items-center gap-2 px-4 py-2.5 rounded-lg bg-gray-50 text-slate-600 border border-gray-200 hover:bg-gray-100 font-semibold text-sm transition-all">
                            <Filter size={16} /> Filtros
                        </button>
                    </div>
                </div>

                {/* TABLE */}
                <div className="bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden">
                    <div className="overflow-x-auto">
                        <table className="w-full text-left border-collapse">
                            <thead>
                                <tr className="bg-gray-50 border-b border-gray-200 text-xs font-bold text-gray-400 uppercase tracking-wider">
                                    <th className="py-4 px-6 border-r border-gray-100/50 w-[30%]">Lead & Motivo</th>
                                    <th className="py-4 px-6 border-r border-gray-100/50 w-[15%]">Empresa</th>
                                    <th className="py-4 px-6 border-r border-gray-100/50 w-[15%]">Qualifica√ß√£o</th>
                                    <th className="py-4 px-6 border-r border-gray-100/50 w-[15%]">Status</th>
                                    <th className="py-4 px-6 border-r border-gray-100/50 w-[10%]">Engajamento</th>
                                    <th className="py-4 px-6 w-[15%]">A√ß√£o</th>
                                </tr>
                            </thead>
                            <tbody className="divide-y divide-gray-100">
                                {loading && stats.total === 0 ? (
                                    <tr><td colSpan="5" className="py-12 text-center text-gray-400"><Loader2 className="animate-spin mx-auto mb-2" />Carregando...</td></tr>
                                ) : leads.map(lead => {

                                    // Row Visual Logic
                                    const isQualified = lead.qualification_status === 'QUALIFIED'
                                    const isDisqualified = lead.qualification_status === 'DISQUALIFIED'

                                    let rowClass = "hover:bg-gray-50/80 transition-all group border-l-[3px] border-l-transparent"
                                    if (isQualified) rowClass += " bg-green-50/30 border-l-green-500"
                                    if (isDisqualified) rowClass += " opacity-60 grayscale-[0.5]"

                                    return (
                                        <tr key={lead.id} className={rowClass}>
                                            <td className="py-4 px-6">
                                                <div className="flex items-start gap-4">
                                                    <div className="w-10 h-10 rounded-full bg-slate-200 flex items-center justify-center text-slate-500 font-bold border-2 border-white shadow-sm overflow-hidden shrink-0 mt-1">
                                                        {lead.avatar_url ? <img src={lead.avatar_url} className="w-full h-full object-cover" /> : (lead.nome?.charAt(0) || '?')}
                                                    </div>
                                                    <div className="flex-1 min-w-0">
                                                        <div className="flex items-center gap-2">
                                                            <div className="font-bold text-slate-800 text-sm truncate">{lead.nome || 'Sem Nome'}</div>
                                                        </div>
                                                        <div className="text-xs text-gray-400 truncate mb-1">{lead.headline}</div>

                                                        {/* ICP REASON (TRUNCATED) */}
                                                        {lead.icp_reason && (
                                                            <div className="text-[11px] text-slate-500 bg-slate-50 px-2 py-1 rounded border border-slate-100 inline-block max-w-full truncate hover:whitespace-normal hover:border-slate-300 transition-colors cursor-help" title={lead.icp_reason}>
                                                                <span className="font-semibold text-slate-400 mr-1">üîé</span>
                                                                {lead.icp_reason}
                                                            </div>
                                                        )}
                                                    </div>
                                                </div>
                                            </td>
                                            <td className="py-4 px-6 align-top pt-5">
                                                <span className="text-sm font-medium text-slate-700 truncate block max-w-[150px]" title={lead.empresa}>
                                                    {lead.empresa || '-'}
                                                </span>
                                            </td>
                                            <td className="py-4 px-6 align-top pt-5">
                                                <QualificationBadge
                                                    isHighTicket={lead.is_high_ticket}
                                                    isB2B={lead.is_b2b}
                                                    companySize={lead.company_size_type}
                                                />
                                            </td>
                                            <td className="py-4 px-6 align-top pt-5">
                                                <span className={`px-2.5 py-1 rounded-md text-[11px] font-bold uppercase tracking-wide border ${lead.status_pipeline === 'Conex√£o'
                                                    ? 'bg-blue-50 text-blue-600 border-blue-100'
                                                    : 'bg-gray-100 text-gray-500 border-gray-200'
                                                    }`}>
                                                    {lead.status_pipeline || 'Desconhecido'}
                                                </span>
                                            </td>
                                            <td className="py-4 px-6 align-top pt-5">
                                                {lead.engagement_score > 0 ? (
                                                    <div className="flex items-center gap-1.5 font-bold text-orange-600 text-sm">
                                                        <Zap size={14} fill="currentColor" /> {lead.engagement_score} pts
                                                    </div>
                                                ) : (
                                                    <span className="text-gray-300 text-xs font-medium">-</span>
                                                )}
                                            </td>
                                            <td className="py-4 px-6 align-top pt-4">
                                                <div className="flex gap-2">
                                                    <button
                                                        onClick={() => !isDisqualified && setSelectedLead(lead)}
                                                        disabled={isDisqualified}
                                                        className={`px-4 py-2 rounded-lg font-semibold text-xs transition-all shadow-sm flex-1 ${isDisqualified
                                                            ? 'bg-gray-100 text-gray-400 cursor-not-allowed border border-gray-200'
                                                            : 'bg-white hover:bg-orange-50 text-slate-600 hover:text-orange-600 border border-gray-200 hover:border-orange-200 shadow-sm hover:shadow'
                                                            }`}
                                                    >
                                                        {isDisqualified ? 'Desqualificado' : 'Abordar'}
                                                    </button>
                                                    <button
                                                        onClick={(e) => {
                                                            e.stopPropagation()
                                                            handleEnrichment(lead)
                                                        }}
                                                        disabled={enrichmentLoading}
                                                        title="Re-analisar com IA"
                                                        className="px-2 py-2 rounded-lg bg-gray-50 text-gray-400 hover:bg-purple-50 hover:text-purple-600 border border-gray-200 transition-all"
                                                    >
                                                        <Bot size={16} />
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    )
                                })}
                            </tbody>
                        </table>
                    </div>
                    {/* Load More Sentinel */}
                    <div ref={observerTarget} className="py-6 text-center">
                        {loadingMore && <div className="flex items-center justify-center gap-2 text-gray-500 text-sm"><Loader2 className="animate-spin" size={16} /> Carregando mais...</div>}
                        {!hasMore && leads.length > 0 && <span className="text-gray-400 text-xs">Voc√™ chegou ao fim da lista.</span>}
                    </div>
                </div>
            </div>

            {/* DRAWER (Slide-Over) */}
            {selectedLead && (
                <div className="fixed inset-0 z-50 flex justify-end">
                    <div className="absolute inset-0 bg-slate-900/20 backdrop-blur-sm transition-opacity" onClick={() => setSelectedLead(null)} />
                    <div className="relative w-full max-w-lg bg-white h-full shadow-2xl flex flex-col animate-slide-in-right overflow-hidden border-l border-gray-200">
                        {/* Drawer Header */}
                        <div className="p-6 border-b border-gray-100 flex justify-between items-center bg-white">
                            <div>
                                <h2 className="text-xl font-bold text-slate-800">Cad√™ncia de Venda</h2>
                                <p className="text-xs text-gray-500 mt-1">Gerencie a intera√ß√£o com este lead</p>
                            </div>
                            <button onClick={() => setSelectedLead(null)} className="p-2 rounded-full hover:bg-gray-100 text-gray-400 hover:text-slate-600 transition-colors">
                                <X size={20} />
                            </button>
                        </div>

                        {/* Drawer Body - Split into Context and Action */}
                        <div className="flex-1 overflow-y-auto p-6 space-y-8 custom-scrollbar bg-slate-50/50">

                            {/* BLOCK 1: CONTEXT (Why is this lead here?) */}
                            <div className="bg-white p-5 rounded-xl border border-orange-100 shadow-sm">
                                <div className="flex items-start gap-4 mb-4">
                                    <div className="w-14 h-14 rounded-full bg-slate-100 flex items-center justify-center text-lg font-bold text-slate-500 shrink-0 border border-gray-200">
                                        {selectedLead.avatar_url ? <img src={selectedLead.avatar_url} className="w-full h-full object-cover rounded-full" /> : (selectedLead.nome?.charAt(0) || '?')}
                                    </div>
                                    <div className="flex-1">
                                        <div className="flex justify-between items-start">
                                            <h3 className="text-lg font-bold text-slate-900 leading-tight">{selectedLead.nome}</h3>
                                            {selectedLead.company_website && (
                                                <a href={selectedLead.company_website} target="_blank" rel="noopener noreferrer" className="text-gray-400 hover:text-blue-600 transition-colors" title="Visitar Site">
                                                    <Globe size={18} />
                                                </a>
                                            )}
                                        </div>
                                        <p className="text-sm text-gray-500 mb-1">{selectedLead.headline}</p>
                                        <div className="flex flex-wrap gap-2 mt-2">
                                            {selectedLead.is_high_ticket && <span className="px-2 py-0.5 bg-indigo-50 text-indigo-700 text-[10px] font-bold rounded border border-indigo-100 flex items-center gap-1"><Gem size={10} /> High Ticket</span>}
                                            {selectedLead.company_size_type && <span className="px-2 py-0.5 bg-gray-100 text-gray-600 text-[10px] font-bold rounded border border-gray-200"><Building2 size={10} className="inline mr-1" />{selectedLead.company_size_type}</span>}
                                        </div>
                                    </div>
                                </div>

                                {/* ICP REASON */}
                                <div className="p-3 bg-orange-50 rounded-lg border border-orange-100/60">
                                    <h4 className="flex items-center gap-2 text-[10px] font-bold text-orange-600 uppercase tracking-wider mb-1">
                                        <Sparkles size={12} /> Motivo da Qualifica√ß√£o
                                    </h4>
                                    <p className="text-sm text-slate-700 leading-relaxed font-medium">
                                        {selectedLead.icp_reason || "Este perfil apresenta alta ader√™ncia com seu ICP ideal, ocupando cargo de decis√£o em setor estrat√©gico."}
                                    </p>
                                </div>
                            </div>

                            {/* Skills Tag Cloud (Collapsed/Secondary) */}
                            {selectedLead.skills && (
                                <div>
                                    <h4 className="text-xs font-bold text-gray-400 uppercase tracking-wider mb-3 px-2">Habilidades Detectadas</h4>
                                    <div className="flex flex-wrap gap-2 px-2">
                                        {(() => {
                                            try {
                                                const tags = typeof selectedLead.skills === 'string' ? JSON.parse(selectedLead.skills) : selectedLead.skills
                                                return tags.slice(0, 5).map((t, i) => (
                                                    <span key={i} className="px-2 py-1 rounded-md bg-white text-slate-500 text-xs font-medium border border-gray-200 shadow-sm">
                                                        {typeof t === 'string' ? t : t.name}
                                                    </span>
                                                ))
                                            } catch (e) { return null }
                                        })()}
                                    </div>
                                </div>
                            )}
                        </div>

                        {/* BLOCK 2: ACTION (Bottom Fixed) */}
                        <div className="p-6 border-t border-gray-200 bg-white">
                            <label className="block text-xs font-bold text-gray-500 uppercase tracking-wider mb-2">Mensagem de Conex√£o</label>

                            <div className="relative mb-4">
                                <textarea
                                    className="w-full h-32 p-3 bg-slate-50 border border-gray-300 rounded-lg text-sm text-slate-700 focus:outline-none focus:border-orange-500 focus:ring-1 focus:ring-orange-500 resize-none font-medium leading-relaxed"
                                    value={messageDraft}
                                    onChange={(e) => setMessageDraft(e.target.value)}
                                    placeholder="Escreva sua mensagem de conex√£o..."
                                />
                                <button
                                    onClick={() => handleCopy(messageDraft)}
                                    className="absolute top-2 right-2 p-1.5 rounded-md bg-white text-gray-400 hover:text-orange-600 border border-gray-200 shadow-sm transition-all"
                                    title="Copiar texto"
                                >
                                    <Copy size={14} />
                                </button>
                            </div>

                            <button
                                onClick={handleSendMessage}
                                disabled={sendingMessage}
                                className={`w-full py-3.5 rounded-xl text-white font-bold shadow-lg transition-all transform active:scale-95 flex items-center justify-center gap-2 ${sendingMessage
                                    ? 'bg-orange-300 cursor-not-allowed'
                                    : 'bg-orange-600 hover:bg-orange-700 shadow-orange-200 hover:shadow-orange-300'
                                    }`}
                            >
                                {sendingMessage ? <Loader2 className="animate-spin" size={20} /> : <Send size={18} />}
                                {sendingMessage ? 'Enviando...' : 'Enviar Conex√£o'}
                            </button>

                            <p className="text-center text-[10px] text-gray-400 mt-2">
                                Esta a√ß√£o enviar√° um convite de conex√£o via LinkedIn.
                            </p>
                        </div>
                    </div>
                </div>
            )}
        </div>
    )
}

export default SalesHubPage

```

## File: src\pages\SalesInbox.css
```css
/* 
  DEPRECATED: Styles have been moved to Tailwind classes in SalesInboxPage.jsx
  as part of the Obsidian Glass visual overhaul.
*/
```

## File: src\pages\SalesInboxPage.jsx
```javascript
import React, { useState, useEffect, useRef } from 'react'
import { supabase } from '../services/supabaseClient'
import { useClientSelection } from '../contexts/ClientSelectionContext'
import { Search, Send, MoreVertical, Phone, Mail, MapPin, Briefcase, Zap, Star, Sparkles, MessageSquare, Copy, Check, LayoutGrid, List, Loader2, X } from 'lucide-react'

const N8N_GENERATE_REPLY_URL = 'https://n8n-n8n-start.kfocge.easypanel.host/webhook/generate-reply'
import KanbanColumn from '../components/kanban/KanbanColumn'
import KanbanLeadCard from '../components/kanban/KanbanLeadCard'
import StrategicContextCard from '../components/StrategicContextCard'

const SalesInboxPage = () => {
    const { selectedClientId } = useClientSelection()
    const [leads, setLeads] = useState([])
    const [loadingLeads, setLoadingLeads] = useState(false)
    const [activeLead, setActiveLead] = useState(null)

    // View Mode
    const [viewMode, setViewMode] = useState('list') // 'list' | 'kanban'
    const [searchTerm, setSearchTerm] = useState('')

    // Chat State
    const [interactions, setInteractions] = useState([])
    const [loadingChat, setLoadingChat] = useState(false)
    const [newMessage, setNewMessage] = useState('')

    // AI Actions State
    const [draftMessage, setDraftMessage] = useState('')
    const [selectedSuggestionIdx, setSelectedSuggestionIdx] = useState(null)
    const [copiedIdx, setCopiedIdx] = useState(null)
    const [generatingReply, setGeneratingReply] = useState(false)
    const [sdrSeniorGenerated, setSdrSeniorGenerated] = useState(false)
    const [generatedReasoning, setGeneratedReasoning] = useState(null)

    // 1. Fetch Inbox Leads (Score > 0, Sorted Desc)
    useEffect(() => {
        if (!selectedClientId) return

        const fetchInboxLeads = async () => {
            setLoadingLeads(true)
            try {
                const { data, error } = await supabase
                    .from('leads')
                    .select('*')
                    .eq('client_id', selectedClientId)
                    .order('last_interaction_date', { ascending: false, nullsFirst: false })
                    .limit(50)

                if (error) throw error

                const leadIds = (data || []).map(l => l.id)

                // Fetch last interaction direction (is_sender) per lead
                let lastSenderMap = {}
                if (leadIds.length > 0) {
                    const { data: intData } = await supabase
                        .from('interactions')
                        .select('lead_id, is_sender, interaction_date')
                        .in('lead_id', leadIds)
                        .order('interaction_date', { ascending: false })

                    if (intData) {
                        intData.forEach(row => {
                            if (!(row.lead_id in lastSenderMap)) {
                                lastSenderMap[row.lead_id] = row.is_sender
                            }
                        })
                    }
                }

                const processedLeads = (data || []).map(lead => ({
                    ...lead,
                    total_interactions_count: lead.total_interactions_count || 0,
                    last_interaction_date: lead.last_interaction_date || null,
                    // is_sender=true ‚Üí I sent last msg | is_sender=false ‚Üí lead sent last msg
                    _lastMsgIsSender: lead.id in lastSenderMap ? lastSenderMap[lead.id] : null
                }))

                setLeads(processedLeads)
            } catch (err) {
                console.error('Erro ao buscar leads do inbox:', err)
            } finally {
                setLoadingLeads(false)
            }
        }

        fetchInboxLeads()
    }, [selectedClientId])

    // 2. Fetch Interactions when Active Lead Changes
    useEffect(() => {
        if (!activeLead) {
            setInteractions([])
            setDraftMessage('')
            setSelectedSuggestionIdx(null)
            setSdrSeniorGenerated(false)
            setGeneratedReasoning(null)
            return
        }

        // Load suggested_message from DB if it exists
        if (activeLead.suggested_message) {
            setDraftMessage(activeLead.suggested_message)
            setSdrSeniorGenerated(true)
        } else {
            setDraftMessage('')
            setSdrSeniorGenerated(false)
        }
        setSelectedSuggestionIdx(null)
        setGeneratedReasoning(null)

        const fetchInteractions = async () => {
            setLoadingChat(true)
            try {
                const { data, error } = await supabase
                    .from('interactions')
                    .select('*')
                    .eq('lead_id', activeLead.id)
                    .order('interaction_date', { ascending: false })

                if (error) throw error
                setInteractions(data || [])
            } catch (err) {
                console.error('Erro ao buscar chat:', err)
            } finally {
                setLoadingChat(false)
            }
        }

        fetchInteractions()
    }, [activeLead])

    // Kanban Categorization Logic
    // 1) Prioridade Alta: confian√ßa >= 75
    // 2) Para Responder: confian√ßa < 75, lead enviou a √∫ltima msg (eu preciso responder)
    // 3) Aguardando: confian√ßa < 75, eu enviei a √∫ltima msg (aguardando lead responder)
    // 4) Stand-by: confian√ßa < 75, mais de 7 dias desde a √∫ltima mensagem
    const categorizeLeads = (leadsArray) => {
        const now = new Date()
        const sevenDaysAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000)

        const highPriority = []
        const toRespond = []
        const waiting = []
        const standby = []

        leadsArray.forEach(lead => {
            const trustScore = lead?.trust_score || lead?.engagement_score || 0
            const lastDate = lead?.last_interaction_date ? new Date(lead.last_interaction_date) : null

            // Rule 1: Prioridade Alta ‚Äî confian√ßa >= 75
            if (trustScore >= 75) {
                highPriority.push(lead)
                return
            }

            // Rule 4: Stand-by ‚Äî mais de 7 dias sem intera√ß√£o
            if (lastDate && lastDate < sevenDaysAgo) {
                standby.push(lead)
                return
            }

            // Rule 2 & 3: baseado em quem enviou a √∫ltima mensagem
            // _lastMsgIsSender: true = eu enviei, false = lead enviou, null = sem dados
            if (lead._lastMsgIsSender === false) {
                // Lead enviou a √∫ltima msg ‚Üí eu preciso responder
                toRespond.push(lead)
            } else if (lead._lastMsgIsSender === true) {
                // Eu enviei a √∫ltima msg ‚Üí aguardando resposta do lead
                waiting.push(lead)
            } else {
                // Sem hist√≥rico de intera√ß√£o ‚Üí Para Responder (default)
                toRespond.push(lead)
            }
        })

        return { highPriority, toRespond, waiting, standby }
    }

    const filteredLeads = searchTerm.trim()
        ? leads.filter(lead => {
            const term = searchTerm.toLowerCase()
            return (
                (lead.nome || '').toLowerCase().includes(term) ||
                (lead.headline || '').toLowerCase().includes(term) ||
                (lead.company || '').toLowerCase().includes(term)
            )
        })
        : leads

    const kanbanData = categorizeLeads(filteredLeads)

    const handleSendMessage = async () => {
        if (!newMessage.trim() || !activeLead) return

        // Optimistic UI Update
        const tempMsg = {
            id: Date.now(),
            content: newMessage,
            direction: 'outbound',
            interaction_date: new Date().toISOString()
        }
        setInteractions([tempMsg, ...interactions])
        setNewMessage('')
    }

    const handleAiSend = () => {
        if (!draftMessage.trim() || !activeLead) return

        console.log('[LinkedIn Send] Simulating send:', draftMessage)

        // Optimistic Update
        const tempMsg = {
            id: Date.now(),
            content: draftMessage,
            direction: 'outbound',
            interaction_date: new Date().toISOString()
        }
        setInteractions([tempMsg, ...interactions])
        alert('‚úÖ Mensagem enviada via LinkedIn (Simula√ß√£o)')
        setDraftMessage('')
    }

    const copyToClipboard = (text, idx) => {
        navigator.clipboard.writeText(text)
        setCopiedIdx(idx)
        setTimeout(() => setCopiedIdx(null), 2000)
    }

    const generateAISuggestion = async () => {
        if (!activeLead || !selectedClientId) return

        setGeneratingReply(true)
        setSdrSeniorGenerated(false)
        setGeneratedReasoning(null)
        try {
            const conversationHistory = interactions
                .slice().reverse()
                .map(msg => `${msg.is_sender ? 'Eu' : 'Lead'}: ${msg.content}`)
                .join('\n')

            const payload = {
                user_id: selectedClientId,
                lead_id: activeLead.id,
                lead_name: activeLead.nome || '',
                lead_headline: activeLead.headline || '',
                lead_location: activeLead.location || '',
                lead_reasoning: activeLead.analysis_reasoning || '',
                lead_icp_reason: activeLead.icp_reason || '',
                conversation_history: conversationHistory,
                is_icebreaker: interactions.length === 0
            }

            const response = await fetch(N8N_GENERATE_REPLY_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            })

            if (!response.ok) throw new Error('Erro na requisi√ß√£o')

            const data = await response.json()
            if (data.reply) {
                setNewMessage(data.reply)
                setDraftMessage(data.reply)
                setSdrSeniorGenerated(true)
                if (data.reasoning) {
                    setGeneratedReasoning(data.reasoning)
                }
            }

            // After 5s, re-fetch the lead's strategic columns + suggested_message (populated by n8n workflow)
            const leadId = activeLead.id
            setTimeout(async () => {
                try {
                    const { data: updated, error } = await supabase
                        .from('leads')
                        .select('last_cadence_level, last_signal_detected, last_psychological_factor, last_forbidden_action, last_strategy_used, suggested_message')
                        .eq('id', leadId)
                        .single()

                    if (error || !updated) return

                    // Update activeLead & leads array
                    setActiveLead(prev => prev && prev.id === leadId ? { ...prev, ...updated } : prev)
                    setLeads(prev => prev.map(l => l.id === leadId ? { ...l, ...updated } : l))

                    // Update Pr√≥ximo Passo with DB suggested_message
                    if (updated.suggested_message) {
                        setDraftMessage(updated.suggested_message)
                        setSdrSeniorGenerated(true)
                    }
                } catch (err) {
                    console.error('[Raio-X] Error refreshing strategic data:', err)
                }
            }, 5000)
        } catch (error) {
            console.error('[AI] Error generating suggestion:', error)
            alert('‚ùå Erro ao gerar sugest√£o. Tente novamente.')
        } finally {
            setGeneratingReply(false)
        }
    }

    if (!selectedClientId) return (
        <div className="flex flex-col items-center justify-center h-[calc(100vh-100px)] text-gray-400 gap-4">
            <div className="w-16 h-16 rounded-full bg-primary/10 border border-primary/30 flex items-center justify-center">
                <Mail size={24} className="text-primary/70" />
            </div>
            <p className="text-gray-300">Selecione um cliente para acessar o Inbox.</p>
        </div>
    )

    return (
        <div className="flex flex-col h-[calc(100vh-120px)] p-2 gap-4 overflow-hidden">

            {/* HEADER & TOGGLE */}
            <div className="flex flex-wrap justify-between items-center px-4 gap-3 shrink-0">
                <h1 className="text-xl font-bold text-black flex items-center gap-2">
                    <LayoutGrid size={20} className="text-primary" /> Inbox Inteligente
                </h1>

                {/* Search Input */}
                <div className="relative flex-1 max-w-xs">
                    <Search size={14} className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500" />
                    <input
                        type="text"
                        placeholder="Pesquisar lead..."
                        value={searchTerm}
                        onChange={e => setSearchTerm(e.target.value)}
                        className="w-full bg-black/40 border border-white/10 rounded-xl pl-9 pr-8 py-2 text-sm text-white placeholder-gray-500 focus:outline-none focus:border-primary/50 focus:ring-1 focus:ring-primary/30 transition-all"
                    />
                    {searchTerm && (
                        <button
                            onClick={() => setSearchTerm('')}
                            className="absolute right-2.5 top-1/2 -translate-y-1/2 text-gray-500 hover:text-white transition-colors"
                        >
                            <X size={14} />
                        </button>
                    )}
                </div>

                <div className="bg-black/40 p-1 rounded-xl border border-white/10 flex gap-1 backdrop-blur-md">
                    <button
                        onClick={() => setViewMode('kanban')}
                        className={`px-3 py-1.5 rounded-lg text-xs font-bold uppercase tracking-wider transition-all flex items-center gap-2 ${viewMode === 'kanban' ? 'bg-primary text-white shadow-lg shadow-primary/20' : 'text-gray-400 hover:text-white hover:bg-white/5'}`}
                    >
                        <LayoutGrid size={14} /> Kanban
                    </button>
                    <button
                        onClick={() => setViewMode('list')}
                        className={`px-3 py-1.5 rounded-lg text-xs font-bold uppercase tracking-wider transition-all flex items-center gap-2 ${viewMode === 'list' ? 'bg-primary text-white shadow-lg shadow-primary/20' : 'text-gray-400 hover:text-white hover:bg-white/5'}`}
                    >
                        <List size={14} /> Lista
                    </button>
                </div>
            </div>

            {/* KANBAN VIEW */}
            {viewMode === 'kanban' && (
                <div className="flex-1 overflow-x-auto pb-4 custom-scrollbar">
                    <div className="flex gap-6 min-w-max h-full px-4">
                        {/* Column 1: High Priority */}
                        <KanbanColumn
                            title="Prioridade Alta"
                            icon="üî•"
                            count={kanbanData.highPriority.length}
                            colorClass="bg-red-500"
                        >
                            {kanbanData.highPriority.map(lead => (
                                <KanbanLeadCard
                                    key={lead.id}
                                    lead={lead}
                                    onClick={(l) => { setActiveLead(l); setViewMode('list') }}
                                />
                            ))}
                        </KanbanColumn>

                        {/* Column 2: To Respond */}
                        <KanbanColumn
                            title="Para Responder"
                            icon="üì©"
                            count={kanbanData.toRespond.length}
                            colorClass="bg-blue-500"
                        >
                            {kanbanData.toRespond.map(lead => (
                                <KanbanLeadCard
                                    key={lead.id}
                                    lead={lead}
                                    onClick={(l) => { setActiveLead(l); setViewMode('list') }}
                                />
                            ))}
                        </KanbanColumn>

                        {/* Column 3: Waiting */}
                        <KanbanColumn
                            title="Aguardando"
                            icon="‚è≥"
                            count={kanbanData.waiting.length}
                            colorClass="bg-amber-500"
                        >
                            {kanbanData.waiting.map(lead => (
                                <KanbanLeadCard
                                    key={lead.id}
                                    lead={lead}
                                    onClick={(l) => { setActiveLead(l); setViewMode('list') }}
                                />
                            ))}
                        </KanbanColumn>

                        {/* Column 4: Stand-by */}
                        <KanbanColumn
                            title="Stand-by / Frios"
                            icon="üí§"
                            count={kanbanData.standby.length}
                            colorClass="bg-slate-400"
                        >
                            {kanbanData.standby.map(lead => (
                                <KanbanLeadCard
                                    key={lead.id}
                                    lead={lead}
                                    onClick={(l) => { setActiveLead(l); setViewMode('list') }}
                                />
                            ))}
                        </KanbanColumn>
                    </div>
                </div>
            )}

            {/* LIST / DETAIL VIEW */}
            {viewMode === 'list' && (
                <div className="flex-1 flex gap-6 overflow-hidden">
                    {/* LEFT: Lead List */}
                    <div className="w-80 flex flex-col bg-[#0d0d0d] rounded-2xl border border-white/10 overflow-hidden shrink-0">
                        <div className="p-4 border-b border-white/10 bg-[#111111] flex justify-between items-center">
                            <span className="font-semibold text-white">Inbox Priorit√°rio</span>
                            <span className="text-xs bg-primary/20 text-primary px-2 py-1 rounded-full font-bold">
                                {filteredLeads.length}
                            </span>
                        </div>

                        <div className="flex-1 overflow-y-auto custom-scrollbar p-2 space-y-2">
                            {loadingLeads ? (
                                <div className="p-8 text-center text-gray-500 text-sm">Carregando...</div>
                            ) : filteredLeads.map(lead => (
                                <div
                                    key={lead.id}
                                    onClick={() => setActiveLead(lead)}
                                    className={`p-3 rounded-xl border cursor-pointer transition-all ${activeLead?.id === lead.id
                                        ? 'bg-primary/20 border-primary/50 shadow-lg shadow-primary/10'
                                        : 'border-transparent hover:bg-white/10 hover:border-white/10'
                                        }`}
                                >
                                    <div className="flex justify-between items-start mb-1">
                                        <span className={`font-semibold text-sm truncate max-w-[160px] ${activeLead?.id === lead.id ? 'text-white' : 'text-white'}`}>
                                            {lead.nome || 'Sem Nome'}
                                        </span>
                                        <span className="text-[10px] text-gray-400">
                                            {lead.last_interaction ? new Date(lead.last_interaction).toLocaleDateString(undefined, { month: 'short', day: 'numeric' }) : ''}
                                        </span>
                                    </div>
                                    <div className="text-xs text-gray-300 mb-2 truncate">
                                        {lead.headline || 'Lead qualificado'}
                                    </div>
                                    <div className="flex items-center gap-1 text-[10px] font-bold text-white bg-primary/30 self-start px-2 py-0.5 rounded-md inline-flex">
                                        <Star size={10} className="text-primary fill-primary" /> {lead.engagement_score} pts
                                    </div>
                                </div>
                            ))}
                            {!loadingLeads && filteredLeads.length === 0 && (
                                <div className="p-8 text-center text-gray-500 text-sm">
                                    {searchTerm ? 'Nenhum lead encontrado.' : 'Nenhum lead com engajamento.'}
                                </div>
                            )}
                        </div>
                    </div>

                    {/* MIDDLE: Chat Area */}
                    {activeLead ? (
                        <div className="flex-1 flex flex-col bg-[#0d0d0d] rounded-2xl border border-white/10 overflow-hidden relative">
                            {/* Header */}
                            <div className="p-4 border-b border-white/10 bg-[#111111] flex items-center justify-between z-10">
                                <div className="flex items-center gap-3 flex-1 min-w-0">
                                    <div className="w-10 h-10 shrink-0 rounded-full bg-gradient-to-br from-gray-700 to-black border border-glass-border flex items-center justify-center text-white font-bold shadow-inner overflow-hidden">
                                        {activeLead.avatar_url ? (
                                            <img src={activeLead.avatar_url} alt={activeLead.nome} className="w-full h-full object-cover" />
                                        ) : (
                                            activeLead.nome?.charAt(0)
                                        )}
                                    </div>
                                    <div className="flex-1 min-w-0">
                                        <div className="font-bold text-white text-sm truncate">{activeLead.nome}</div>
                                        <div className="text-xs text-gray-400 truncate">{activeLead.headline || activeLead.company}</div>
                                    </div>
                                </div>
                                <button className="p-2 rounded-lg hover:bg-white/5 text-gray-400 hover:text-white transition-colors shrink-0">
                                    <MoreVertical size={18} />
                                </button>
                            </div>

                            {/* Timeline */}
                            <div className="flex-1 overflow-y-auto p-6 flex flex-col-reverse gap-4 custom-scrollbar bg-black/20">
                                {loadingChat ? (
                                    <div className="text-center text-gray-500 text-sm py-10">Carregando hist√≥rico...</div>
                                ) : interactions.length === 0 ? (
                                    <div className="text-center text-gray-500 text-sm py-10 flex flex-col items-center gap-2">
                                        <MessageSquare size={24} className="opacity-20" />
                                        Nenhuma mensagem trocada ainda.
                                    </div>
                                ) : interactions.map(msg => (
                                    <div key={msg.id} className={`flex flex-col max-w-[80%] ${msg.is_sender === true ? 'self-end items-end' : 'self-start items-start'}`}>
                                        <div className={`px-4 py-3 rounded-2xl text-sm leading-relaxed ${msg.is_sender === true
                                            ? 'bg-primary/90 text-white rounded-br-sm shadow-lg shadow-primary/10'
                                            : 'bg-white/10 text-gray-200 rounded-bl-sm'
                                            }`}>
                                            {msg.content}
                                        </div>
                                        <span className="text-[10px] text-gray-500 mt-1 px-1">
                                            {new Date(msg.interaction_date).toLocaleString('pt-BR', { hour: '2-digit', minute: '2-digit' })}
                                        </span>
                                    </div>
                                ))}
                            </div>

                            {/* Input Area */}
                            <div className="p-4 border-t border-glass-border bg-white/[0.02]">
                                <div className="relative">
                                    <textarea
                                        className="w-full bg-black/40 border border-glass-border rounded-xl pl-4 pr-12 py-3 text-white placeholder-gray-500 focus:outline-none focus:border-primary/50 focus:ring-1 focus:ring-primary/50 transition-all resize-none text-sm"
                                        rows="1"
                                        placeholder="Digite sua resposta..."
                                        value={newMessage}
                                        onChange={e => setNewMessage(e.target.value)}
                                        onKeyDown={e => {
                                            if (e.key === 'Enter' && !e.shiftKey) {
                                                e.preventDefault()
                                                handleSendMessage()
                                            }
                                        }}
                                    />
                                    <button
                                        onClick={handleSendMessage}
                                        className="absolute right-2 top-1/2 -translate-y-1/2 p-2 rounded-lg bg-primary hover:bg-primary-dark text-white shadow-lg shadow-primary/20 transition-all"
                                    >
                                        <Send size={14} />
                                    </button>
                                </div>
                            </div>
                        </div>
                    ) : (
                        <div className="flex-1 flex flex-col items-center justify-center bg-[#0d0d0d] rounded-2xl border border-white/10 text-gray-300 gap-4">
                            <div className="w-20 h-20 rounded-full bg-primary/10 flex items-center justify-center">
                                <Zap size={32} className="text-primary/50" />
                            </div>
                            <p className="text-sm text-gray-400">Selecione um lead para iniciar o atendimento.</p>
                        </div>
                    )}

                    {/* RIGHT: Context & AI (ENHANCED) */}
                    <div className="w-80 flex flex-col gap-4 shrink-0 overflow-y-auto custom-scrollbar">
                        {activeLead ? (
                            <>
                                {/* Lead Info Card - 3 Main Indicators */}
                                <div className="bg-[#0d0d0d] rounded-2xl border border-white/10 p-5">
                                    <h4 className="text-xs font-bold text-primary uppercase tracking-wider mb-4">Dados do Lead</h4>
                                    <div className="flex items-center justify-between gap-3">
                                        {/* ICP Score */}
                                        <div className={`flex-1 text-center py-2 px-3 rounded-lg border ${activeLead.icp_score === 'A' ? 'bg-emerald-500/20 border-emerald-500/50 text-emerald-400' :
                                            activeLead.icp_score === 'B' ? 'bg-amber-500/20 border-amber-500/50 text-amber-400' :
                                                'bg-slate-500/20 border-slate-500/50 text-slate-400'
                                            }`}>
                                            <div className="text-[10px] uppercase tracking-wider opacity-70 mb-1">ICP</div>
                                            <div className="text-lg font-bold">{activeLead.icp_score || 'C'}</div>
                                        </div>

                                        {/* Interactions Count */}
                                        <div className="flex-1 text-center py-2 px-3 rounded-lg bg-blue-500/20 border border-blue-500/50 text-blue-400">
                                            <div className="text-[10px] uppercase tracking-wider opacity-70 mb-1">Intera√ß√µes</div>
                                            <div className="text-lg font-bold">{activeLead.total_interactions_count || activeLead.total_interactions || 0}</div>
                                        </div>

                                        {/* Cadence Stage */}
                                        {(() => {
                                            const stage = activeLead.cadence_stage || ''
                                            const match = stage?.toString().match(/(\d+)/)
                                            const level = match ? parseInt(match[1], 10) : 0
                                            const style = level >= 5 ? 'bg-emerald-500/20 border-emerald-500/50 text-emerald-400'
                                                : level >= 3 ? 'bg-amber-500/20 border-amber-500/50 text-amber-400'
                                                    : level >= 1 ? 'bg-blue-500/20 border-blue-500/50 text-blue-400'
                                                        : 'bg-slate-500/20 border-slate-500/50 text-slate-400'
                                            return (
                                                <div className={`flex-1 text-center py-2 px-3 rounded-lg border ${style}`}>
                                                    <div className="text-[10px] uppercase tracking-wider opacity-70 mb-1">Cad√™ncia</div>
                                                    <div className="text-lg font-bold">{stage || '‚Äî'}</div>
                                                </div>
                                            )
                                        })()}
                                    </div>
                                </div>

                                {/* Raio-X da Negocia√ß√£o */}
                                <StrategicContextCard lead={activeLead} />

                                {/* AI Suggestion Card - Always starts clean */}
                                <div className="relative p-[1px] rounded-2xl bg-gradient-to-br from-primary/50 to-purple-600/50 shadow-lg shadow-primary/10">
                                    <div className="bg-[#0d0d0d] rounded-2xl p-5 h-full flex flex-col gap-4">
                                        <div className="flex items-center gap-2 text-primary font-bold text-sm">
                                            <Sparkles size={16} /> Pr√≥ximo Passo
                                        </div>

                                        {(() => {
                                            const isIcebreaker = interactions.length === 0
                                            const hasGeneratedReply = !!draftMessage

                                            // Has a message (from DB or just generated) ‚Üí show it
                                            if (hasGeneratedReply) {
                                                return (
                                                    <>
                                                        {/* SDR Senior Badge */}
                                                        <div className="flex items-center gap-2 px-3 py-1.5 rounded-lg bg-gradient-to-r from-amber-500/20 to-orange-500/20 border border-amber-500/30 text-amber-400 text-[10px] font-bold uppercase tracking-wider">
                                                            <Sparkles size={12} />
                                                            Gerada pelo Agente SDR Senior
                                                        </div>

                                                        {/* Message - Prominent Display */}
                                                        <div className="p-4 rounded-xl bg-white/10 border border-primary/30">
                                                            <p className="text-white text-sm leading-relaxed whitespace-pre-wrap">
                                                                "{draftMessage}"
                                                            </p>
                                                        </div>

                                                        {/* Reasoning (only if available) */}
                                                        {generatedReasoning && (
                                                            <div className="flex gap-2 text-gray-400 text-xs">
                                                                <span className="text-primary/60 shrink-0">üí°</span>
                                                                <p className="leading-relaxed italic">
                                                                    {generatedReasoning}
                                                                </p>
                                                            </div>
                                                        )}

                                                        {/* Regenerate Button */}
                                                        <button
                                                            onClick={generateAISuggestion}
                                                            disabled={generatingReply}
                                                            className="w-full mt-2 py-2.5 rounded-lg bg-gradient-to-r from-amber-500/20 to-orange-500/20 hover:from-amber-500/30 hover:to-orange-500/30 border border-amber-500/30 text-xs font-semibold text-amber-300 hover:text-amber-200 transition-all flex justify-center items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed"
                                                        >
                                                            {generatingReply ? (
                                                                <>
                                                                    <Loader2 size={14} className="animate-spin" />
                                                                    {isIcebreaker ? 'Gerando Icebreaker...' : 'Gerando Resposta...'}
                                                                </>
                                                            ) : (
                                                                <>
                                                                    <Sparkles size={14} />
                                                                    {isIcebreaker ? 'Gerar Novo Icebreaker' : 'Gerar Nova Resposta'}
                                                                </>
                                                            )}
                                                        </button>

                                                        {/* Use in Chat Button */}
                                                        <button
                                                            onClick={() => {
                                                                setNewMessage(draftMessage)
                                                                setSelectedSuggestionIdx(0)
                                                            }}
                                                            className="w-full py-2.5 rounded-lg bg-primary hover:bg-primary/80 text-white text-xs font-bold shadow-lg shadow-primary/20 transition-all flex justify-center items-center gap-2"
                                                        >
                                                            <Check size={14} />
                                                            Usar no Chat
                                                        </button>
                                                    </>
                                                )
                                            }

                                            // Default: Empty state ‚Üí show generate button
                                            return (
                                                <div className="text-center py-6">
                                                    <p className="text-sm text-gray-400 mb-5">
                                                        {isIcebreaker
                                                            ? 'Nenhuma conversa iniciada com este lead.'
                                                            : 'Clique para gerar uma sugest√£o de resposta com IA.'}
                                                    </p>
                                                    <button
                                                        onClick={generateAISuggestion}
                                                        disabled={generatingReply}
                                                        className="w-full py-3 rounded-lg bg-gradient-to-r from-amber-500/20 to-orange-500/20 hover:from-amber-500/30 hover:to-orange-500/30 border border-amber-500/30 text-sm font-semibold text-amber-300 hover:text-amber-200 transition-all flex justify-center items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed"
                                                    >
                                                        {generatingReply ? (
                                                            <>
                                                                <Loader2 size={14} className="animate-spin" />
                                                                {isIcebreaker ? 'Gerando Icebreaker...' : 'Gerando Resposta...'}
                                                            </>
                                                        ) : (
                                                            <>
                                                                <Sparkles size={14} />
                                                                {isIcebreaker ? 'Gerar Icebreaker' : 'Gerar Resposta'}
                                                            </>
                                                        )}
                                                    </button>
                                                </div>
                                            )
                                        })()}
                                    </div>
                                </div>
                            </>
                        ) : (
                            <div className="bg-[#0d0d0d] rounded-2xl border border-white/10 p-8 text-center text-gray-400 text-sm h-40 flex items-center justify-center">
                                Contexto do lead aparecer√° aqui.
                            </div>
                        )}
                    </div>
                </div>
            )}
        </div>
    )
}

export default SalesInboxPage

```

## File: src\pages\SystemInfoPage.jsx
```javascript
import React from 'react'
import { RefreshCw, History, Info, Server, ShieldCheck, Activity } from 'lucide-react'

const SystemInfoPage = () => {
    return (
        <div className="p-8 max-w-5xl mx-auto space-y-8 animate-fade-in-up">

            {/* Header */}
            <div className="flex flex-col gap-2 mb-8">
                <h1 className="text-3xl font-bold text-slate-900 flex items-center gap-3">
                    <Info className="text-blue-600" size={32} />
                    Informa√ß√µes do Sistema
                </h1>
                <p className="text-slate-500 text-lg">
                    Entenda como o Link&Lead opera seus processos de sincroniza√ß√£o e seguran√ßa.
                </p>
            </div>

            {/* SYNC STATUS SECTION */}
            <div className="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
                <div className="px-8 py-6 border-b border-slate-100 bg-slate-50/50 flex items-center gap-3">
                    <Activity size={20} className="text-slate-500" />
                    <h2 className="text-xl font-bold text-slate-800">Status da Sincroniza√ß√£o</h2>
                </div>

                <div className="p-8 grid gap-8 md:grid-cols-2">

                    {/* Block 1: Real-time Sync */}
                    <div className="flex flex-col gap-4 p-6 rounded-xl bg-green-50/50 border border-green-100/50 hover:shadow-md transition-shadow">
                        <div className="w-12 h-12 rounded-full bg-green-100 text-green-600 flex items-center justify-center shadow-sm">
                            <RefreshCw size={24} className="animate-spin-slow" />
                        </div>
                        <div>
                            <h3 className="text-lg font-bold text-slate-900 mb-2 flex items-center gap-2">
                                üü¢ Sincroniza√ß√£o em Tempo Real (O "Rep√≥rter")
                            </h3>
                            <p className="text-slate-600 leading-relaxed">
                                "Para manter suas conversas fluindo, o sistema verifica novas mensagens automaticamente v√°rias vezes ao dia. Assim que seu lead responder no LinkedIn, a mensagem aparecer√° na plataforma e a IA analisar√° o contexto imediato para sugerir a pr√≥xima a√ß√£o. (Janela de leitura: √öltimas 50 mensagens)."
                            </p>
                        </div>
                    </div>

                    {/* Block 2: History Import */}
                    <div className="flex flex-col gap-4 p-6 rounded-xl bg-amber-50/50 border border-amber-100/50 hover:shadow-md transition-shadow">
                        <div className="w-12 h-12 rounded-full bg-amber-100 text-amber-600 flex items-center justify-center shadow-sm">
                            <History size={24} />
                        </div>
                        <div>
                            <h3 className="text-lg font-bold text-slate-900 mb-2 flex items-center gap-2">
                                üü° Importa√ß√£o de Hist√≥rico (O "Arque√≥logo")
                            </h3>
                            <p className="text-slate-600 leading-relaxed">
                                "Para garantir que a IA conhe√ßa seu cliente a fundo, ao cadastrar um novo lead, iniciamos uma varredura segura para recuperar o hist√≥rico de conversas antigas (at√© 1 ano). Isso permite que o sistema entenda dores passadas e negocia√ß√µes anteriores. (Execu√ß√£o √∫nica no cadastro)."
                            </p>
                        </div>
                    </div>

                </div>
            </div>

            {/* SERVER SECTION */}
            <div className="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
                <div className="px-8 py-6 border-b border-slate-100 bg-slate-50/50 flex items-center gap-3">
                    <Server size={20} className="text-slate-500" />
                    <h2 className="text-xl font-bold text-slate-800">Infraestrutura & Seguran√ßa</h2>
                </div>
                <div className="p-8">
                    <div className="flex gap-4 items-start">
                        <div className="mt-1">
                            <ShieldCheck size={24} className="text-indigo-600" />
                        </div>
                        <div>
                            <h3 className="text-lg font-bold text-slate-900 mb-2">Dados e Privacidade</h3>
                            <p className="text-slate-600 leading-relaxed max-w-2xl">
                                Todos os dados de leads e mensagens s√£o processados em servidores seguros. Utilizamos conex√µes criptografadas (SSL) para toda a comunica√ß√£o com o LinkedIn e gateways de pagamento. Seus dados nunca s√£o compartilhados com terceiros.
                            </p>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    )
}

export default SystemInfoPage

```

## File: src\services\api.js
```javascript

export const generateContent = async (cliente, tema, publico, clientData = null, imageUrl = null) => {
    try {
        // Construct rich payload with briefing data if available
        const payload = {
            cliente,
            tema,
            publico,
            imageUrl, // Pass the uploaded image URL
            // If clientData exists, inject its fields
            ...(clientData && {
                clientId: clientData.id, // Explicit ID for DB relation
                resumo_negocio: clientData.description,
                tom_de_voz: clientData.tone_of_voice,
                dores: clientData.pain_points
            })
        }

        const response = await fetch('https://n8n-n8n-start.kfocge.easypanel.host/webhook/create-post-workflow', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(payload),
        })

        if (!response.ok) {
            throw new Error('Erro ao gerar conte√∫do')
        }

        return await response.json()
    } catch (error) {
        console.error('Error generating content:', error)
        throw error
    }
}

```

## File: src\services\supabaseClient.js
```javascript

import { createClient } from '@supabase/supabase-js'

const supabaseUrl = import.meta.env.VITE_SUPABASE_URL
const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY

export const supabase = createClient(supabaseUrl, supabaseAnonKey)

```

